<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Esplacnolog√≠a - Prada Final</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #27ae60;
            --success: #2ecc71;
            --error: #e74c3c;
            --bg: #f0f4f1;
            --sidebar-w: 130px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
        }

        /* √çndice lateral en 3 columnas */
        #sidebar {
            width: var(--sidebar-w);
            background: var(--primary);
            height: 100vh;
            position: fixed;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-header {
            color: white;
            text-align: center;
            padding: 10px 5px;
            font-size: 0.75em;
            font-weight: bold;
            border-bottom: 1px solid #34495e;
        }

        .nav-container {
            flex-grow: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            padding: 10px;
            align-content: start;
        }

        .nav-dot {
            aspect-ratio: 1;
            background: #34495e;
            color: white;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.75em;
            transition: 0.2s;
        }

        .nav-dot:hover { background: var(--accent); }
        .nav-dot.answered { background: var(--success); }
        .nav-dot.marked { border: 2px solid #f1c40f; color: #f1c40f; }

        .restart-tab {
            padding: 15px 0;
            background: #1a252f;
            color: #f1c40f;
            text-align: center;
            cursor: pointer;
            font-size: 1.2em;
            border-top: 1px solid #34495e;
        }

        #main-content {
            margin-left: calc(var(--sidebar-w) + 20px);
            padding: 30px;
            width: 100%;
            max-width: 850px;
        }

        .question-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            position: relative;
            border-left: 5px solid var(--accent);
        }

        .mark-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 20px;
            color: #ccc;
        }
        .mark-btn.active { color: #f1c40f; }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .option {
            padding: 12px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            background: #fff;
        }

        .option:hover:not(.disabled) { border-color: var(--accent); background: #f9fffb; }
        .option.correct { background: #d4edda; border-color: var(--success); color: #155724; }
        .option.incorrect { background: #f8d7da; border-color: var(--error); color: #721c24; }
        .option.disabled { cursor: not-allowed; }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            font-size: 0.95em;
            background: #f8f9fa;
            border-left: 4px solid var(--accent);
        }

        #results-area {
            display: none;
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            padding: 14px;
            border: none;
            border-radius: 8px;
            background: var(--accent);
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-finish { background: var(--primary); margin-bottom: 30px; width: 100%; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="nav-header">ESPLACNO</div>
    <div class="nav-container" id="nav-dots"></div>
    <div class="restart-tab" onclick="showResults()" title="Finalizar y Reiniciar">üîÑ</div>
</div>

<div id="main-content">
    <h1>Esplacnolog√≠a - Examen Final Completo</h1>
    <button class="btn-finish" onclick="showResults()">Finalizar Cuestionario</button>
    
    <div id="results-area">
        <h2>Resultados</h2>
        <p id="score-text" style="font-size: 1.4rem;"></p>
        <div class="btn-group">
            <button onclick="restartQuiz('all')">Repetir Todo</button>
            <button onclick="restartQuiz('failed')">Repetir Falladas</button>
            <button onclick="restartQuiz('marked')">Repetir Marcadas</button>
            <button onclick="restartQuiz('failed-marked')">Falladas + Marcadas</button>
        </div>
    </div>

    <div id="quiz-container"></div>
</div>

<script>
    const rawQuestions = [
        { id: 1, q: "Sobre el p√°ncreas relacione qu√© porci√≥n se relaciona ventralmente con la cara posterior del est√≥mago", options: ["cuerpo", "proceso unciforme", "cabeza", "cola"], correct: 0, r: "El cuerpo del p√°ncreas forma parte del lecho g√°strico, separado por la bolsa omental." },
        { id: 2, q: "En la papila duodenal menor drena", options: ["El conducto pancreatico accesorio de Santorini", "El conducto col√©doco", "El conducto de Wirsung", "La ampolla hepatopancre√°tica"], correct: 0, r: "El conducto accesorio drena habitualmente en la papila menor, situada superior a la mayor." },
        { id: 3, q: "Se√±ale cu√°l de las siguientes estructuras no se encuentra en el mediastino posterior", options: ["nervio fr√©nico", "conducto tor√°cico", "venas √°cigos", "es√≥fago"], correct: 0, r: "El nervio fr√©nico transcurre por el mediastino medio." },
        { id: 4, q: "El estrechamiento broncoa√≥rtico del es√≥fago se produce por", options: ["el cruce con el bronquio principal izquierdo y el arco a√≥rtico", "el cruce con la aorta ascendente", "el cruce con el bronquio principal derecho", "el cart√≠lago cricoides"], correct: 0, r: "Es el segundo estrechamiento fisiol√≥gico del es√≥fago." },
        { id: 5, q: "Qu√© elemento no forma parte del √°rbol bronquial", options: ["tr√°quea", "bronquiolos terminales", "bronquios segmentarios", "bronquios lobares"], correct: 0, r: "La tr√°quea es el conducto previo a la formaci√≥n del √°rbol bronquial propiamente dicho." },
        { id: 6, q: "Cu√°l de las siguientes afirmaciones sobre los pulmones es falsa", options: ["el pulm√≥n izquierdo tiene tres l√≥bulos", "la base descansa sobre el diafragma", "el hilio se encuentra en la cara mediast√≠nica", "el pulm√≥n derecho tiene dos fisuras"], correct: 0, r: "El pulm√≥n izquierdo solo tiene dos l√≥bulos (superior e inferior)." },
        { id: 7, q: "El ligamento pulmonar es una dependencia de", options: ["la pleura", "el peritoneo", "el pericardio", "la fascia endotor√°cica"], correct: 0, r: "Es una reflexi√≥n de la pleura mediast√≠nica en el hilio." },
        { id: 8, q: "La cara posterior del coraz√≥n est√° formada principalmente por", options: ["atrio (aur√≠cula) izquierdo", "ventr√≠culo derecho", "atrio derecho", "ventr√≠culo izquierdo"], correct: 0, r: "El atrio izquierdo forma la base del coraz√≥n." },
        { id: 9, q: "La v√°lvula tric√∫spide se sit√∫a entre", options: ["atrio derecho y ventr√≠culo derecho", "atrio izquierdo y ventr√≠culo izquierdo", "ventr√≠culo izquierdo y aorta", "ventr√≠culo derecho y pulm√≥n"], correct: 0, r: "Comunica las c√°maras derechas del coraz√≥n." },
        { id: 10, q: "La arteria coronaria derecha suele originar la arteria", options: ["interventricular posterior", "interventricular anterior", "circunfleja", "marginal izquierda"], correct: 0, r: "En la mayor√≠a de los casos (dominancia derecha) origina la descendente posterior." },
        { id: 11, q: "El nodo sinoatrial (sinusal) se localiza en", options: ["la pared del atrio derecho", "el tabique interventricular", "el atrio izquierdo", "el ventr√≠culo derecho"], correct: 0, r: "Se sit√∫a cerca de la desembocadura de la vena cava superior." },
        { id: 12, q: "El conducto tor√°cico desemboca habitualmente en", options: ["√°ngulo venoso yugulosubclavio izquierdo", "vena cava superior", "atrio derecho", "vena √°cigos"], correct: 0, r: "Recoge la linfa de la mayor parte del cuerpo." },
        { id: 13, q: "El tronco cel√≠aco da origen a las arterias", options: ["g√°strica izquierda, espl√©nica y hep√°tica com√∫n", "mesent√©rica superior e inferior", "renales y gonadales", "lumbares"], correct: 0, r: "Son las tres ramas principales del tronco cel√≠aco." },
        { id: 14, q: "Cu√°l de estos √≥rganos es retroperitoneal primario", options: ["ri√±√≥n", "est√≥mago", "bazo", "yeyuno"], correct: 0, r: "Los ri√±ones se sit√∫an detr√°s del peritoneo durante todo el desarrollo." },
        { id: 15, q: "El epipl√≥n (omento) menor se extiende entre", options: ["h√≠gado, est√≥mago y duodeno", "est√≥mago y colon transverso", "est√≥mago y bazo", "h√≠gado y diafragma"], correct: 0, r: "Contiene los ligamentos hepatog√°strico y hepatoduodenal." },
        { id: 16, q: "La tr√≠ada portal en el ligamento hepatoduodenal consta de", options: ["vena porta, arteria hep√°tica propia y conducto col√©doco", "vena cava, aorta y conducto tor√°cico", "arteria mesent√©rica, vena mesent√©rica y nervio vago", "conducto c√≠stico, conducto hep√°tico y ves√≠cula"], correct: 0, r: "Es la unidad funcional que entra al hilio hep√°tico." },
        { id: 17, q: "El esf√≠nter de Oddi se localiza en", options: ["la papila duodenal mayor", "el cardias", "el p√≠loro", "la uni√≥n ileocecal"], correct: 0, r: "Regula el paso de bilis y jugo pancre√°tico al duodeno." },
        { id: 18, q: "La arteria mesent√©rica superior irriga habitualmente hasta", options: ["los 2/3 proximales del colon transverso", "el est√≥mago", "el recto", "el colon descendente"], correct: 0, r: "Irriga el intestino derivado del intestino medio." },
        { id: 19, q: "Las tenias del colon son", options: ["bandas de m√∫sculo liso longitudinal", "pliegues de la mucosa", "ap√©ndices grasos", "dilataciones de la pared"], correct: 0, r: "Su contracci√≥n forma las haustras del colon." },
        { id: 20, q: "La vena porta se forma por la uni√≥n de", options: ["vena mesent√©rica superior y vena espl√©nica", "venas hep√°ticas", "venas renales", "vena cava y vena √°cigos"], correct: 0, r: "Suele recibir tambi√©n a la mesent√©rica inferior." },
        { id: 21, q: "El l√≥bulo caudado del h√≠gado se sit√∫a entre", options: ["la fisura del ligamento venoso y la vena cava inferior", "el l√≥bulo derecho y el izquierdo", "la ves√≠cula biliar y el ligamento redondo", "el bazo y el est√≥mago"], correct: 0, r: "Es funcionalmente independiente de los l√≥bulos derecho e izquierdo." },
        { id: 22, q: "La ves√≠cula biliar se relaciona inferiormente con", options: ["el duodeno y el colon transverso", "el est√≥mago", "el ri√±√≥n derecho", "el bazo"], correct: 0, r: "Se sit√∫a en la fosa de la cara visceral del h√≠gado." },
        { id: 23, q: "El bazo se sit√∫a en", options: ["hipocondrio izquierdo", "epigastrio", "hipocondrio derecho", "fosa il√≠aca izquierda"], correct: 0, r: "Se relaciona con las costillas 9¬™ a 11¬™." },
        { id: 24, q: "La unidad funcional del ri√±√≥n es", options: ["la nefrona", "el c√°liz", "la pir√°mide", "el glom√©rulo √∫nicamente"], correct: 0, r: "Compuesta por corp√∫sculo y sistema tubular." },
        { id: 25, q: "El ur√©ter cruza por delante de", options: ["los vasos il√≠acos", "la arteria aorta", "la vena cava inferior", "los vasos gonadales"], correct: 0, r: "Punto de estrechamiento importante." },
        { id: 26, q: "La gl√°ndula suprarrenal derecha tiene forma", options: ["piramidal", "semilunar", "esf√©rica", "aplanada"], correct: 0, r: "A diferencia de la izquierda que es m√°s semilunar." },
        { id: 27, q: "El detrusor es el m√∫sculo de", options: ["la vejiga urinaria", "el √∫tero", "el est√≥mago", "el recto"], correct: 0, r: "Su contracci√≥n permite el vaciado vesical." },
        { id: 28, q: "La uretra masculina m√°s corta es la porci√≥n", options: ["membranosa", "prost√°tica", "esponjosa", "preprost√°tica"], correct: 0, r: "Atraviesa el perin√© profundo." },
        { id: 29, q: "Los conductos eyaculadores desembocan en", options: ["la uretra prost√°tica", "la vejiga", "el test√≠culo", "el conducto deferente"], correct: 0, r: "Lo hacen a nivel del col√≠culo seminal." },
        { id: 30, q: "La t√∫nica albug√≠nea envuelve a", options: ["el test√≠culo", "la pr√≥stata", "la ves√≠cula seminal", "el ur√©ter"], correct: 0, r: "Es una c√°psula fibrosa densa." },
        { id: 31, q: "El √∫tero se sit√∫a normalmente en", options: ["anteversoflexi√≥n", "retroversi√≥n", "anteposici√≥n √∫nicamente", "retroflexi√≥n"], correct: 0, r: "Inclinado hacia adelante sobre la vejiga." },
        { id: 32, q: "Las trompas uterinas se abren a la cavidad peritoneal por", options: ["el ostium abdominal (infund√≠bulo)", "el istmo", "la porci√≥n intramural", "la ampolla"], correct: 0, r: "Permite la captaci√≥n del ovocito." },
        { id: 33, q: "El ligamento ancho del √∫tero es", options: ["un pliegue de peritoneo", "un ligamento fibroso", "un m√∫sculo", "una fascia"], correct: 0, r: "Contiene a las trompas y vasos." },
        { id: 34, q: "La arteria uterina cruza al ur√©ter", options: ["por delante y por arriba", "por detr√°s", "por debajo", "medialmente sin cruzarlo"], correct: 0, r: "Relaci√≥n quir√∫rgica cr√≠tica ('agua bajo el puente')." },
        { id: 35, q: "El recto comienza a nivel de", options: ["S3", "L5", "S1", "Coccix"], correct: 0, r: "Continuaci√≥n del colon sigmoide." },
        { id: 36, q: "El canal anal presenta internamente", options: ["columnas anales de Morgagni", "tenias", "haustras", "villi"], correct: 0, r: "Pliegues verticales de mucosa." },
        { id: 37, q: "Cu√°l de estos no es un componente del cord√≥n esperm√°tico", options: ["nervio ilioinguinal", "conducto deferente", "arteria testicular", "plexo pampiniforme"], correct: 0, r: "El nervio ilioinguinal acompa√±a al cord√≥n pero no va dentro de sus fascias." },
        { id: 38, q: "El mediastino medio contiene", options: ["el coraz√≥n y pericardio", "el es√≥fago", "la tr√°quea √∫nicamente", "la vena √°cigos"], correct: 0, r: "Es la porci√≥n central del mediastino inferior." },
        { id: 39, q: "La pleura parietal se inerva por", options: ["nervios intercostales y fr√©nicos", "nervio vago", "plexo pulmonar", "nervios espl√°cnicos"], correct: 0, r: "Es sensible al dolor a diferencia de la visceral." },
        { id: 40, q: "El hilio pulmonar derecho tiene la arteria pulmonar", options: ["anterior al bronquio", "superior al bronquio", "posterior al bronquio", "inferior al bronquio"], correct: 0, r: "En el izquierdo es superior." },
        { id: 41, q: "Las venas pulmonares llevan sangre", options: ["oxigenada al atrio izquierdo", "carboxigenada al pulm√≥n", "oxigenada al ventr√≠culo derecho", "carboxigenada al atrio derecho"], correct: 0, r: "Excepci√≥n a la regla general de venas." },
        { id: 42, q: "La fosa oval se encuentra en", options: ["el tabique interatrial", "el ventr√≠culo derecho", "la aorta", "el tabique interventricular"], correct: 0, r: "Remanente del foramen oval fetal." },
        { id: 43, q: "El es√≥fago atraviesa el diafragma a nivel de", options: ["T10", "T8", "T12", "L1"], correct: 0, r: "Junto con los nervios vagos." },
        { id: 44, q: "El fondo del est√≥mago se sit√∫a", options: ["superior al cardias", "inferior al p√≠loro", "medial al cuerpo", "en la curvatura menor"], correct: 0, r: "Suele contener aire (burbuja g√°strica)." },
        { id: 45, q: "El conducto c√≠stico une", options: ["ves√≠cula biliar y conducto hep√°tico com√∫n", "h√≠gado y duodeno", "p√°ncreas y ves√≠cula", "est√≥mago e h√≠gado"], correct: 0, r: "Forma el conducto col√©doco." },
        { id: 46, q: "La fascia de Gerota envuelve a", options: ["el ri√±√≥n", "el h√≠gado", "el bazo", "el coraz√≥n"], correct: 0, r: "Es la fascia renal." },
        { id: 47, q: "La arteria mesent√©rica inferior se origina a nivel de", options: ["L3", "L1", "T12", "L5"], correct: 0, r: "Irriga el intestino posterior." },
        { id: 48, q: "La arteria del conducto deferente es rama de", options: ["A umbilical", "Il√≠aca interna", "Iliaca externa", "obturatriz"], correct: 0, r: "Nace de la porci√≥n permeable de la umbilical." },
        { id: 49, q: "En el bazo, una afirmaci√≥n es falsa", options: ["el peritoneo no lo envuelve completamente", "En la cara visceral se imprimen el est√≥mago y ri√±√≥n izquierdo", "se sit√∫a bajo la c√∫pula diafragm√°tica izquierda", "Recibe un √∫nico grueso tronco arterial del tronco celiaco"], correct: 0, r: "Es un √≥rgano intraperitoneal envuelto casi totalmente." },
        { id: 50, q: "Los ligamentos frenoc√≥licos, se√±ale la incorrecta", options: ["fijan desde las fascias de Toldt hasta los m√∫sculos cuadrados de los lomos", "Fijan los √°ngulos c√≥licos hasta la fascia del m√∫sculo diafragma", "Se produce por pliegues peritoneales en los √°ngulos c√≥licos", "Se encuentran en ambos hipocondrios"], correct: 0, r: "Unen los √°ngulos del colon al diafragma." }
    ];

    let userAnswers = {};
    let markedQuestions = new Set();
    let currentPool = [];

    function preparePool(questions) {
        return questions.map(q => {
            const options = q.options.map((text, i) => ({ text, isCorrect: i === q.correct }));
            return { ...q, options };
        });
    }

    const fullPool = preparePool(rawQuestions);

    function initQuiz(questions) {
        const container = document.getElementById('quiz-container');
        const nav = document.getElementById('nav-dots');
        container.innerHTML = '';
        nav.innerHTML = '';

        questions.forEach((q, index) => {
            const dot = document.createElement('div');
            dot.className = `nav-dot ${markedQuestions.has(q.id) ? 'marked' : ''}`;
            dot.id = `dot-${q.id}`;
            dot.innerHTML = index + 1;
            dot.onclick = () => document.getElementById(`q-card-${q.id}`).scrollIntoView({behavior: 'smooth'});
            nav.appendChild(dot);

            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-card-${q.id}`;
            
            const markBtn = document.createElement('span');
            markBtn.className = `mark-btn ${markedQuestions.has(q.id) ? 'active' : ''}`;
            markBtn.innerHTML = '‚òÖ';
            markBtn.onclick = () => toggleMark(q.id, markBtn);
            
            const qText = document.createElement('h3');
            qText.innerHTML = `${index + 1}. ${q.q}`;
            
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options-container';
            const shuffled = [...q.options].sort(() => Math.random() - 0.5);
            
            shuffled.forEach(opt => {
                const optDiv = document.createElement('div');
                optDiv.className = 'option';
                optDiv.innerHTML = opt.text;
                optDiv.onclick = () => handleAnswer(q.id, opt, optDiv, card);
                optionsDiv.appendChild(optDiv);
            });

            const feedback = document.createElement('div');
            feedback.className = 'feedback';
            card.appendChild(markBtn);
            card.appendChild(qText);
            card.appendChild(optionsDiv);
            card.appendChild(feedback);
            container.appendChild(card);
        });
    }

    function toggleMark(id, btn) {
        if (markedQuestions.has(id)) {
            markedQuestions.delete(id);
            btn.classList.remove('active');
            document.getElementById(`dot-${id}`).classList.remove('marked');
        } else {
            markedQuestions.add(id);
            btn.classList.add('active');
            document.getElementById(`dot-${id}`).classList.add('marked');
        }
    }

    function handleAnswer(qId, option, el, card) {
        if (userAnswers[qId]) return;
        userAnswers[qId] = { correct: option.isCorrect, id: qId };
        const allOpts = card.querySelectorAll('.option');
        allOpts.forEach(o => o.classList.add('disabled'));
        const fb = card.querySelector('.feedback');
        fb.style.display = 'block';
        const qData = fullPool.find(f => f.id === qId);
        fb.innerHTML = `<strong>${option.isCorrect ? 'Correcto' : 'Incorrecto'}</strong>: ${qData.r}`;
        el.classList.add(option.isCorrect ? 'correct' : 'incorrect');
        if (!option.isCorrect) {
            const correctText = qData.options.find(o => o.isCorrect).text;
            allOpts.forEach(o => { if (o.innerHTML === correctText) o.classList.add('correct'); });
        }
        document.getElementById(`dot-${qId}`).classList.add('answered');
    }

    function showResults() {
        const total = currentPool.length;
        const correctas = Object.values(userAnswers).filter(a => a.correct).length;
        document.getElementById('quiz-container').style.display = 'none';
        document.querySelector('.btn-finish').style.display = 'none';
        document.getElementById('results-area').style.display = 'block';
        document.getElementById('score-text').innerHTML = `Has acertado <strong>${correctas}</strong> de <strong>${total}</strong> preguntas.`;
        window.scrollTo(0,0);
    }

    function restartQuiz(mode) {
        let next = [];
        if (mode === 'all') next = [...fullPool];
        else if (mode === 'failed') next = fullPool.filter(q => userAnswers[q.id] && !userAnswers[q.id].correct);
        else if (mode === 'marked') next = fullPool.filter(q => markedQuestions.has(q.id));
        else if (mode === 'failed-marked') next = fullPool.filter(q => (userAnswers[q.id] && !userAnswers[q.id].correct) || markedQuestions.has(q.id));

        if (next.length === 0) { alert("No hay preguntas en esta selecci√≥n."); return; }
        userAnswers = {};
        currentPool = next;
        document.getElementById('quiz-container').style.display = 'block';
        document.querySelector('.btn-finish').style.display = 'block';
        document.getElementById('results-area').style.display = 'none';
        initQuiz(next);
        window.scrollTo(0,0);
    }

    currentPool = [...fullPool];
    initQuiz(currentPool);
</script>
</body>
</html>