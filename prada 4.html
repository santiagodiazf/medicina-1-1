<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Anatomía - Tema 16: Pulmones y Pleuras</title>
    <style>
        :root {
            --primary-color: #16a085; /* Verde azulado para Pulmones */
            --secondary-color: #1abc9c;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --background-color: #f0fdfa;
            --card-background: #ffffff;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #bdc3c7;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 15px;
            text-align: center;
            background-color: #1a252f;
            border-bottom: 1px solid #34495e;
        }

        .sidebar-header h2 { margin: 0; font-size: 1.1rem; }
        
        .sidebar-controls {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .sidebar-stats { font-size: 0.9rem; color: #bdc3c7; }

        .finish-btn-side {
            background-color: #e74c3c;
            border: none;
            border-radius: 4px;
            color: white;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            width: 80%;
            transition: 0.2s;
        }
        .finish-btn-side:hover { background-color: #c0392b; }

        .sidebar-nav {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 5px;
            align-content: start;
        }

        .nav-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 4px;
            background-color: #34495e;
            color: white;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: 0.2s;
        }

        .nav-btn:hover { background-color: var(--secondary-color); }
        .nav-btn.correct { background-color: var(--success-color); }
        .nav-btn.incorrect { background-color: var(--error-color); }
        .nav-btn.marked { border: 2px solid #f1c40f; color: #f1c40f; font-weight: bold; }

        /* MAIN CONTENT */
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 30px;
            scroll-behavior: smooth;
        }

        .container { max-width: 900px; margin: 0 auto; }

        h1 { color: var(--primary-color); border-bottom: 3px solid var(--secondary-color); padding-bottom: 10px; }

        .question-card {
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--secondary-color);
            scroll-margin-top: 20px;
        }

        .question-header-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .bookmark-btn {
            background: none;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            cursor: pointer;
            color: #95a5a6;
            padding: 2px 8px;
        }
        .bookmark-btn.active { color: #f39c12; border-color: #f39c12; background: #fef9e7; }

        .question-text { font-size: 1.1rem; color: #2c3e50; margin-bottom: 15px; font-weight: 600; line-height: 1.4; }

        .options-grid { display: flex; flex-direction: column; gap: 8px; }

        .option-btn {
            padding: 10px 15px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            text-align: left;
            transition: 0.2s;
            font-size: 1rem;
        }

        .option-btn:hover:not(.disabled) { background-color: #e0f2f1; border-color: var(--primary-color); }
        
        .option-btn.correct { background-color: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.incorrect { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }
        .option-btn.disabled { cursor: default; opacity: 0.7; }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
            font-size: 0.9rem;
        }
        .feedback.show { display: block; }
        .feedback.success { background-color: #e8f8f5; color: #0e6251; }
        .feedback.error { background-color: #fdedec; color: #78281f; }

        /* RESULT PANEL */
        .results-panel {
            background: #2c3e50;
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-top: 40px;
            display: none;
            margin-bottom: 50px;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            background: var(--secondary-color);
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: transform 0.1s;
        }
        .action-btn:hover { background: #16a085; transform: scale(1.05); }
        .action-btn:active { transform: scale(0.95); }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .sidebar { width: 100%; height: 160px; border-right: none; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
            .sidebar-nav { grid-template-columns: repeat(8, 1fr); max-height: 150px; }
            .main-content { overflow: visible; }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2>Tema 16: Pulmones</h2>
        <div class="sidebar-controls">
            <div class="sidebar-stats"><span id="progress-text">0/125</span> respondidas</div>
            <button class="finish-btn-side" onclick="showResults(true)">Finalizar Test</button>
        </div>
    </div>
    <div id="sidebar-nav" class="sidebar-nav"></div>
</div>

<div class="main-content">
    <div class="container">
        <h1>Pulmones y Pleuras 

[Image of human lungs anatomy]
</h1>
        <div id="questions-list"></div>
        
        <div id="results-panel" class="results-panel">
            <h2>Test Finalizado</h2>
            <p id="score-text" style="font-size: 1.4rem; margin: 15px 0;"></p>
            <div class="action-buttons">
                <button class="action-btn" onclick="resetQuiz('all')">Repetir Todo</button>
                <button class="action-btn" onclick="resetQuiz('wrong')">Repetir Falladas</button>
                <button class="action-btn" onclick="resetQuiz('marked')">Repetir Marcadas</button>
                <button class="action-btn" onclick="resetQuiz('wrong_marked')">Falladas + Marcadas</button>
            </div>
        </div>
    </div>
</div>

<script>
    // BASE DE DATOS - TEMA 16
    const dbQuestions = [
        { id: 1, original: "1", q: "Acerca de la pleura visceral señale la opción incorrecta:", options: ["Tapiza la cara externa del parénquima pulmonar", "Tapiza la cara inferior de la base del pulmón", "Está inervada por los nervios intercostales", "Se introduce penetrando en las cisuras pulmonares"], correct: 2, exp: "La pleura visceral tiene inervación autónoma (no sensitiva al dolor somático). Los intercostales inervan la pleura parietal costal." },
        { id: 2, original: "Extra", q: "el bronquio principal izquierdo elige la correcta", options: ["Superiormente lo cruza el cayado aortico", "Es más vertical que el derecho", "Se divide antes de entrar al hilio", "Lo cruza la vena ácigos"], correct: 0, exp: "El cayado de la aorta cabalga sobre el bronquio principal izquierdo." },
        { id: 3, original: "Extra", q: "Los linfáticos pulmonares derechos van a drenar mayoritariamente sobre:", options: ["Vena subclavia derecha", "Sobre los ganglios mediastínicos contranaturales", "A los gánglios linfáticos pleurales esternocostales", "Junto al saco pericárdico, al plexo cardíaco"], correct: 0, exp: "Drenan hacia la gran vena linfática en el ángulo venoso derecho." },
        { id: 4, original: "Extra", q: "En el pedículo pulmonar derecho ¿Qué elemento apoya inmediatamente central (superior/craneal) al bronquio principal derecho?", options: ["Arteria pulmonar", "Esófago", "Arteria subclavia derecha", "Cayado de la vena ácigos"], correct: 3, exp: "El cayado de la vena ácigos cabalga sobre el pedículo pulmonar derecho." },
        { id: 5, original: "Extra", q: "Marque la opción correcta:", options: ["El pulmón derecho se divide en dos lóbulos", "El pulmón izquierdo es más pequeño que el derecho", "Las bases pulmonares están desprovistas de pleura visceral", "Los vértices pulmonares se extienden hacia la abertura superior del tórax"], correct: 1, exp: "El izquierdo es más pequeño por la presencia del corazón. Los vértices SOBRESALEN por la abertura superior." },
        { id: 6, original: "5", q: "Sobre la segmentación broncopulmonar:", options: ["El bronquio lobar superior derecho se divide en bronquios lobares apical, anterior y posterior", "A partir del bronquio lobar inferior derecho se originan simultáneamente todos los bronquios basales", "La porción caudal del bronquio lobar superior izquierdo da origen a los bronquios linguales", "El bronquio lobar medio da bronquios segmentarios para el pulmón izquierdo"], correct: 2, exp: "La língula depende del lobar superior izquierdo." },
        { id: 7, original: "6", q: "La cara interna del pulmón izquierdo se relaciona con:", options: ["Vena ácigos", "Aorta (cayado y descendente)", "Vena cava superior", "Vena cava inferior"], correct: 1, exp: "La aorta deja una impronta profunda en el pulmón izquierdo." },
        { id: 8, original: "7", q: "La cúpula pleural llega hasta:", options: ["El borde inferior de la clavícula", "3 cm por encima de la primera costilla (y clavícula)", "3 cm por encima del primer cartílago costal", "El nivel de la horquilla esternal"], correct: 1, exp: "Sobresale unos 2-3 cm por encima del tercio medial de la clavícula/1ª costilla." },
        { id: 9, original: "8", q: "¿Qué elemento se introduce en la profundidad de las fisuras que limitan los lóbulos pulmonares?", options: ["Pleura visceral", "Ligamento pulmonar", "Receso costomediastínico", "Pleura parietal"], correct: 0, exp: "La pleura visceral tapiza las cisuras interlobulares." },
        { id: 10, original: "9", q: "¿Cuál de los siguientes enunciados sobre la inervación de la pleura es incorrecto?", options: ["La pleura visceral se inerva desde el propio parénquima pulmonar (plexos pulmonares)", "La pleura parietal diafragmática se inerva por el nervio frénico", "La pleura parietal costal se inerva por los nervios intercostales", "La pleura parietal se inerva por los nervios bronquiales"], correct: 3, exp: "La parietal NO se inerva por nervios bronquiales, sino por somáticos (frénico/intercostales)." },
        { id: 11, original: "10", q: "Acerca de la pleura visceral, señale la opción correcta:", options: ["Está inervada por los nervios intercostales", "Tapiza la cara superior del músculo diafragma", "Se introduce penetrando en las cisuras pulmonares", "Tapiza la cara interna de la parrilla costal"], correct: 2, exp: "Es la única serosa que entra en las cisuras." },
        { id: 12, original: "11", q: "De los elementos del pedículo pulmonar, cuál se sitúa más ventralmente:", options: ["El bronquio principal", "Venas pulmonares (Vena pulmonar superior)", "Arterias pulmonares", "Arteria bronquial"], correct: 1, exp: "Las venas pulmonares superiores son los elementos más anteriores (ventrales)." },
        { id: 13, original: "12", q: "En el pedículo pulmonar derecho, qué elemento se apoya sobre el bronquio principal derecho:", options: ["Cayado de la vena ácigos", "Vena pulmonar", "Arteria subclavia derecha", "Esófago"], correct: 0, exp: "El arco de la ácigos." },
        { id: 14, original: "13", q: "En la segmentación de la vía aérea pulmonar, el bronquiolo se caracteriza por:", options: ["Se introduce en el fondo del receso costodiafragmático", "Se bifurca un bronquiolo para cada lóbulo pulmonar", "Solo se observan a nivel del hilio pulmonar", "Su pared no presenta anillos cartilaginosos"], correct: 3, exp: "Los bronquiolos carecen de cartílago en sus paredes." },
        { id: 15, original: "14", q: "La línea de reflexión de la pleura parietal para transformarse en pleura visceral, organiza un ligamento que tiene todas estas características, excepto una:", options: ["Se sitúa cranealmente con relación a la región del hilio pulmonar, alcanzando el ápex", "Se denomina ligamento pulmonar", "Se encuentra en la cara mediastínica de los pulmones", "Discurre caudalmente, desde el hilio a la base pulmonar"], correct: 0, exp: "El ligamento pulmonar desciende desde el hilio, no asciende al ápex." },
        { id: 16, original: "15", q: "La língula se relaciona sobre:", options: ["Esófago torácico", "Mediastino anterior", "La cara mediastínica del pulmón derecho", "Superficie esternocostal del corazón (ápex)"], correct: 3, exp: "La língula del pulmón izquierdo cubre el ápex del corazón." },
        { id: 17, original: "16", q: "La pleura parietal, señale la incorrecta:", options: ["Sus expansiones hacia los espacios intercostales crean los recesos o senos", "Se relaciona íntimamente con la primera costilla", "En su porción costal, se adhiere a través de la fascia endotorácica", "En su porción apical, forma la membrana suprapleural"], correct: 0, exp: "Los recesos no se forman hacia los espacios intercostales, sino en los ángulos de reflexión (ej. costodiafragmático)." },
        { id: 18, original: "17", q: "Sobre el ápex pulmonar, señale la respuesta incorrecta:", options: ["Los vasos subclavios señalan su huella al pasar por el borde anterior", "Se introduce en el espacio costomediastínico", "Alcanzan a relacionarse con los músculos escalenos medios", "Su cara medial se relaciona con el paquete vasculonervioso del cuello"], correct: 1, exp: "No se introduce en el receso costomediastínico, sobresale superiormente." },
        { id: 19, original: "18", q: "Sobre los bronquios principales, señale la opción correcta:", options: ["Tienen una estructura similar a la de la tráquea, pero sin cartílagos", "El bronquio principal izquierdo rechaza al esófago hacia la derecha (no lo rechaza, lo cruza)", "Se encuentran a nivel de T7 (Carina es T5)", "El bronquio principal izquierdo es más largo, sinuoso"], correct: 3, exp: "El izquierdo es más largo y horizontal." },
        { id: 20, original: "19", q: "El ápex pulmonar no se relaciona con:", options: ["Tronco venoso braquiocefálico izquierdo (está más medial/anterior)", "Músculos escalenos", "Vena subclavia", "Primera costilla"], correct: 0, exp: "La vena subclavia y arteria sí cruzan el ápex. El TVBCI está más alejado en el mediastino superior." },
        { id: 21, original: "20", q: "En el ápex pulmonar, no se marca la relación de qué estructura", options: ["Primera costilla", "Timo", "Arteria subclavia", "Vena subclavia"], correct: 1, exp: "El timo es anterior y medial, no deja impronta en el ápex propiamente dicho." },
        { id: 22, original: "21", q: "Los linfáticos pulmonares derechos van a drenar mayoritariamente sobre:", options: ["A la vena subclavia derecha (Gran vena linfática)", "Junto al saco pericárdico", "Sobre los ganglios mediastínicos contralaterales", "A los ganglios pleurales"], correct: 0, exp: "Repetida." },
        { id: 23, original: "22", q: "Los linfáticos pulmonares se sitúan", options: ["No poseen drenaje", "Junto a los bronquios principales (peribronquiales)", "Directamente ganglios mediastínicos", "Junto a ganglios pleurales"], correct: 1, exp: "Siguen el árbol bronquial." },
        { id: 24, original: "23", q: "La língula se relaciona con:", options: ["Superficie esternocostal del corazón", "Esófago", "Pulmón derecho", "Mediastino anterior"], correct: 0, exp: "Repetida." },
        { id: 25, original: "24", q: "Con respecto a los bronquios:", options: ["Son los elementos mas anteriores del pedículo (Falso, son las venas)", "Los nervios vagos pasan anteriores al hilio (Falso, posteriores)", "Los bronquios tienen una relación anterior directa con las venas pulmonares (Las venas son anteriores)", "A y C", "B y C", "Ninguna es cierta"], correct: 5, exp: "Las venas son anteriores, las arterias en medio/superior, bronquios posteriores. Vago posterior." },
        { id: 26, original: "25", q: "Con respecto a las pleuras:", options: ["La pleura que se relaciona directamente con la parrilla costal es la pleura visceral (Falso)", "La pleura parietal en el extremo superior se extiende por encima de la 1ª costilla", "Inferiormente llega justo al reborde costal", "Inferiormente llega a antepenúltima costilla"], correct: 1, exp: "La cúpula pleural sobrepasa la 1ª costilla." },
        { id: 27, original: "26", q: "De los elementos del pedículo pulmonar, cúal se sitúa más ventralmente.", options: ["Arteria bronquial", "Arteria pulmonar", "El bronquio principal", "Venas pulmonares"], correct: 3, exp: "Repetida: Venas pulmonares." },
        { id: 28, original: "27", q: "En el pedículo pulmonar derecho, qué elemento se apoya sobre el bronquio principal derecho.", options: ["Vena pulmonar", "Esófago", "Arteria subclavia", "Cayado de la vena ácigos"], correct: 3, exp: "Repetida: Ácigos." },
        { id: 29, original: "28", q: "Los elementos que componen el pediculo pulmonar son:", options: ["Venas, bronquios, arterias", "Venas, bronquios, linfáticos", "Venas, bronquios, arterias pulmonares/bronquiales, linfáticos y nervios", "Venas, bronquios, arterias bronquiales y linfáticos"], correct: 2, exp: "Incluye todos los elementos vasculares, aéreos, nerviosos y linfáticos." },
        { id: 30, original: "29", q: "Las arterias bronquiales son ramas de:", options: ["Aorta ascendente", "Aorta descendente (torácica)", "Tronco pulmonar", "Pulmonar derecha"], correct: 1, exp: "Ramas de la aorta torácica." },
        { id: 31, original: "30", q: "¿Cuantos lóbulos tiene el pulmón izquierdo?", options: ["Uno", "Dos", "Tres", "Cuatro"], correct: 1, exp: "Dos (Superior e Inferior)." },
        { id: 32, original: "31", q: "El bronquio fuente izquierdo se relaciona:", options: ["Por detrás con el nervio frénico (Falso, frénico es anterior)", "Por arriba con el callado de la vena ácigos (Falso, es el derecho)", "Por delante con la vena cava superior (Lejos)", "Por debajo con la vena pulmonar inferior (No, suele ser anterior/inferior, pero la relación clave es cayado aórtico arriba) - Revisión: El cayado AÓRTICO pasa por encima. El esófago por detrás. La arteria pulmonar cruza por delante y arriba."], correct: 4, exp: "Nota: Las opciones dadas son malas. A) Frénico es anterior. B) Ácigos es derecha. C) VCS es derecha. D) Vena pulmonar inferior es inferior. La opción más plausible por descarte anatómico sería D, aunque la relación clásica es el cayado aórtico arriba." },
        { id: 33, original: "32", q: "La arteria pulmonar izquierda es con respecto al bronquio", options: ["Sub bronquial", "Supra bronquial", "Retro bronquial", "Pre bronquial"], correct: 1, exp: "En el hilio izquierdo, la arteria se sitúa SUPERIOR (supra) al bronquio. (En el derecho es anterior/pre)." },
        { id: 34, original: "33", q: "Los segmentos del lóbulo superior del pulmón derecho son:", options: ["Lateral y medial", "Apicoposterior y anterior", "Apicoposterior y posterior", "Apical, anterior y posterior"], correct: 3, exp: "Apical (I), Posterior (II), Anterior (III)." },
        { id: 35, original: "34", q: "¿Que segmentos pulmonares izquierdos toman relación directa con el ventrículo izquierdo?", options: ["Apicodorsal", "Anterior", "Lingulares", "Inferior"], correct: 2, exp: "La língula (segmentos superior e inferior) se apoya sobre el corazón (VI)." },
        { id: 36, original: "35", q: "La serosa que recubre los pulmones se denomina:", options: ["Pericardio", "Peritoneo", "Pleura", "Mesenterio"], correct: 2, exp: "Pleura." },
        { id: 37, original: "36", q: "La vena ácigos desemboca en:", options: ["La vena cava superior", "Confluyente yugulo-subclavio", "Yugular interna", "Conducto torácico"], correct: 0, exp: "En la VCS." },
        { id: 38, original: "37", q: "Seleccione la opción verdadera:", options: ["Pleura costal inervada por pericardiofrénicas", "Pleura diafragmática irrigada por pericardiofrénicas y frénicas inferiores", "Pleura mediastínica irrigada por pericardiofrénica", "B y C", "Ninguna"], correct: 3, exp: "La arteria pericardiofrénica irriga la pleura mediastínica y la parte central de la diafragmática." },
        { id: 39, original: "38", q: "En el pulmón derecho la cisura oblicua:", options: ["Separa medio de superior", "Separa medio de inferior", "Separa superior de inferior (en la parte posterior) y medio de inferior (en la anterior)", "A y C", "B y C"], correct: 4, exp: "La cisura oblicua separa el lóbulo inferior de los otros dos (del superior arriba y del medio abajo)." },
        { id: 40, original: "39", q: "Cuál de las siguientes afirmaciones es verdadera:", options: ["En el pulmón derecho aparece la língula (Falso)", "Segmentos: base al hilio (Falso, vértice al hilio)", "Pulmón derecho: LI 5 segmentos, LS 3, LM 2 (Correcto: 5 basales, 3 sup, 2 med)", "Segmentos base fuera"], correct: 2, exp: "Distribución clásica: Derecho 3-2-5 (Total 10)." },
        { id: 41, original: "40", q: "Se relaciona con la cara anterior del pericardio:", options: ["Lóbulo inferior izquierdo", "Lóbulo superior derecho", "Língula (y borde anterior pulmones)", "Lóbulo inferior derecho"], correct: 2, exp: "La língula y los bordes anteriores cubren el pericardio." },
        { id: 42, original: "41", q: "Con respecto a los nervios frénicos:", options: ["Pasan anteriores al hilio pulmonar", "Pasan posteriores al hilio", "Relación con VCI (derecho)", "A y C", "Ninguna"], correct: 3, exp: "Pasan anteriores al hilio. El derecho pasa junto a la VCI." },
        { id: 43, original: "42", q: "Con respecto a los nervios vagos:", options: ["Pasa a través diafragma con Vena Cava", "Pasan posteriores al hilio pulmonar", "Pasan anteriores", "Relación yugular externa"], correct: 1, exp: "Pasan posteriores al hilio." },
        { id: 44, original: "43", q: "Cuál de las siguientes estructuras no pasa por el hilio pulmonar:", options: ["Venas pulmonares", "Arterias pulmonares", "Tronco de la arteria pulmonar", "Bronquios lobares"], correct: 2, exp: "El tronco se divide antes de entrar, en el mediastino." },
        { id: 45, original: "44", q: "Relaciona: Pulmón izquierdo", options: ["Bronquio principal no se divide antes de entrar (entra como principal)", "Bronquio más ancho", "Triángulo Koch", "Marcapasos"], correct: 0, exp: "El bronquio izquierdo es largo y entra sin dividirse (a diferencia del derecho que a veces da el lobar superior pronto)." },
        { id: 46, original: "45", q: "Relaciona: Pulmón derecho", options: ["Bronquio no se divide", "Bronquio principal más ancho, corto y vertical", "Triángulo Koch", "Marcapasos"], correct: 1, exp: "Más vertical, riesgo de aspiración." },
        { id: 47, original: "46", q: "Marque la opción correcta:", options: ["Pulmón derecho 2 lóbulos", "Izquierdo más pequeño", "Bases sin pleura", "Vértices hacia tórax"], correct: 1, exp: "Repetida." },
        { id: 48, original: "47", q: "Sobre la segmentación broncopulmonar:", options: ["Bronquio lobar derecho apical, ant, post", "Basales simultáneos", "Caudal izquierdo da lingulares", "Medio da segmentos izquierdo"], correct: 0, exp: "El lobar superior derecho da: Apical, Anterior, Posterior." },
        { id: 49, original: "48", q: "La cara interna del pulmón izquierdo se relaciona con:", options: ["Ácigos", "Aorta", "VCS", "VCI"], correct: 1, exp: "Repetida: Aorta." },
        { id: 50, original: "49", q: "La cúpula pleural llega hasta:", options: ["Borde inferior clavícula", "3 cm sobre 1ª costilla", "3 cm sobre cartílago", "Horquilla"], correct: 1, exp: "Repetida." },
        { id: 51, original: "50", q: "Los elementos que componen el pedículo pulmonar:", options: ["Solo vasculares", "Vasos y linfáticos", "Venas, bronquios, arterias pulmonares/bronquiales, linfáticos, nervios", "Faltan nervios"], correct: 2, exp: "Repetida." },
        { id: 52, original: "51", q: "La arterias bronquiales son ramas de:", options: ["Aorta ascendente", "Aorta descendente", "Tronco pulmonar", "Pulmonar"], correct: 1, exp: "Repetida." },
        { id: 53, original: "52", q: "¿Cuántos lóbulos tiene el pulmón izquierdo?", options: ["Uno", "Dos", "Tres", "Cuatro"], correct: 1, exp: "Repetida." },
        { id: 54, original: "53", q: "el bronquio fuente izquierdo se relaciona:", options: ["Por detrás frénico", "Arriba ácigos", "Delante VCS", "Debajo vena pulmonar inferior"], correct: 3, exp: "Repetida. Opción D por descarte." },
        { id: 55, original: "54", q: "La arteria pulmonar izquierda es con respecto al bronquio:", options: ["Sub", "Supra", "Retro", "Pre"], correct: 1, exp: "Repetida: Supra." },
        { id: 56, original: "55", q: "Los segmentos del lóbulo superior del pulmón derecho son:", options: ["Lat/Med", "Apico/Ant", "Apico/Post", "Apical, anterior y posterior"], correct: 3, exp: "Repetida." },
        { id: 57, original: "56", q: "¿Qué segmentos pulmonares izquierdos toman relación directa con el ventrículo izquierdo?", options: ["Apicodorsal", "Anterior", "Lingulares", "Inferior"], correct: 2, exp: "Repetida." },
        { id: 58, original: "57", q: "La serosa que recubre los pulmones de denomina:", options: ["Pericardio", "Peritoneo", "Pleura", "Mesenterio"], correct: 2, exp: "Repetida." },
        { id: 59, original: "58", q: "La vena ácigos desemboca en:", options: ["Vena cava superior", "Yugulo-subclavio", "Yugular", "Conducto torácico"], correct: 0, exp: "Repetida." },
        { id: 60, original: "59", q: "El conducto torácico desemboca en:", options: ["Confluyente yugulosubclavio derecho", "Confluyente yugulosubclavio izquierdo", "Ganglios axilares", "Mamaria interna"], correct: 1, exp: "Ángulo venoso izquierdo." },
        { id: 61, original: "60", q: "El conducto torácico se encuentra inmediatamente por:", options: ["Delante aorta", "Detrás aorta (y esófago)", "Delante esófago", "Detrás VCS"], correct: 1, exp: "Repetida: Posterior a la aorta/esófago." },
        { id: 62, original: "61", q: "Se relaciona topográficamente con el triángulo supraclavicular:", options: ["Lóbulo inferior derecho", "Lóbulo medio", "Lóbulo superior derecho (Vértice)", "Lóbulo inferior izquierdo"], correct: 2, exp: "El vértice pulmonar asoma en el cuello." },
        { id: 63, original: "Extra", q: "El nervio vago:", options: ["Derecho relación tráquea", "Izquierdo apoya cayado", "Derecho bajo subclavia (recurrente)", "Posterior bronquio", "Todas son ciertas"], correct: 4, exp: "Repetida." },
        { id: 64, original: "52", q: "Con respecto a los bronquios seleccione la respuesta correcta:", options: ["Bronquio principal izquierdo bifurca antes", "Bronquio principal derecho bifurca antes entrada hilio", "Bronquio derecho concavidad anterior", "B y C"], correct: 1, exp: "Repetida." },
        { id: 65, original: "53", q: "La arteria bronquial es rama de:", options: ["Aorta torácica", "Pericardiofrénica", "Pulmonar", "Torácica interna"], correct: 0, exp: "Repetida." },
        { id: 66, original: "54", q: "Con respecto a los bronquios:", options: ["Anteriores", "Vagos anteriores", "Relación anterior venas", "A y C"], correct: 2, exp: "Repetida." },
        { id: 67, original: "60", q: "Con respecto a las pleuras:", options: ["Parietal sobrepasa 1ª costilla", "Visceral parrilla costal", "Inferior reborde costal", "Inferior antepenúltima"], correct: 0, exp: "Repetida." },
        { id: 68, original: "61", q: "La fascia de Sibson:", options: ["Inserta borde medial 1ª costilla y apófisis transversa C7", "Borde lateral", "Escalenos aportan fibras", "A y C"], correct: 3, exp: "Membrana suprapleural." },
        { id: 69, original: "62", q: "Señale la opción verdadera:", options: ["Pleura costal inervada pericardiofrénicas", "Diafragmática irrigada pericardiofrénicas", "Mediastínica irrigada pericardiofrénica", "B y C"], correct: 3, exp: "Repetida." },
        { id: 70, original: "63", q: "En el pulmón derecho la cisura oblicua:", options: ["Medio/Sup", "Medio/Inf", "Sup/Inf", "Separar Inf de Sup y Medio (B y C)"], correct: 3, exp: "Repetida." },
        { id: 71, original: "64", q: "Cuál de las siguientes afirmaciones es verdadera:", options: ["Língula en derecho", "Segmentos base hilio", "Derecho 3-2-5", "Segmentos base fuera"], correct: 2, exp: "Repetida." },
        { id: 72, original: "65", q: "Cuál de las siguientes estructuras NO forma parte del mediastino superior:", options: ["Cayado", "Venas braquiocefálicas", "Carótida", "Tronco arteria pulmonar", "TBC"], correct: 3, exp: "Repetida: Pulmonar es Medio." },
        { id: 73, original: "66", q: "El foco de auscultación pulmonar lo encontramos a nivel de:", options: ["3º", "2º espacio intercostal izquierdo", "4º", "1º"], correct: 1, exp: "Repetida." },
        { id: 74, original: "67", q: "Cual de las siguientes estructuras no pasa por el hilio pulmonar:", options: ["Venas", "Arterias", "Tronco arteria pulmonar", "Bronquios"], correct: 2, exp: "Repetida." },
        { id: 75, original: "71", q: "El pulmón derecho se relaciona con:", options: ["Hemiácigos", "VCI", "VCS", "Aorta ascendente", "C y B (Venas Cavas)"], correct: 4, exp: "Las venas cavas dejan impronta en el pulmón derecho." },
        { id: 76, original: "72", q: "Sobre el relieve cardiaco cae la língula del:", options: ["Inf Dcho", "Sup Dcho", "Sup Izq (parte inferior)", "Inf Izq"], correct: 2, exp: "Lóbulo Superior Izquierdo." },
        { id: 77, original: "3", q: "La tráquea:", options: ["Anillos C invertida", "Carina no Louis", "Izq inclinado", "Lobectomía posible", "Venas inferiores"], correct: 3, exp: "Repetida." },
        { id: 78, original: "74", q: "Señale la respuesta verdadera:", options: ["Tronco pulmonar a la derecha", "Arterias bronquiales posteriores al pedículo", "Arteria pulmonar izquierda bifurcada", "Arterias bronquiales derechas derivan aorta (variable, suele ser intercostal)", "B y D (o Arterias bronquiales posteriores es lo más constante)"], correct: 1, exp: "Las arterias bronquiales discurren por la cara posterior de los bronquios." },
        { id: 79, original: "75", q: "Qué elemento NO mantiene relación con la cara mediastínica del pulmón derecho:", options: ["Hemiácigos (Izquierda)", "Frénico derecho", "VCI", "VCS"], correct: 0, exp: "La Hemiácigos es izquierda." },
        { id: 80, original: "76", q: "La línea de reflexión de la pleura parietal para hacerse pleura visceral... excepto:", options: ["Cara mediastínica", "Discurre caudalmente", "Sitúa cranealmente (Falso, es ligamento inferior)", "Ligamento pulmonar"], correct: 2, exp: "Repetida." },
        { id: 81, original: "77", q: "El tronco braquiocefálico derecho y la cava superior mantienen relación de cercanía y dejan una impronta sobre:", options: ["Saco pericárdico", "Cara mediastínica del pulmón derecho", "Tráquea", "Esófago"], correct: 1, exp: "Improntas en lóbulo superior derecho." },
        { id: 82, original: "79", q: "En los pedículos pulmonares, la situación más anterior e interior la ocupan:", options: ["Plexos", "Bronquios", "Venas pulmonares", "Arterias"], correct: 2, exp: "Venas pulmonares (Vena pulmonar superior es la más anterior)." },
        { id: 83, original: "80", q: "¿Qué elemento se introduce en la profundidad de las fisuras que limitan los lóbulos pulmonares?", options: ["Pleura visceral", "Ligamento", "Receso", "Parietal"], correct: 0, exp: "Repetida." },
        { id: 84, original: "82", q: "¿Cuál de los siguientes enunciados sobre la inervación de la pleura es incorrecto?", options: ["Visceral parénquima", "Parietal frénico", "Costal intercostal", "Parietal bronquiales (Falso)"], correct: 3, exp: "Repetida." },
        { id: 85, original: "84", q: "¿Qué estructura se forma por la reflexión de ambas láminas plurales?", options: ["Pleura visceral", "Ligamento pulmonar", "Receso", "Parietal"], correct: 1, exp: "El ligamento pulmonar es la reflexión inferior." },
        { id: 86, original: "85", q: "Las arterias bronquiales pueden tener distintos orígenes pero uno de los siguientes no es correcto:", options: ["Arterias pulmonares", "3ª arterias intercostales posteriores", "Aorta torácica", "Arteria subclavia (menos común) / Opción 'Estas no existen'"], correct: 0, exp: "No nacen de las arterias pulmonares (llevan sangre funcional, no nutricia)." },
        { id: 87, original: "90", q: "El ligamento suspensorio del pulmón no posee una de las siguientes características:", options: ["Continúa reborde perihiliar", "Se enfría cranealmente (Error texto: Quizás 'fija')", "Se fija fascia escalenos", "Relación cadena simpática"], correct: 1, exp: "El ligamento pulmonar (suspensorio a veces confundido con fascia Sibson) está abajo. Si se refiere a la membrana suprapleural (Sibson), se fija a la transversa C7. La opción b 'se enfría' parece error tipográfico del examen original. Asumiendo ligamento pulmonar inferior: no es craneal." },
        { id: 88, original: "91", q: "¿Qué elemento tapiza la cara interna de la parrilla costal y la cara superior del músculo diafragma?", options: ["Receso", "Pleura parietal", "Receso", "Visceral"], correct: 1, exp: "Pleura parietal (costal y diafragmática)." },
        { id: 89, original: "1", q: "Acerca de la pleura visceral señale la opción correcta:", options: ["Tapiza costillas", "Inervada intercostales", "Tapiza diafragma", "Se introduce penetrando en las cisuras pulmonares"], correct: 3, exp: "Repetida." },
        { id: 90, original: "4", q: "En el pedículo pulmonar derecho, qué elemento se apoya sobre el bronquio principal derecho:", options: ["Esófago", "Subclavia", "Vena pulmonar", "Cayado de la vena ácigos"], correct: 3, exp: "Repetida." },
        { id: 91, original: "5", q: "En la segmentación de la vía aérea pulmonar, el bronquiolo se caracteriza por:", options: ["Solo hilio", "Bifurca lóbulo", "Su pared no presenta anillos cartilaginosos", "Receso"], correct: 2, exp: "Repetida." },
        { id: 92, original: "6", q: "La línea de reflexión de la pleura parietal para transformarse en pleura visceral... excepto:", options: ["Cara mediastínica", "Discurre caudalmente", "Ligamento pulmonar", "Se sitúa cranealmente (Falso)"], correct: 3, exp: "Repetida." },
        { id: 93, original: "8", q: "La pleura parietal (señale la incorrecta):", options: ["Sus expansiones crean recesos (hacia espacios intercostales es falso)", "Relación 1ª costilla", "Membrana suprapleural", "Fascia endotorácica"], correct: 0, exp: "Repetida." },
        { id: 94, original: "12", q: "Sobre el ápex pulmonar, señale la respuesta incorrecta:", options: ["Relación PVN cuello", "Escalenos", "Se introduce en el espacio costomediastínico (Falso)", "Vasos subclavios"], correct: 2, exp: "Repetida." },
        { id: 95, original: "15", q: "Sobre los bronquios principales (señale la correcta):", options: ["Como tráquea", "Izquierdo largo/horizontal", "Izquierdo rechaza esófago (Lo cruza)", "Nivel T7"], correct: 1, exp: "Repetida." },
        { id: 96, original: "11", q: "La comunicación entre la arteria pulmonar y la aorta se denomina", options: ["CIV", "Tabicamiento", "AV", "Ductus de Botal", "Grandes vasos"], correct: 3, exp: "Repetida." },
        { id: 97, original: "3", q: "El receso costodiafragmático", options: ["Segmento", "Triángulo", "Apoya cúpula", "Se relaciona con el décimo espacio intercostal en la línea axilar anterior (Punción)", "Língula"], correct: 3, exp: "Lugar de toracocentesis." },
        { id: 98, original: "4", q: "Qué elemento no forma parte del pedículo pulmonar", options: ["Arteria pulmonar", "Arteria bronquial", "Arteria pericardicofrénica", "Venas", "Bronquio"], correct: 2, exp: "La pericardiofrénica va por el pericardio, fuera del hilio." },
        { id: 99, original: "5", q: "En el pedículo pulmonar, los bronquios principales (señale la opción incorrecta)", options: ["Dorsales", "Arterias bronquiales", "Similar tráquea", "Son los elementos más ventrales del pedículo (Falso, son las venas)", "Izquierdo largo"], correct: 3, exp: "Son posteriores (dorsales)." },
        { id: 100, original: "6", q: "Acerca del nervio frénico, señale la opción incorrecta", options: ["Junto pericardiofrénica", "Sobre escaleno anterior", "Inervan a los rectos anteriores del abdomen (Falso)", "Izquierdo sobre pericardio", "Derecho sobre pleura"], correct: 2, exp: "Los rectos son inervados por intercostales/toracoabdominales. El frénico es diafragma." },
        { id: 101, original: "7", q: "Los linfáticos pulmonares se sitúan:", options: ["No existen", "Junto ganglios pleurales", "Junto a los bronquios principales (y parénquima)", "Directamente mediastínicos"], correct: 2, exp: "Repetida." },
        { id: 102, original: "8", q: "Cuando definimos un segmento broncopulmonar nos referimos:", options: ["Porción cualquier bronquio", "Segmentos disecables del pulmón con ramas directas derivadas del bronquio lobular (Segmentario)", "Indefinidos", "Lóbulo"], correct: 1, exp: "Unidad funcional independiente." },
        { id: 103, original: "9", q: "Sobre el bronquio principal derecho, señale la incorrecta:", options: ["Cayado ácigos", "Arterias bronquiales", "Se bifurca en bronquios lobares dentro del parénquima pulmonar (Suele dar el superior antes)", "Ventralmente arteria pulmonar"], correct: 2, exp: "El bronquio lobar superior derecho suele salir muy pronto, a veces extrahiliar." },
        { id: 104, original: "1", q: "¿Qué relación mantiene la pleura parietal con respecto al músculo diafragma?", options: ["Tapiza la cara superior del músculo diafragma", "Cisuras", "Costal", "Aorta", "Intercostales"], correct: 0, exp: "Pleura diafragmática." },
        { id: 105, original: "2", q: "Acerca de la pleura visceral señala la opción correcta:", options: ["Diafragma", "Se introduce en la profundidad de las cisuras pulmonares", "Costal", "Aorta", "Intercostales"], correct: 1, exp: "Repetida." },
        { id: 106, original: "3", q: "La glándula tímica se encuentra ocupando parte del espacio:", options: ["Saco", "Mediastino posterior", "Mediastino superior (y anterior)", "Anterior", "Pulmón"], correct: 2, exp: "Repetida." },
        { id: 107, original: "4", q: "El espacio que queda anterior con respecto al saco pericárdico es denominado:", options: ["Saco", "Post", "Sup", "Mediastino anterior", "Pulmón"], correct: 3, exp: "Repetida." },
        { id: 108, original: "5", q: "Los ligamentos pericardicofrénicos se fijan al centro tendinoso del diafragma y:", options: ["Saco inferior", "Post", "Sup", "Ant", "Cara mediastínica"], correct: 0, exp: "Al saco pericárdico." },
        { id: 109, original: "6", q: "El lóbulo superior del pulmón:", options: ["Segmento", "Triángulo supraclavicular (Vértice)", "Cúpula", "Décimo espacio", "Língula"], correct: 1, exp: "El vértice (parte del lóbulo superior) asoma en el cuello." },
        { id: 110, original: "7", q: "El lóbulo inferior:", options: ["Segmento", "Triángulo", "Cúpula", "Se relaciona con el décimo espacio intercostal (Receso)", "Língula"], correct: 3, exp: "Llega más abajo (posteriormente hasta T10/Costilla 10)." },
        { id: 111, original: "8", q: "El receso coatodiafragmático:", options: ["Segmento", "Triángulo", "Cúpula", "Se relaciona con el décimo espacio intercostal en la línea axial anterior", "Língula"], correct: 3, exp: "Repetida." },
        { id: 112, original: "9", q: "Qué elemento no forma parte del pedículo pulmonar:", options: ["Pulmonar", "Bronquial", "Arteria pericardiofrénica", "Venas", "Bronquio"], correct: 2, exp: "Repetida." },
        { id: 113, original: "10", q: "En el pedículo pulmonar, los bronquios principales (señala la incorrecta):", options: ["Dorsales", "Bronquiales", "Estructura tráquea", "Son los elementos más ventrales del pedículo", "Izquierdo largo"], correct: 3, exp: "Repetida." },
        { id: 114, original: "11", q: "Acerca del nervio frénico, señale la opción incorrecta:", options: ["Pericardiofrénica", "Escaleno", "Inervan a los rectos anteriores del abdomen", "Izq pericardio", "Der pleura"], correct: 2, exp: "Repetida." },
        { id: 115, original: "12", q: "Cuál de los siguientes vasos mantiene relación de cercanía con el borde lateral de la tráquea:", options: ["Subclavia", "Torácica int", "Carótida común", "Vertebral", "Epigástrica"], correct: 2, exp: "Repetida." },
        { id: 116, original: "13", q: "La arteria pericardicofrénica es rama de:", options: ["Subclavia", "Arteria torácica interna", "Carótida", "Vertebral", "Epigástrica"], correct: 1, exp: "Repetida." },
        { id: 117, original: "14", q: "La arteria torácica interna es rama de:", options: ["Arteria subclavia", "Torácica", "Carótida", "Vertebral", "Epigástrica"], correct: 0, exp: "Rama de la subclavia (1ª porción)." }
    ];

    let currentQuestions = [...dbQuestions];
    let markedIds = new Set();
    let userAnswers = {};

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function renderQuiz() {
        const list = document.getElementById('questions-list');
        const nav = document.getElementById('sidebar-nav');
        const resultsPanel = document.getElementById('results-panel');
        
        list.innerHTML = '';
        nav.innerHTML = '';
        resultsPanel.style.display = 'none';

        if(currentQuestions.length === 0) {
            list.innerHTML = `<div class="question-card"><p>No hay preguntas para los criterios seleccionados.</p></div>`;
            return;
        }

        currentQuestions.forEach((q, index) => {
            const btn = document.createElement('a');
            btn.href = `#q-${q.id}`;
            btn.className = 'nav-btn';
            btn.innerText = index + 1;
            btn.id = `nav-btn-${q.id}`;
            
            if (userAnswers[q.id] === true) btn.classList.add('correct');
            if (userAnswers[q.id] === false) btn.classList.add('incorrect');
            if (markedIds.has(q.id)) btn.classList.add('marked');

            nav.appendChild(btn);

            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-${q.id}`;

            const originalOptions = q.options.map((text, i) => ({ text, isCorrect: i === q.correct }));
            const finalOptions = shuffle(originalOptions);

            let optionsHTML = '';
            finalOptions.forEach(opt => {
                const safeText = opt.text.replace(/'/g, "&#39;"); 
                optionsHTML += `<button class="option-btn" onclick="handleAnswer(${q.id}, ${opt.isCorrect}, this)">${opt.text}</button>`;
            });

            const isMarked = markedIds.has(q.id);

            card.innerHTML = `
                <div class="question-header-row">
                    <span>Pregunta ${index + 1} (Ref: ${q.original})</span>
                    <button class="bookmark-btn ${isMarked ? 'active' : ''}" onclick="toggleMark(${q.id}, this)">
                        ${isMarked ? '★ Marcada' : '☆ Marcar'}
                    </button>
                </div>
                <div class="question-text">${q.q}</div>
                <div class="options-grid" id="opts-${q.id}">
                    ${optionsHTML}
                </div>
                <div class="feedback" id="feed-${q.id}"></div>
            `;
            list.appendChild(card);
        });
        updateProgress();
    }

    function handleAnswer(id, isCorrect, btn) {
        if (userAnswers.hasOwnProperty(id)) return;
        
        userAnswers[id] = isCorrect;
        const navBtn = document.getElementById(`nav-btn-${id}`);
        const feedback = document.getElementById(`feed-${id}`);
        const container = document.getElementById(`opts-${id}`);
        const qData = dbQuestions.find(x => x.id === id);

        const allBtns = container.querySelectorAll('.option-btn');
        allBtns.forEach(b => {
            b.classList.add('disabled');
            b.onclick = null;
            const correctText = qData.options[qData.correct];
            if (b.innerText === correctText) b.classList.add('correct');
        });

        if (isCorrect) {
            feedback.innerHTML = `<strong>¡Correcto!</strong><br>${qData.exp}`;
            feedback.className = 'feedback success show';
            if(navBtn) navBtn.classList.add('correct');
        } else {
            btn.classList.add('incorrect');
            feedback.innerHTML = `<strong>Incorrecto.</strong><br>${qData.exp}`;
            feedback.className = 'feedback error show';
            if(navBtn) navBtn.classList.add('incorrect');
        }
        updateProgress();
    }

    function toggleMark(id, btn) {
        const navBtn = document.getElementById(`nav-btn-${id}`);
        if (markedIds.has(id)) {
            markedIds.delete(id);
            btn.innerHTML = '☆ Marcar';
            btn.classList.remove('active');
            if(navBtn) navBtn.classList.remove('marked');
        } else {
            markedIds.add(id);
            btn.innerHTML = '★ Marcada';
            btn.classList.add('active');
            if(navBtn) navBtn.classList.add('marked');
        }
    }

    function updateProgress() {
        const count = Object.keys(userAnswers).length;
        const total = currentQuestions.length;
        document.getElementById('progress-text').innerText = `${count}/${total}`;
        
        if (count === total && total > 0) {
            showResults(false);
        }
    }

    function showResults(manualFinish = false) {
        const panel = document.getElementById('results-panel');
        let correct = 0;
        Object.values(userAnswers).forEach(v => { if(v) correct++; });
        
        const total = currentQuestions.length;
        
        document.getElementById('score-text').innerText = `Has acertado ${correct} de ${total}`;
        panel.style.display = 'block';
        
        if(manualFinish) {
            panel.scrollIntoView({ behavior: 'smooth' });
        } else {
            setTimeout(() => panel.scrollIntoView({ behavior: 'smooth' }), 100);
        }
    }

    function resetQuiz(mode) {
        let nextIds = [];

        if (mode === 'all') {
            nextIds = dbQuestions.map(q => q.id);
        } else if (mode === 'wrong') {
            nextIds = Object.keys(userAnswers).filter(id => userAnswers[id] === false).map(Number);
        } else if (mode === 'marked') {
            nextIds = Array.from(markedIds);
        } else if (mode === 'wrong_marked') {
            const wrong = Object.keys(userAnswers).filter(id => userAnswers[id] === false).map(Number);
            const marked = Array.from(markedIds);
            nextIds = [...new Set([...wrong, ...marked])];
        }

        if (nextIds.length === 0) {
            alert("No hay preguntas para los criterios seleccionados.");
            return;
        }

        userAnswers = {};
        currentQuestions = dbQuestions.filter(q => nextIds.includes(q.id));
        renderQuiz();
        document.querySelector('.main-content').scrollTop = 0;
    }

    renderQuiz();
</script>
</body>
</html>