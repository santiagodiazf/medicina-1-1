<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Bloque 5 (Parte 2) - Avanzado</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --success: #27ae60;
            --danger: #c0392b;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        header {
            text-align: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        h1 { color: var(--primary); margin: 0; font-size: 1.8rem; }
        .info { font-style: italic; color: #7f8c8d; }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: #dfe6e9;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .question-card {
            display: none;
            position: relative; /* Para posicionar el marcador */
        }
        .question-card.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        /* ESTILOS DEL MARCADOR (Bookmark) */
        .bookmark-container {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #fff8e1;
            border: 1px solid #ffe082;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            z-index: 10;
        }
        .bookmark-container:hover { background-color: #ffecb3; }
        .bookmark-container input { cursor: pointer; transform: scale(1.2); }

        .topic-badge {
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-block;
            margin-top: 10px;
        }

        .question-text {
            font-size: 1.2rem;
            margin: 15px 0 25px 0;
            font-weight: 600;
            padding-right: 120px; /* Espacio para que el texto no tape el marcador */
        }

        .options-container {
            display: grid;
            gap: 10px;
        }

        .option-btn {
            background: white;
            border: 2px solid #bdc3c7;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
            width: 100%;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: #f4f6f7;
        }
        .option-btn:disabled { cursor: default; opacity: 0.8; }

        .correct {
            background-color: #d5f5e3 !important;
            border-color: var(--success) !important;
            color: #196f3d;
        }

        .incorrect {
            background-color: #fadbd8 !important;
            border-color: var(--danger) !important;
            color: #922b21;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .feedback.show { display: block; }
        .feedback-correct { background: #e8f8f5; border-left: 5px solid var(--success); }
        .feedback-incorrect { background: #fdedec; border-left: 5px solid var(--danger); }

        .btn-next {
            display: none;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 20px;
            float: right;
        }
        .btn-next:hover { background: var(--secondary); }

        /* PANTALLA DE RESULTADOS */
        .results {
            text-align: center;
            display: none;
            padding: 20px 0;
        }
        .score-circle {
            width: 120px;
            height: 120px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 20px auto;
            font-weight: bold;
        }
        
        .stats-summary {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        /* BOTONES DE ACCI√ìN FINAL */
        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        .action-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }
        .action-btn:hover { transform: translateY(-2px); filter: brightness(110%); }
        .action-btn:disabled { background-color: #bdc3c7 !important; cursor: not-allowed; transform: none; filter: none; }

        .btn-restart { background-color: var(--primary); grid-column: span 2; }
        .btn-failed { background-color: var(--danger); }
        .btn-marked { background-color: var(--warning); color: #333; }
        .btn-mixed { background-color: #8e44ad; grid-column: span 2; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Examen Bloque 5: Set Avanzado</h1>
        <div class="info">Membranas, Citoesqueleto y Org√°nulos Energ√©ticos</div>
    </header>

    <div class="status-bar" id="statusBar">
        <span id="q-counter">Cargando...</span>
        <span id="score-counter">Aciertos: 0</span>
    </div>

    <div id="quiz-container"></div>

    <div id="results-screen" class="results">
        <h2>Sesi√≥n Finalizada</h2>
        <div class="score-circle" id="final-score">0</div>
        <p id="final-msg" style="font-weight: bold; font-size: 1.1rem;"></p>
        
        <div class="stats-summary" id="stats-summary"></div>

        <div class="action-grid">
            <button class="action-btn btn-restart" onclick="startQuiz('all')">üîÑ Reiniciar Test Completo (Borrar todo)</button>
            <button class="action-btn btn-failed" id="btn-failed" onclick="startQuiz('failed')">‚ùå Repetir Falladas</button>
            <button class="action-btn btn-marked" id="btn-marked" onclick="startQuiz('marked')">‚ö†Ô∏è Repetir Marcadas</button>
            <button class="action-btn btn-mixed" id="btn-mixed" onclick="startQuiz('mixed')">‚ùå + ‚ö†Ô∏è Repetir Falladas y Marcadas</button>
        </div>
    </div>
</div>

<script>
// Datos de las 75 preguntas
const quizData = [
    // --- MEMBRANAS (1-20) ---
    { topic: "L√≠pidos", question: "¬øQu√© movimiento lip√≠dico es catalizado por enzimas llamadas 'flipasas' y 'scramblasas'?", options: ["Difusi√≥n lateral", "Rotaci√≥n", "Flip-flop (translocaci√≥n transversal)", "Flexi√≥n de colas"], correct: 2, explanation: "El flip-flop espont√°neo es casi imposible; requiere estas enzimas para mantener la asimetr√≠a." },
    { topic: "Estructura", question: "¬øQu√© tipo de fosfol√≠pido se localiza preferentemente en la monocapa interna y tiene carga negativa (se√±alizaci√≥n)?", options: ["Fosfatidilcolina", "Esfingomielina", "Fosfatidilserina", "Glucol√≠pidos"], correct: 2, explanation: "La fosfatidilserina es clave en la cara interna; su exposici√≥n al exterior es se√±al de apoptosis." },
    { topic: "Fluidez", question: "¬øQu√© son las 'balsas lip√≠dicas' (lipid rafts)?", options: ["Zonas da√±adas", "Microdominios ricos en colesterol y esfingol√≠pidos, m√°s ordenados", "Poros nucleares", "Ves√≠culas"], correct: 1, explanation: "Son plataformas especializadas que concentran prote√≠nas de se√±alizaci√≥n." },
    { topic: "Prote√≠nas", question: "¬øC√≥mo se puede separar una prote√≠na perif√©rica de la membrana?", options: [ "Usando detergentes fuertes", "Cambiando el pH o la fuerza i√≥nica (sin romper bicapa)", "Hirviendo la c√©lula", "Con enzimas"], correct: 1, explanation: "Al estar unidas por enlaces d√©biles, salen con tratamientos suaves, a diferencia de las integrales." },
    { topic: "Corteza", question: "¬øQu√© enfermedad hereditaria se debe a defectos en la espectrina (corteza) de los gl√≥bulos rojos?", options: ["Esferocitosis hereditaria", "Anemia falciforme", "Diabetes", "Fibrosis qu√≠stica"], correct: 0, explanation: "Los gl√≥bulos rojos pierden su forma bic√≥ncava, volvi√©ndose fr√°giles y esf√©ricos." },
    { topic: "Transporte", question: "¬øQu√© es una acuaporina?", options: ["Un canal de sodio", "Una prote√≠na canal para paso r√°pido de agua", "Una bomba de protones", "Un l√≠pido"], correct: 1, explanation: "Permiten un flujo masivo de agua en tejidos como el ri√±√≥n." },
    { topic: "Potencial", question: "¬øQu√© ecuaci√≥n describe el potencial de equilibrio de un solo ion?", options: ["Ecuaci√≥n de Nernst", "Michaelis-Menten", "Ley de Ohm", "Goldman"], correct: 0, explanation: "Calcula el voltaje te√≥rico si la membrana fuera permeable solo a ese ion." },
    { topic: "Bombas", question: "¬øA qu√© familia pertenece la bomba de Ca2+ del ret√≠culo sarcopl√°smico?", options: ["Bombas tipo P", "Bombas tipo V", "Bombas tipo F", "Transportadores ABC"], correct: 0, explanation: "Al igual que la bomba Na/K, usa un ciclo de fosforilaci√≥n (tipo P)." },
    { topic: "Canales", question: "¬øQu√© t√©cnica permite estudiar un solo canal i√≥nico?", options: ["Microscop√≠a", "Patch-clamp (Fijaci√≥n de parche)", "PCR", "Western Blot"], correct: 1, explanation: "A√≠sla un trozo microsc√≥pico de membrana para medir corrientes individuales." },
    { topic: "Neurona", question: "¬øQu√© canales se concentran en el Nodo de Ranvier?", options: ["Canales de Na+ regulados por voltaje", "Canales de ligando", "Bombas de protones", "Porinas"], correct: 0, explanation: "Permiten la conducci√≥n saltatoria regenerando el potencial de acci√≥n." },
    { topic: "Transporte", question: "El simporte Na+/glucosa es:", options: ["Transporte pasivo", "Activo primario", "Activo secundario", "Difusi√≥n facilitada"], correct: 2, explanation: "Usa la energ√≠a del gradiente de Na+, no ATP directamente." },
    { topic: "Potencial", question: "¬øQu√© ocurre si se bloquean los canales de K+ regulados por voltaje?", options: ["No hay potencial", "La repolarizaci√≥n se retrasa mucho", "Despolarizaci√≥n inmediata", "Nada"], correct: 1, explanation: "Sin la salida r√°pida de K+, la membrana tarda mucho m√°s en volver al reposo." },
    { topic: "Sinapsis", question: "¬øQu√© ion entra en la terminal presin√°ptica para provocar la exocitosis?", options: ["Na+", "K+", "Ca2+", "Cl-"], correct: 2, explanation: "La entrada de Ca2+ es el gatillo de la fusi√≥n de ves√≠culas." },
    { topic: "Sinapsis", question: "¬øQu√© tipo de receptor es el de acetilcolina neuromuscular?", options: [ "Canal i√≥nico regulado por ligando", "Acoplado a prote√≠na G", "Quinasa", "Transportador"], correct: 0, explanation: "Al unirse la acetilcolina, el canal se abre permitiendo la entrada de Na+." },
    { topic: "Se√±alizaci√≥n", question: "¬øQu√© significa que un canal se 'inactive'?", options: ["Se cierra y puede abrirse", "Est√° bloqueado por una compuerta interna (refractario)", "Desaparece", "Cambia de ion"], correct: 1, explanation: "Es un estado refractario distinto al 'cerrado', vital para la direcci√≥n del impulso." },
    { topic: "Estructura", question: "¬øC√≥mo se anclan las prote√≠nas si no son transmembrana?", options: ["Anclas lip√≠dicas (GPI, miristoilo)", "Puentes de hidr√≥geno", "Flotando", "Pegadas con az√∫car"], correct: 0, explanation: "Las anclas lip√≠dicas fijan prote√≠nas solubles a la superficie." },
    { topic: "Glucoc√°liz", question: "¬øQu√© prote√≠nas unen la matriz extracelular con el citoesqueleto?", options: ["Integrinas", "Cadherinas", "Selectinas", "Claudinas"], correct: 0, explanation: "Las integrinas son los principales receptores de adhesi√≥n c√©lula-matriz." },
    { topic: "Transporte", question: "¬øQu√© es un canal de fuga?", options: ["Canal que siempre oscila permitiendo paso basal", "Canal roto", "Solo deja salir agua", "Poro nuclear"], correct: 0, explanation: "Los canales de fuga de K+ generan el potencial de reposo." },
    { topic: "Estructura", question: "¬øQu√© detergente suave solubiliza prote√≠nas sin desnaturalizar?", options: ["SDS", "Trit√≥n X-100", "√Åcido sulf√∫rico", "Lej√≠a"], correct: 1, explanation: "El Trit√≥n es no i√≥nico y preserva la estructura." },
    { topic: "Gradientes", question: "¬øQu√© org√°nulo almacena Ca2+ activamente en el m√∫sculo?", options: ["Lisosoma", "Ret√≠culo Sarcopl√°smico", "N√∫cleo", "Golgi"], correct: 1, explanation: "Es el reservorio de calcio para la contracci√≥n." },

    // --- MITOCONDRIA (21-45) ---
    { topic: "Transporte e-", question: "¬øQu√© complejo de la cadena NO bombea protones?", options: ["Complejo I", "Complejo II", "Complejo III", "Complejo IV"], correct: 1, explanation: "El Complejo II introduce electrones del FADH2 pero no bombea H+." },
    { topic: "Transporte e-", question: "¬øQu√© es la Ubiquinona (Coenzima Q)?", options: ["Prote√≠na grande", "Mol√©cula lip√≠dica m√≥vil transportadora de electrones", "Canal de protones", "Az√∫car"], correct: 1, explanation: "Transporta electrones del Complejo I y II al III dentro de la bicapa." },
    { topic: "Bioenerg√©tica", question: "¬øQu√© fuerza motriz tiene mayor peso en la mitocondria?", options: ["Potencial el√©ctrico (voltaje)", "Gradiente de pH", "Iguales", "Ninguno"], correct: 0, explanation: "El voltaje contribuye m√°s a la fuerza motriz que el pH." },
    { topic: "Transporte", question: "¬øC√≥mo entra el piruvato a la matriz?", options: ["Difusi√≥n", "Simporte con H+", "Bombas ATP", "Canales de agua"], correct: 1, explanation: "Aprovecha el gradiente de H+ para entrar." },
    { topic: "Transporte", question: "¬øC√≥mo sale el ATP de la matriz?", options: [ "Difusi√≥n", "Antiportador ATP/ADP impulsado por voltaje", "Canales", "Ves√≠culas"], correct: 1, explanation: "Saca ATP (4-) y mete ADP (3-), impulsado por el potencial negativo interno." },
    { topic: "ATP Sintasa", question: "¬øQu√© subunidad tiene actividad catal√≠tica (hace ATP)?", options: ["F0", "Cabeza F1 (beta)", "Eje", "Canal"], correct: 1, explanation: "La cabeza F1 en la matriz sintetiza el ATP." },
    { topic: "Inhibidores", question: "¬øQu√© efecto tiene el DNP (desacoplante)?", options: ["Bloquea cadena", "Permeabiliza membrana a H+, desacoplando oxidaci√≥n de fosforilaci√≥n", "Inhibe sintasa", "Rompe mitocondria"], correct: 1, explanation: "Elimina el gradiente de protones generando calor sin ATP." },
    { topic: "Origen", question: "Las mitocondrias se dividen por:", options: ["Mitosis", "Fisi√≥n binaria", "Meiosis", "Gemaci√≥n"], correct: 1, explanation: "Proceso similar a las bacterias." },
    { topic: "Genoma", question: "¬øEl c√≥digo gen√©tico mitocondrial es id√©ntico al nuclear?", options: ["S√≠", "No, tiene variaciones", "No tiene c√≥digo", "Binario"], correct: 1, explanation: "Algunos codones tienen significados distintos (excepci√≥n a la universalidad)." },
    { topic: "ROS", question: "¬øQu√© subproducto t√≥xico genera la cadena de electrones?", options: ["Agua", "ROS (Radicales libres)", "ATP", "Glucosa"], correct: 1, explanation: "Fugas de electrones crean super√≥xido." },
    { topic: "Eficiencia", question: "¬øCu√°ntos protones se necesitan aprox. para 1 ATP?", options: ["1", "3-4", "10", "100"], correct: 1, explanation: "El flujo de 3-4 protones mueve la turbina para liberar 1 ATP." },
    { topic: "Estructura", question: "En la grasa parda, la mitocondria contiene:", options: ["M√°s sintasa", "Termogenina (UCP1)", "Clorofila", "Menos crestas"], correct: 1, explanation: "Desacopla el gradiente para producir calor corporal." },
    { topic: "Metabolismo", question: "¬øQu√© mol√©cula conecta gluc√≥lisis con Krebs?", options: ["Glucosa", "Acetil-CoA", "Lactato", "NADH"], correct: 1, explanation: "El piruvato se convierte en Acetil-CoA para entrar al ciclo." },
    { topic: "Estructura", question: "¬øD√≥nde est√°n las enzimas de Krebs?", options: ["Membrana externa", "Espacio intermembrana", "Matriz", "Citosol"], correct: 2, explanation: "Son solubles en la matriz (salvo succinato deshidrogenasa)." },
    { topic: "Herencia", question: "Si una madre tiene enfermedad mitocondrial, ¬øqui√©n hereda?", options: ["Hijas", "Hijos", "Todos los hijos/as", "Nadie"], correct: 2, explanation: "Todos heredan mitocondrias maternas." },
    { topic: "Inhibidores", question: "¬øQu√© inhibe el CO (mon√≥xido de carbono)?", options: ["Complejo I", "Complejo IV", "Sintasa", "Piruvato"], correct: 1, explanation: "Compite con el ox√≠geno en el √∫ltimo paso." },
    { topic: "Potencial", question: "¬øColorante para ver mitocondrias activas?", options: ["DAPI", "Hematoxilina", "MitoTracker / Rodamina", "Coomassie"], correct: 2, explanation: "Se acumulan en la matriz negativa." },
    { topic: "Teor√≠a", question: "¬øEvidencia de la endosimbiosis?", options: ["ADN circular y ribosomas bacterianos", "Pared celular", "Clorofila", "De novo"], correct: 0, explanation: "Maquinaria gen√©tica muy similar a bacterias." },
    { topic: "Complejos", question: "¬øQu√© transfiere electrones de Ubiquinol a Citocromo c?", options: ["Complejo I", "Complejo II", "Complejo III", "Complejo IV"], correct: 2, explanation: "Complejo III es el intermediario." },
    { topic: "Balance", question: "¬øQu√© pasa con el NADH citos√≥lico?", options: ["Entra directo", "Usa lanzaderas (malato/glicerol)", "Se degrada", "Nada"], correct: 1, explanation: "La membrana es impermeable al NADH; usa lanzaderas." },
    { topic: "Se√±alizaci√≥n", question: "¬øQu√© libera la mitocondria para activar apoptosis?", options: ["ATP", "Citocromo c", "Ca2+", "ADN"], correct: 1, explanation: "Activa las caspasas en el citosol." },
    { topic: "Estructura", question: "¬øQu√© regula la forma de las crestas?", options: ["Complejo MICOS", "Actina", "Tubulina", "Clatrina"], correct: 0, explanation: "Mantienen las uniones de las crestas." },
    { topic: "S√≠ntesis", question: "¬øLa ATP sintasa puede funcionar al rev√©s?", options: ["No", "S√≠ (hidroliza ATP para bombear H+)", "Con luz", "Hace ADP"], correct: 1, explanation: "Es reversible si el gradiente cae dr√°sticamente." },
    { topic: "Biog√©nesis", question: "¬øQu√© importa prote√≠nas a la mitocondria?", options: ["Complejos TIM y TOM", "Poros", "COP", "Ribosomas"], correct: 0, explanation: "Translocasas de membrana externa e interna." },
    { topic: "Historia", question: "¬øQui√©n propuso la hip√≥tesis quimiosm√≥tica?", options: ["Peter Mitchell", "Krebs", "Watson", "Pasteur"], correct: 0, explanation: "Nobel por descubrir el gradiente de protones." },

    // --- CITOESQUELETO (46-75) ---
    { topic: "Actina", question: "¬øQu√© prote√≠na secuestra mon√≥meros de actina impidiendo polimerizaci√≥n?", options: ["Timosina", "Profilina", "Formina", "Arp2/3"], correct: 0, explanation: "Mantiene una reserva de actina libre." },
    { topic: "Actina", question: "¬øQu√© droga estabiliza actina (veneno de seta)?", options: ["Faloidina", "Citocalasina", "Latrunculina", "Taxol"], correct: 0, explanation: "La faloidina 'congela' la actina." },
    { topic: "Microt√∫bulos", question: "¬øQu√© es la 'cat√°strofe'?", options: ["Rotura", "Cambio s√∫bito a despolimerizaci√≥n r√°pida", "P√©rdida tubulina", "Uni√≥n motora"], correct: 1, explanation: "P√©rdida del casquete GTP." },
    { topic: "Centrosoma", question: "¬øQu√© hay en el centro del centrosoma?", options: ["Mitocondrias", "Dos centriolos perpendiculares", "N√∫cleo", "Ribosomas"], correct: 1, explanation: "Organizan la matriz pericentriolar." },
    { topic: "Microt√∫bulos", question: "¬øMotor del transporte retr√≥grado (hacia el n√∫cleo)?", options: ["Cinesina", "Dine√≠na", "Miosina", "Actina"], correct: 1, explanation: "Dine√≠na viaja al extremo menos (-)." },
    { topic: "Cilios", question: "¬øEnfermedad por cilios inm√≥viles?", options: ["S√≠ndrome de Kartagener", "Gripe", "C√°ncer", "Alzheimer"], correct: 0, explanation: "Causa infecciones respiratorias, infertilidad y situs inversus." },
    { topic: "Actina", question: "¬øEstructura en microvellosidades?", options: ["Haces paralelos estables", "Redes", "Anillos", "Lamelipodios"], correct: 0, explanation: "Haces r√≠gidos para aumentar superficie." },
    { topic: "Intermedios", question: "¬øFilamento intermedio nuclear universal?", options: ["Laminas nucleares", "Queratinas", "Vimentina", "Neurofilamentos"], correct: 0, explanation: "Soportan la envoltura nuclear." },
    { topic: "Miosina", question: "¬øQu√© parte determina la carga a transportar?", options: ["Cabeza", "Cola", "ATP", "Cuello"], correct: 1, explanation: "La cola es espec√≠fica para la carga." },
    { topic: "Contracci√≥n", question: "¬øProte√≠na gigante 'muelle' del sarc√≥mero?", options: ["Titina", "Nebulina", "Actina", "Distrofina"], correct: 0, explanation: "Da elasticidad al m√∫sculo." },
    { topic: "Contracci√≥n", question: "¬øFunci√≥n de Nebulina?", options: ["Regla molecular (longitud actina)", "Contrae", "Bombea Ca", "Une miosina"], correct: 0, explanation: "Define la longitud del filamento fino." },
    { topic: "Uniones", question: "¬øUniones para paso de iones en coraz√≥n?", options: ["Estrechas", "Gap (comunicantes)", "Desmosomas", "Hemidesmosomas"], correct: 1, explanation: "Acoplamiento el√©ctrico." },
    { topic: "Uniones", question: "¬øProte√≠na de Uniones Estrechas?", options: ["Claudinas/Ocludinas", "Cadherinas", "Integrinas", "Conexinas"], correct: 0, explanation: "Sell√°n el espacio intercelular." },
    { topic: "Uniones", question: "¬øQu√© conecta un Hemidesmosoma?", options: ["C√©lula-C√©lula", "C√©lula-Matriz (mediante intermedios)", "Actina-Matriz", "MT-N√∫cleo"], correct: 1, explanation: "Anclan c√©lula a l√°mina basal." },
    { topic: "Uniones", question: "¬øProte√≠na de adhesi√≥n dependiente de Ca2+?", options: ["Cadherina", "Integrina", "Selectina", "Ig-CAM"], correct: 0, explanation: "Pegamento de desmosomas." },
    { topic: "Actina", question: "¬øProte√≠na que corta actina (gel-sol)?", options: ["Gelsolina", "Fimbrina", "Espectrina", "CapZ"], correct: 0, explanation: "Fragmenta actina con calcio." },
    { topic: "Microt√∫bulos", question: "¬øMAP alterada en Alzheimer?", options: ["Tau", "Kinesina", "Dine√≠na", "Actina"], correct: 0, explanation: "Tau hiperfosforilada desestabiliza microt√∫bulos." },
    { topic: "Movimiento", question: "¬øQu√© pasa en la parte trasera al reptar?", options: ["Polimerizaci√≥n", "Contracci√≥n miosina II (retracci√≥n)", "Filopodios", "Nada"], correct: 1, explanation: "Despega la cola." },
    { topic: "Divisi√≥n", question: "¬øQu√© es el fragmoplasto?", options: ["Anillo animal", "Estructura divisoria vegetal", "Lisosoma", "MT roto"], correct: 1, explanation: "Forma la pared celular nueva." },
    { topic: "Drogas", question: "¬øQu√© hace la Latrunculina?", options: ["Secuestra mon√≥meros actina (despolimeriza)", "Estabiliza MT", "Bloquea miosina", "Rompe n√∫cleo"], correct: 0, explanation: "Impide polimerizaci√≥n." },
    { topic: "Estructura", question: "¬øExtremo del MT anclado en centrosoma?", options: ["Positivo (+)", "Negativo (-)", "Ambos", "Ninguno"], correct: 1, explanation: "El menos est√° protegido." },
    { topic: "Citoesqueleto", question: "¬øFilamentos del surco de divisi√≥n?", options: ["Microt√∫bulos", "Actina y Miosina", "Intermedios", "Laminas"], correct: 1, explanation: "El anillo contr√°ctil." },
    { topic: "Patolog√≠a", question: "Causa de Distrofia Duchenne:", options: ["Defecto distrofina", "Defecto miosina", "Falta ATP", "Exceso actina"], correct: 0, explanation: "La membrana muscular se rompe sin ella." },
    { topic: "Motores", question: "¬øPaso limitante ciclo miosina?", options: ["Golpe fuerza", "Salida ADP", "Hidr√≥lisis ATP", "Salida Fosfato"], correct: 3, explanation: "Dispara el golpe de fuerza." },
    { topic: "General", question: "¬øFilamento m√°s din√°mico (cambio forma)?", options: ["Intermedios", "Microt√∫bulos", "Actina", "L√°mina"], correct: 2, explanation: "Reorganizaci√≥n r√°pida de superficie." },
    { topic: "Se√±alizaci√≥n", question: "¬øQu√© hace Rac?", options: ["Lamelipodios", "Filopodios", "Contracci√≥n", "Rompe MT"], correct: 0, explanation: "Redes de actina en periferia." },
    { topic: "Cilios", question: "¬øQu√© es el axonema?", options: ["N√∫cleo 9+2", "Membrana", "Base", "Motor"], correct: 0, explanation: "Estructura central MT." },
    { topic: "Microt√∫bulos", question: "¬øQu√© es casquete GTP?", options: ["Extremo (+) estable con GTP-tubulina", "Sombrero", "Prote√≠na", "Defecto"], correct: 0, explanation: "Permite crecimiento." },
    { topic: "Transporte", question: "¬øQu√© hacen los Gap junctions?", options: ["Adhesi√≥n", "Paso iones/mol√©culas peque√±as entre c√©lulas", "Bloqueo", "Ves√≠culas"], correct: 1, explanation: "Acoplamiento metab√≥lico/el√©ctrico." },
    { topic: "Final", question: "¬øCitoesqueleto sin motores?", options: ["Actina", "Microt√∫bulos", "Intermedios", "Todos tienen"], correct: 2, explanation: "Son solo estructurales." }
];

// --- GESTI√ìN DE ESTADO ---
// Inicializamos propiedades en el array para seguimiento
quizData.forEach(q => {
    q.isMarked = false;
    q.userCorrect = null; // null = no contestada, true = bien, false = mal
});

let activeIndices = []; 
let currentPlaylistIndex = 0;
let sessionScore = 0;
let answered = false;

document.addEventListener('DOMContentLoaded', () => {
    startQuiz('all');
});

// FUNCI√ìN PRINCIPAL: Configura la "Playlist" de preguntas
function startQuiz(mode) {
    activeIndices = [];

    if (mode === 'all') {
        // Reset total de respuestas, pero opcionalmente podr√≠amos mantener marcas.
        // Aqu√≠ reseteamos respuestas para un intento limpio.
        quizData.forEach(q => q.userCorrect = null);
        // Si quieres borrar marcas al reiniciar todo, descomenta:
        // quizData.forEach(q => q.isMarked = false); 
        activeIndices = quizData.map((_, i) => i);
    } 
    else if (mode === 'failed') {
        activeIndices = quizData.map((q, i) => q.userCorrect === false ? i : -1).filter(i => i !== -1);
    } 
    else if (mode === 'marked') {
        activeIndices = quizData.map((q, i) => q.isMarked ? i : -1).filter(i => i !== -1);
    } 
    else if (mode === 'mixed') {
        activeIndices = quizData.map((q, i) => (q.userCorrect === false || q.isMarked) ? i : -1).filter(i => i !== -1);
    }

    if (activeIndices.length === 0) {
        alert("No hay preguntas en esta categor√≠a (no has fallado o marcado ninguna).");
        return;
    }

    // Configuraci√≥n inicial de la sesi√≥n
    currentPlaylistIndex = 0;
    sessionScore = 0;
    
    document.getElementById('results-screen').style.display = 'none';
    document.getElementById('quiz-container').style.display = 'block';
    document.getElementById('statusBar').style.display = 'flex';
    
    loadQuestion();
}

function loadQuestion() {
    answered = false;
    const realIndex = activeIndices[currentPlaylistIndex]; // √çndice real en quizData
    const q = quizData[realIndex];
    
    // Actualizar UI Contadores
    document.getElementById('q-counter').innerText = `Pregunta ${currentPlaylistIndex + 1}/${activeIndices.length}`;
    document.getElementById('score-counter').innerText = `Aciertos sesi√≥n: ${sessionScore}`;

    const container = document.getElementById('quiz-container');
    
    // Estado del checkbox
    const checkedAttr = q.isMarked ? 'checked' : '';

    let html = `
        <div class="question-card active">
            <label class="bookmark-container">
                <input type="checkbox" onchange="toggleMark(${realIndex}, this)" ${checkedAttr}>
                <span>Marcar</span>
            </label>

            <span class="topic-badge">${q.topic}</span>
            <div class="question-text">${q.question}</div>
            
            <div class="options-container">
                ${q.options.map((opt, i) => `
                    <button class="option-btn" onclick="checkAnswer(${i}, ${q.correct}, this, ${realIndex})">
                        ${String.fromCharCode(65+i)}. ${opt}
                    </button>
                `).join('')}
            </div>
            
            <div class="feedback" id="feedback-box"></div>
            <button class="btn-next" id="next-btn" onclick="nextQuestion()">Siguiente</button>
        </div>
    `;
    
    container.innerHTML = html;
}

function toggleMark(realIndex, checkbox) {
    quizData[realIndex].isMarked = checkbox.checked;
}

function checkAnswer(selectedIndex, correctIndex, btnElement, realIndex) {
    if(answered) return;
    answered = true;

    const buttons = document.querySelectorAll('.option-btn');
    const feedbackBox = document.getElementById('feedback-box');
    const nextBtn = document.getElementById('next-btn');

    // Deshabilitar todos
    buttons.forEach(btn => btn.disabled = true);

    if(selectedIndex === correctIndex) {
        sessionScore++;
        quizData[realIndex].userCorrect = true; // Guardar acierto
        btnElement.classList.add('correct');
        feedbackBox.classList.add('feedback-correct');
        feedbackBox.innerHTML = `<strong>¬°Correcto!</strong> ${quizData[realIndex].explanation}`;
    } else {
        quizData[realIndex].userCorrect = false; // Guardar fallo
        btnElement.classList.add('incorrect');
        buttons[correctIndex].classList.add('correct');
        feedbackBox.classList.add('feedback-incorrect');
        feedbackBox.innerHTML = `<strong>Incorrecto.</strong> ${quizData[realIndex].explanation}`;
    }

    feedbackBox.classList.add('show');
    nextBtn.style.display = 'block';
    
    document.getElementById('score-counter').innerText = `Aciertos sesi√≥n: ${sessionScore}`;
}

function nextQuestion() {
    if(currentPlaylistIndex < activeIndices.length - 1) {
        currentPlaylistIndex++;
        loadQuestion();
    } else {
        finishQuiz();
    }
}

function finishQuiz() {
    document.getElementById('statusBar').style.display = 'none';
    document.getElementById('quiz-container').style.display = 'none';
    
    const resultsScreen = document.getElementById('results-screen');
    resultsScreen.style.display = 'block';
    
    // Resultados de la sesi√≥n actual
    document.getElementById('final-score').innerText = `${sessionScore}/${activeIndices.length}`;
    const percentage = Math.round((sessionScore / activeIndices.length) * 100);
    
    let text = "";
    if(percentage >= 90) text = "¬°Excelente!";
    else if(percentage >= 70) text = "Muy bien.";
    else if(percentage >= 50) text = "Aprobado.";
    else text = "Sigue repasando.";
    
    document.getElementById('final-msg').innerText = `${percentage}% - ${text}`;

    // Calcular estad√≠sticas globales para los botones
    const totalFailed = quizData.filter(q => q.userCorrect === false).length;
    const totalMarked = quizData.filter(q => q.isMarked === true).length;
    const totalMixed = quizData.filter(q => q.userCorrect === false || q.isMarked).length;

    document.getElementById('stats-summary').innerHTML = `
        Preguntas marcadas para revisi√≥n: <strong>${totalMarked}</strong><br>
        Preguntas falladas (acumulado): <strong>${totalFailed}</strong>
    `;

    // Activar/Desactivar botones
    document.getElementById('btn-failed').disabled = (totalFailed === 0);
    document.getElementById('btn-marked').disabled = (totalMarked === 0);
    document.getElementById('btn-mixed').disabled = (totalMixed === 0);
    
    document.getElementById('btn-failed').innerText = `‚ùå Repetir Falladas (${totalFailed})`;
    document.getElementById('btn-marked').innerText = `‚ö†Ô∏è Repetir Marcadas (${totalMarked})`;
}
</script>

</body>
</html>
