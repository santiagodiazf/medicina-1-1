<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario: Ciclo Celular y Apoptosis (Bloque VIII)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .quiz-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 200px;
        }
        .question-block {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            position: relative; /* Necesario para la pesta√±a de marcar */
        }
        
        /* ESTILO NUEVO: Pesta√±a para Marcar */
        .mark-container {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #555;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s;
            z-index: 10;
        }
        .mark-container:hover {
            background-color: #e2e6ea;
        }
        .mark-container input {
            cursor: pointer;
            transform: scale(1.2);
        }

        .question-title {
            font-size: 1.1em;
            margin-bottom: 15px;
            font-weight: 600;
            padding-right: 90px; /* Espacio para que el texto no tape el marcador */
        }
        .options-list {
            list-style-type: none;
            padding: 0;
        }
        .option-item {
            margin-bottom: 10px;
        }
        .option-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 15px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95em;
            color: #444;
        }
        .option-btn:hover {
            background-color: #f0f0f0;
            border-color: #bbb;
        }
        
        /* Estilos de correcci√≥n */
        .correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
            color: #155724 !important;
            position: relative;
        }
        .correct::after {
            content: " ‚úì Correcto";
            font-weight: bold;
            float: right;
        }
        
        .incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
            color: #721c24 !important;
            position: relative;
        }
        .incorrect::after {
            content: " ‚úó Incorrecto";
            font-weight: bold;
            float: right;
        }

        .disabled {
            pointer-events: none;
            opacity: 0.8;
        }

        /* ESTILO NUEVO: Panel de Resultados */
        #results-panel {
            display: none; /* Oculto al inicio */
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border-top: 5px solid #2c3e50;
        }
        .retry-buttons-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }
        .retry-btn {
            padding: 12px;
            font-size: 1em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            color: white;
            transition: opacity 0.2s;
        }
        .retry-btn:hover { opacity: 0.9; }
        
        /* Colores de botones */
        .btn-full { background-color: #3498db; }    /* Azul */
        .btn-failed { background-color: #e74c3c; }  /* Rojo */
        .btn-marked { background-color: #f39c12; }  /* Naranja */
        .btn-mixed { background-color: #9b59b6; }   /* Morado */

        @media (max-width: 600px) {
            .retry-buttons-grid { grid-template-columns: 1fr; }
            .question-title { padding-right: 0; margin-top: 40px; }
            .mark-container { width: 100%; justify-content: flex-end; border: none; background: transparent; top: -10px;}
        }
    </style>
</head>
<body>

    <h1 id="quiz-title">Test Bloque VIII: Ciclo Celular</h1>
    
    <div class="quiz-container" id="quiz">
        </div>

    <div id="finish-container" style="text-align: center; margin-top: 40px; padding: 20px; background: #eee; border-radius: 8px;">
        <button id="btn-finish" style="background: #2c3e50; color: white; border: none; padding: 15px 30px; font-size: 1.2em; border-radius: 6px; cursor: pointer; font-weight: bold;">
            üèÅ Finalizar y Guardar Nota
        </button>
    </div>

    <div id="results-panel">
        <h2>üìä Resultados</h2>
        <p id="score-text" style="font-size: 1.3em; margin: 20px 0;"></p>
        
        <h3>¬øQu√© deseas hacer ahora?</h3>
        <div class="retry-buttons-grid">
            <button class="retry-btn btn-full" onclick="retryQuiz('all')">üîÑ Repetir Completo</button>
            <button class="retry-btn btn-failed" onclick="retryQuiz('failed')">‚ùå Repetir Falladas</button>
            <button class="retry-btn btn-marked" onclick="retryQuiz('marked')">üîñ Repetir Marcadas</button>
            <button class="retry-btn btn-mixed" onclick="retryQuiz('mixed')">‚ùå + üîñ Falladas y Marcadas</button>
        </div>
        <br>
        <button onclick="window.location.href='index.html'" style="background:transparent; border:1px solid #999; padding:8px 15px; border-radius:4px; cursor:pointer; color:#555;">Volver al Men√∫ Principal</button>
    </div>

    <script>
        // Datos de preguntas originales
        const rawQuestions = [
  {
    "id": "1",
    "text": "El sistema de control del ciclo celular se basa en una compleja red de prote√≠nas reguladoras. El evento molecular central que impulsa el progreso a trav√©s de las fases es la:",
    "options": [
      {
        "text": "Inactivaci√≥n estable de las prote√≠nas Cdk por p27 en la fase S.",
        "correct": false
      },
      {
        "text": "Degradaci√≥n de los factores de crecimiento mediada por el Proteasoma.",
        "correct": false
      },
      {
        "text": "Activaci√≥n c√≠clica de las prote√≠nas Cinasas dependientes de Ciclinas (Cdk).",
        "correct": true
      },
      {
        "text": "Fosforilaci√≥n exclusiva de las condensinas por las S-Cdk en la fase G1.",
        "correct": false
      }
    ]
  },
  {
    "id": "2",
    "text": "Las Cinasas dependientes de Ciclinas (Cdk) est√°n presentes de forma continua durante el ciclo celular. Sin embargo, solo se activan cuando:",
    "options": [
      {
        "text": "Se unen a una ciclina espec√≠fica, formando un complejo Ciclina-Cdk.",
        "correct": true
      },
      {
        "text": "Se fosforilan en sitios inhibidores.",
        "correct": false
      },
      {
        "text": "Se degradan por ubiquitinaci√≥n.",
        "correct": false
      },
      {
        "text": "Se unen al ADN directamente.",
        "correct": false
      }
    ]
  },
  {
    "id": "3",
    "text": "Las concentraciones de ciclinas var√≠an c√≠clicamente. Las ciclinas mit√≥ticas (M-ciclinas) aumentan durante G2 y desencadenan la mitosis al activar:",
    "options": [
      {
        "text": "El complejo S-Cdk.",
        "correct": false
      },
      {
        "text": "El complejo M-Cdk.",
        "correct": true
      },
      {
        "text": "La ADN polimerasa.",
        "correct": false
      },
      {
        "text": "La telomerasa.",
        "correct": false
      }
    ]
  },
  {
    "id": "4",
    "text": "La transici√≥n de G1 a S es un punto de control cr√≠tico llamado 'Punto de Restricci√≥n' o 'Start'. En este punto, la c√©lula se compromete a:",
    "options": [
      {
        "text": "Entrar en G0.",
        "correct": false
      },
      {
        "text": "Completar el ciclo celular y dividirse.",
        "correct": true
      },
      {
        "text": "Iniciar la apoptosis.",
        "correct": false
      },
      {
        "text": "Diferenciarse.",
        "correct": false
      }
    ]
  },
  {
    "id": "5",
    "text": "La actividad de los complejos Cdk-Ciclina puede ser inhibida r√°pidamente por:",
    "options": [
      {
        "text": "Fosforilaci√≥n activadora.",
        "correct": false
      },
      {
        "text": "Prote√≠nas Inhibidoras de Cdk (CKI), como p27, que abrazan y bloquean el complejo.",
        "correct": true
      },
      {
        "text": "S√≠ntesis de nuevas ciclinas.",
        "correct": false
      },
      {
        "text": "La uni√≥n de ATP.",
        "correct": false
      }
    ]
  },
  {
    "id": "6",
    "text": "La degradaci√≥n de ciclinas es un mecanismo irreversible para apagar la actividad Cdk. Este proceso est√° mediado por la ubiquitinaci√≥n a cargo de:",
    "options": [
      {
        "text": "El complejo APC/C (Anaphase Promoting Complex).",
        "correct": true
      },
      {
        "text": "La caspasa 3.",
        "correct": false
      },
      {
        "text": "La fosfatasa Cdc25.",
        "correct": false
      },
      {
        "text": "El ribosoma.",
        "correct": false
      }
    ]
  },
  {
    "id": "7",
    "text": "La fosforilaci√≥n inhibidora de las Cdk es llevada a cabo por la quinasa Wee1. Para activar el complejo M-Cdk al inicio de la mitosis, esta inhibici√≥n debe ser eliminada por:",
    "options": [
      {
        "text": "La fosfatasa Cdc25.",
        "correct": true
      },
      {
        "text": "La quinasa CAK.",
        "correct": false
      },
      {
        "text": "La prote√≠na p53.",
        "correct": false
      },
      {
        "text": "La ubiquitina ligasa.",
        "correct": false
      }
    ]
  },
  {
    "id": "8",
    "text": "En respuesta al da√±o en el ADN en G1, la prote√≠na p53 se estabiliza y activa la transcripci√≥n de p21. La funci√≥n de p21 es:",
    "options": [
      {
        "text": "Reparar el ADN directamente.",
        "correct": false
      },
      {
        "text": "Inhibir los complejos G1/S-Cdk y S-Cdk, deteniendo el ciclo para permitir la reparaci√≥n.",
        "correct": true
      },
      {
        "text": "Promover la entrada en fase S.",
        "correct": false
      },
      {
        "text": "Degradar p53.",
        "correct": false
      }
    ]
  },
  {
    "id": "9",
    "text": "Si el da√±o en el ADN es demasiado severo para ser reparado, p53 induce:",
    "options": [
      {
        "text": "Necrosis.",
        "correct": false
      },
      {
        "text": "Apoptosis (muerte celular programada).",
        "correct": true
      },
      {
        "text": "Diferenciaci√≥n.",
        "correct": false
      },
      {
        "text": "Mitosis r√°pida.",
        "correct": false
      }
    ]
  },
  {
    "id": "10",
    "text": "El complejo APC/C desencadena la anafase al promover la degradaci√≥n de la Securina. La degradaci√≥n de la Securina libera y activa a la enzima:",
    "options": [
      {
        "text": "Cohesina.",
        "correct": false
      },
      {
        "text": "Separasa, que corta las cohesinas.",
        "correct": true
      },
      {
        "text": "Cdk1.",
        "correct": false
      },
      {
        "text": "Condensina.",
        "correct": false
      }
    ]
  },
  {
    "id": "11",
    "text": "Las Cohesinas son complejos proteicos que:",
    "options": [
      {
        "text": "Condensan los cromosomas.",
        "correct": false
      },
      {
        "text": "Mantienen unidas a las crom√°tidas hermanas tras la replicaci√≥n del ADN.",
        "correct": true
      },
      {
        "text": "Forman el huso mit√≥tico.",
        "correct": false
      },
      {
        "text": "Regulan la transcripci√≥n.",
        "correct": false
      }
    ]
  },
  {
    "id": "12",
    "text": "Las Condensinas son responsables de:",
    "options": [
      {
        "text": "Replicar el ADN.",
        "correct": false
      },
      {
        "text": "Compactar los cromosomas al inicio de la mitosis (Profase) para facilitar su segregaci√≥n.",
        "correct": true
      },
      {
        "text": "Separar las crom√°tidas.",
        "correct": false
      },
      {
        "text": "Desensamblar la envoltura nuclear.",
        "correct": false
      }
    ]
  },
  {
    "id": "13",
    "text": "El Cinetocoro es una estructura proteica en el centr√≥mero que sirve como sitio de uni√≥n para:",
    "options": [
      {
        "text": "Los microt√∫bulos del huso mit√≥tico.",
        "correct": true
      },
      {
        "text": "Los filamentos de actina.",
        "correct": false
      },
      {
        "text": "Las cohesinas.",
        "correct": false
      },
      {
        "text": "Los ribosomas.",
        "correct": false
      }
    ]
  },
  {
    "id": "14",
    "text": "Durante la Profase, el evento clave es:",
    "options": [
      {
        "text": "La separaci√≥n de crom√°tidas.",
        "correct": false
      },
      {
        "text": "La condensaci√≥n de los cromosomas y el inicio de la formaci√≥n del huso mit√≥tico.",
        "correct": true
      },
      {
        "text": "La ruptura de la envoltura nuclear.",
        "correct": false
      },
      {
        "text": "La citocinesis.",
        "correct": false
      }
    ]
  },
  {
    "id": "15",
    "text": "La Prometafase comienza abruptamente con:",
    "options": [
      {
        "text": "La duplicaci√≥n del centrosoma.",
        "correct": false
      },
      {
        "text": "El desensamblaje de la envoltura nuclear (fosforilaci√≥n de l√°minas), permitiendo a los microt√∫bulos acceder a los cromosomas.",
        "correct": true
      },
      {
        "text": "La alineaci√≥n en el ecuador.",
        "correct": false
      },
      {
        "text": "La s√≠ntesis de ADN.",
        "correct": false
      }
    ]
  },
  {
    "id": "16",
    "text": "En la Metafase, los cromosomas se encuentran:",
    "options": [
      {
        "text": "En los polos opuestos.",
        "correct": false
      },
      {
        "text": "Alineados en el ecuador del huso (placa metaf√°sica) bajo tensi√≥n.",
        "correct": true
      },
      {
        "text": "Descondensados.",
        "correct": false
      },
      {
        "text": "En el citosol dispersos.",
        "correct": false
      }
    ]
  },
  {
    "id": "17",
    "text": "La Anafase se desencadena por la p√©rdida de cohesi√≥n entre crom√°tidas hermanas, permitiendo su:",
    "options": [
      {
        "text": "Replicaci√≥n.",
        "correct": false
      },
      {
        "text": "Separaci√≥n y movimiento hacia los polos opuestos del huso.",
        "correct": true
      },
      {
        "text": "Condensaci√≥n m√°xima.",
        "correct": false
      },
      {
        "text": "Fusi√≥n.",
        "correct": false
      }
    ]
  },
  {
    "id": "18",
    "text": "Durante la Telofase:",
    "options": [
      {
        "text": "Los cromosomas se condensan m√°s.",
        "correct": false
      },
      {
        "text": "Se reensambla la envoltura nuclear alrededor de cada juego de cromosomas hijos y estos se descondensan.",
        "correct": true
      },
      {
        "text": "Se rompe el huso mit√≥tico completamente.",
        "correct": false
      },
      {
        "text": "Se duplica el ADN.",
        "correct": false
      }
    ]
  },
  {
    "id": "19",
    "text": "La Citoquinesis es la divisi√≥n del citoplasma. En c√©lulas animales, es mediada por:",
    "options": [
      {
        "text": "Una pared celular nueva.",
        "correct": false
      },
      {
        "text": "Un anillo contr√°ctil de filamentos de actina y miosina II.",
        "correct": true
      },
      {
        "text": "Microt√∫bulos del huso.",
        "correct": false
      },
      {
        "text": "Ves√≠culas del Golgi.",
        "correct": false
      }
    ]
  },
  {
    "id": "20",
    "text": "El anillo contr√°ctil se forma en:",
    "options": [
      {
        "text": "La Profase.",
        "correct": false
      },
      {
        "text": "La Anafase tard√≠a o Telofase, perpendicular al eje del huso.",
        "correct": true
      },
      {
        "text": "La Metafase.",
        "correct": false
      },
      {
        "text": "G1.",
        "correct": false
      }
    ]
  },
  {
    "id": "21",
    "text": "Los Mit√≥genos estimulan la divisi√≥n celular activando la v√≠a de las MAP quinasas, lo que conduce a la s√≠ntesis de ciclinas G1 y:",
    "options": [
      {
        "text": "La entrada en fase S.",
        "correct": true
      },
      {
        "text": "La apoptosis.",
        "correct": false
      },
      {
        "text": "La diferenciaci√≥n.",
        "correct": false
      },
      {
        "text": "La senescencia.",
        "correct": false
      }
    ]
  },
  {
    "id": "22",
    "text": "Los Factores de Crecimiento estimulan el crecimiento celular (aumento de masa) promoviendo:",
    "options": [
      {
        "text": "La degradaci√≥n de prote√≠nas.",
        "correct": false
      },
      {
        "text": "La s√≠ntesis de prote√≠nas y macromol√©culas e inhibiendo su degradaci√≥n (v√≠a mTOR).",
        "correct": true
      },
      {
        "text": "La divisi√≥n sin crecimiento.",
        "correct": false
      },
      {
        "text": "La condensaci√≥n de cromatina.",
        "correct": false
      }
    ]
  },
  {
    "id": "23",
    "text": "Los Factores de Supervivencia suprimen la apoptosis regulando:",
    "options": [
      {
        "text": "La familia de prote√≠nas Bcl2 (aumentando anti-apopt√≥ticas como Bcl2).",
        "correct": true
      },
      {
        "text": "La actividad de la telomerasa.",
        "correct": false
      },
      {
        "text": "La formaci√≥n del huso.",
        "correct": false
      },
      {
        "text": "La s√≠ntesis de ADN.",
        "correct": false
      }
    ]
  },
  {
    "id": "24",
    "text": "La Apoptosis es un proceso limpio y ordenado, mediado por caspasas, que evita:",
    "options": [
      {
        "text": "La diferenciaci√≥n.",
        "correct": false
      },
      {
        "text": "La respuesta inflamatoria y el da√±o a c√©lulas vecinas (a diferencia de la necrosis).",
        "correct": true
      },
      {
        "text": "La fagocitosis.",
        "correct": false
      },
      {
        "text": "El reciclaje de componentes.",
        "correct": false
      }
    ]
  },
  {
    "id": "25",
    "text": "La Necrosis es una muerte celular accidental causada por da√±o agudo, caracterizada por:",
    "options": [
      {
        "text": "Condensaci√≥n nuclear.",
        "correct": false
      },
      {
        "text": "Hinchaz√≥n, lisis celular y liberaci√≥n del contenido al exterior, provocando inflamaci√≥n.",
        "correct": true
      },
      {
        "text": "Formaci√≥n de cuerpos apopt√≥ticos.",
        "correct": false
      },
      {
        "text": "Activaci√≥n de caspasas.",
        "correct": false
      }
    ]
  },
  {
    "id": "26",
    "text": "Las Caspasas son proteasas que se sintetizan como precursores inactivos (procaspasas). Su activaci√≥n implica:",
    "options": [
      {
        "text": "Fosforilaci√≥n.",
        "correct": false
      },
      {
        "text": "Corte proteol√≠tico y ensamblaje, iniciando una cascada de amplificaci√≥n.",
        "correct": true
      },
      {
        "text": "Uni√≥n a GTP.",
        "correct": false
      },
      {
        "text": "Metilaci√≥n.",
        "correct": false
      }
    ]
  },
  {
    "id": "27",
    "text": "Bcl2 y Bcl-XL son miembros de la familia Bcl2 que:",
    "options": [
      {
        "text": "Promueven la liberaci√≥n de citocromo c.",
        "correct": false
      },
      {
        "text": "Inhiben la apoptosis bloqueando la liberaci√≥n de citocromo c (anti-apopt√≥ticas).",
        "correct": true
      },
      {
        "text": "Son factores de transcripci√≥n.",
        "correct": false
      },
      {
        "text": "Activan caspasas.",
        "correct": false
      }
    ]
  },
  {
    "id": "28",
    "text": "Bax y Bak son miembros de la familia Bcl2 que:",
    "options": [
      {
        "text": "Inhiben la apoptosis.",
        "correct": false
      },
      {
        "text": "Promueven la apoptosis formando canales en la membrana mitocondrial para liberar citocromo c (pro-apopt√≥ticas).",
        "correct": true
      },
      {
        "text": "Reparan el ADN.",
        "correct": false
      },
      {
        "text": "Estabilizan los microt√∫bulos.",
        "correct": false
      }
    ]
  },
  {
    "id": "29",
    "text": "La liberaci√≥n de Citocromo c al citosol activa la formaci√≥n del Apoptosoma, que recluta y activa a:",
    "options": [
      {
        "text": "La procaspasa-9.",
        "correct": true
      },
      {
        "text": "La ciclina B.",
        "correct": false
      },
      {
        "text": "La prote√≠na p53.",
        "correct": false
      },
      {
        "text": "La actina.",
        "correct": false
      }
    ]
  },
  {
    "id": "30",
    "text": "La v√≠a extr√≠nseca de la apoptosis se activa por:",
    "options": [
      {
        "text": "Da√±o en el ADN.",
        "correct": false
      },
      {
        "text": "La uni√≥n de un ligando de muerte (ej. Fas ligando) a un receptor de muerte en la superficie celular.",
        "correct": true
      },
      {
        "text": "Falta de nutrientes.",
        "correct": false
      },
      {
        "text": "Estr√©s del RE.",
        "correct": false
      }
    ]
  },
  {
    "id": "31",
    "text": "En ausencia de mit√≥genos, las c√©lulas pueden retirarse del ciclo celular a un estado de reposo llamado:",
    "options": [
      {
        "text": "Fase S.",
        "correct": false
      },
      {
        "text": "Fase G0.",
        "correct": true
      },
      {
        "text": "Mitosis.",
        "correct": false
      },
      {
        "text": "Apoptosis.",
        "correct": false
      }
    ]
  },
  {
    "id": "32",
    "text": "La prote√≠na Retinoblastoma (Rb) inhibe la progresi√≥n del ciclo celular en G1 al unirse e inactivar a:",
    "options": [
      {
        "text": "Las Cdk.",
        "correct": false
      },
      {
        "text": "Los factores de transcripci√≥n E2F (necesarios para la s√≠ntesis de fase S).",
        "correct": true
      },
      {
        "text": "La helicasa.",
        "correct": false
      },
      {
        "text": "Las ciclinas.",
        "correct": false
      }
    ]
  },
  {
    "id": "33",
    "text": "La Interfase comprende las fases:",
    "options": [
      {
        "text": "Profase, Metafase, Anafase.",
        "correct": false
      },
      {
        "text": "G1, S, G2.",
        "correct": true
      },
      {
        "text": "Solo S.",
        "correct": false
      },
      {
        "text": "Mitosis y Citocinesis.",
        "correct": false
      }
    ]
  },
  {
    "id": "34",
    "text": "La duplicaci√≥n del Centrosoma comienza en:",
    "options": [
      {
        "text": "La Mitosis.",
        "correct": false
      },
      {
        "text": "La Fase G1/S, coordinada con la replicaci√≥n del ADN.",
        "correct": true
      },
      {
        "text": "La Telofase.",
        "correct": false
      },
      {
        "text": "La fase G0.",
        "correct": false
      }
    ]
  },
  {
    "id": "35",
    "text": "El control de la prote√≥lisis (degradaci√≥n de prote√≠nas) es crucial para:",
    "options": [
      {
        "text": "Iniciar la transcripci√≥n.",
        "correct": false
      },
      {
        "text": "Las transiciones irreversibles del ciclo (ej. Metafase-Anafase).",
        "correct": true
      },
      {
        "text": "Reparar el ADN.",
        "correct": false
      },
      {
        "text": "Sintetizar ATP.",
        "correct": false
      }
    ]
  },
  {
    "id": "36",
    "text": "La quinasa Wee1 inhibe la actividad Cdk fosforilando un sitio clave. ¬øQu√© enzima revierte esta inhibici√≥n?",
    "options": [
      {
        "text": "Cdc25 fosfatasa.",
        "correct": true
      },
      {
        "text": "PKA.",
        "correct": false
      },
      {
        "text": "APC/C.",
        "correct": false
      },
      {
        "text": "Caspasa.",
        "correct": false
      }
    ]
  },
  {
    "id": "37",
    "text": "El punto de control G2/M asegura que:",
    "options": [
      {
        "text": "El entorno sea favorable.",
        "correct": false
      },
      {
        "text": "Todo el ADN est√© replicado y no da√±ado antes de entrar en mitosis.",
        "correct": true
      },
      {
        "text": "Los cromosomas est√©n alineados.",
        "correct": false
      },
      {
        "text": "La c√©lula tenga el tama√±o adecuado.",
        "correct": false
      }
    ]
  },
  {
    "id": "38",
    "text": "El punto de control de la Metafase (o del huso) impide la anafase si:",
    "options": [
      {
        "text": "El ADN est√° da√±ado.",
        "correct": false
      },
      {
        "text": "Alg√∫n cromosoma no est√° correctamente unido al huso mit√≥tico.",
        "correct": true
      },
      {
        "text": "Faltan nutrientes.",
        "correct": false
      },
      {
        "text": "La c√©lula es peque√±a.",
        "correct": false
      }
    ]
  },
  {
    "id": "39",
    "text": "El huso mit√≥tico est√° formado por tres tipos de microt√∫bulos: Astrales, Cinetoc√≥ricos e:",
    "options": [
      {
        "text": "Intermedios.",
        "correct": false
      },
      {
        "text": "Interpolares.",
        "correct": true
      },
      {
        "text": "De actina.",
        "correct": false
      },
      {
        "text": "De miosina.",
        "correct": false
      }
    ]
  },
  {
    "id": "40",
    "text": "El anillo contr√°ctil divide el citoplasma mediante un mecanismo de:",
    "options": [
      {
        "text": "Polimerizaci√≥n de tubulina.",
        "correct": false
      },
      {
        "text": "Deslizamiento de filamentos de actina y miosina II.",
        "correct": true
      },
      {
        "text": "Fusi√≥n de ves√≠culas.",
        "correct": false
      },
      {
        "text": "√ìsmosis.",
        "correct": false
      }
    ]
  },
  {
    "id": "41",
    "text": "Los microt√∫bulos astrales irradian desde el centrosoma hacia:",
    "options": [
      {
        "text": "Los cromosomas.",
        "correct": false
      },
      {
        "text": "La corteza celular, ayudando a posicionar el huso.",
        "correct": true
      },
      {
        "text": "El otro centrosoma.",
        "correct": false
      },
      {
        "text": "El n√∫cleo.",
        "correct": false
      }
    ]
  },
  {
    "id": "42",
    "text": "Los microt√∫bulos interpolares interact√∫an entre s√≠ desde polos opuestos para:",
    "options": [
      {
        "text": "Capturar cromosomas.",
        "correct": false
      },
      {
        "text": "Estabilizar el huso y empujar los polos (Anafase B).",
        "correct": true
      },
      {
        "text": "Degradar prote√≠nas.",
        "correct": false
      },
      {
        "text": "Formar la envoltura nuclear.",
        "correct": false
      }
    ]
  },
  {
    "id": "43",
    "text": "La tensi√≥n generada por la uni√≥n bipolar de los microt√∫bulos a los cinetocoros es la se√±al que:",
    "options": [
      {
        "text": "Detiene la anafase.",
        "correct": false
      },
      {
        "text": "Confirma la correcta alineaci√≥n y permite el paso a la Anafase (silencia el checkpoint).",
        "correct": true
      },
      {
        "text": "Inicia la apoptosis.",
        "correct": false
      },
      {
        "text": "Degrada el ADN.",
        "correct": false
      }
    ]
  },
  {
    "id": "44",
    "text": "La Separasa es la proteasa que corta las cohesinas. Normalmente est√° inhibida por:",
    "options": [
      {
        "text": "Cdk.",
        "correct": false
      },
      {
        "text": "Securina.",
        "correct": true
      },
      {
        "text": "Ciclina.",
        "correct": false
      },
      {
        "text": "p53.",
        "correct": false
      }
    ]
  },
  {
    "id": "45",
    "text": "El complejo APC/C marca a la Securina para su degradaci√≥n, lo que permite:",
    "options": [
      {
        "text": "La entrada en fase S.",
        "correct": false
      },
      {
        "text": "La activaci√≥n de la Separasa y el inicio de la Anafase.",
        "correct": true
      },
      {
        "text": "La condensaci√≥n de cromosomas.",
        "correct": false
      },
      {
        "text": "La replicaci√≥n del ADN.",
        "correct": false
      }
    ]
  },
  {
    "id": "46",
    "text": "En la Anafase A:",
    "options": [
      {
        "text": "Los polos se separan.",
        "correct": false
      },
      {
        "text": "Los cromosomas son arrastrados hacia los polos por el acortamiento de los microt√∫bulos del cinetocoro.",
        "correct": true
      },
      {
        "text": "La envoltura nuclear se rompe.",
        "correct": false
      },
      {
        "text": "Se forma el anillo contr√°ctil.",
        "correct": false
      }
    ]
  },
  {
    "id": "47",
    "text": "En la Anafase B:",
    "options": [
      {
        "text": "Los cromosomas se condensan.",
        "correct": false
      },
      {
        "text": "Los polos del huso se separan entre s√≠ (elongaci√≥n del huso).",
        "correct": true
      },
      {
        "text": "El ADN se replica.",
        "correct": false
      },
      {
        "text": "Las cohesinas se rompen.",
        "correct": false
      }
    ]
  },
  {
    "id": "48",
    "text": "¬øQu√© prote√≠na relacionada con el citoesqueleto de actina NO es esencial para la formaci√≥n del anillo contr√°ctil?",
    "options": [
      {
        "text": "Miosina II.",
        "correct": false
      },
      {
        "text": "Actina.",
        "correct": false
      },
      {
        "text": "Fragmina (prote√≠na de corte de actina, no formadora de anillos).",
        "correct": true
      },
      {
        "text": "Formina.",
        "correct": false
      }
    ]
  },
  {
    "id": "49",
    "text": "La reformaci√≥n de la envoltura nuclear en la Telofase se debe a:",
    "options": [
      {
        "text": "La degradaci√≥n de l√°minas.",
        "correct": false
      },
      {
        "text": "La desfosforilaci√≥n de las prote√≠nas de la l√°mina nuclear y los poros nucleares.",
        "correct": true
      },
      {
        "text": "La s√≠ntesis de nuevos l√≠pidos.",
        "correct": false
      },
      {
        "text": "La acci√≥n de la separasa.",
        "correct": false
      }
    ]
  },
  {
    "id": "50",
    "text": "Durante la mitosis, org√°nulos como las mitocondrias se:",
    "options": [
      {
        "text": "Degradan.",
        "correct": false
      },
      {
        "text": "Reparten aleatoriamente entre las c√©lulas hijas (si hay suficientes).",
        "correct": true
      },
      {
        "text": "Fusionan en una sola.",
        "correct": false
      },
      {
        "text": "Replican su ADN.",
        "correct": false
      }
    ]
  },
  {
    "id": "51",
    "text": "El Ret√≠culo Endoplasm√°tico y el Golgi sufren _____ durante la mitosis para facilitar su reparto.",
    "options": [
      {
        "text": "Expansi√≥n.",
        "correct": false
      },
      {
        "text": "Fragmentaci√≥n (o reorganizaci√≥n).",
        "correct": true
      },
      {
        "text": "Desaparici√≥n total.",
        "correct": false
      },
      {
        "text": "Fusi√≥n nuclear.",
        "correct": false
      }
    ]
  },
  {
    "id": "52",
    "text": "La Miostatina es un ejemplo de se√±al extracelular que:",
    "options": [
      {
        "text": "Estimula el crecimiento muscular.",
        "correct": false
      },
      {
        "text": "Inhibe el crecimiento y la proliferaci√≥n de mioblastos (regulaci√≥n negativa del tama√±o).",
        "correct": true
      },
      {
        "text": "Promueve la apoptosis.",
        "correct": false
      },
      {
        "text": "Activa la telomerasa.",
        "correct": false
      }
    ]
  },
  {
    "id": "53",
    "text": "La iniciaci√≥n de la replicaci√≥n del ADN ocurre:",
    "options": [
      {
        "text": "Continuamente.",
        "correct": false
      },
      {
        "text": "Una sola vez por ciclo celular.",
        "correct": true
      },
      {
        "text": "En fase M.",
        "correct": false
      },
      {
        "text": "En G2.",
        "correct": false
      }
    ]
  },
  {
    "id": "54",
    "text": "El complejo ORC (Origin Recognition Complex) se une a los or√≠genes de replicaci√≥n y permanece all√≠:",
    "options": [
      {
        "text": "Solo en fase S.",
        "correct": false
      },
      {
        "text": "Durante todo el ciclo celular.",
        "correct": true
      },
      {
        "text": "Solo en mitosis.",
        "correct": false
      },
      {
        "text": "Solo en G0.",
        "correct": false
      }
    ]
  },
  {
    "id": "55",
    "text": "En G1, la prote√≠na Cdc6 ayuda a cargar las helicasas del ADN en el ORC, formando el:",
    "options": [
      {
        "text": "Complejo pre-replicativo (pre-RC).",
        "correct": true
      },
      {
        "text": "Huso mit√≥tico.",
        "correct": false
      },
      {
        "text": "Poro nuclear.",
        "correct": false
      },
      {
        "text": "Apoptosoma.",
        "correct": false
      }
    ]
  },
  {
    "id": "56",
    "text": "La activaci√≥n de S-Cdk inicia la replicaci√≥n y tambi√©n:",
    "options": [
      {
        "text": "Bloquea la re-replicaci√≥n (fosforilando Cdc6 y ORC).",
        "correct": true
      },
      {
        "text": "Detiene el ciclo.",
        "correct": false
      },
      {
        "text": "Condensa los cromosomas.",
        "correct": false
      },
      {
        "text": "Degrada el ADN.",
        "correct": false
      }
    ]
  },
  {
    "id": "57",
    "text": "La fase M (Mitosis + Citocinesis) es t√≠picamente:",
    "options": [
      {
        "text": "La fase m√°s larga del ciclo.",
        "correct": false
      },
      {
        "text": "La fase m√°s corta del ciclo.",
        "correct": true
      },
      {
        "text": "Igual que G1.",
        "correct": false
      },
      {
        "text": "Ausente en c√©lulas cancerosas.",
        "correct": false
      }
    ]
  },
  {
    "id": "58",
    "text": "La fase G1 es un intervalo de:",
    "options": [
      {
        "text": "Divisi√≥n.",
        "correct": false
      },
      {
        "text": "Crecimiento y monitorizaci√≥n del entorno antes de la replicaci√≥n.",
        "correct": true
      },
      {
        "text": "S√≠ntesis de ADN.",
        "correct": false
      },
      {
        "text": "Segregaci√≥n de cromosomas.",
        "correct": false
      }
    ]
  },
  {
    "id": "59",
    "text": "La fase G2 permite:",
    "options": [
      {
        "text": "La replicaci√≥n del ADN.",
        "correct": false
      },
      {
        "text": "Verificar la replicaci√≥n y crecer antes de la mitosis.",
        "correct": true
      },
      {
        "text": "La citocinesis.",
        "correct": false
      },
      {
        "text": "La entrada en G0.",
        "correct": false
      }
    ]
  },
  {
    "id": "60",
    "text": "Las Cdk son quinasas de Serina/Treonina. Su nivel de prote√≠na es:",
    "options": [
      {
        "text": "C√≠clico.",
        "correct": false
      },
      {
        "text": "Constante a lo largo del ciclo.",
        "correct": true
      },
      {
        "text": "Nulo en G1.",
        "correct": false
      },
      {
        "text": "Indetectable.",
        "correct": false
      }
    ]
  },
  {
    "id": "61",
    "text": "Los niveles de Ciclinas son:",
    "options": [
      {
        "text": "Constantes.",
        "correct": false
      },
      {
        "text": "Fluctuantes (c√≠clicos), sintetiz√°ndose y degrad√°ndose en cada ciclo.",
        "correct": true
      },
      {
        "text": "Independientes del ciclo.",
        "correct": false
      },
      {
        "text": "Siempre altos.",
        "correct": false
      }
    ]
  },
  {
    "id": "62",
    "text": "Las prote√≠nas CKI (ej. p27, p21) funcionan uni√©ndose al complejo Cdk-Ciclina y:",
    "options": [
      {
        "text": "Activ√°ndolo.",
        "correct": false
      },
      {
        "text": "Inhibi√©ndolo conformacionalmente.",
        "correct": true
      },
      {
        "text": "Degrad√°ndolo.",
        "correct": false
      },
      {
        "text": "Export√°ndolo al n√∫cleo.",
        "correct": false
      }
    ]
  },
  {
    "id": "63",
    "text": "La Prote√≥lisis regulada (ubiquitinaci√≥n) es clave para:",
    "options": [
      {
        "text": "Iniciar el ciclo.",
        "correct": false
      },
      {
        "text": "Las transiciones irreversibles del ciclo (ej. Metafase-Anafase).",
        "correct": true
      },
      {
        "text": "La s√≠ntesis de ADN.",
        "correct": false
      },
      {
        "text": "La transcripci√≥n.",
        "correct": false
      }
    ]
  },
  {
    "id": "64",
    "text": "La regulaci√≥n transcripcional controla la s√≠ntesis de:",
    "options": [
      {
        "text": "Cdk.",
        "correct": false
      },
      {
        "text": "Ciclinas (en momentos espec√≠ficos).",
        "correct": true
      },
      {
        "text": "ATP.",
        "correct": false
      },
      {
        "text": "Agua.",
        "correct": false
      }
    ]
  },
  {
    "id": "65",
    "text": "El movimiento de los cromosomas en la prometafase ('congregaci√≥n') hacia la placa metaf√°sica es dirigido por:",
    "options": [
      {
        "text": "La actina.",
        "correct": false
      },
      {
        "text": "Los microt√∫bulos del cinetocoro y prote√≠nas motoras.",
        "correct": true
      },
      {
        "text": "Los filamentos intermedios.",
        "correct": false
      },
      {
        "text": "La membrana nuclear.",
        "correct": false
      }
    ]
  },
  {
    "id": "66",
    "text": "La Mecanotransducci√≥n implica que las c√©lulas del entorno influyen en la divisi√≥n. Si los Mit√≥genos promueven la divisi√≥n celular (G1-S), ¬øqu√© ocurrir√≠a si estas se√±ales fueran retiradas de un cultivo celular antes de que la c√©lula supere la Fase G1?",
    "options": [
      {
        "text": "La c√©lula entrar√≠a en la Fase S inmediatamente.",
        "correct": false
      },
      {
        "text": "La c√©lula permanecer√≠a en G1 o entrar√≠a en G0.",
        "correct": true
      },
      {
        "text": "Se activar√≠a la cascada de caspasas.",
        "correct": false
      },
      {
        "text": "El complejo APC/C degradar√≠a las ciclinas.",
        "correct": false
      }
    ]
  },
  {
    "id": "67",
    "text": "La activaci√≥n de los receptores de muerte (como el Receptor Fas) en la superficie celular desencadena la apoptosis al:",
    "options": [
      {
        "text": "Bloquear el progreso de G1 a S.",
        "correct": false
      },
      {
        "text": "Activar la cascada de caspasas extr√≠nseca.",
        "correct": true
      },
      {
        "text": "Activar directamente la s√≠ntesis de ciclinas.",
        "correct": false
      },
      {
        "text": "Inducir la desfosforilaci√≥n de la envoltura nuclear.",
        "correct": false
      }
    ]
  },
  {
    "id": "68",
    "text": "Si el APC/C no se activara correctamente al final de la Fase M, ¬øcu√°l ser√≠a la consecuencia molecular inmediata en la c√©lula?",
    "options": [
      {
        "text": "El ADN no se replicar√≠a.",
        "correct": false
      },
      {
        "text": "Las cohesinas no se escindir√≠an y la anafase no ocurrir√≠a.",
        "correct": true
      },
      {
        "text": "Las Cdk permanecer√≠an inactivas.",
        "correct": false
      },
      {
        "text": "Las c√©lulas terminalmente diferenciadas reingresar√≠an al ciclo.",
        "correct": false
      }
    ]
  },
  {
    "id": "69",
    "text": "La coreograf√≠a molecular de la Mitosis requiere que el huso mit√≥tico se ensamble en el citosol tras el desensamblaje de la envoltura nuclear, pero son los propios cromosomas duplicados los que ayudan a:",
    "options": [
      {
        "text": "Detener el ciclo en G1.",
        "correct": false
      },
      {
        "text": "Estabilizar y ensamblar el huso mit√≥tico (nucleaci√≥n local).",
        "correct": true
      },
      {
        "text": "Inactivar el complejo S-Cdk.",
        "correct": false
      },
      {
        "text": "Degradar las prote√≠nas por el Proteasoma.",
        "correct": false
      }
    ]
  },
  {
    "id": "70",
    "text": "¬øCu√°l es el estado celular m√°s susceptible a la inducci√≥n de la apoptosis, dado que el equilibrio entre factores de supervivencia, mit√≥genos y factores de crecimiento regula si la c√©lula debe vivir, dividirse o morir?",
    "options": [
      {
        "text": "C√©lulas que carecen de se√±ales de supervivencia.",
        "correct": true
      },
      {
        "text": "C√©lulas en estado de reposo G0 permanente.",
        "correct": false
      },
      {
        "text": "C√©lulas que han completado la Fase S y tienen ADN replicado.",
        "correct": false
      },
      {
        "text": "C√©lulas con una alta concentraci√≥n de ciclinas M.",
        "correct": false
      }
    ]
  },
  {
    "id": "71",
    "text": "Un evento ultraestructural de la c√©lula que indica que est√° saliendo de la Fase M (Mitosis) es la aparici√≥n de:",
    "options": [
      {
        "text": "La formaci√≥n de la placa metaf√°sica.",
        "correct": false
      },
      {
        "text": "La condensaci√≥n de los cromosomas.",
        "correct": false
      },
      {
        "text": "El surco de segmentaci√≥n (o cleavage furrow).",
        "correct": true
      },
      {
        "text": "La escisi√≥n de las cohesinas.",
        "correct": false
      }
    ]
  },
  {
    "id": "72",
    "text": "La acci√≥n de los factores de crecimiento, al aumentar la s√≠ntesis de prote√≠nas, contrarresta la acci√≥n molecular de las hormonas o se√±ales que:",
    "options": [
      {
        "text": "Promueven la apoptosis (Bax/Bak).",
        "correct": false
      },
      {
        "text": "Disminuyen la velocidad de degradaci√≥n.",
        "correct": false
      },
      {
        "text": "Inhiben la s√≠ntesis de macromol√©culas (antagonistas del crecimiento).",
        "correct": true
      },
      {
        "text": "Activaci√≥n c√≠clica de las Cdk.",
        "correct": false
      }
    ]
  },
  {
    "id": "73",
    "text": "El complejo M-Cdk tiene una funci√≥n clave en la Metafase. Su rol incluye preparar los cromosomas duplicados para la segregaci√≥n e inducir:",
    "options": [
      {
        "text": "La escisi√≥n de las cohesinas.",
        "correct": false
      },
      {
        "text": "El ensamblado del huso mit√≥tico.",
        "correct": true
      },
      {
        "text": "La degradaci√≥n de las prote√≠nas por p53.",
        "correct": false
      },
      {
        "text": "La replicaci√≥n del ADN.",
        "correct": false
      }
    ]
  },
  {
    "id": "74",
    "text": "¬øQu√© requisito molecular, si se detecta como incorrecto, detendr√≠a el ciclo en G2, evitando que la c√©lula pase a la Fase M?",
    "options": [
      {
        "text": "Da√±o en el ADN (Fase G1).",
        "correct": false
      },
      {
        "text": "Duplicaci√≥n incompleta del centrosoma (Fase M).",
        "correct": false
      },
      {
        "text": "Replicaci√≥n incompleta del ADN o da√±o en el ADN.",
        "correct": true
      },
      {
        "text": "Un cinetocoro libre (Fase M).",
        "correct": false
      }
    ]
  },
  {
    "id": "75",
    "text": "La Necrosis, en contraste con la Apoptosis, se caracteriza por desencadenar una respuesta:",
    "options": [
      {
        "text": "De crecimiento celular.",
        "correct": false
      },
      {
        "text": "Inflamatoria.",
        "correct": true
      },
      {
        "text": "De inhibici√≥n de Cdk.",
        "correct": false
      },
      {
        "text": "De activaci√≥n de caspasas.",
        "correct": false
      }
    ]
  },
  {
    "id": "76",
    "text": "Las concentraciones de Cdk son estables a lo largo del ciclo, pero su activaci√≥n depende de las Ciclinas. Esta regulaci√≥n garantiza que:",
    "options": [
      {
        "text": "La APC/C se mantenga inactiva.",
        "correct": false
      },
      {
        "text": "Las enzimas de control del ciclo sean activadas y desactivadas c√≠clicamente.",
        "correct": true
      },
      {
        "text": "La prote√≠na p27 se una permanentemente.",
        "correct": false
      },
      {
        "text": "La replicaci√≥n se bloquee en G1.",
        "correct": false
      }
    ]
  },
  {
    "id": "77",
    "text": "¬øCu√°l es la consecuencia de la fosforilaci√≥n de los complejos Condensinas por M-Cdk?",
    "options": [
      {
        "text": "Se inicia la s√≠ntesis de ciclinas.",
        "correct": false
      },
      {
        "text": "Se desencadena la condensaci√≥n de los cromosomas.",
        "correct": true
      },
      {
        "text": "Se desensambla el huso mit√≥tico.",
        "correct": false
      },
      {
        "text": "Se libera el Citocromo C.",
        "correct": false
      }
    ]
  },
  {
    "id": "78",
    "text": "La Citoquinesis es un proceso de reparto de org√°nulos. ¬øQu√© org√°nulo es el √∫nico que se menciona que se duplica antes de la Citoquinesis para ser repartido?",
    "options": [
      {
        "text": "Ret√≠culo endoplasm√°tico (fragmentos).",
        "correct": false
      },
      {
        "text": "Aparato de Golgi (fragmentos).",
        "correct": false
      },
      {
        "text": "Ribosomas (reparto aleatorio).",
        "correct": false
      },
      {
        "text": "Mitocondrias (y cloroplastos).",
        "correct": true
      }
    ]
  },
  {
    "id": "79",
    "text": "En el contexto de la regulaci√≥n molecular, las prote√≠nas de la familia Bcl2 est√°n en la interfaz cr√≠tica entre la se√±alizaci√≥n de supervivencia (factores de supervivencia) y la:",
    "options": [
      {
        "text": "Inestabilidad din√°mica de los microt√∫bulos.",
        "correct": false
      },
      {
        "text": "La inducci√≥n de la apoptosis (v√≠a intr√≠nseca).",
        "correct": true
      },
      {
        "text": "La divisi√≥n celular mediada por mit√≥genos.",
        "correct": false
      },
      {
        "text": "La inactivaci√≥n de p53.",
        "correct": false
      }
    ]
  },
  {
    "id": "80",
    "text": "Si una c√©lula muscular ya est√° terminalmente diferenciada (en G0 permanente), ¬øqu√© evento molecular hace que la c√©lula sea refractaria a los Mit√≥genos?",
    "options": [
      {
        "text": "La escisi√≥n de las cohesinas.",
        "correct": false
      },
      {
        "text": "La inactivaci√≥n irreversible de los genes de ciclinas y Cdk.",
        "correct": true
      },
      {
        "text": "La activaci√≥n transitoria de p53.",
        "correct": false
      },
      {
        "text": "El uso del APC/C para degradar ciclinas",
        "correct": false
      }
    ]
  }
];

        // A√±adimos propiedades de estado a las preguntas
        // userMarked: si el usuario marc√≥ la pregunta para revisar
        // userFailed: si el usuario fall√≥ la pregunta en alg√∫n momento
        // userAnswered: si la pregunta ha sido respondida en la ronda actual
        const questions = rawQuestions.map(q => ({
            ...q,
            userMarked: false,
            userFailed: false,
            userAnswered: false,
            shuffledOptions: null 
        }));

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Renderiza el quiz con la lista de preguntas proporcionada
        function renderQuiz(questionsToRender) {
            const quizContainer = document.getElementById('quiz');
            quizContainer.innerHTML = '';
            
            // Ocultar resultados y mostrar bot√≥n finalizar
            document.getElementById('results-panel').style.display = 'none';
            document.getElementById('finish-container').style.display = 'block';

            if(questionsToRender.length === 0) {
                quizContainer.innerHTML = '<p style="text-align:center; padding:20px; font-style:italic; color:#666;">No hay preguntas que coincidan con este criterio.</p>';
                document.getElementById('finish-container').style.display = 'none';
                document.getElementById('results-panel').style.display = 'block';
                return;
            }

            questionsToRender.forEach((q) => {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';

                // --- Pesta√±a "Marcar" ---
                const markContainer = document.createElement('label');
                markContainer.className = 'mark-container';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = q.userMarked;
                checkbox.onchange = function() {
                    q.userMarked = this.checked;
                };
                markContainer.appendChild(checkbox);
                markContainer.appendChild(document.createTextNode(" Marcar"));
                questionBlock.appendChild(markContainer);

                // --- T√≠tulo ---
                const title = document.createElement('div');
                title.className = 'question-title';
                title.innerText = `${q.id}. ${q.text}`;
                questionBlock.appendChild(title);

                // --- Opciones ---
                if (!q.shuffledOptions) {
                    q.shuffledOptions = [...q.options];
                    shuffleArray(q.shuffledOptions);
                }

                const optionsList = document.createElement('ul');
                optionsList.className = 'options-list';

                q.shuffledOptions.forEach(opt => {
                    const li = document.createElement('li');
                    li.className = 'option-item';
                    
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = opt.text;
                    
                    btn.onclick = function() {
                        q.userAnswered = true;

                        // Deshabilitar botones
                        const allBtns = optionsList.querySelectorAll('.option-btn');
                        allBtns.forEach(b => b.classList.add('disabled'));

                        if (opt.correct) {
                            btn.classList.add('correct');
                        } else {
                            btn.classList.add('incorrect');
                            q.userFailed = true; // Marcamos como fallada para futuras revisiones

                            // Mostrar la correcta
                            allBtns.forEach(b => {
                                const originalOpt = q.options.find(o => o.correct);
                                if (b.innerText === originalOpt.text) {
                                    b.classList.add('correct');
                                }
                            });
                        }
                    };

                    li.appendChild(btn);
                    optionsList.appendChild(li);
                });

                questionBlock.appendChild(optionsList);
                quizContainer.appendChild(questionBlock);
            });
        }

        // Renderizado inicial (todas las preguntas)
        renderQuiz(questions);

        // L√≥gica de Finalizaci√≥n
        const urlParams = new URLSearchParams(window.location.search);
        const testID = urlParams.get('id');

        document.getElementById('btn-finish').onclick = function() {
            // Calcular nota basada en las preguntas visibles actualmente
            const currentBlocks = document.querySelectorAll('.question-block');
            let totalCurrent = currentBlocks.length;
            let currentCorrect = 0;

            currentBlocks.forEach(block => {
                // Si est√° respondida (tiene botones disabled)
                if (block.querySelector('.disabled')) {
                    // Si no hay bot√≥n incorrecto, es un acierto
                    const hasIncorrect = block.querySelector('.incorrect');
                    if (!hasIncorrect) {
                        currentCorrect++;
                    }
                }
            });

            const notaFinal = totalCurrent > 0 ? Math.round((currentCorrect / totalCurrent) * 100) : 0;

            // Mostrar Panel
            document.getElementById('finish-container').style.display = 'none';
            const resultsPanel = document.getElementById('results-panel');
            resultsPanel.style.display = 'block';
            
            document.getElementById('score-text').innerHTML = 
                `Has acertado <b>${currentCorrect}</b> de <b>${totalCurrent}</b> preguntas visibles.<br>Nota de este intento: <b>${notaFinal}%</b>`;
            
            // Scroll hacia resultados
            resultsPanel.scrollIntoView({behavior: "smooth"});

            // Guardar nota solo si es el test completo original
            if (testID && totalCurrent === questions.length) {
                let intentos = parseInt(localStorage.getItem(`intentos_${testID}`) || 0);
                localStorage.setItem(`intentos_${testID}`, intentos + 1);

                let notaAnterior = localStorage.getItem(`nota_${testID}`);
                if (!notaAnterior || notaFinal > parseInt(notaAnterior)) {
                    localStorage.setItem(`nota_${testID}`, notaFinal);
                }
            }
        };

        // --- L√≥gica de Repetici√≥n (Filtros) ---
        function retryQuiz(mode) {
            let filteredQuestions = [];

            if (mode === 'all') {
                // Reiniciar todo
                questions.forEach(q => {
                    q.userFailed = false;
                    q.userMarked = false; // Desmarcar al reiniciar completo
                    q.userAnswered = false;
                    q.shuffledOptions = null; // Re-mezclar
                });
                filteredQuestions = questions;
            } 
            else if (mode === 'failed') {
                filteredQuestions = questions.filter(q => q.userFailed);
                // Resetear estado de respuesta para poder reintentar
                filteredQuestions.forEach(q => {
                    q.userAnswered = false; 
                    q.shuffledOptions = null;
                });
            } 
            else if (mode === 'marked') {
                filteredQuestions = questions.filter(q => q.userMarked);
                filteredQuestions.forEach(q => {
                    q.userAnswered = false;
                    q.shuffledOptions = null;
                });
            }
            else if (mode === 'mixed') {
                // Falladas O Marcadas
                filteredQuestions = questions.filter(q => q.userFailed || q.userMarked);
                filteredQuestions.forEach(q => {
                    q.userAnswered = false;
                    q.shuffledOptions = null;
                });
            }

            renderQuiz(filteredQuestions);

            // Actualizar t√≠tulo
            const modeTitles = {
                'all': 'Test Completo',
                'failed': 'Repaso de Fallos',
                'marked': 'Repaso de Marcadas',
                'mixed': 'Repaso (Falladas + Marcadas)'
            };
            document.getElementById('quiz-title').innerText = `Modo: ${modeTitles[mode]}`;
            
            // Subir al inicio
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
