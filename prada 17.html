<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Anatomía - Tema 34: Genital Femenino</title>
    <style>
        :root {
            --primary-color: #e91e63; /* Rosa/Fucsia para Genital Femenino */
            --secondary-color: #c2185b;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --background-color: #fce4ec;
            --card-background: #ffffff;
            --sidebar-width: 300px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #880e4f;
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ad1457;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 15px;
            text-align: center;
            background-color: #6a0a3d;
            border-bottom: 1px solid #ad1457;
        }

        .sidebar-header h2 { margin: 0; font-size: 1.1rem; }
        
        .sidebar-controls {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .sidebar-stats { font-size: 0.9rem; color: #f48fb1; }

        .finish-btn-side {
            background-color: #f1c40f;
            border: none;
            border-radius: 4px;
            color: #880e4f;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            width: 80%;
            transition: 0.2s;
        }
        .finish-btn-side:hover { background-color: #f39c12; }

        .sidebar-nav {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(5, 1fr); 
            gap: 4px;
            align-content: start;
        }

        .nav-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 4px;
            background-color: #ad1457;
            color: white;
            cursor: pointer;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: 0.2s;
        }

        .nav-btn:hover { background-color: var(--secondary-color); }
        .nav-btn.correct { background-color: var(--success-color); }
        .nav-btn.incorrect { background-color: var(--error-color); }
        .nav-btn.marked { border: 2px solid #f1c40f; color: #f1c40f; font-weight: bold; }

        /* MAIN CONTENT */
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 30px;
            scroll-behavior: smooth;
        }

        .container { max-width: 900px; margin: 0 auto; }

        h1 { color: var(--primary-color); border-bottom: 3px solid var(--secondary-color); padding-bottom: 10px; }

        .question-card {
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--secondary-color);
            scroll-margin-top: 20px;
        }

        .question-header-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .bookmark-btn {
            background: none;
            border: 1px solid #f48fb1;
            border-radius: 4px;
            cursor: pointer;
            color: #c2185b;
            padding: 2px 8px;
        }
        .bookmark-btn.active { color: #f39c12; border-color: #f39c12; background: #fffde7; }

        .question-text { font-size: 1.1rem; color: #880e4f; margin-bottom: 15px; font-weight: 600; line-height: 1.4; }

        .options-grid { display: flex; flex-direction: column; gap: 8px; }

        .option-btn {
            padding: 10px 15px;
            border: 1px solid #f8bbd0;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            text-align: left;
            transition: 0.2s;
            font-size: 1rem;
        }

        .option-btn:hover:not(.disabled) { background-color: #fce4ec; border-color: var(--primary-color); }
        
        .option-btn.correct { background-color: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.incorrect { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }
        .option-btn.disabled { cursor: default; opacity: 0.7; }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
            font-size: 0.9rem;
        }
        .feedback.show { display: block; }
        .feedback.success { background-color: #e8f8f5; color: #0e6251; }
        .feedback.error { background-color: #fdedec; color: #78281f; }

        /* RESULT PANEL */
        .results-panel {
            background: #880e4f;
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-top: 40px;
            display: none;
            margin-bottom: 50px;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            background: var(--secondary-color);
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: transform 0.1s;
        }
        .action-btn:hover { background: #e91e63; transform: scale(1.05); }
        .action-btn:active { transform: scale(0.95); }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .sidebar { width: 100%; height: 160px; border-right: none; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
            .sidebar-nav { grid-template-columns: repeat(10, 1fr); max-height: 150px; }
            .main-content { overflow: visible; }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2>Tema 34: Genital Femenino</h2>
        <div class="sidebar-controls">
            <div class="sidebar-stats"><span id="progress-text">0/133</span> respondidas</div>
            <button class="finish-btn-side" onclick="showResults(true)">Finalizar Test</button>
        </div>
    </div>
    <div id="sidebar-nav" class="sidebar-nav"></div>
</div>

<div class="main-content">
    <div class="container">
        <h1>Aparato Genital Femenino 

[Image of female reproductive system]
</h1>
        <div id="questions-list"></div>
        
        <div id="results-panel" class="results-panel">
            <h2>Test Finalizado</h2>
            <p id="score-text" style="font-size: 1.4rem; margin: 15px 0;"></p>
            <div class="action-buttons">
                <button class="action-btn" onclick="resetQuiz('all')">Repetir Todo</button>
                <button class="action-btn" onclick="resetQuiz('wrong')">Repetir Falladas</button>
                <button class="action-btn" onclick="resetQuiz('marked')">Repetir Marcadas</button>
                <button class="action-btn" onclick="resetQuiz('wrong_marked')">Falladas + Marcadas</button>
            </div>
        </div>
    </div>
</div>

<script>
    // BASE DE DATOS - TEMA 34 GENITAL FEMENINO
    const dbQuestions = [
        { id: 1, original: "Extra 1", q: "El conducto excretor de las glándulas de Bartholin drenan:", options: ["En la uretra", "En el vestíbulo vaginal", "Entre labios mayores y menores", "En el introito vaginal"], correct: 1, exp: "Drenan en el vestíbulo, entre los labios menores y el himen." },
        { id: 2, original: "Extra 2", q: "La rama tubárica ovárica alcanza el ovario, ¿apoyándose en qué estructura?:", options: ["Mesoovario", "Mesosalpinx", "Ligamento suspensorio", "Ligamento propio"], correct: 0, exp: "A través del mesoovario." },
        { id: 3, original: "Extra 3", q: "El homólogo del bulbo vestibular en la mujer es:", options: ["Cuerpo esponjoso", "Introito vaginal", "Labios menores", "Cuerpo cavernoso"], correct: 0, exp: "Corresponde al bulbo del cuerpo esponjoso masculino." },
        { id: 4, original: "Extra 4", q: "¿Cuál de los siguientes elementos no se encuentra limitando la fosa ovárica?", options: ["Ampolla tubárica", "Cara lateral del recto (o sigmoides)", "Vasos ilíacos externos", "Arteria vesical posterior (No suele citarse como límite directo clásico)"], correct: 3, exp: "Límites: Vasos iliacos externos (arriba), internos (atrás), lig ancho (delante)." },
        { id: 5, original: "55 (Extra)", q: "La arteria ovárica, rama de la aorta abdominal, alcanza el ovario apoyándose en qué estructura:", options: ["Ligamento redondo", "Ligamento suspensorio (Infundíbulo-pélvico)", "Ligamento cardinales", "Ligamento propio"], correct: 1, exp: "El ligamento suspensorio contiene los vasos ováricos." },
        { id: 6, original: "Extra 6", q: "El cuerpo del clítoris, señale la correcta:", options: ["Se forma por la unión de ambos pilares del clítoris", "Posee un ligamento infundibular", "No mantiene relación con vasos dorsales", "No posee prepucio"], correct: 0, exp: "Unión de los cuerpos cavernosos (pilares)." },
        { id: 7, original: "22 (Extra)", q: "El útero didelfo o tabicado es una malformación que tiene su origen en:", options: ["La agenesia de los conductos mesonéfricos", "La duplicidad de los conductos de Wolf", "La no fusión o no correcta de los conductos de Müller (Paramesonéfricos)", "La agenesia de los metanefros"], correct: 2, exp: "Fallo en la fusión de los conductos de Müller." },
        { id: 8, original: "1", q: "Los labios mayores se forman a partir de:", options: ["Los pliegues genitales (Protuberancias genitales)", "Tubérculo genital", "Pliegues uretrales", "Seno urogenital"], correct: 0, exp: "Protuberancias genitales." },
        { id: 9, original: "2", q: "¿Cuál de las siguientes estructuras NO deriva del conducto de Müller?", options: ["Vesículas seminales", "Trompas", "Útero", "Tercio superior vagina"], correct: 0, exp: "Las vesículas seminales derivan del conducto de Wolff." },
        { id: 10, original: "3", q: "Los defectos congénitos que afectan al útero, se producen por uno de los siguientes procesos:", options: ["Déficit de la unión media de los conductos de Müller", "Persistencia de Wolff", "Agenesia gonadal", "Fallo SRY"], correct: 0, exp: "Fallo en la fusión medial." },
        { id: 11, original: "4", q: "El clítoris deriva de:", options: ["El tubérculo genital", "Pliegues urogenitales", "Pliegues labioescrotales", "Seno urogenital"], correct: 0, exp: "Tubérculo genital." },
        { id: 12, original: "5", q: "La arteria ovárica alcanza el ovario apoyándose en:", options: ["El ligamento suspensorio", "Ligamento propio", "Mesovario", "Mesosalpinx"], correct: 0, exp: "Ligamento suspensorio del ovario." },
        { id: 13, original: "6", q: "La rama ovárica de la arteria uterina alcanza el ovario discurriendo junto:", options: ["El mesovario", "Ligamento suspensorio", "Ligamento redondo", "Trompa"], correct: 0, exp: "Por el mesoovario (anastomosis con ovárica)." },
        { id: 14, original: "7", q: "Desde el útero, el origen del ligamento propio del ovario se produce desde:", options: ["Los cuernos laterales, donde se continúan los bordes laterales del cuerpo y fondo uterino", "Cérvix", "Fondo puro", "Cara anterior"], correct: 0, exp: "En el cuerno uterino, posterior a la trompa." },
        { id: 15, original: "8", q: "En la mujer, ¿qué elemento cruza por encima de los uréteres en el trayecto que estos desarrollan en la pelvis?", options: ["Arteria uterina", "Trompa", "Ligamento redondo", "Arteria ovárica"], correct: 0, exp: "Arteria uterina ('agua bajo el puente')." },
        { id: 16, original: "9", q: "El cuerpo eréctil que forma parte de los labios menores de la vulva es:", options: ["Bulbo vestibular", "Pilar clítoris", "Cuerpo cavernoso", "Glándula Bartholin"], correct: 0, exp: "Los bulbos vestibulares están profundos a los labios." },
        { id: 17, original: "10", q: "De las siguientes porciones del útero, ¿cuál se relaciona con la parte superior de la vagina?", options: ["Cérvix (Cuello)", "Cuerpo", "Fondo", "Istmo"], correct: 0, exp: "El cérvix protruye en la vagina." },
        { id: 18, original: "11", q: "¿Cuál de las siguientes afirmaciones NO se corresponden con los ovarios?", options: ["Se encuentran dentro de la cavidad peritoneo (Son intraperitoneales reales)", "Están cubiertos por peritoneo visceral (Falso, epitelio germinal)", "Se relacionan con la fosa iliaca", "Están sujetos por el ligamento propio"], correct: 1, exp: "El ovario NO está cubierto por peritoneo (se detiene en el mesoovario/línea de Farre)." },
        { id: 19, original: "12", q: "La arteria uterina es rama de:", options: ["Arteria ilíaca interna", "Iliaca externa", "Obturatriz", "Rectal media"], correct: 0, exp: "Rama visceral de la hipogástrica." },
        { id: 20, original: "13", q: "Desde el útero, el origen del ligamento propio del ovario se produce desde: (Repetida)", options: ["Cuernos laterales", "Fondo", "Cérvix", "Cuerpo"], correct: 0, exp: "Repetida." },
        { id: 21, original: "14", q: "el útero se relaciona:", options: ["Hacia delante con la parte terminal del aparato digestivo (Recto es atrás)", "Hacia abajo con la vagina", "Hacia los laterales con los vasos ilíacos primitivos", "Hacia atrás con la vejiga (Vejiga es delante)"], correct: 1, exp: "Inferiormente se continúa con la vagina." },
        { id: 22, original: "15", q: "Marque la opción correcta:", options: ["La trompa uterina se encuentra en la aleta anterior del ligamento ancho (Superior)", "La irrigación de la trompa del útero está a cargo de las arterias uterina y ovárica", "La cara interna de la trompa forma con el ovario la fosita tuboovarica", "La trompa se divide en 3 regiones"], correct: 1, exp: "Doble irrigación (arco tubárico)." },
        { id: 23, original: "16", q: "el ovario:", options: ["Se encuentra en la fosa ovárica", "Tiene dos caras: una anterior y una posterior (Son medial/lateral)", "Pesa 3 gramos", "Da inserción a 8 ligamentos"], correct: 0, exp: "En la nulípara está en la fosa ovárica de Krause." },
        { id: 24, original: "17", q: "El ligamento redondo del útero:", options: ["Es la vena umbilical obliterada (Falso)", "Se extiende entre el útero y los ovarios (Falso, propio)", "Se extiende entre el útero y los labios mayores", "Cruza la cara anterior de los ligamentos anchos"], correct: 2, exp: "Va del cuerno uterino a los labios mayores pasando por el conducto inguinal." },
        { id: 25, original: "18", q: "Cuál de los siguientes elementos no delimitan la fosa ovárica:", options: ["Trompa uterina (Límite superior/anterior)", "Ligamento ancho del útero", "Bordes laterales del recto intraperitoneal", "Vasos ilíacos (Externos/Internos)"], correct: 2, exp: "El recto está más posterior. La fosa está delimitada por vasos iliacos y ligamento ancho." },
        { id: 26, original: "19", q: "La glándula seromucosa que se fija en la membrana del seno urogenital es:", options: ["Bartholin", "Cooper", "Skeene", "Gardner"], correct: 0, exp: "Glándulas vestibulares mayores." },
        { id: 27, original: "20", q: "De la lámina posterior del mesometrio se forma:", options: ["Mesoovario", "Ligamento cardinal", "Ligamento redondo", "Tabique"], correct: 0, exp: "El mesoovario sale de la hoja posterior." },
        { id: 28, original: "21", q: "El déficit embriogénico de fusión en la línea media de os conductos para mesofrénicos de Müller dan lugar a :", options: ["Útero didelfo o tabicado", "Agenesia unilateral", "Quiste Gardner", "Atresia"], correct: 0, exp: "Didelfo (doble)." },
        { id: 29, original: "22", q: "El homólogo de la bolsa escrotal en la mujer es:", options: ["Labios mayores", "Seno urogenital", "Introito", "Labios menores"], correct: 0, exp: "Labios mayores." },
        { id: 30, original: "23", q: "El músculo transverso profundo del periné:", options: ["Superficial a él se sitúa el diafragma urogenital", "Está situado por debajo del músculo transverso superficial", "Se inserta alrededor de la porción distal del conducto vaginal (y uretral)", "Se origina espina"], correct: 2, exp: "Forma parte del diafragma urogenital." },
        { id: 31, original: "24", q: "El principal soporte uterino depende de:", options: ["Ligamento cardinal (Mackenrodt) y uterosacros", "Ligamento redondo", "Pubococcígeo", "Tendón central"], correct: 0, exp: "Soporte ligamentoso principal (parametrio)." },
        { id: 32, original: "25", q: "En la mujer, el uréter:", options: ["Se acompaña de la arteria uterina en su trayecto (Se cruzan)", "Está cruzado por la arteria uterina superiormente", "Pasa a través del ligamento ancho (Base)", "Se encuentra dorsal borde lateral vagina"], correct: 1, exp: "La uterina pasa por encima." },
        { id: 33, original: "26", q: "La arteria ovárica alcanza el ovario apoyándose en qué estructura: (Repetida)", options: ["Ligamento suspensorio", "Ligamento propio", "Cardinales", "Redondo"], correct: 0, exp: "Repetida." },
        { id: 34, original: "27", q: "La arteria uterina es rama de: (Repetida)", options: ["Arteria ilíaca interna", "Rectal media", "Externa", "Obturatriz"], correct: 0, exp: "Repetida." },
        { id: 35, original: "28", q: "Las columnas rugosas de la vagina:", options: ["Se encuentran en las paredes laterales", "Son exclusivas de la porción caudal", "Son pliegues transversales", "Se observan solo en mujeres jóvenes"], correct: 2, exp: "Pliegues transversales de la mucosa." },
        { id: 36, original: "29", q: "Qué elemento no participa del sostenimiento del ovario in situ:", options: ["Ligamento propio (Útero-Ovárico)", "Mesosálpinx", "Mesovario", "Ligamento suspensorio"], correct: 1, exp: "El mesosálpinx sostiene a la trompa, no al ovario." },
        { id: 37, original: "30", q: "Sobre la vagina, señale la opción incorrecta:", options: ["La cara posterior se fija al recto mediante tejido conectivo (Tabique)", "Es un tubo elástico músculomucoso", "El fórnix anterior es más profundo (Falso, el posterior es más profundo)", "En su cara anterior la uretra queda marcada"], correct: 2, exp: "El fórnix posterior es mucho más profundo (Fondo de saco de Douglas)." },
        { id: 38, original: "31", q: "El ramo ovárico de la arteria uterina alcanza el ovario discurriendo a través", options: ["Mesovario", "Ligamento suspensorio", "Ligamento propio", "Mesosálpinx"], correct: 0, exp: "Repetida: Mesovario." },
        { id: 39, original: "32", q: "La expansión de peritoneo parietal que cae sobre la trompa uterina, creando un meso, se denomina", options: ["Mesosálpinx", "Suspensoio", "Propio", "Mesovario"], correct: 0, exp: "Parte superior del ligamento ancho." },
        { id: 40, original: "33", q: "Qué elemento discurre por el trayecto inguinal", options: ["Ligamento redondo del útero", "Arteria uterina", "Uréter", "Ligamento propio"], correct: 0, exp: "Contenido del conducto inguinal femenino." },
        { id: 41, original: "34", q: "A través de qué estructura, apoyándose, alcanza la arteria ovárica a la gónada (Repetida)", options: ["Ligamento suspensorio", "Propio", "Redondo", "Uterosacros"], correct: 0, exp: "Repetida: Suspensorio." },
        { id: 42, original: "35", q: "Qué estructura atraviesa la membrana del seno urogenital solo en la mujer", options: ["Vagina", "Uretra", "Meato", "Labios"], correct: 0, exp: "La vagina perfora el diafragma urogenital." },
        { id: 43, original: "200", q: "Relacione: Fondo de saco de Douglas", options: ["Se encuentra posterior a la vagina y anterior al recto formando un receso de peritoneo", "Anterior vagina", "Túnica", "Próstata"], correct: 0, exp: "Receso rectouterino." },
        { id: 44, original: "36", q: "Qué estructura tiene forma tubular, aplanada anteriormente", options: ["Vagina", "Uretra", "Vestíbulo", "Labios"], correct: 0, exp: "La vagina (paredes anterior y posterior en contacto)." },
        { id: 45, original: "37", q: "Rodea los pilares del clítoris", options: ["Músculo isquiocavernoso", "Bulboesponjoso", "Cowper", "Utrículo"], correct: 0, exp: "Músculo erector." },
        { id: 46, original: "38", q: "La arteria ovárica alcanza el ovario apoyándose en, ¿qué ligamento? (Repetida)", options: ["Ligamento suspensorio", "Propio", "Redondo", "Cardinales"], correct: 0, exp: "Repetida." },
        { id: 47, original: "39", q: "En la mujer, ¿qué elemento cruza por encima de los uréteres en el trayecto que estos desarrollan en la pelvis? (Repetida)", options: ["Arteria uterina", "Uretra", "Ligamentos", "Redondo"], correct: 0, exp: "Repetida." },
        { id: 48, original: "40", q: "Qué elemento no participa del sostenimiento del ovario in situ. (Repetida)", options: ["Mesosalpinx", "Propio", "Suspensorio", "Mesovario"], correct: 0, exp: "Repetida." },
        { id: 49, original: "41", q: "El conducto excretor de las glándulas de Bartholini drenan", options: ["En la cara medial de los labios menores en el vestíbulo vaginal (o surco ninfohimeneal)", "Uretra", "Introito", "Entre mayores y menores"], correct: 0, exp: "Repetida: Vestíbulo." },
        { id: 50, original: "42", q: "Un útero anteverso y en anteflexión es", options: ["La posición habitual en la mujer nulípara", "Anomalía", "Patología", "Gestación"], correct: 0, exp: "Posición normal." },
        { id: 51, original: "43", q: "La arteria uterina es rama de (Repetida)", options: ["Iliaca interna", "Rectal", "Obturatriz", "Externa"], correct: 0, exp: "Repetida." },
        { id: 52, original: "44", q: "En la mujer, la vejiga por su cara posterior se relaciona con el:", options: ["Útero (y Vagina)", "Recto", "Colon", "Ileon"], correct: 0, exp: "Repetida." },
        { id: 53, original: "45", q: "¿Qué ligamento del útero termina en el labio mayor?", options: ["Ligamento redondo", "Mesosalpinx", "Ancho", "Uterosacro"], correct: 0, exp: "Repetida." },
        { id: 54, original: "46", q: "¿Cuál de los indicados designa un sector de las trompas uterinas?", options: ["Ampolla", "Lóbulo", "Cucilo", "Cuerno"], correct: 0, exp: "Partes: Infundíbulo, Ampolla, Istmo, Intramural." },
        { id: 55, original: "47", q: "¿Cuál de las siguientes arterias es rama de la ilíaca interna?", options: ["Uterina", "Epigástrica inf", "Ovárica", "Circunfleja"], correct: 0, exp: "Repetida." },
        { id: 56, original: "48", q: "La agenesia unilateral tubárica, señale la correcta:", options: ["Se produce por un Déficit de la unión medial de los conductos de Müller (o desarrollo)", "Wolff", "5alfa", "Cloaca"], correct: 0, exp: "Defecto Mülleriano." },
        { id: 57, original: "49", q: "El ligamento redondo que atraviesa el trayecto inguinal se inserta en", options: ["Labios mayores", "Menores", "Introito", "Seno"], correct: 0, exp: "Repetida." },
        { id: 58, original: "50", q: "¿Cuál de las siguientes estructuras NO deriva de conducto de Müller? (Repetida)", options: ["Trompas", "Útero", "Vagina sup", "Vesículas seminales (o algo no mulleriano)"], correct: 3, exp: "Repetida." },
        { id: 59, original: "51", q: "¿Cuál de los siguientes elementos no delimitan la fosa ovárica (Repetida)", options: ["Trompa", "Bordes recto", "Lig ancho", "Vasos iliacos"], correct: 1, exp: "Repetida." },
        { id: 60, original: "52", q: "La glándula seromucosa que se fija a la membrana del seno urogenital es (Repetida)", options: ["Bartholin", "Gardner", "Cooper", "Skeene"], correct: 0, exp: "Repetida." },
        { id: 61, original: "54", q: "De la lámina posterior del mesometrio se forma (Repetida)", options: ["Mesovario", "Cardinal", "Redondo", "Tabique"], correct: 0, exp: "Repetida." },
        { id: 62, original: "55", q: "El déficit embriogénico de fusión en la línea media de los conductos paramesonéfricos de Múller dan lugar a (Repetida)", options: ["Útero didelfo", "Gardner", "Atresia", "Agenesia"], correct: 0, exp: "Repetida." },
        { id: 63, original: "56", q: "El homólogo de la bolsa escrotal en la mujer es (Repetida)", options: ["Labios mayores", "Introito", "Menores", "Seno"], correct: 0, exp: "Repetida." },
        { id: 64, original: "57", q: "El músculo transverso profundo del periné (Repetida)", options: ["Superficial a él diafragma", "Debajo superficial", "Espina", "Vagina inserta"], correct: 0, exp: "Repetida." },
        { id: 65, original: "58", q: "El principal soporte uterino depende de (Repetida)", options: ["Ligamento cardinal", "Redondo", "Pubococcígeo", "Tendón"], correct: 0, exp: "Repetida." },
        { id: 66, original: "59", q: "En la mujer, el uréter (Repetida)", options: ["Está cruzado por la arteria uterina superiormente", "Acompaña", "Dorsal vagina", "Lig ancho"], correct: 0, exp: "Repetida." },
        { id: 67, original: "196", q: "Con respecto a los cuerpos cavernosos (En contexto femenino):", options: ["En la mujer los cuerpos cavernosos se encuentran separados del cuerpo esponjoso (bulbos)", "Junto esponjoso", "Un cuerpo", "Ninguna"], correct: 0, exp: "Clítoris tiene cavernosos, bulbos son esponjosos separados." },
        { id: 68, original: "60", q: "La arteria ovárica alcanza el ovario apoyándose en qué estructura (Repetida)", options: ["Ligamento suspensorio", "Propio", "Cardinal", "Redondo"], correct: 0, exp: "Repetida." },
        { id: 69, original: "61", q: "La arteria uterina es rama de (Repetida 4)", options: ["Iliaca interna", "Rectal", "Externa", "Obturatriz"], correct: 0, exp: "Repetida." },
        { id: 70, original: "62", q: "Las columnas rugosas de la vagina (Repetida)", options: ["Son pliegues transversales", "Paredes laterales", "Caudal", "Jóvenes"], correct: 0, exp: "Repetida." },
        { id: 71, original: "63", q: "Qué elemento no participa del sostenimiento del ovario in situ (Repetida)", options: ["Mesosalpinx", "Propio", "Mesovario", "Suspensorio"], correct: 0, exp: "Repetida." },
        { id: 72, original: "64", q: "Sobre la vagina, señale la opción incorrecta (Repetida)", options: ["El fórnix anterior es más profundo", "Tubo elástico", "Uretra cresta", "Posterior recto"], correct: 0, exp: "Repetida: Posterior es más profundo." },
        { id: 73, original: "65", q: "Sobre los labios menores de la vulva, señale la incorrecta:", options: ["Forman el frenillo del clítoris (Incorrecta: Forman prepucio y frenillo? Wait. Texto dice: 'Forman el frenillo del clítoris (MAL)'. Si MAL significa Incorrecta, entonces la incorrecta es esa. Pero anatómicamente forman el prepucio y el frenillo. La opción a 'contienen tejido graso' es falsa (carecen de grasa). Texto ambiguo. Asumiremos 'contienen tejido graso' es la incorrecta anatómica real, o seguiremos la marca del texto 'MAL' si existe)", "Contienen un tejido graso (Incorrecto anatómico)", "Medialmente limitan vestíbulo", "Forman prepucio"], correct: 1, exp: "Los labios menores NO tienen tejido adiposo (a diferencia de los mayores)." },
        { id: 74, original: "66", q: "Un útero anteverso y en anteflexión relaciona su cara anterior con:", options: ["Cara anterosuperior de la vejiga urinaria", "Retzius", "Sínfisis", "Recto"], correct: 0, exp: "Se apoya sobre la vejiga." },
        { id: 75, original: "67", q: "El ramo ovárico de la arteria uterina alcanza el ovario discurriendo a través: (Repetida)", options: ["Mesovario", "Suspensorio", "Propio", "Mesosalpinx"], correct: 0, exp: "Repetida." },
        { id: 76, original: "68", q: "La expansión de peritoneo parietal que cae sobre la trompa uterina...: (Repetida)", options: ["Mesosalpinx", "Suspensorio", "Propio", "Mesovario"], correct: 0, exp: "Repetida." },
        { id: 77, original: "69", q: "Qué elemento discurre por el trayecto inguinal: (Repetida)", options: ["Ligamento redondo del útero", "Uterina", "Uréter", "Propio"], correct: 0, exp: "Repetida." },
        { id: 78, original: "70", q: "Qué elemento cruza por encima de los uréteres... (Repetida)", options: ["Arteria uterina", "Uréter", "Propio", "Redondo"], correct: 0, exp: "Repetida." },
        { id: 79, original: "71", q: "A través, de qué estructura, apoyándose, alcanza la arteria uterina a la gónada (Error texto: Debe ser Ovárica, o Rama ovárica de uterina):", options: ["Mesovario/Ligamento propio", "Uréter", "Redondo", "Uterosacros"], correct: 0, exp: "La anastomosis va por el mesoovario/ligamento propio." },
        { id: 80, original: "72", q: "Qué estructura atraviesa la membrana urogenital tanto en el hombre como en la mujer: (Repetida)", options: ["La uretra", "Meato", "Vestíbulo", "Vagina"], correct: 0, exp: "Repetida." },
        { id: 81, original: "73", q: "Y qué estructura lo hace solo en la mujer: (Repetida)", options: ["La vagina", "Uretra", "Meato", "Labios"], correct: 0, exp: "Repetida." },
        { id: 82, original: "74", q: "Qué estructura tiene una forma tubular, aplanada anteriormente: (Repetida)", options: ["La vagina", "Uretra", "Meato", "Vestíbulo"], correct: 0, exp: "Repetida." },
        { id: 83, original: "75", q: "Rodea los pilares del clítoris: (Repetida)", options: ["Músculo isquiocavernoso", "Bulbo", "Cowper", "Utrículo"], correct: 0, exp: "Repetida." },
        { id: 84, original: "76", q: "Con respecto a los cuerpos cavernosos: (Repetida)", options: ["En la mujer los cuerpos cavernosos se encuentran separados del cuerpo esponjoso", "Junto", "Uno", "Todas"], correct: 0, exp: "Repetida." },
        { id: 85, original: "77", q: "Relacione: Fondo de saco de Douglas (Repetida)", options: ["Posterior vagina/Anterior recto", "Anterior vagina", "Túnica", "Próstata"], correct: 0, exp: "Repetida." },
        { id: 86, original: "78", q: "El útero se relaciona: (Repetida)", options: ["Hacia abajo con la vagina", "Adelante digestivo", "Laterales iliacos", "Atrás vejiga"], correct: 0, exp: "Repetida." },
        { id: 87, original: "79", q: "Marque la opción correcta: (Trompa)", options: ["La irrigación de la trompa del útero está a cargo de las arterias uterina y ovárica", "Aleta anterior", "Fosita tuboovarica interna", "3 regiones"], correct: 0, exp: "Repetida." },
        { id: 88, original: "80", q: "El ovario: (Repetida)", options: ["Se encuentra en la fosa ovárica", "Caras ant/post", "3 gr", "8 ligamentos"], correct: 0, exp: "Repetida." },
        { id: 89, original: "81", q: "La cara posterior de la vejiga se relaciona fundamentalmente en la mujer con: (Repetida)", options: ["La vagina", "Sacro", "Recto", "Ovarios"], correct: 0, exp: "Repetida." },
        { id: 90, original: "82", q: "En la mujer, la vejiga por su cara posterior se relaciona con el: (Repetida)", options: ["Útero (Cuello)", "Recto", "Colon", "Ilion"], correct: 0, exp: "Repetida." },
        { id: 91, original: "84", q: "La cara posterior de la uretra femenina se relaciona con: (Repetida)", options: ["La pared anterior de la vagina", "Recto", "Vejiga", "Útero"], correct: 0, exp: "Repetida." },
        { id: 92, original: "85", q: ". ¿Cuál de los indicados designa un sector de las trompas uterinas (taba uterina)? (Repetida)", options: ["Ampolla", "Lóbulo", "Cucilo", "Cuerno"], correct: 0, exp: "Repetida." },
        { id: 93, original: "86", q: "En la base del ligamento ancho el úreter cruza a: (Repetida)", options: ["La arteria uterina", "Trompa", "Deferente", "Plexo"], correct: 0, exp: "Repetida." },
        { id: 94, original: "87", q: " ¿Cuál de las siguientes arterias es rama de la iliaca interna? (Repetida)", options: ["Uterina", "Epigástrica", "Ovárica", "Circunfleja"], correct: 0, exp: "Repetida." },
        { id: 95, original: "88", q: "Sobre los pilares del clítoris, señala la opción incorrecta:", options: ["Se fija intensamente a la membrana del seno urogenital (Es el bulbo el que se relaciona más con membrana/isquio)", "Conforman el espesor de los labios menores (Falso, los labios menores no tienen pilares)", "Son eréctiles", "Isquiocavernosos rodean"], correct: 1, exp: "Los pilares están profundos y laterales, no en los labios menores." },
        { id: 96, original: "89", q: "¿Qué estructura se hallan alojadas en el espesor de los labios mayores de la vulva?", options: ["Ligamentos redondos del útero (Terminación)", "Bulbo", "Transverso", "Rafe"], correct: 0, exp: "El ligamento redondo termina en el monte de Venus y labios mayores." },
        { id: 97, original: "90", q: "En la fosa ovárica, ¿qué elementos se sitúan craneales a los ovarios delimitando la misma?", options: ["Vasos iliacos externos", "Promontorio", "Uréteres", "Ligamento ancho"], correct: 0, exp: "Límite superior." },
        { id: 98, original: "91", q: "Los labios mayores se forman a partir de: (Repetida)", options: ["Los pliegues genitales", "Uretrales", "Tubérculo", "Cordones"], correct: 0, exp: "Repetida." },
        { id: 99, original: "92", q: "La arteria ovárica alcanza el ovario apoyándose en, ¿qué ligamento? (Repetida)", options: ["Ligamento suspensorio", "Cardinales", "Redondo", "Propio"], correct: 0, exp: "Repetida." },
        { id: 100, original: "93", q: "La rama ovárica de la arteria uterina alcanza el ovario discurriendo junto: (Repetida)", options: ["El mesovario", "Mesosalpinx", "Suspensorio", "Propio"], correct: 0, exp: "Repetida." },
        { id: 101, original: "94", q: "El conducto de Wolff se organiza junto al: (Repetida)", options: ["Mesonefros", "Celoma", "Pronefros", "Metanefros"], correct: 0, exp: "Repetida." },
        { id: 102, original: "95", q: "Desde el útero, el origen del ligamento propio del ovario se produce desde: (Repetida)", options: ["Cuernos laterales", "Fondo", "Cérvix", "Cuerpo"], correct: 0, exp: "Repetida." },
        { id: 103, original: "96", q: "En la mujer, ¿qué elemento cruza por encima de los uréteres... (Repetida)", options: ["Arteria uterina", "Uretra", "Redondo", "Uterosacros"], correct: 0, exp: "Repetida." },
        { id: 104, original: "97", q: "¿Cuál de las siguientes estructuras no deriva del conducto de Müller? (Repetida)", options: ["Vesículas seminales", "Trompas", "Útero", "Vagina"], correct: 0, exp: "Repetida." },
        { id: 105, original: "98", q: "Los defectos congénitos que afectan al útero...: (Repetida)", options: ["Déficit de la unión media de los conductos de Müller", "Wolff", "5alfa", "Mesonefros"], correct: 0, exp: "Repetida." },
        { id: 106, original: "99", q: "El cuerpo eréctil que forma parte de los labios menores de la vulva es: (Repetida)", options: ["Bulbo vestibular (aunque anatómicamente es profundo a ellos)", "Skene", "Bartholin", "Pilar"], correct: 0, exp: "Repetida del texto original." },
        { id: 107, original: "100", q: "El clítoris deriva de: (Repetida)", options: ["El tubérculo genital", "Ureterales", "Genitales", "Cordones"], correct: 0, exp: "Repetida." },
        { id: 108, original: "101", q: "De las siguientes porciones del útero, cuál se relaciona con la parte superior de la vagina: (Repetida)", options: ["Cérvix", "Cuerpo", "Trompa", "Fundus"], correct: 0, exp: "Repetida." },
        { id: 109, original: "102", q: "Cuál de las siguientes afirmaciones no se corresponden con los ovarios (Repetida)", options: ["Están cubiertos de peritoneo (Falso)", "Dentro cavidad", "Fijan 2 ligamentos", "Cercanos fimbrias"], correct: 0, exp: "Repetida." },
        { id: 110, original: "103", q: "Fondo de saco recto-uterino (espacio de Douglas):", options: ["Llega hasta la vagina (Fórnix posterior)", "No toca vagina", "Solo recto", "Solo útero"], correct: 0, exp: "El fondo de saco de Douglas está en contacto con la pared posterior de la vagina." },
        { id: 111, original: "104", q: "Mesosálpinx es:", options: ["Parte del ligamento ancho próxima a la trompa uterina", "Ovario", "Redondo", "Uterosacro"], correct: 0, exp: "Meso de la trompa." },
        { id: 112, original: "105", q: "El trayecto del ligamento redondo en el aparato genital femenino:", options: ["Va desde el borde lateral y superior del útero hasta la pared lateral de la pelvis, se continúa con el conducto inguinal hasta los labios mayores", "Va al ovario", "Va al sacro", "Va al recto"], correct: 0, exp: "Trayecto inguinal clásico." },
        { id: 113, original: "106", q: "La expansión de peritoneo parietal que cae sobre la trompa uterina, creando un meso, se denomina (Repetida)", options: ["Mesosalpinx", "Suspensorio", "Propio", "Musivario"], correct: 0, exp: "Repetida." },
        { id: 114, original: "107", q: "A través de qué estructura, apoyándose, alcanza la arteria ovárica a la gónada (Repetida)", options: ["Ligamento suspensorio (Infundíbulo)", "Uterina", "Uréter", "Propio"], correct: 0, exp: "Repetida (Corrección texto: Suspensorio)." },
        { id: 115, original: "108", q: "La arteria uterina en su nacimiento de la iliaca interna sigue tres trayectos:", options: ["Pared lateral pelvis, transversal lig ancho, cayado y ascenso lateral útero", "Descendente", "Posterior", "Medial directo"], correct: 0, exp: "Trayecto parietal, transversal y marginal." },
        { id: 116, original: "Extra", q: "Sobre el cuerpo del clítoris, señale la incorrecta:", options: ["No posee ningún recubrimiento epitelial como si tiene el prepucio (Falso, tiene prepucio)", "Se forma por unión pilares", "Posee ligamento suspensorio", "Posee ligamento infundibular (??)"], correct: 0, exp: "El clítoris tiene glande y prepucio." },
        { id: 117, original: "Extra", q: "El conducto excretor de las glándulas de Bartolino drena: (Repetida)", options: ["En la cara medial de los labios menores, en el vestíbulo vaginal", "Introito", "Entre mayores y menores", "Uretra"], correct: 0, exp: "Repetida." },
        { id: 118, original: "Extra", q: "Que estructura NO SE RELACIONA con el lóbulo tuberoso o derecho del hígado (Pregunta colada en texto original):", options: ["Antro pilórico", "Riñón", "Colon", "Duodeno"], correct: 0, exp: "Antro (Lóbulo cuadrado/izq)." },
        { id: 119, original: "Extra", q: "Los labios mayores y el escroto se forman a partir de: (Repetida)", options: ["Pliegues genitales", "Uretrales", "Tubérculo", "Cordones"], correct: 0, exp: "Repetida." },
        { id: 120, original: "Extra", q: "Desde el útero, el origen del ligamento propio del ovario se produce desde: (Repetida)", options: ["Cuernos laterales", "Fondo", "Cérvix", "Cuerpo"], correct: 0, exp: "Repetida." },
        { id: 121, original: "Extra", q: "¿Cuál es la posición más frecuente del útero?", options: ["Anteversión y anteflexión", "Retroversoflexión", "Indiferente", "Vertical"], correct: 0, exp: "AVF." },
        { id: 122, original: "Extra", q: "El ligamento ancho contiene todas las estructuras siguientes EXCEPTO:", options: ["Ovarios (Están unidos por meso, pero son intraperitoneales posteriores)", "Trompas", "Ligamento redondo", "Arteria uterina", "Uréteres (Pasan por la base, no dentro de las hojas superiores)"], correct: 4, exp: "El uréter pasa por la base del ligamento ancho (parametrio), pero no se considera contenido 'entre las hojas' como la trompa o redondo en sentido estricto de mesos." },
        { id: 123, original: "Extra", q: "La vascularización de la vagina proviene de:", options: ["Arteria vaginal, uterina, rectal media y pudenda interna", "Solo uterina", "Solo pudenda", "Ovárica"], correct: 0, exp: "Riego múltiple escalonado." },
        { id: 124, original: "Extra", q: "El drenaje linfático del ovario se dirige principalmente a:", options: ["Ganglios lumbares (aórticos)", "Inguinales", "Iliacos internos", "Iliacos externos"], correct: 0, exp: "Sigue a los vasos ováricos." },
        { id: 125, original: "Extra", q: "El drenaje linfático de la vulva y tercio inferior de vagina va a:", options: ["Ganglios inguinales superficiales", "Lumbares", "Iliacos", "Sacros"], correct: 0, exp: "Inguinales." },
        { id: 126, original: "Extra", q: "El vestíbulo de la vagina es el espacio situado entre:", options: ["Los labios menores", "Los labios mayores", "El himen y el cérvix", "El clítoris y el ano"], correct: 0, exp: "Espacio interlabial menor." },
        { id: 127, original: "Extra", q: "Las glándulas de Skene son homólogas a:", options: ["Próstata", "Cowper", "Seminales", "Testículo"], correct: 0, exp: "Glándulas parauretrales (próstata femenina)." },
        { id: 128, original: "Extra", q: "El himen es un repliegue de mucosa que cierra parcialmente:", options: ["El orificio vaginal", "La uretra", "El ano", "El cérvix"], correct: 0, exp: "Entrada vagina." },
        { id: 129, original: "Extra", q: "El fondo de saco vesicouterino se encuentra entre:", options: ["Vejiga y útero", "Recto y útero", "Vejiga y sínfisis", "Útero y vagina"], correct: 0, exp: "Receso anterior." },
        { id: 130, original: "Extra", q: "El músculo bulboesponjoso en la mujer rodea:", options: ["El bulbo vestibular y orificio vaginal", "El clítoris", "El ano", "La uretra"], correct: 0, exp: "Esfínter de la vagina." },
        { id: 131, original: "Extra", q: "La arteria pudenda interna sale de la pelvis por:", options: ["Agujero ciático mayor", "Agujero ciático menor", "Conducto obturador", "Laguna vascular"], correct: 0, exp: "Sale por el mayor (infrapiriforme) y entra por el menor." },
        { id: 132, original: "Extra", q: "El nervio pudendo inerva:", options: ["Genitales externos y periné", "Ovarios", "Útero (fondo)", "Trompas"], correct: 0, exp: "Inervación somática perineal." },
        { id: 133, original: "Extra", q: "La vagina tiene una longitud aproximada de:", options: ["7-9 cm", "2-3 cm", "15-20 cm", "30 cm"], correct: 0, exp: "Longitud media." }
    ];

    let currentQuestions = [...dbQuestions];
    let markedIds = new Set();
    let userAnswers = {};

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function renderQuiz() {
        const list = document.getElementById('questions-list');
        const nav = document.getElementById('sidebar-nav');
        const resultsPanel = document.getElementById('results-panel');
        
        list.innerHTML = '';
        nav.innerHTML = '';
        resultsPanel.style.display = 'none';

        if(currentQuestions.length === 0) {
            list.innerHTML = `<div class="question-card"><p>No hay preguntas para los criterios seleccionados.</p></div>`;
            return;
        }

        currentQuestions.forEach((q, index) => {
            const btn = document.createElement('a');
            btn.href = `#q-${q.id}`;
            btn.className = 'nav-btn';
            btn.innerText = index + 1;
            btn.id = `nav-btn-${q.id}`;
            
            if (userAnswers[q.id] === true) btn.classList.add('correct');
            if (userAnswers[q.id] === false) btn.classList.add('incorrect');
            if (markedIds.has(q.id)) btn.classList.add('marked');

            nav.appendChild(btn);

            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-${q.id}`;

            const originalOptions = q.options.map((text, i) => ({ text: text, isCorrect: i === q.correct }));
            const finalOptions = shuffle(originalOptions);

            let optionsHTML = '';
            finalOptions.forEach(opt => {
                const safeText = opt.text.replace(/'/g, "&#39;"); 
                optionsHTML += `<button class="option-btn" onclick="handleAnswer(${q.id}, ${opt.isCorrect}, this)">${opt.text}</button>`;
            });

            const isMarked = markedIds.has(q.id);

            card.innerHTML = `
                <div class="question-header-row">
                    <span>Pregunta ${index + 1} (Ref: ${q.original})</span>
                    <button class="bookmark-btn ${isMarked ? 'active' : ''}" onclick="toggleMark(${q.id}, this)">
                        ${isMarked ? '★ Marcada' : '☆ Marcar'}
                    </button>
                </div>
                <div class="question-text">${q.q}</div>
                <div class="options-grid" id="opts-${q.id}">
                    ${optionsHTML}
                </div>
                <div class="feedback" id="feed-${q.id}"></div>
            `;
            list.appendChild(card);
        });
        updateProgress();
    }

    function handleAnswer(id, isCorrect, btn) {
        if (userAnswers.hasOwnProperty(id)) return;
        
        userAnswers[id] = isCorrect;
        const navBtn = document.getElementById(`nav-btn-${id}`);
        const feedback = document.getElementById(`feed-${id}`);
        const container = document.getElementById(`opts-${id}`);
        const qData = dbQuestions.find(x => x.id === id);

        const allBtns = container.querySelectorAll('.option-btn');
        allBtns.forEach(b => {
            b.classList.add('disabled');
            b.onclick = null;
            const correctText = qData.options[qData.correct];
            if (b.innerText === correctText) b.classList.add('correct');
        });

        if (isCorrect) {
            feedback.innerHTML = `<strong>¡Correcto!</strong><br>${qData.exp}`;
            feedback.className = 'feedback success show';
            if(navBtn) navBtn.classList.add('correct');
        } else {
            btn.classList.add('incorrect');
            feedback.innerHTML = `<strong>Incorrecto.</strong><br>${qData.exp}`;
            feedback.className = 'feedback error show';
            if(navBtn) navBtn.classList.add('incorrect');
        }
        updateProgress();
    }

    function toggleMark(id, btn) {
        const navBtn = document.getElementById(`nav-btn-${id}`);
        if (markedIds.has(id)) {
            markedIds.delete(id);
            btn.innerHTML = '☆ Marcar';
            btn.classList.remove('active');
            if(navBtn) navBtn.classList.remove('marked');
        } else {
            markedIds.add(id);
            btn.innerHTML = '★ Marcada';
            btn.classList.add('active');
            if(navBtn) navBtn.classList.add('marked');
        }
    }

    function updateProgress() {
        const count = Object.keys(userAnswers).length;
        const total = currentQuestions.length;
        document.getElementById('progress-text').innerText = `${count}/${total} respondidas`;
        
        if (count === total && total > 0) {
            showResults(false);
        }
    }

    function showResults(manualFinish = false) {
        const panel = document.getElementById('results-panel');
        let correct = 0;
        Object.values(userAnswers).forEach(v => { if(v) correct++; });
        
        const total = currentQuestions.length;
        
        document.getElementById('score-text').innerText = `Has acertado ${correct} de ${total}`;
        panel.style.display = 'block';
        
        if(manualFinish) {
            panel.scrollIntoView({ behavior: 'smooth' });
        } else {
            setTimeout(() => panel.scrollIntoView({ behavior: 'smooth' }), 100);
        }
    }

    function resetQuiz(mode) {
        let nextIds = [];

        if (mode === 'all') {
            nextIds = dbQuestions.map(q => q.id);
        } else if (mode === 'wrong') {
            nextIds = Object.keys(userAnswers).filter(id => userAnswers[id] === false).map(Number);
        } else if (mode === 'marked') {
            nextIds = Array.from(markedIds);
        } else if (mode === 'wrong_marked') {
            const wrong = Object.keys(userAnswers).filter(id => userAnswers[id] === false).map(Number);
            const marked = Array.from(markedIds);
            nextIds = [...new Set([...wrong, ...marked])];
        }

        if (nextIds.length === 0) {
            alert("No hay preguntas para los criterios seleccionados.");
            return;
        }

        userAnswers = {};
        currentQuestions = dbQuestions.filter(q => nextIds.includes(q.id));
        renderQuiz();
        document.querySelector('.main-content').scrollTop = 0;
    }

    renderQuiz();
</script>
</body>
</html>