<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario de Biolog√≠a - Versi√≥n Literal</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --light: #f8f9fa;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--light); line-height: 1.5; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        .nav-index { 
            display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 25px; 
            padding: 15px; background: #fff; border: 1px solid #ddd; border-radius: 8px;
            position: sticky; top: 10px; z-index: 1000;
        }
        
        .nav-dot {
            width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;
            border: 1px solid #ccc; border-radius: 5px; cursor: pointer; text-decoration: none; color: #555; font-weight: bold;
        }
        .nav-dot.answered { background: #e0e0e0; }
        .nav-dot.marked { border: 2px solid var(--warning); background: #fff9c4; }
        .nav-dot:hover { background: var(--secondary); color: white; }

        .question-block { border-bottom: 2px solid #eee; padding: 25px 0; scroll-margin-top: 130px; }
        .q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .btn-mark { padding: 5px 12px; cursor: pointer; border: 1px solid var(--warning); background: white; border-radius: 4px; }
        .btn-mark.active { background: var(--warning); font-weight: bold; }

        .options-list { display: grid; gap: 10px; margin-top: 15px; }
        .opt-btn { 
            text-align: left; padding: 12px 18px; border: 1px solid #ddd; border-radius: 6px; 
            background: white; cursor: pointer; font-size: 1rem; transition: 0.2s;
        }
        .opt-btn:hover:not(:disabled) { background: #f0f7ff; border-color: var(--secondary); }
        
        .correct-opt { background: var(--success) !important; color: white; border-color: #1e8449; }
        .wrong-opt { background: var(--danger) !important; color: white; border-color: #a93226; }

        .explanation { 
            margin-top: 15px; padding: 15px; border-radius: 6px; display: none;
            border-left: 5px solid;
        }
        .expl-correct { background: #d4edda; color: #155724; border-color: #28a745; }
        .expl-wrong { background: #f8d7da; color: #721c24; border-color: #dc3545; }

        #final-screen { display: none; margin-top: 40px; text-align: center; padding: 40px; background: var(--primary); color: white; border-radius: 10px; }
        .grid-restart { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .btn-restart { padding: 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; background: var(--secondary); color: white; }
        .btn-restart:disabled { background: #95a5a6; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="container">
    <h1>Cuestionario de Biolog√≠a</h1>
    <div id="nav-index" class="nav-index"></div>
    <div id="quiz-root"></div>

    <div id="final-screen">
        <h2>Resultados Finales</h2>
        <p id="score-text" style="font-size: 1.2rem;"></p>
        <div class="grid-restart">
            <button class="btn-restart" onclick="location.reload()">Volver a realizar completo</button>
            <button class="btn-restart" id="btn-restart-failed" onclick="restartSelected('failed')">Solo las falladas</button>
            <button class="btn-restart" id="btn-restart-marked" onclick="restartSelected('marked')">Solo las marcadas</button>
            <button class="btn-restart" id="btn-restart-both" onclick="restartSelected('both')">Falladas + Marcadas</button>
        </div>
    </div>
</div>

<script>
const questions = [
    {
        q: "¬øEn qu√© fase se encuentran los cromosomas en su forma m√°s compacta?",
        opts: ["Durante la interfase", "Durante la mitosis", "Durante la replicaci√≥n", "Durante la expresi√≥n g√©nica"],
        ans: 1,
        expl: "La compactaci√≥n m√°xima ocurre en la metafase (mitosis) para permitir el movimiento de los cromosomas."
    },
    {
        q: "¬øQu√© aÔ¨Årmaci√≥n es cierta acerca de la asociaci√≥n de prote√≠nas histonas y ADN?",
        opts: [
            "Las prote√≠nas histonas forman enlaces de hidr√≥geno con las bases de nucle√≥tidos del ADN",
            "Cada prote√≠na histona tiene una profunda ranura en la cual una doble h√©lice de ADN encaja Ô¨Årmemente",
            "Las prote√≠nas histonas tienen una alta proporci√≥n de amino√°cidos con carga negativa, las cuales se unen fuertemente al ADN que est√° cargado positivamente",
            "Las prote√≠nas histonas tienen una alta proporci√≥n de amino√°cidos cargados positivamente, los cuales se unen fuertemente al ADN que est√° cargado negativamente"
        ],
        ans: 3,
        expl: "Las histonas son b√°sicas (lisina/arginina) con carga positiva, uni√©ndose al ADN √°cido con carga negativa."
    },
    {
        q: "D√≥nde no se encuentra de manera frecuente la heterocromatina?",
        opts: ["Centr√≥meros", "Cromosoma X", "Regiones cromos√≥micas con ausencia de genes", "Regiones cromos√≥micas incluyendo genes que codiÔ¨Åcar para prote√≠nas ribos√≥micas"],
        ans: 3,
        expl: "Los genes ribos√≥micos est√°n en transcripci√≥n activa constante (eucromatina)."
    },
    {
        q: "¬øQu√© aÔ¨Årmaci√≥n describe el ADN de las c√©lulas hijas resultantes?",
        opts: [
            "Una c√©lula hija recibe las cadenas de ADN que estaban originalmente en la c√©lula madre, mientras que la otra hija recibe las cadenas reci√©n sintetizadas",
            "Cada hebra de ADN en las c√©lulas hijas contiene una mezcla de ADN reci√©n replicado y original",
            "Las c√©lulas hijas reciben solo ADN reci√©n sintetizado; la c√©lula madre conserva el ADN original",
            "La doble h√©lice de cada c√©lula hija consta de una cadena madre y una cadena reci√©n sintetizada"
        ],
        ans: 3,
        expl: "Este es el modelo semiconservativo de la replicaci√≥n del ADN."
    },
    {
        q: "¬øCu√°ndo es m√°s probable que ocurra la recombinaci√≥n hom√≥loga, que puede reparar perfectamente las roturas del ADN de doble cadena?",
        opts: [
            "Antes de que se replique el ADN para evitar la propagaci√≥n del error",
            "Cuando el sistema de reparaci√≥n de apareamientos err√≥neos pasa por alto las roturas",
            "Siempre que se detecte una rotura de doble hebra",
            "d. Despu√©s de que el ADN de la c√©lula se haya replicado"
        ],
        ans: 3,
        expl: "Requiere la presencia de la crom√°tida hermana id√©ntica como molde, disponible tras la replicaci√≥n."
    },
    {
        q: "¬øQu√© porcentaje de errores de replicaci√≥n normalmente corrige la reparaci√≥n de discordancias de ADN?",
        opts: ["1%", "50%", "99%", "100%"],
        ans: 2,
        expl: "Este sistema es extremadamente eficiente, corrigiendo el 99% de los errores residuales de la polimerasa."
    },
    {
        q: "¬øCu√°l de las siguientes opciones deÔ¨Åne mejor una mutaci√≥n?",
        opts: [
            "Cambio permanente de una secuencia de ADN",
            "Error creado por una reparaci√≥n defectuosa que no coincide",
            "Cambio por un da√±o en una secuencia de ADN",
            "Cambio en la secuencia del ADN que provoca un cambio en un amino√°cido de una prote√≠na"
        ],
        ans: 0,
        expl: "Una mutaci√≥n es cualquier cambio permanente y heredable en la secuencia del material gen√©tico."
    },
    {
        q: "¬øQu√© es cierto para los ARNm eucariontes?",
        opts: [
            "Se sintetizan y traducen simult√°neamente",
            "Siempre deben plegarse en una forma tridimensional compleja antes de poder traducirse",
            "Se procesan solo despu√©s de ser liberados por la polimerasa",
            "Se traducen despu√©s de ser exportados desde el n√∫cleo"
        ],
        ans: 3,
        expl: "La traducci√≥n ocurre en el citosol tras el transporte nuclear."
    },
    {
        q: "¬øEn qu√© direcci√≥n se sintetiza una cadena de ARN?",
        opts: ["Solo de 3‚Äô a 5‚Äô", "Depende de qu√© cadena de ADN act√∫a como plantilla", "Depende de qu√© ARN polimerasa realiza la transcripci√≥n", "5‚Äô a 3‚Äô solamente"],
        ans: 3,
        expl: "La polimerasa a√±ade nucle√≥tidos al extremo 3' libre de la cadena en crecimiento."
    },
    {
        q: "En los eucariotas, ¬øqu√© partes de un gen se transcriben en ARN?",
        opts: ["Solo intrones", "Intrones y exones", "Solo exones", "Solo la regi√≥n codiÔ¨Åcante de las prote√≠nas"],
        ans: 1,
        expl: "El transcrito primario incluye ambos; los intrones se eliminan despu√©s en el splicing."
    },
    {
        q: "En eucariotas, ¬øa qu√© regi√≥n del ADN se unen los reguladores de la transcripci√≥n?",
        opts: [
            "Solo aguas arriba de los genes que regulan",
            "Solo en la caja TATA",
            "Solo en el sitio de inicio de la transcripci√≥n",
            "Aguas arriba o abajo del gen, o dentro del gen que regulan"
        ],
        ans: 3,
        expl: "Los enhancers o silencers pueden estar localizados a miles de pares de bases en cualquier direcci√≥n."
    },
    {
        q: "En la transcripci√≥n eucariota, la regulaci√≥n de la expresi√≥n g√©nica es altamente compleja y multifac√©tica. ¬øQu√© evento, que involucra tanto la remodelaci√≥n de la cromatina como el reclutamiento de la ARN polimerasa, es un paso clave en la iniciaci√≥n?",
        opts: [
            "La uni√≥n de la prote√≠na TBP (prote√≠na de uni√≥n a la caja TATA) para reclutar el complejo preiniciador, seguido de una desacetilaci√≥n de histonas",
            "La acci√≥n de complejos remodeladores de la cromatina para aumentar accesibilidad, junto con la uni√≥n de FT activadores, facilitando la uni√≥n del mediador y la ARN polimerasa",
            "La poliadenilaci√≥n en el extremo 3‚Äô y la adici√≥n del capuch√≥n en el extremo 5‚Äô del ARNm, lo que permite la disociaci√≥n de la ARN polimerasa del complejo de transcripci√≥n"
        ],
        ans: 1,
        expl: "Requiere remodelaci√≥n de cromatina y mediadores para que la ARN polimerasa acceda al promotor."
    },
    {
        q: "¬øQu√© proceso no contribuye de manera signiÔ¨Åcativa a la evoluci√≥n de los genomas?",
        opts: [
            "Duplicaci√≥n de genes que pueden adquirir una nueva funci√≥n",
            "Formaci√≥n de nuevos genes a partir de DNA no codiÔ¨Åcante",
            "Transferencia horizontal de DNA entre c√©lulas de distintas especies",
            "Mutaci√≥n de genes existentes que crean nuevas funciones",
            "Mezclado de dominios proteicos mediante reordenaci√≥n"
        ],
        ans: 1,
        expl: "La transferencia horizontal es fundamental en procariotas, pero menos frecuente/significativa en la evoluci√≥n de genomas eucariotas multicelulares."
    },
    {
        q: "Los transposones son par√°sitos, son perjudiciales para el organismo hospedador y lo sit√∫an en desventaja evolutiva",
        opts: ["Verdadero", "Falso"],
        ans: 1,
        expl: "Falso. Aunque ego√≠stas, han permitido la evoluci√≥n de la complejidad gen√≥mica y nuevas funciones."
    },
    {
        q: "¬øQu√© aÔ¨Årmaci√≥n NO es correcta acerca de las c√©lulas de h√≠gado y ri√±√≥n del mismo organismo?",
        opts: [
            "Contienen prote√≠nas distintas",
            "Expresan genes distintos",
            "Contienen toda la informaci√≥n necesaria para que se forme un organismo entero",
            "Contienen genes diferentes"
        ],
        ans: 3,
        expl: "Tienen exactamente los mismos genes (mismo ADN), pero difieren en su expresi√≥n."
    },
    {
        q: "De los siguientes m√©todos cu√°l es el m√°s apropiado para determinar la expresi√≥n de genes de un tipo celular",
        opts: ["Espectroscop√≠a de RMN", "Secuenciaci√≥n de ADN", "Microscop√≠a electr√≥nica", "Secuenciaci√≥n de ARN"],
        ans: 3,
        expl: "La RNA-seq permite cuantificar todos los transcriptos activos en una c√©lula."
    },
    {
        q: "¬øQu√© es un oper√≥n?",
        opts: [
            "Una secuencia corta de ADN a la que se une un regulador de la transcripci√≥n",
            "Un conjunto de genes controlados por la uni√≥n de m√∫ltiples reguladores de la transcripci√≥n",
            "Una secuencia de ADN que produce una variedad de ARNm",
            "Un conjunto de genes transcritos como un solo ARNm a partir de un √∫nico promotor"
        ],
        ans: 3,
        expl: "Caracter√≠stico de bacterias, permite regular genes de una misma v√≠a metab√≥lica."
    },
    {
        q: "¬øQu√© no afecta a la expresi√≥n g√©nica a nivel post-transcripcional?",
        opts: [
            "Peque√±os ARN de interferencia (small interfering RNAs)",
            "microRNAs",
            "Secuencias de nucle√≥tidos en las regiones no traducidas de un ARNm",
            "Metilaci√≥n del ADN"
        ],
        ans: 3,
        expl: "La metilaci√≥n del ADN ocurre en el material gen√©tico antes de la transcripci√≥n."
    },
    {
        q: "¬øCu√°l de las siguientes respuestas son correctas?",
        opts: [
            "En bacterias, pero no en eucariotas, muchos ARNm contienen la regi√≥n codiÔ¨Åcante de m√°s de un gen",
            "La mayor√≠a de prote√≠nas de uni√≥n de ADN se unen al surco mayor de la doble h√©lice de ADN",
            "De los distintos puntos de control de la expresi√≥n g√©nica el inicio de la transcripci√≥n es uno de los principales",
            "Todas son correctas"
        ],
        ans: 3,
        expl: "Todas las opciones describen correctamente procesos de regulaci√≥n gen√©tica."
    },
    {
        q: "¬øCu√°l NO es un ejemplo de herencia epigen√©tica?",
        opts: [
            "La herencia de los patrones de metilaci√≥n en el ADN",
            "La herencia de los patrones de condensaci√≥n de los cromosomas",
            "La herencia de una prote√≠na reguladora que activa su propia transcripci√≥n",
            "La herencia de una mutaci√≥n puntual en un solo gen"
        ],
        ans: 3,
        expl: "Una mutaci√≥n puntual es un cambio en la secuencia gen√©tica, no epigen√©tica."
    },
    {
        q: "¬øQu√© caracter√≠stica principal se usa para clasiÔ¨Åcar los virus seg√∫n el sistema de Baltimore?",
        opts: [
            "El tama√±o de la c√°psida",
            "El tipo de genoma y su estrategia de replicaci√≥n",
            "El tipo de c√©lula que infectan",
            "Su v√≠a de transcripci√≥n"
        ],
        ans: 1,
        expl: "Se basa en el mecanismo de producci√≥n de ARNm seg√∫n el tipo de √°cido nucleico."
    },
    {
        q: "Los coronavirus poseen un genoma de‚Ä¶",
        opts: ["ADN bicatenario", "ARN bicatenario", "ARN monocatenario", "ADN monocatenario"],
        ans: 2,
        expl: "Tienen ARN de polaridad positiva monocatenario."
    },
    {
        q: "Los retrovirus se distinguen principalmente porque‚Ä¶",
        opts: [
            "Utilizan una ADN polimerasa dependiente de ARN",
            "Poseen ARN bicatenario",
            "Utilizan una transcriptasa inversa para sintetizar ADN",
            "No requieren enzimas para replicarse"
        ],
        ans: 2,
        expl: "La enzima retrotranscriptasa permite integrar su genoma en el ADN celular."
    },
    {
        q: "¬øCu√°l es una caracter√≠stica funcional clave de la transcriptasa inversa?",
        opts: [
            "Sintetiza prote√≠nas estructurales virales",
            "Copia ARN a ADN",
            "Copia ADN a ARN",
            "Genera mutaciones espont√°neas en el virus"
        ],
        ans: 1,
        expl: "Realiza la transcripci√≥n inversa del genoma viral de ARN a ADN."
    },
    {
        q: "¬øQu√© son los ‚Äúobeliscos‚Äù descritos recientemente en la microbiota humana?",
        opts: [
            "Virus gigantes que infectan bacterias intestinales",
            "Elementos gen√©ticos de ARN con estructura compleja",
            "Retrovirus end√≥genos reactivados",
            "Micropat√≥genos celulares desconocidos"
        ],
        ans: 1,
        expl: "Son nuevas entidades de ARN circulares descubiertas recientemente."
    },
    {
        q: "¬øCu√°l de las siguientes aÔ¨Årmaciones sobre los obeliscos es correcta?",
        opts: [
            "Se replican mediante ADN polimerasa del hu√©sped",
            "Tienen genomas lineales de ADN",
            "Representan un posible nuevo tipo de entidad biol√≥gica basada en ARN",
            "Son un subtipo de retrovirus"
        ],
        ans: 2,
        expl: "Sus genomas de ARN son peque√±os y circulares, distintos a virus conocidos."
    },
    {
        q: "¬øQu√© caracter√≠stica explica la relativa baja tasa de mutaci√≥n de los coronavirus en comparaci√≥n con otros virus de ARN?",
        opts: [
            "Su genoma es muy peque√±o",
            "Poseen una ARN polimerasa dependiente de ADN",
            "Poseen una exorribonucleasa con actividad correctora",
            "Se integran en el genoma del hu√©sped"
        ],
        ans: 2,
        expl: "La enzima nsp14 corrige errores, lo que les permite tener genomas muy grandes."
    },
    {
        q: "La menor variabilidad gen√©tica de los coronavirus se debe, entre otras razones, a que‚Ä¶",
        opts: [
            "Su replicaci√≥n ocurre en el n√∫cleo",
            "Su ciclo replicativo inicial es corto, reduciendo la presi√≥n inmunitaria prolongada",
            "Sus prote√≠nas estructurales son muy inestables",
            "Utilizan ribosomas propios para replicarse"
        ],
        ans: 1,
        expl: "Al replicarse r√°pido y ser eficientes, acumulan menos presi√≥n selectiva en etapas tempranas."
    },
    {
        q: "El VIH presenta alta variabilidad gen√©tica principalmente porque‚Ä¶",
        opts: [
            "Tiene ADN bicatenario",
            "Usa una transcriptasa inversa muy Ô¨Åel",
            "Genera prote√≠nas de reparaci√≥n especializadas",
            "Su transcriptasa inversa carece de actividad correctora"
        ],
        ans: 3,
        expl: "La alta tasa de error de la TI genera una nube de variantes o cuasiespecies."
    },
    {
        q: "¬øQu√© consecuencia tiene la alta variabilidad gen√©tica del VIH?",
        opts: [
            "Es m√°s resistente a la acci√≥n del sistema inmune y a tratamientos",
            "Su replicaci√≥n es m√°s lenta",
            "Infecta √∫nicamente c√©lulas epiteliales",
            "Tiene un ciclo de infecci√≥n muy corto"
        ],
        ans: 0,
        expl: "Permite al virus evadir f√°rmacos y anticuerpos mediante mutaciones constantes."
    },
    {
        q: "¬øQu√© t√©rmino describe mejor a un grupo de virus relacionados que comparten ancestro reciente y caracter√≠sticas gen√≥micas espec√≠Ô¨Åcas?",
        opts: ["Cepa", "Linaje", "Serogrupo", "Cuasiespecie"],
        ans: 1,
        expl: "Un linaje es una rama filogen√©tica clara dentro de una especie viral."
    },
    {
        q: "Una ‚Äúcepa‚Äù viral se deÔ¨Åne correctamente como",
        opts: [
            "Una variante con diferencias gen√≥micas m√≠nimas pero sin cambio fenot√≠pico",
            "Un conjunto de virus de distintas especies que comparten un ant√≠geno",
            "Una variante con caracter√≠sticas biol√≥gicas o fenot√≠picas distintivas",
            "Un conjunto de virus que infectan al mismo hospedador"
        ],
        ans: 2,
        expl: "El t√©rmino cepa implica que existe una diferencia funcional o de comportamiento biol√≥gico."
    },
    {
        q: "¬øPor qu√© el VIH est√° sometido a una presi√≥n inmunitaria prolongada?",
        opts: [
            "Porque se replica √∫nicamente en c√©lulas epiteliales",
            "Porque establece infecciones persistentes e integra su genoma en el hu√©sped",
            "Porque solo infecta durante pocos d√≠as",
            "Porque posee una exorribonucleasa propia"
        ],
        ans: 1,
        expl: "La integraci√≥n permite al virus persistir de por vida, enfrentando al sistema inmune constantemente."
    },
    {
        q: "¬øCu√°l de las siguientes es una diferencia clave entre coronavirus y retrovirus en cuanto a su replicaci√≥n?",
        opts: [
            "Los coronavirus se integran en el genoma del hu√©sped",
            "Los retrovirus utilizan la transcriptasa inversa y se integran en el ADN de la c√©lula",
            "Ambos dependen una polimerasa con actividad correctora",
            "Los retrovirus replican exclusivamente en el citoplasma"
        ],
        ans: 1,
        expl: "Los retrovirus obligatoriamente integran su genoma (fase proviral)."
    },
    {
        q: "Los obeliscos, en contraste con los coronavirus y retrovirus, se caracterizan por‚Ä¶",
        opts: [
            "Tener genomas muy grandes de ADN",
            "Carecer de prote√≠nas propias y se completamente dependientes del hu√©sped",
            "Replicarse en el n√∫cleo mediante ADN polimerasa",
            "Ser entidades de ARN peque√±as"
        ],
        ans: 3,
        expl: "Son mucho m√°s simples que los virus, similares a viroides."
    },
    {
        q: "36. ¬øQu√© funci√≥n tiene la primasa en la replicaci√≥n?",
        opts: [
            "Sintetizar fragmentos de Okazaki",
            "Eliminar cebadores de ARN",
            "Unir los fragmentos generados en la hebra l√≠der",
            "Crear un cebador de ARN para iniciar la s√≠ntesis de ADN"
        ],
        ans: 3,
        expl: "La ADN polimerasa no puede empezar de cero y necesita el extremo 3'-OH de un cebador."
    },
    {
        q: "En eucariotas, la remodelaci√≥n de cromatina que facilita la transcripci√≥n suele implicar:",
        opts: [
            "Metilaci√≥n de ADN en las islas CpG",
            "Acetilaci√≥n de histonas que relaja la estructura de la cromatina",
            "Compactaci√≥n adicional de nucleosomas",
            "Eliminaci√≥n del capuch√≥n 5‚Äô"
        ],
        ans: 1,
        expl: "La acetilaci√≥n neutraliza las cargas positivas de las histonas."
    },
    {
        q: "¬øCu√°l de los siguientes es un represor transcripcional?",
        opts: [
            "Una prote√≠na que recluta desacetilasas de histonas (HDAC)",
            "La ARN polimerasa",
            "Las chaperonas",
            "d. Una topoisomerasa"
        ],
        ans: 0,
        expl: "Al eliminar grupos acetilo, se compacta la cromatina y se impide la expresi√≥n del gen."
    }
];

let states = { answered: {}, marked: new Set() };

function init() {
    const root = document.getElementById('quiz-root');
    const nav = document.getElementById('nav-index');
    root.innerHTML = ''; nav.innerHTML = '';
    
    questions.forEach((q, i) => {
        const dot = document.createElement('a');
        dot.className = 'nav-dot'; dot.id = `dot-${i}`; dot.innerText = i + 1;
        dot.href = `#q-block-${i}`;
        nav.appendChild(dot);

        const block = document.createElement('div');
        block.className = 'question-block'; block.id = `q-block-${i}`;
        block.innerHTML = `
            <div class="q-header">
                <h3>Pregunta ${i + 1}</h3>
                <button class="btn-mark" id="mark-${i}" onclick="mark(${i})">Marcar üîñ</button>
            </div>
            <p><strong>${q.q}</strong></p>
            <div class="options-list" id="opts-${i}">
                ${q.opts.map((o, oi) => `<button class="opt-btn" onclick="check(${i}, ${oi})">${o}</button>`).join('')}
            </div>
            <div class="explanation" id="expl-${i}"></div>
        `;
        root.appendChild(block);
    });
}

function mark(i) {
    const btn = document.getElementById(`mark-${i}`);
    const dot = document.getElementById(`dot-${i}`);
    if(states.marked.has(i)) {
        states.marked.delete(i); btn.classList.remove('active'); dot.classList.remove('marked');
    } else {
        states.marked.add(i); btn.classList.add('active'); dot.classList.add('marked');
    }
}

function check(qIdx, oIdx) {
    if(states.answered[qIdx] !== undefined) return;
    
    const correct = questions[qIdx].ans === oIdx;
    states.answered[qIdx] = correct;
    
    const btns = document.getElementById(`opts-${qIdx}`).children;
    for(let b of btns) b.disabled = true;
    
    btns[oIdx].classList.add(correct ? 'correct-opt' : 'wrong-opt');
    if(!correct) btns[questions[qIdx].ans].classList.add('correct-opt');

    const expl = document.getElementById(`expl-${qIdx}`);
    expl.style.display = 'block';
    expl.className = 'explanation ' + (correct ? 'expl-correct' : 'expl-wrong');
    expl.innerHTML = `<strong>${correct ? 'Correcto' : 'Incorrecto'}</strong>: ${questions[qIdx].expl}`;
    
    document.getElementById(`dot-${qIdx}`).classList.add('answered');
    if(Object.keys(states.answered).length === questions.length) finish();
}

function finish() {
    const screen = document.getElementById('final-screen');
    const correctCount = Object.values(states.answered).filter(v => v).length;
    document.getElementById('score-text').innerText = `Aciertos: ${correctCount} / ${questions.length}`;
    
    const failedCount = questions.length - correctCount;
    document.getElementById('btn-restart-failed').disabled = failedCount === 0;
    document.getElementById('btn-restart-marked').disabled = states.marked.size === 0;
    document.getElementById('btn-restart-both').disabled = (failedCount === 0 && states.marked.size === 0);
    
    screen.style.display = 'block';
}

function restartSelected(mode) {
    let toReset = [];
    questions.forEach((_, i) => {
        const isFailed = !states.answered[i];
        const isMarked = states.marked.has(i);
        if(mode === 'failed' && isFailed) toReset.push(i);
        else if(mode === 'marked' && isMarked) toReset.push(i);
        else if(mode === 'both' && (isFailed || isMarked)) toReset.push(i);
    });

    toReset.forEach(i => {
        delete states.answered[i];
        document.getElementById(`dot-${i}`).classList.remove('answered');
        document.getElementById(`expl-${i}`).style.display = 'none';
        const btns = document.getElementById(`opts-${i}`).children;
        for(let b of btns) { b.disabled = false; b.className = 'opt-btn'; }
    });
    
    document.getElementById('final-screen').style.display = 'none';
    window.scrollTo({top: 0, behavior: 'smooth'});
}

init();
</script>
</body>
</html>