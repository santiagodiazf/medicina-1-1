<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Anatomía - Tema 33: Genital Masculino</title>
    <style>
        :root {
            --primary-color: #006064; /* Cian Oscuro */
            --secondary-color: #0097a7;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --background-color: #e0f7fa;
            --card-background: #ffffff;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #004d40;
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #00695c;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 15px;
            text-align: center;
            background-color: #00332c;
            border-bottom: 1px solid #00695c;
        }

        .sidebar-header h2 { margin: 0; font-size: 1.1rem; }
        
        .sidebar-controls {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .sidebar-stats { font-size: 0.9rem; color: #80cbc4; }

        .finish-btn-side {
            background-color: #fbc02d;
            border: none;
            border-radius: 4px;
            color: #00332c;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            width: 80%;
            transition: 0.2s;
        }
        .finish-btn-side:hover { background-color: #fdd835; }

        .sidebar-nav {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 5px;
            align-content: start;
        }

        .nav-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 4px;
            background-color: #00695c;
            color: white;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: 0.2s;
        }

        .nav-btn:hover { background-color: var(--secondary-color); }
        .nav-btn.correct { background-color: var(--success-color); }
        .nav-btn.incorrect { background-color: var(--error-color); }
        .nav-btn.marked { border: 2px solid #fbc02d; color: #fbc02d; font-weight: bold; }

        /* MAIN CONTENT */
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 30px;
            scroll-behavior: smooth;
        }

        .container { max-width: 900px; margin: 0 auto; }

        h1 { color: var(--primary-color); border-bottom: 3px solid var(--secondary-color); padding-bottom: 10px; }

        .question-card {
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--secondary-color);
            scroll-margin-top: 20px;
        }

        .question-header-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .bookmark-btn {
            background: none;
            border: 1px solid #80cbc4;
            border-radius: 4px;
            cursor: pointer;
            color: #00695c;
            padding: 2px 8px;
        }
        .bookmark-btn.active { color: #fbc02d; border-color: #fbc02d; background: #fffde7; }

        .question-text { font-size: 1.1rem; color: #004d40; margin-bottom: 15px; font-weight: 600; line-height: 1.4; }

        .options-grid { display: flex; flex-direction: column; gap: 8px; }

        .option-btn {
            padding: 10px 15px;
            border: 1px solid #b2dfdb;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            text-align: left;
            transition: 0.2s;
            font-size: 1rem;
        }

        .option-btn:hover:not(.disabled) { background-color: #e0f2f1; border-color: var(--primary-color); }
        
        .option-btn.correct { background-color: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.incorrect { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }
        .option-btn.disabled { cursor: default; opacity: 0.7; }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
            font-size: 0.9rem;
        }
        .feedback.show { display: block; }
        .feedback.success { background-color: #e8f8f5; color: #0e6251; }
        .feedback.error { background-color: #fdedec; color: #78281f; }

        /* RESULT PANEL */
        .results-panel {
            background: #004d40;
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-top: 40px;
            display: none;
            margin-bottom: 50px;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            background: var(--secondary-color);
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: transform 0.1s;
        }
        .action-btn:hover { background: #006064; transform: scale(1.05); }
        .action-btn:active { transform: scale(0.95); }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .sidebar { width: 100%; height: 160px; border-right: none; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
            .sidebar-nav { grid-template-columns: repeat(8, 1fr); max-height: 150px; }
            .main-content { overflow: visible; }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2>Tema 33: Genital Masculino</h2>
        <div class="sidebar-controls">
            <div class="sidebar-stats"><span id="progress-text">0/96</span> respondidas</div>
            <button class="finish-btn-side" onclick="showResults(true)">Finalizar Test</button>
        </div>
    </div>
    <div id="sidebar-nav" class="sidebar-nav"></div>
</div>

<div class="main-content">
    <div class="container">
        <h1>Aparato Genital Masculino 

[Image of male reproductive system anatomy]
</h1>
        <div id="questions-list"></div>
        
        <div id="results-panel" class="results-panel">
            <h2>Test Finalizado</h2>
            <p id="score-text" style="font-size: 1.4rem; margin: 15px 0;"></p>
            <div class="action-buttons">
                <button class="action-btn" onclick="resetQuiz('all')">Repetir Todo</button>
                <button class="action-btn" onclick="resetQuiz('wrong')">Repetir Falladas</button>
                <button class="action-btn" onclick="resetQuiz('marked')">Repetir Marcadas</button>
                <button class="action-btn" onclick="resetQuiz('wrong_marked')">Falladas + Marcadas</button>
            </div>
        </div>
    </div>
</div>

<script>
    // BASE DE DATOS - TEMA 33 GENITAL MASCULINO
    const dbQuestions = [
        { id: 1, original: "Extra 1", q: "¿Cómo se denomina el estrechamiento en la porción inicial de la uretra masculina?", options: ["Porción membranosa", "Esfínter interno de la uretra (Cuello)", "Esfínter externo de la uretra", "Fosa navicular"], correct: 1, exp: "El primer estrechamiento es el cuello vesical (esfínter interno)." },
        { id: 2, original: "Extra 2", q: "El epidídimo se conforma por la confluencia de los:", options: ["Conductos seminíferos", "Conductos eferentes", "Conductos deferentes", "Túbulos seminíferos"], correct: 1, exp: "Los conductos eferentes salen de la rete testis y forman la cabeza del epidídimo." },
        { id: 3, original: "Extra 3", q: "¿En qué porción del testículo se encuentra el mediastino testicular?", options: ["Polo inferior", "Borde posterior", "Cara lateral", "Borde anterior"], correct: 1, exp: "El mediastino testicular (cuerpo de Highmore) está en el borde posterior." },
        { id: 4, original: "1", q: "El conducto de Wolff se organiza junto al:", options: ["Mesonefros", "Pronefros", "Metanefros", "Gonada indiferenciada"], correct: 0, exp: "Es el conducto del mesonefros." },
        { id: 5, original: "2", q: "¿Qué estructuras NO derivan o dependen de restos del conducto de Wolff?", options: ["Uretra esponjosa", "Epidídimo", "Conducto deferente", "Vesículas seminales"], correct: 0, exp: "La uretra esponjosa deriva del seno urogenital." },
        { id: 6, original: "3", q: "El escroto se forma a partir de:", options: ["Los pliegues genitales (o protuberancias genitales)", "Tubérculo genital", "Pliegues uretrales", "Seno urogenital"], correct: 0, exp: "Las protuberancias genitales (labioescrotales) forman el escroto." },
        { id: 7, original: "4", q: "Para que un sujeto se denomine fenotípicamente en sentido masculino el genotipo o composición genotípica debe expresarse en última instancia:", options: ["SRY", "XX", "WNT4", "DAX1"], correct: 0, exp: "El gen SRY en el cromosoma Y." },
        { id: 8, original: "5", q: "¿Qué gen se expresa para poner en marcha la determinación sexual del embrión?", options: ["SRY", "HOX", "P53", "BRCA"], correct: 0, exp: "Sex-determining Region Y." },
        { id: 9, original: "6", q: "El glande deriva de:", options: ["El tubérculo genital", "Pliegues uretrales", "Pliegues genitales", "Seno urogenital"], correct: 0, exp: "El tubérculo genital forma el glande." },
        { id: 10, original: "7", q: "¿Qué músculo es responsable de la aportación de fibras para la formación del músculo cremáster?", options: ["Oblicuo interno (menor)", "Oblicuo externo", "Transverso", "Recto anterior"], correct: 0, exp: "El cremáster deriva del oblicuo interno." },
        { id: 11, original: "8", q: "Con respecto a los cuerpos cavernosos:", options: ["Se encuentran junto al cuerpo esponjoso en hombres", "En la mujer los cuerpos cavernosos están separados del cuerpo esponjoso", "Existen dos cuerpos cavernosos y un cuerpo esponjoso", "Todas son ciertas"], correct: 3, exp: "Todas las afirmaciones son correctas anatómicamente." },
        { id: 12, original: "9", q: "Relaciones las siguientes estructuras (Recto):", options: ["Es posterior a la próstata", "Es anterior a la próstata", "Lateral", "Superior"], correct: 0, exp: "El recto está detrás de la próstata (tabique rectoprostático)." },
        { id: 13, original: "9B", q: "Relaciones las siguientes estructuras (Testículo):", options: ["Túnica vaginal", "Peritoneo parietal", "Fascia de Gerota", "Fascia renal"], correct: 0, exp: "El testículo está cubierto por la túnica vaginal (derivada del peritoneo)." },
        { id: 14, original: "10", q: "Marque lo correcto sobre el testículo:", options: ["El izquierdo está 1 cm más abajo que el derecho", "El derecho más bajo", "Están al mismo nivel", "Son retroperitoneales"], correct: 0, exp: "El izquierdo suele descender más." },
        { id: 15, original: "11", q: "Los lóbulos testiculares:", options: ["Cada uno contiene de 1 a 3 túbulos seminíferos", "Son únicos", "Contienen la rete testis", "No tienen túbulos"], correct: 0, exp: "La unidad funcional contiene 1-3 túbulos." },
        { id: 16, original: "12", q: "Los conductos deferentes:", options: ["Están irrigados por ramas de la arteria vesical superior (Arteria del conducto deferente)", "Por la testicular", "Por la pudenda", "Por la cremastérica"], correct: 0, exp: "La arteria del deferente suele nacer de la vesical superior (o inferior)." },
        { id: 17, original: "13", q: "La próstata:", options: ["Está irrigada por ramas de las arterias pudenda interna, vesical inferior y hemorroidal media", "Solo vesical superior", "Solo pudenda", "Solo rectal superior"], correct: 0, exp: "Recibe riego múltiple de la ilíaca interna." },
        { id: 18, original: "14", q: "La uretra masculina:", options: ["Tiene tres porciones (Prostática, Membranosa, Esponjosa)", "Tiene dos", "Tiene una", "Es recta"], correct: 0, exp: "División clásica." },
        { id: 19, original: "15", q: "En el pene:", options: ["El cuerpo esponjoso es atravesado por la uretra", "Los cavernosos son atravesados", "No hay uretra", "La uretra es dorsal"], correct: 0, exp: "La uretra discurre por el cuerpo esponjoso (ventral)." },
        { id: 20, original: "16", q: "La uretra esponjosa se encuentra en:", options: ["El pene", "La próstata", "La vejiga", "Entre el riñón y el trígono vesical"], correct: 0, exp: "Porción peneana." },
        { id: 21, original: "17", q: "Con respecto a la próstata:", options: ["Su cara posterior se apoya en la ampolla del recto", "Por su interior transita la uretra membranosa (Falso, es prostática)", "Su cara anterior se relaciona con la vejiga (Falso, superior)", "Los conductos eyaculadores penetran por su cara anterior (Falso, posterior)"], correct: 0, exp: "Relación posterior rectal (tacto rectal)." },
        { id: 22, original: "18", q: "El veru montanum o colículo seminal se encuentra en:", options: ["La uretra prostática", "El conducto eyaculador", "La uretra membranosa", "El conducto deferente"], correct: 0, exp: "En la pared posterior de la uretra prostática." },
        { id: 23, original: "19", q: "El pene está formado por:", options: ["Dos cuerpos cavernosos y uno esponjoso, por donde pasa la uretra", "Dos cavernosos y uno membranoso", "Dos cavernosos que forman el glande", "Un cavernoso y un esponjoso"], correct: 0, exp: "Estructura eréctil clásica." },
        { id: 24, original: "20", q: "El cordón espermático está constituido por:", options: ["El conducto deferente, la arteria y las venas espermáticas (testiculares), y las arterias deferenciales y funicular (cremastérica)", "Solo conducto deferente", "Solo arterias", "Conducto eyaculador y vasos"], correct: 0, exp: "Contiene deferente, 3 arterias, 3 venas (grupos), nervios y linfáticos." },
        { id: 25, original: "21", q: "La próstata se relaciona con el recto por su cara:", options: ["Posterior", "Anterior", "Lateral", "Superior"], correct: 0, exp: "Repetida: Posterior." },
        { id: 26, original: "22", q: "Las vesículas seminales se encuentran:", options: ["Posteriores a la vejiga (y laterales a los deferentes)", "Anterior a la vejiga", "Laterales a los conductos deferentes (pero la opción más precisa es posterior a vejiga en algunos contextos, o laterales al deferente en la ampolla). Texto: Laterales a deferentes.", "Mediales a los conductos deferentes"], correct: 2, exp: "Están laterales a la ampolla del deferente, en la base vesical." },
        { id: 27, original: "23", q: "El glande peneano es continuación de:", options: ["El cuerpo esponjoso", "El rafe medio", "Los cuerpos cavernosos", "Los músculos isquiocavernosos"], correct: 0, exp: "Es la expansión distal del cuerpo esponjoso." },
        { id: 28, original: "24", q: "La arteria pudenda interna es rama de la arteria:", options: ["Hipogástrica (ilíaca interna)", "Iliaca primitiva", "Vesical inferior", "Iliaca externa"], correct: 0, exp: "Rama terminal de la ilíaca interna." },
        { id: 29, original: "25", q: "¿Cuál NO es estructura del cordón espermático?", options: ["Tendón conjunto", "Conducto deferente", "Arteria testicular", "Plexo pampiniforme"], correct: 0, exp: "El tendón conjunto forma parte del techo/pared posterior del conducto inguinal, no del contenido." },
        { id: 30, original: "26", q: "¿Qué capa de la bolsa escrotal deriva de fibras musculares derivadas de los músculos del techo del conducto inguinal?", options: ["Cremáster (del Oblicuo Interno)", "Dartos", "Fascia espermática externa", "Túnica vaginal"], correct: 0, exp: "El cremáster viene del oblicuo interno." },
        { id: 31, original: "27", q: "Los conductos eyaculadores drenan en:", options: ["El colículo seminal del seno prostático", "La uretra membranosa", "La vejiga", "El utrículo"], correct: 0, exp: "A ambos lados del utrículo en el veru montanum." },
        { id: 32, original: "28", q: "La cavidad vaginal que rodea en parte al testículo organiza un ligamento que fija al testículo en la región del:", options: ["Polo superior (Ligamento de Cloquet? No, el texto dice Polo Superior)", "Polo inferior (Gubernaculum)", "Cara anterior", "Cara posterior"], correct: 0, exp: "Nota: El ligamento escrotal (gubernaculum) está en el polo INFERIOR. Sin embargo, el texto original marca 'Polo superior' en la pregunta 28 del bloque. Si nos ceñimos a la anatomía clásica, el ligamento suspensorio o restos del proceso vaginal están arriba, pero la fijación principal es abajo. Seguiré la literalidad del texto proporcionado: Polo superior (aunque sea discutible)." },
        { id: 33, original: "29", q: "El epídidimo se conforma por la reunión de los:", options: ["Conductos eferentes", "Deferentes", "Seminíferos", "Eyaculadores"], correct: 0, exp: "Cabeza del epidídimo." },
        { id: 34, original: "30", q: "Durante la eyaculación, ¿qué estructura impide el retorno del líquido seminal a la luz vesical?", options: ["Esfínter interno de la uretra", "Esfínter externo", "Veru montanum", "Diafragma urogenital"], correct: 0, exp: "Cierre simpático del cuello vesical." },
        { id: 35, original: "31", q: "¿En qué porción del testículo se sitúa el mediastino testicular? (Repetida)", options: ["Borde posterior", "Polo superior", "Polo inferior", "Cara lateral"], correct: 0, exp: "Repetida: Borde posterior." },
        { id: 36, original: "32", q: "¿Cuál de los siguientes nervios periféricos NO procede del nervio pudendo?", options: ["Nervio testicular (Plexo lumbar/renal)", "Nervios perineales", "Nervio dorsal del pene", "Nervios rectales inferiores"], correct: 0, exp: "La inervación testicular es autónoma (plexo testicular), no somática del pudendo." },
        { id: 37, original: "33", q: "¿Qué porción del testículo no queda rodeada por la cavidad vaginal?", options: ["Borde posterior", "Cara lateral", "Polo anterior", "Polo inferior"], correct: 0, exp: "El borde posterior (meso) y mediastino." },
        { id: 38, original: "34", q: "El ligamento testicular fija al testículo, ¿en qué porción del mismo se ancla?", options: ["Polo inferior del testículo", "Polo superior", "Cara lateral", "Mediastino"], correct: 0, exp: "Gubernaculum testis en el polo inferior." },
        { id: 39, original: "35", q: "El drenaje venoso que procede de los testículos se organiza en su origen en la gónada a través de los elementos:", options: ["Plexo pampiniforme", "Vena cava", "Vena renal", "Vena ilíaca"], correct: 0, exp: "Red venosa pampiniforme." },
        { id: 40, original: "36", q: "La porción funicular del cordón espermático se encuentra envuelto en su trayecto externo al anillo inguinal superficial por:", options: ["Fascia espermática externa (y las internas)", "Solo cremáster", "Solo peritoneo", "Ninguna"], correct: 0, exp: "Al salir del anillo superficial, tiene todas las capas (Espermática externa, Cremáster, Espermática interna)." },
        { id: 41, original: "37", q: "La arteria del conducto deferente es rama de:", options: ["Arteria umbilical (porción permeable)", "Vesical inferior", "Testicular", "Pudenda"], correct: 0, exp: "Suele nacer de la umbilical/vesical superior." },
        { id: 42, original: "38", q: "¿Qué porción del trayecto del conducto deferente no está recubierta de la fascia espermática externa?", options: ["Pélvica", "La porción inicial tras la cola del epidídimo", "Funicular", "Escrotal"], correct: 0, exp: "En la pelvis ya ha salido del cordón espermático y sus cubiertas." },
        { id: 43, original: "39", q: "La cavidad vaginal que rodea en parte al testículo organiza un ligamento que fija al testículo en la región del: (Repetida 28)", options: ["Polo superior", "Polo inferior", "Cara medial", "Mediastino"], correct: 0, exp: "Repetida literal del texto (ver nota Q32)." },
        { id: 44, original: "40", q: "El epidídimo se conforma por la reunión de los: (Repetida)", options: ["Conductos eferentes", "Mediastino", "Seminíferos", "Deferentes"], correct: 0, exp: "Repetida." },
        { id: 45, original: "41", q: "Marque lo correcto sobre el testículo: (Repetida)", options: ["El izquierdo está ubicado 1 cm más abajo que el derecho", "Por su polo inferior se relaciona con la cola del epidídimo", "Longitud 2cm", "Apéndice es resabio"], correct: 0, exp: "Repetida." },
        { id: 46, original: "42", q: "Los lóbulos testiculares: (Repetida)", options: ["Cada uno contiene de 1 a 3 túbulos seminíferos", "Son 20", "No tienen cubierta", "Están en el epidídimo"], correct: 0, exp: "Repetida." },
        { id: 47, original: "43", q: "Los conductos deferentes: (Repetida)", options: ["Van desde el testículo hacia el epidídimo (Falso, al revés)", "Se encuentran enrollados (Falso, es recto)", "Están irrigados por ramas de la arteria vesical superior", "Inervados por plexo testicular"], correct: 2, exp: "Repetida: Arteria deferencial." },
        { id: 48, original: "44", q: "La próstata: (Repetida)", options: ["Está irrigada por ramas de la arteria pudenda interna, vesical inferior y hemorroidal media", "Peso 4gr", "Detrás ampolla rectal", "Celda ligamento"], correct: 0, exp: "Repetida." },
        { id: 49, original: "45", q: "En el pene: (Repetida)", options: ["El cuerpo esponjosos es atravesado por la uretra", "Cavernoso y 2 esponjosos", "Bulbo continua cavernoso", "Esponjoso cubierto por isquiocavernoso"], correct: 0, exp: "Repetida." },
        { id: 50, original: "46", q: "El drenaje linfático testicular tiene lugar fundamental hacia:", options: ["Ganglios linfáticos lumbares (aórticos laterales)", "Inguinales", "Femorales", "Pélvicos"], correct: 0, exp: "Sigue a los vasos testiculares hacia el retroperitoneo alto." },
        { id: 51, original: "47", q: "El epidídimo se conforma por la confluencia de los: (Repetida)", options: ["Conducto eferente (Conductos)", "Deferentes", "Seminíferos", "Conductillos"], correct: 0, exp: "Repetida." },
        { id: 52, original: "48", q: "Qué elemento exprime el cuerpo esponjoso para facilitar la salida del semen.", options: ["Musculo bulboesponjoso", "Isquiocavernoso", "Esfinter externo", "Transverso"], correct: 0, exp: "El bulboesponjoso comprime la uretra bulbar." },
        { id: 53, original: "49", q: "El drenaje linfático testicular tiene lugar fundamentalmente hacia: (Repetida)", options: ["Ganglios linfáticos lumbares", "Pélvicos", "Femorales", "Inguinales"], correct: 0, exp: "Repetida." },
        { id: 54, original: "50", q: "En su trayecto, atraviesa en el varón el conducto inguinal", options: ["Arterias gonadales (Testicular)", "Esplénica", "Mesentérica", "Cólica"], correct: 0, exp: "La arteria testicular va dentro del cordón espermático." },
        { id: 55, original: "51", q: "Qué arteria nutre los cuerpos eréctiles del pene", options: ["Pudenda interna", "Umbilical", "Epigástrica", "Rectal"], correct: 0, exp: "Da las arterias cavernosas y dorsal del pene." },
        { id: 56, original: "52", q: "Exprime el bulbo del cuerpo esponjoso para facilitar la salida del semen (Repetida)", options: ["Músculo bulboesponjoso", "Isquiocavernoso", "Cowper", "Utrículo"], correct: 0, exp: "Repetida." },
        { id: 57, original: "53", q: "La cavidad que rodea en buena parte al testículo está organizada por cuál de las siguientes láminas", options: ["Túnica vaginal", "Albugínea", "Cremáster", "Dartos"], correct: 0, exp: "La vaginal es la serosa." },
        { id: 58, original: "54", q: "Fibras musculares derivadas de los músculos del techo del conducto inguinal", options: ["Cremáster", "Albugínea", "Vaginal", "Dartos"], correct: 0, exp: "Repetida." },
        { id: 59, original: "55", q: "¿Qué estructuras no derivan o dependen de restos del conducto de Wolff? (Repetida)", options: ["Uretra esponjosa", "Epidídimo", "Deferentes", "Seminales"], correct: 0, exp: "Repetida." },
        { id: 60, original: "56", q: "¿Cuál de las siguientes capas no posee el cordón espermático?", options: ["Túnica albugínea", "Cremáster", "Fascia espermática interna", "Fascia espermática externa"], correct: 0, exp: "La albugínea es la cápsula propia del testículo, profunda a la vaginal, no una capa del cordón." },
        { id: 61, original: "57", q: "En la transformación del final del tubérculo genital no participa de ninguna manera uno de los siguientes factores", options: ["SRY", "5 ALFA REDUCTASA", "Genes HOX", "Gen del receptor de andrógenos"], correct: 0, exp: "El SRY actúa en la diferenciación gonadal inicial. La transformación del tubérculo (genitales externos) depende de andrógenos/DHT (5-alfa, receptor) y HOX. El SRY ya 'actuó' mucho antes." },
        { id: 62, original: "58", q: "Cómo se denomina el estrechamiento en la porción inicial de la uretra masculina. (Repetida)", options: ["Esfínter interno de la uretra", "Fosa navicular", "Membranosa", "Esfínter externo"], correct: 0, exp: "Repetida." },
        { id: 63, original: "59", q: "La arteria dorsal del pene es rama de la arteria:", options: ["Pudenda interna", "Rectal inferior", "Obturatriz", "Pudenda externa"], correct: 0, exp: "Rama terminal de la pudenda interna." },
        { id: 64, original: "60", q: "El nervio pudendo inerva sensitivamente todas estas regiones, excepto:", options: ["Cara lateral de la bolsa escrotal (Nervio Genitofemoral/Ilioinguinal)", "Cuerpos eréctiles", "Espacio perineal", "Canal anorrectal"], correct: 0, exp: "La cara lateral del escroto/muslo es L1-L2 (Genitofemoral)." },
        { id: 65, original: "61", q: "El receso vaginal es una prolongación que acompaña a:", options: ["Cola del Epidídimo (o ligamentos testiculares, pero la vaginal suele dejar un receso entre cuerpo epidi. y testículo)", "Hidátide", "Conducto deferente", "Albugínea"], correct: 0, exp: "El seno del epidídimo (receso) está lateral, entre el epidídimo y el testículo." },
        { id: 66, original: "62", q: "En qué porción del testículo se encuentra el mediastino testicular: (Repetida)", options: ["Borde posterior", "Anterior", "Lateral", "Inferior"], correct: 0, exp: "Repetida." },
        { id: 67, original: "63", q: "La afectación del testículo produce dolor que se refleja a la cavidad abdominal. Esto se produce por:", options: ["El origen lumbar de la inervación vegetativa que acompaña a la arteria testicular", "Vaginal peritoneal", "Albugínea", "Cava"], correct: 0, exp: "Por el origen embriológico alto (T10)." },
        { id: 68, original: "64", q: "Qué arteria no participa de los elementos vasculares que se encuentran en el trayecto inguinal:", options: ["Epigástrica superficial", "Arteria testicular", "Deferente", "Cremastérica"], correct: 0, exp: "La epigástrica superficial es subcutánea, fuera del conducto." },
        { id: 69, original: "65", q: "Qué elemento exprime el cuerpo esponjoso para facilitar la salida del semen: (Repetida)", options: ["Músculo bulboesponjoso", "Isquiocavernoso", "Transverso", "Esfínter"], correct: 0, exp: "Repetida." },
        { id: 70, original: "66", q: "Qué elemento queda fuera del cordón espermático:", options: ["Ramo genital del nervio genitofemoral (Está dentro)", "Conducto deferente", "Arteria testicular", "Nervio ilioinguinal (Está fuera, sobre el cordón)"], correct: 3, exp: "Nota: La opción literal D del texto es 'ramo genital...', pero el ramo genital va DENTRO. El nervio Ilioinguinal va FUERA. Si la pregunta busca lo que está fuera, es Ilioinguinal. El texto dice 'Ramo genital...' como opción D en la lista de arriba (q69 original), pero en q18 extra pone 'Ramo genital... dentro'. Asumiré que el distractor correcto es Ilioinguinal o similar externo." },
        { id: 71, original: "67", q: "Qué porción del testículo no se encuentra envuelto por la túnica vaginal: (Repetida)", options: ["Borde posterior", "Superior", "Anterior", "Medial"], correct: 0, exp: "Repetida." },
        { id: 72, original: "68", q: "Sobre la porción pélvica del conducto deferente, señale la incorrecta:", options: ["Durante su trayecto, se apoya sobre el uréter para dirigirse caudalmente (Falso, pasa POR ENCIMA/DELANTE del uréter)", "Extraperitoneal", "Cremáster cubre adventicia (En cordón, no en pelvis)", "Apoya vejiga"], correct: 0, exp: "El deferente cruza por encima al uréter ('agua bajo el puente'). Decir que se 'apoya para dirigirse caudalmente' puede interpretarse mal si implica ir paralelo. La relación clave es el cruce superior." },
        { id: 73, original: "69", q: "Que elemento queda dentro del cordon espermático (Repetida contexto)", options: ["Arteria testicular", "Epidídimo (No, está en testículo)", "Eferentes", "Genitofemoral"], correct: 0, exp: "Repetida." },
        { id: 74, original: "17 (Repetida)", q: "En su trayecto, atraviesa en el varón el conducto inguinal: (Repetida)", options: ["Arterias gonadales", "Esplénica", "Mesentérica", "Cólica"], correct: 0, exp: "Repetida." },
        { id: 75, original: "18 (Repetida)", q: "Qué elemento queda dentro del cordón espermático (Repetida)", options: ["Arteria testicular", "Eferentes", "Epidídimo", "Genital"], correct: 0, exp: "Repetida." },
        { id: 76, original: "19 (Repetida)", q: "Para que un sujeto se determine fenotípicamente en sentido masculino...: (Repetida)", options: ["SRY", "Muller", "5alfa", "XX"], correct: 0, exp: "Repetida." },
        { id: 77, original: "20 (Repetida)", q: "Qué porción del testículo no queda rodeado por la cavidad vaginal: (Repetida)", options: ["Borde posterior", "Polo superior", "Polo inferior", "Anterior"], correct: 0, exp: "Repetida: Borde Posterior." },
        { id: 78, original: "21 (Repetida)", q: "¿Qué músculo es responsable de la aportación de fibras para la formación del músculo cremáster? (Repetida)", options: ["Oblicuo interno", "Externo", "Transverso", "Psoas"], correct: 0, exp: "Repetida." },
        { id: 79, original: "22 (Repetida)", q: "Con respecto a los cuerpos cavernosos: (Repetida)", options: ["Todas son ciertas", "Junto esponjoso", "Separados en mujer", "Dos cavernosos"], correct: 0, exp: "Repetida." },
        { id: 80, original: "23 (Repetida)", q: "Relacione: Recto", options: ["Es posterior a la próstata", "Anterior próstata", "Túnica", "Receso"], correct: 0, exp: "Repetida." },
        { id: 81, original: "24 (Repetida)", q: "Relacione: Testículo", options: ["Túnica vaginal", "Posterior próstata", "Anterior", "Receso"], correct: 0, exp: "Repetida." },
        { id: 82, original: "25 (Repetida)", q: "Marque lo correcto sobre el testículo: (Repetida)", options: ["El izquierdo está 1 cm más abajo que el derecho", "Polo superior cola", "Longitud 2cm", "Apéndice mesonefros"], correct: 0, exp: "Repetida." },
        { id: 83, original: "26 (Repetida)", q: "Los lóbulos testiculares: (Repetida)", options: ["Cada uno contiene de 1 a 3 túbulos seminíferos", "20", "Sin cubierta", "Epidídimo"], correct: 0, exp: "Repetida." },
        { id: 84, original: "27 (Extra)", q: "Está situado entre la aponeurosis prostatoperitoneal y la próstata:", options: ["Espacio retroprostático de Proust (Denonvilliers separa próstata de recto)", "Preprostático", "Perineal", "Retzius"], correct: 0, exp: "Fascia de Denonvilliers." },
        { id: 85, original: "28 (Extra)", q: "Está ocupado por el plexo venoso de Santorini:", options: ["Espacio preprostático (Retzius)", "Retroprostático", "Rectal", "Perineal"], correct: 0, exp: "Plexo venoso dorsal profundo/Santorini en espacio retropúbico." },
        { id: 86, original: "Extra", q: "En relación al desarrollo del aparato genital indique que afirmación ES FALSA:", options: ["El Complejo Testosterona-Receptor viriliza el conducto de Müller (Falso, es el AMH el que lo atrofia)", "Testosterona viriliza Wolff", "DHT viriliza externos", "SRY inicia"], correct: 0, exp: "El conducto de Müller se atrofia por la Hormona Antimülleriana, no por la testosterona (que estimula Wolff)." },
        { id: 87, original: "29 (Extra)", q: "Los conductos de Gartner o epóforo son restos del:", options: ["Conducto de Wolff (en la mujer)", "Müller", "Seno urogenital", "Uraco"], correct: 0, exp: "Restos mesonéfricos en la mujer." },
        { id: 88, original: "30 (Extra)", q: "Un hombre de 69 años... impotencia. ¿Dónde se localizan los cuerpos neuronales responsables de la erección?:", options: ["Núcleo parasimpático sacro (S2-S4)", "Simpático lumbar", "Pudendo", "Corteza"], correct: 0, exp: "Erección es Parasimpática (S2-S4)." },
        { id: 89, original: "31 (Extra)", q: "La vena testicular izquierda drena a:", options: ["La vena renal izquierda", "Cava", "Ilíaca", "Mesentérica"], correct: 0, exp: "Repetida: Renal izquierda." },
        { id: 90, original: "32 (Extra)", q: "Relacione las estructuras abdominales con sus equivalentes en el escroto: Tejido celular subcutáneo", options: ["Túnica dartos", "Cremáster", "Fascia espermática ext", "Albugínea"], correct: 0, exp: "Dartos (músculo liso subcutáneo)." },
        { id: 91, original: "33 (Extra)", q: "El músculo isquiocavernoso:", options: ["Tiene su origen en la tuberosidad y rama isquiática y su inserción en el pilar del pene", "Rodea uretra", "Es liso", "Forma esfínter"], correct: 0, exp: "Comprime el pilar." },
        { id: 92, original: "34 (Extra)", q: "Relacione las estructuras abdominales con sus equivalentes en el escroto: Aponeurosis del Oblicuo externo", options: ["Fascia espermática externa", "Cremáster", "Dartos", "Interna"], correct: 0, exp: "Capa más externa del cordón." },
        { id: 93, original: "35 (Extra)", q: "Está situado entre la aponeurosis prostatoperitoneal y el recto:", options: ["Espacio prerrectal", "Retzius", "Perineal", "Vesical"], correct: 0, exp: "Separa fascia de Denonvilliers del recto." },
        { id: 94, original: "36 (Extra)", q: "Relacione las estructuras abdominales con sus equivalentes en el escroto: Oblicuo interno", options: ["Cremáster", "Dartos", "Externa", "Interna"], correct: 0, exp: "Repetida: Cremáster." },
        { id: 95, original: "39 (Extra)", q: "La arteria funicular o espermática externa procede de:", options: ["Arteria epigástrica caudal (inferior)", "Pudenda", "Testicular", "Vesical"], correct: 0, exp: "Rama de la epigástrica inferior." },
        { id: 96, original: "30 (Extra Final)", q: "Indique que arteria NO ES RAMA INTRAPELVICA visceral de la arteria iliaca interna o hipogástrica:", options: ["Pudenda interna (Parietal)", "Uterina (Visceral)", "Vesical (Visceral)", "Rectal media (Visceral)"], correct: 0, exp: "La pudenda interna es rama parietal extrapélvica (sale por el agujero ciático mayor)." }
    ];

    let currentQuestions = [...dbQuestions];
    let markedIds = new Set();
    let userAnswers = {};

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function renderQuiz() {
        const list = document.getElementById('questions-list');
        const nav = document.getElementById('sidebar-nav');
        const resultsPanel = document.getElementById('results-panel');
        
        list.innerHTML = '';
        nav.innerHTML = '';
        resultsPanel.style.display = 'none';

        if(currentQuestions.length === 0) {
            list.innerHTML = `<div class="question-card"><p>No hay preguntas para los criterios seleccionados.</p></div>`;
            return;
        }

        currentQuestions.forEach((q, index) => {
            const btn = document.createElement('a');
            btn.href = `#q-${q.id}`;
            btn.className = 'nav-btn';
            btn.innerText = index + 1;
            btn.id = `nav-btn-${q.id}`;
            
            if (userAnswers[q.id] === true) btn.classList.add('correct');
            if (userAnswers[q.id] === false) btn.classList.add('incorrect');
            if (markedIds.has(q.id)) btn.classList.add('marked');

            nav.appendChild(btn);

            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-${q.id}`;

            const originalOptions = q.options.map((text, i) => ({ text: text, isCorrect: i === q.correct }));
            const finalOptions = shuffle(originalOptions);

            let optionsHTML = '';
            finalOptions.forEach(opt => {
                const safeText = opt.text.replace(/'/g, "&#39;"); 
                optionsHTML += `<button class="option-btn" onclick="handleAnswer(${q.id}, ${opt.isCorrect}, this)">${opt.text}</button>`;
            });

            const isMarked = markedIds.has(q.id);

            card.innerHTML = `
                <div class="question-header-row">
                    <span>Pregunta ${index + 1} (Ref: ${q.original})</span>
                    <button class="bookmark-btn ${isMarked ? 'active' : ''}" onclick="toggleMark(${q.id}, this)">
                        ${isMarked ? '★ Marcada' : '☆ Marcar'}
                    </button>
                </div>
                <div class="question-text">${q.q}</div>
                <div class="options-grid" id="opts-${q.id}">
                    ${optionsHTML}
                </div>
                <div class="feedback" id="feed-${q.id}"></div>
            `;
            list.appendChild(card);
        });
        updateProgress();
    }

    function handleAnswer(id, isCorrect, btn) {
        if (userAnswers.hasOwnProperty(id)) return;
        
        userAnswers[id] = isCorrect;
        const navBtn = document.getElementById(`nav-btn-${id}`);
        const feedback = document.getElementById(`feed-${id}`);
        const container = document.getElementById(`opts-${id}`);
        const qData = dbQuestions.find(x => x.id === id);

        const allBtns = container.querySelectorAll('.option-btn');
        allBtns.forEach(b => {
            b.classList.add('disabled');
            b.onclick = null;
            const correctText = qData.options[qData.correct];
            if (b.innerText === correctText) b.classList.add('correct');
        });

        if (isCorrect) {
            feedback.innerHTML = `<strong>¡Correcto!</strong><br>${qData.exp}`;
            feedback.className = 'feedback success show';
            if(navBtn) navBtn.classList.add('correct');
        } else {
            btn.classList.add('incorrect');
            feedback.innerHTML = `<strong>Incorrecto.</strong><br>${qData.exp}`;
            feedback.className = 'feedback error show';
            if(navBtn) navBtn.classList.add('incorrect');
        }
        updateProgress();
    }

    function toggleMark(id, btn) {
        const navBtn = document.getElementById(`nav-btn-${id}`);
        if (markedIds.has(id)) {
            markedIds.delete(id);
            btn.innerHTML = '☆ Marcar';
            btn.classList.remove('active');
            if(navBtn) navBtn.classList.remove('marked');
        } else {
            markedIds.add(id);
            btn.innerHTML = '★ Marcada';
            btn.classList.add('active');
            if(navBtn) navBtn.classList.add('marked');
        }
    }

    function updateProgress() {
        const count = Object.keys(userAnswers).length;
        const total = currentQuestions.length;
        document.getElementById('progress-text').innerText = `${count}/${total} respondidas`;
        
        if (count === total && total > 0) {
            showResults(false);
        }
    }

    function showResults(manualFinish = false) {
        const panel = document.getElementById('results-panel');
        let correct = 0;
        Object.values(userAnswers).forEach(v => { if(v) correct++; });
        
        const total = currentQuestions.length;
        
        document.getElementById('score-text').innerText = `Has acertado ${correct} de ${total}`;
        panel.style.display = 'block';
        
        if(manualFinish) {
            panel.scrollIntoView({ behavior: 'smooth' });
        } else {
            setTimeout(() => panel.scrollIntoView({ behavior: 'smooth' }), 100);
        }
    }

    function resetQuiz(mode) {
        let nextIds = [];

        if (mode === 'all') {
            nextIds = dbQuestions.map(q => q.id);
        } else if (mode === 'wrong') {
            nextIds = Object.keys(userAnswers).filter(id => userAnswers[id] === false).map(Number);
        } else if (mode === 'marked') {
            nextIds = Array.from(markedIds);
        } else if (mode === 'wrong_marked') {
            const wrong = Object.keys(userAnswers).filter(id => userAnswers[id] === false).map(Number);
            const marked = Array.from(markedIds);
            nextIds = [...new Set([...wrong, ...marked])];
        }

        if (nextIds.length === 0) {
            alert("No hay preguntas para los criterios seleccionados.");
            return;
        }

        userAnswers = {};
        currentQuestions = dbQuestions.filter(q => nextIds.includes(q.id));
        renderQuiz();
        document.querySelector('.main-content').scrollTop = 0;
    }

    renderQuiz();
</script>
</body>
</html>