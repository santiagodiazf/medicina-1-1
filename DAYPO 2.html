<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bloque II: Bioqu√≠mica Cl√≠nica</title>
    <style>
        :root {
            --primary: #0284c7; /* Azul Cl√≠nico Brillante */
            --primary-dark: #075985;
            --primary-light: #e0f2fe;
            --bg: #f0f9ff;
            --text: #0f172a;
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            max-width: 850px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--primary-dark);
            margin-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            display: inline-block;
            width: 100%;
        }

        .question-card {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 6px solid var(--primary);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .question-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* --- Checkbox para Marcar --- */
        .mark-container {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: var(--primary);
            font-weight: bold;
            border-bottom: 1px solid #bae6fd;
            padding-bottom: 10px;
        }
        .mark-container input {
            margin-right: 8px;
            transform: scale(1.3);
            cursor: pointer;
            accent-color: var(--primary);
        }
        .mark-container label {
            cursor: pointer;
        }

        .question-header {
            font-size: 0.85em;
            color: #64748b;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }

        .question-text {
            font-weight: 700;
            font-size: 1.15em;
            margin-bottom: 20px;
            color: #1e293b;
            line-height: 1.5;
        }

        /* Etiquetas para diagramas */
        .img-tag {
            display: block;
            margin-top: 12px;
            padding: 10px;
            background-color: #f0f9ff;
            border-left: 4px solid #38bdf8;
            color: #0369a1;
            font-size: 0.9em;
            font-style: italic;
            border-radius: 0 4px 4px 0;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            background: #fff;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-size: 1em;
            color: #334155;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            background-color: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary-dark);
            padding-left: 25px; /* Efecto desplazamiento */
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.7;
        }

        /* Estados de respuesta */
        .correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #14532d !important;
            font-weight: 600;
        }

        .incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #7f1d1d !important;
        }

        /* Caja de Explicaci√≥n */
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #e0f2fe;
            border-left: 5px solid var(--primary);
            border-radius: 6px;
            display: none;
            font-size: 0.95em;
            color: #0c4a6e;
            animation: slideDown 0.3s ease-out;
        }
        .explanation.visible {
            display: block;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- √Årea de Controles --- */
        #controls-area {
            margin-top: 50px;
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
            border-top: 5px solid var(--primary);
        }

        .action-btn {
            background: var(--primary); color: white; border: none;
            padding: 12px 25px; font-size: 1.05em; border-radius: 8px;
            cursor: pointer; margin: 8px;
            transition: background 0.3s, transform 0.2s;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .action-btn:hover { 
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .restart-options {
            display: none;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        .restart-options button {
            width: 100%;
            background: #475569;
        }
        .restart-options button:hover { background: #334155; }
        .restart-options button:first-child { background: var(--primary); }

    </style>
</head>
<body>

    <h1>Bloque II: Bioqu√≠mica Cl√≠nica</h1>
    <div style="text-align: center; color: #64748b; margin-bottom: 30px;">
        √Ålvaro Cond√≥n | Equilibrio √Åcido-Base, Agua y Soluciones
    </div>
    
    <div id="quiz-container"></div>

    <div id="controls-area">
        <button id="finish-btn" class="action-btn" onclick="showEndOptions()">üèÅ Finalizar revisi√≥n</button>
        
        <div id="restart-menu" class="restart-options">
            <h3>Resultados de la sesi√≥n</h3>
            <p id="stats-summary"></p>
            <button class="action-btn" onclick="restartQuiz('all')">üîÑ Rehacer todo el test</button>
            <button class="action-btn" onclick="restartQuiz('marked')">üîñ Repasar marcadas</button>
            <button class="action-btn" onclick="restartQuiz('failed')">‚ùå Repasar falladas</button>
            <button class="action-btn" onclick="restartQuiz('failed_marked')">‚ö†Ô∏è Falladas + Marcadas</button>
        </div>
    </div>

<script>
    const quizData = [
        { 
            q: "La normalidad de una soluci√≥n 0,5 M de H2SO4 es:", 
            opts: ["1 Normal", "0,5 Normal", "5 Normal"], 
            a: "1 Normal", 
            exp: "La normalidad es la molaridad multiplicada por el n√∫mero de protones intercambiables. El H2SO4 aporta 2 H+, por lo que 0,5 M √ó 2 = 1 N." 
        },
        { 
            q: "Respecto al agua es cierto que:", 
            opts: ["Todas las afirmaciones son correctas", "Constituye entre el 70 % y el 90 % de la composici√≥n de los seres vivos", "Presenta estructura de dipolo el√©ctrico", "Forma puentes de hidr√≥geno", "Tiene car√°cter anf√≥tero"], 
            a: "Todas las afirmaciones son correctas", 
            exp: "El agua es mayoritaria, polar (dipolo), forma redes de puentes de hidr√≥geno y puede actuar como √°cido o base (anf√≥tera)." 
        },
        { 
            q: "Respecto al plasma, el suero fisiol√≥gico (NaCl 9,5 g/L; 0,16 M) es isot√≥nico, por lo que:", 
            opts: ["Presentan una concentraci√≥n osmolar aproximada de 0,32 Osm", "Presentan una concentraci√≥n osmolar de 0,16 Osm", "Lisar√≠a a los hemat√≠es contenidos en suspensi√≥n", "Los iones Cl‚àí y Na+ atraviesan libremente la membrana del hemat√≠e"], 
            a: "Presentan una concentraci√≥n osmolar aproximada de 0,32 Osm", 
            exp: "El NaCl se disocia en 2 iones (Na+ y Cl-). Osmolaridad ‚âà Molaridad √ó 2. 0,16 M √ó 2 = 0,32 Osm (Isot√≥nico)." 
        },
        { 
            q: "Se dice que un √°cido es de naturaleza fuerte cuando:", 
            opts: ["El valor de su Ka es alto", "El valor de su Ka es bajo"], 
            a: "El valor de su Ka es alto", 
            exp: "Un √°cido fuerte se disocia casi completamente, lo que resulta en una constante de disociaci√≥n (Ka) muy elevada." 
        },
        { 
            q: "En un sistema amortiguador, si la concentraci√≥n de H+ del medio disminuye, el sistema compensa:", 
            opts: ["Aumentando la forma i√≥nica del √°cido", "Aumentando la forma i√≥nica de la base", "Aumentando la forma molecular del √°cido"], 
            a: "Aumentando la forma i√≥nica del √°cido", 
            exp: "Si bajan los H+, el √°cido d√©bil del tamp√≥n se disocia para liberar m√°s protones, aumentando su forma i√≥nica (base conjugada)." 
        },
        { 
            q: "Una disoluci√≥n que contiene 2 Eq-g/L de NaCl tiene en un litro:", 
            opts: ["Todas las afirmaciones son correctas", "2 moles de NaCl", "2 Eq-g de NaCl", "2000 mmol de NaCl", "2 N de NaCl"], 
            a: "Todas las afirmaciones son correctas", 
            exp: "En NaCl (valencia 1), Molaridad = Normalidad. 2 Eq = 2 Moles = 2000 mmoles." 
        },
        { 
            q: "¬øQu√© cantidad de agua hay que a√±adir para que una soluci√≥n de 0,2 moles de acetato s√≥dico y 0,5 moles de glucosa tenga osmolalidad 0,45 Osm?", 
            opts: ["2 kg de agua", "1 kg de agua", "1 L de agua", "2 L de agua", "2 moles de agua"], 
            a: "2 kg de agua", 
            exp: "Acetato (2 iones) = 0,4 Osm; Glucosa = 0,5 Osm. Total = 0,9 Osm. Para tener 0,45 Osm/kg se necesitan 2 kg (0,9 / 2 = 0,45)." 
        },
        { 
            q: "En el equilibrio de Gibbs-Donnan con una membrana permeable solo a iones difusibles:", 
            opts: ["El producto de las concentraciones de los iones difusibles es igual a ambos lados", "La concentraci√≥n de K+ es igual en ambos lados", "No hay movimiento de iones en ning√∫n momento"], 
            a: "El producto de las concentraciones de los iones difusibles es igual a ambos lados", 
            exp: "Ley de Donnan: [Cati√≥n]A √ó [Ani√≥n]A = [Cati√≥n]B √ó [Ani√≥n]B para los iones difusibles." 
        },
        { 
            q: "Una soluci√≥n de un √°cido ionizado pr√°cticamente al 100 % tendr√°:", 
            opts: ["Un grado de disociaci√≥n Œ± igual a 1", "Siempre un pH menor de 7", "Acidez potencial pr√°cticamente nula", "Acidez real igual a la acidez total", "Todas las afirmaciones son ciertas"], 
            a: "Un grado de disociaci√≥n Œ± igual a 1", 
            exp: "Si se disocia al 100%, alfa es 1. (Nota: 'Todas ciertas' suele ser incorrecto porque el pH depende de la concentraci√≥n, no solo de la fuerza)." 
        },
        { 
            q: "Una soluci√≥n amortiguadora est√° formada por:", 
            opts: ["E- A y B son correctas", "A- Un √°cido d√©bil y su sal con una base fuerte", "B- Una base d√©bil y su sal con un √°cido fuerte", "C- Un √°cido fuerte y su sal con una base fuerte", "D- Solo un √°cido fuerte en agua"], 
            a: "E- A y B son correctas", 
            exp: "Los tampones se forman por un par conjugado √°cido-base d√©bil." 
        },
        { 
            q: "Una soluci√≥n amortiguadora tiene m√°xima eficacia para regular el pH cuando:", 
            opts: ["El pH que se desea mantener es aproximadamente igual al pKa del sistema", "La relaci√≥n [sal]/[√°cido] es muy peque√±a", "El pKa del sistema es cercano a 1", "El pKa del sistema es cercano a 9", "El √°cido del sistema es muy fuerte"], 
            a: "El pH que se desea mantener es aproximadamente igual al pKa del sistema", 
            exp: "Cuando pH = pKa, la proporci√≥n de √°cido y base es 50/50, ofreciendo la m√°xima capacidad de tamponamiento." 
        },
        { 
            q: "En el sistema amortiguador de la hemoglobina:", 
            opts: ["La desoxihemoglobina contrarresta principalmente las bajadas de pH en los tejidos", "La desoxihemoglobina contrarresta fundamentalmente subidas de pH", "La oxihemoglobina no puede liberar protones", "La hemoglobina no participa en el amortiguamiento del pH"], 
            a: "La desoxihemoglobina contrarresta principalmente las bajadas de pH en los tejidos", 
            exp: "La desoxi-Hb es una base m√°s fuerte (mejor aceptor de H+) que la Oxi-Hb, ayudando a captar los protones generados por el metabolismo tisular." 
        },
        { 
            q: "La mayor parte del di√≥xido de carbono que transporta la sangre circula como:", 
            opts: ["Bicarbonato", "CO2 disuelto", "Carboxihemoglobina", "Carbaminohemoglobina", "√Åcido carb√≥nico"], 
            a: "Bicarbonato", 
            exp: "El CO2 se hidrata en el eritrocito a H2CO3 y se disocia en HCO3- (bicarbonato), que es la forma mayoritaria de transporte." 
        },
        { 
            q: "En una persona con funci√≥n pulmonar normal que hiperventila durante varios segundos, el cambio m√°s significativo es:", 
            opts: ["Disminuci√≥n de la pCO2 arterial", "Gran aumento de la pO2 arterial", "Aumento marcado de la saturaci√≥n de hemoglobina arterial", "Disminuci√≥n del pH arterial", "Aumento de la pCO2 arterial"], 
            a: "Disminuci√≥n de la pCO2 arterial", 
            exp: "La hiperventilaci√≥n 'lava' el CO2 de los pulmones m√°s r√°pido de lo que se produce, causando hipocapnia (bajada de pCO2)." 
        },
        { 
            q: "¬øCu√°l de las siguientes situaciones tiende a producir una alcalosis si el organismo no puede compensarla?", 
            opts: ["V√≥mitos repetidos con p√©rdida de HCl", "Producci√≥n de lactato durante el ejercicio intenso", "Producci√≥n de cuerpos cet√≥nicos en la diabetes mal controlada", "Diarrea con p√©rdida de bicarbonato", "Fiebre con hipercatabolismo"], 
            a: "V√≥mitos repetidos con p√©rdida de HCl", 
            exp: "Perder jugo g√°strico (√°cido clorh√≠drico) implica perder protones (H+), lo que eleva el pH sangu√≠neo (alcalosis metab√≥lica)." 
        },
        { 
            q: "En un paciente con enteropat√≠a que produce gran cantidad de amoniaco (NH3) en la luz intestinal, ¬øqu√© efecto √°cido-base es probable?", 
            opts: ["Conversi√≥n de amoniaco en amonio con consumo de protones y tendencia a alcalosis", "Descenso del pH sangu√≠neo", "Descenso en la concentraci√≥n de bicarbonato en sangre", "Respiraci√≥n de Kussmaul", "Aumento de la espiraci√≥n de CO2"], 
            a: "Conversi√≥n de amoniaco en amonio con consumo de protones y tendencia a alcalosis", 
            exp: "El NH3 capta H+ para formar NH4+, retirando √°cido del medio y tendiendo a alcalinizarlo." 
        },
        { 
            q: "Los puentes de hidr√≥geno son enlaces:", 
            opts: ["D√©biles", "Covalentes", "Muy fuertes", "De alta energ√≠a de hidr√≥lisis", "Id√©nticos a los enlaces i√≥nicos"], 
            a: "D√©biles", 
            exp: "Son interacciones electrost√°ticas d√©biles (comparadas con covalentes), pero fundamentales para la estructura del agua y macromol√©culas." 
        },
        { 
            q: "Calcule la molaridad y la normalidad de una disoluci√≥n en la que se disuelven 80 g de NaOH (PM 40) en agua hasta un volumen final de 500 ml:", 
            opts: ["4 M y 4 N", "2 M y 2 N", "2 M y 4 N", "1 M y 2 N", "4 M y 2 N"], 
            a: "4 M y 4 N", 
            exp: "80g / 40 = 2 moles. 2 moles en 0,5 L = 4 M. Como NaOH tiene 1 OH-, N = M." 
        },
        { 
            q: "Al disolver un soluto no vol√°til en agua pura, la presi√≥n de vapor de la disoluci√≥n:", 
            opts: ["Disminuye respecto a la del agua pura", "Aumenta respecto a la del agua pura", "No se modifica", "Es independiente de la concentraci√≥n de soluto", "Solo depende de la naturaleza qu√≠mica del soluto"], 
            a: "Disminuye respecto a la del agua pura", 
            exp: "Propiedad coligativa (Ley de Raoult): el soluto interfiere en la evaporaci√≥n del disolvente, bajando su presi√≥n de vapor." 
        },
        { 
            q: "¬øCu√°l es el principal cati√≥n implicado en el mantenimiento de la presi√≥n osm√≥tica del compartimento extracelular?", 
            opts: ["Na+", "K+", "Cl‚àí", "Ca2+", "Mg2+"], 
            a: "Na+", 
            exp: "El sodio es el cati√≥n m√°s abundante fuera de la c√©lula y determinante principal de la osmolaridad plasm√°tica." 
        },
        { 
            q: "¬øQu√© factores explican la presi√≥n onc√≥tica ejercida por las prote√≠nas plasm√°ticas?", 
            opts: ["La combinaci√≥n de su car√°cter coloidal, su carga y la presencia de una membrana semipermeable", "Solo su tama√±o molecular", "Exclusivamente su carga el√©ctrica", "Solo la presencia de cristaloides en el plasma", "No ejercen efecto sobre la presi√≥n osm√≥tica"], 
            a: "La combinaci√≥n de su car√°cter coloidal, su carga y la presencia de una membrana semipermeable", 
            exp: "Las prote√≠nas no atraviesan el endotelio capilar libremente y, por el efecto Donnan, retienen agua en el vaso (presi√≥n coloidosm√≥tica)." 
        },
        { 
            q: "La constante del producto i√≥nico del agua indica que:", 
            opts: ["Se representa por Kw y su valor es aproximadamente 1√ó10‚Åª14", "La proporci√≥n [H+] y [OH‚àí] es de 3 a 2", "La proporci√≥n de iones hidronio e hidroxilo es del 50 % en cualquier soluci√≥n", "Kw tiene siempre el valor 1√ó10‚Åª7", "Todas las afirmaciones son correctas"], 
            a: "Se representa por Kw y su valor es aproximadamente 1√ó10‚Åª14", 
            exp: "A 25¬∫C, el producto de [H+] por [OH-] es constante (10^-14)." 
        },
        { 
            q: "El pH se define como:", 
            opts: ["El ‚àílog de la concentraci√≥n de H+", "El log de la concentraci√≥n de H+", "El log de la concentraci√≥n de OH‚àí", "El log de la inversa de Ka", "La suma de pKa y pOH"], 
            a: "El ‚àílog de la concentraci√≥n de H+", 
            exp: "Definici√≥n de Sorensen: pH = -log[H+]." 
        },
        { 
            q: "El pH de una soluci√≥n amortiguadora depende de:", 
            opts: ["La relaci√≥n entre la concentraci√≥n de sal y √°cido", "La relaci√≥n √°cido/sal solamente", "La fuerza del √°cido fuerte presente", "La fuerza de la base fuerte presente", "Solo de la concentraci√≥n total de tamp√≥n"], 
            a: "La relaci√≥n entre la concentraci√≥n de sal y √°cido", 
            exp: "Ecuaci√≥n de Henderson-Hasselbalch: pH = pKa + log([Base]/[√Åcido])." 
        },
        { 
            q: "¬øC√≥mo se llama la enzima que cataliza la conversi√≥n reversible de CO2 y agua en √°cido carb√≥nico?", 
            opts: ["Anhidrasa carb√≥nica", "CO2 carboxilasa", "Bicarbonatasa", "Aldeh√≠do carboxilasa", "Anhidrotransferasa"], 
            a: "Anhidrasa carb√≥nica", 
            exp: "Es una enzima cr√≠tica presente en eritrocitos y t√∫bulos renales que acelera esta reacci√≥n." 
        },
        { 
            q: "Respecto a la hemoglobina, el efecto Bohr:", 
            opts: ["Permite liberar ox√≠geno de la hemoglobina cuando el pH baja y aumenta el CO2", "Permite liberar ox√≠geno cuando el pH sube", "No tiene relaci√≥n con el CO2", "Hace que la hemoglobina capte menos protones", "Impide la salida de ox√≠geno en los tejidos"], 
            a: "Permite liberar ox√≠geno de la hemoglobina cuando el pH baja y aumenta el CO2", 
            exp: "La acidosis y el CO2 alto (tejido activo) reducen la afinidad de la Hb por el O2, facilitando su entrega." 
        },
        { 
            q: "¬øCu√°l de las siguientes afirmaciones es falsa respecto a la composici√≥n del medio interno?", 
            opts: ["El CO2 plasm√°tico circula mayoritariamente como √°cido carb√≥nico", "El Na+ es el principal cati√≥n extracelular", "En alcalosis el pH sangu√≠neo es mayor de 7,45", "El K+ es el principal cati√≥n intracelular", "El Cl‚àí es el principal ani√≥n extracelular"], 
            a: "El CO2 plasm√°tico circula mayoritariamente como √°cido carb√≥nico", 
            exp: "Falso. Circula mayoritariamente como BICARBONATO (HCO3-)." 
        },
        { 
            q: "Una soluci√≥n de NaCl de concentraci√≥n 9,5 g/L:", 
            opts: ["Equivale aproximadamente a 0,16 M", "Es claramente hipot√≥nica respecto al plasma", "Equivale a 0,16 Osm", "Provoca lisis de los hemat√≠es", "Tiene una molaridad de 0,32 M"], 
            a: "Equivale aproximadamente a 0,16 M", 
            exp: "Es el suero fisiol√≥gico est√°ndar. (9,5g/L / 58,44 g/mol ‚âà 0,16 M)." 
        },
        { 
            q: "En la deshidrataci√≥n hipert√≥nica:", 
            opts: ["La osmolaridad plasm√°tica est√° aumentada", "La natremia est√° disminuida", "El hematocrito est√° disminuido por hemodiluci√≥n", "El volumen intracelular no se modifica", "Se pierden l√≠quidos y solutos en la misma proporci√≥n"], 
            a: "La osmolaridad plasm√°tica est√° aumentada", 
            exp: "Se pierde m√°s agua libre que solutos, concentrando el plasma (hipertonicidad)." 
        },
        { 
            q: "Una hemorragia aguda intensa produce un trastorno √°cido-base en el que:", 
            opts: ["Aumenta el lactato en sangre produciendo acidosis metab√≥lica", "Disminuye la concentraci√≥n de H+ en sangre", "Aumenta el bicarbonato sangu√≠neo", "Solo se afecta el componente respiratorio del tamp√≥n bicarbonato", "Aumenta de forma primaria la pCO2"], 
            a: "Aumenta el lactato en sangre produciendo acidosis metab√≥lica", 
            exp: "El shock hipovol√©mico causa hipoxia tisular -> metabolismo anaerobio -> √°cido l√°ctico." 
        },
        { 
            q: "En los tejidos perif√©ricos, respecto al sistema amortiguador de la hemoglobina a pH fisiol√≥gico (Repetida):", 
            opts: ["La desoxihemoglobina tampona fundamentalmente las bajadas de pH", "La hemoglobina sin ox√≠geno es el principal cati√≥n extracelular", "La oxihemoglobina es la forma m√°s b√°sica de la prote√≠na", "La hemoglobina no interviene en el equilibrio √°cido-base"], 
            a: "La desoxihemoglobina tampona fundamentalmente las bajadas de pH", 
            exp: "Repetici√≥n del concepto: la Hb desoxigenada es un excelente tamp√≥n en los tejidos √°cidos." 
        },
        { 
            q: "En el t√∫bulo contorneado proximal del ri√±√≥n:", 
            opts: ["Se reabsorbe la mayor parte del bicarbonato filtrado", "Se secreta la mayor parte del bicarbonato a la orina", "No se produce amonio a partir de glutamina", "No interviene en el equilibrio √°cido-base"], 
            a: "Se reabsorbe la mayor parte del bicarbonato filtrado", 
            exp: "Aproximadamente el 80-90% del bicarbonato se recupera aqu√≠ para mantener la reserva alcalina." 
        },
        { 
            q: "La hipoxia mantenida tiende a producir un trastorno √°cido-base:", 
            opts: ["De tipo acidosis metab√≥lica por acumulaci√≥n de lactato", "De tipo alcalosis respiratoria primaria", "De tipo acidosis respiratoria primaria", "Sin repercusi√≥n sobre el pH"], 
            a: "De tipo acidosis metab√≥lica por acumulaci√≥n de lactato", 
            exp: "Igual que en la hemorragia: falta de O2 = fermentaci√≥n l√°ctica = acidosis." 
        },
        { 
            q: "El suero fisiol√≥gico es una soluci√≥n (Repetida):", 
            opts: ["Isot√≥nica con el plasma", "De 0,32 M de NaCl", "Que contiene 9,5 g/L de KCl", "De 0,16 Osm respecto al medio interno", "Que produce lisis de los hemat√≠es"], 
            a: "Isot√≥nica con el plasma", 
            exp: "Reiteraci√≥n: NaCl 0,9% es isosm√≥tico e isot√≥nico con el plasma humano." 
        },
        { 
            q: "Respecto a la composici√≥n i√≥nica del plasma (Repetida):", 
            opts: ["[Na+] ‚âà 140 mEq/L y [K+] ‚âà 4 mEq/L", "[Na+] ‚âà 140 mEq/L y [K+] ‚âà 140 mEq/L", "[Na+] ‚âà 4 mEq/L y [K+] ‚âà 140 mEq/L", "El CO2 circula principalmente como √°cido carb√≥nico no disociado"], 
            a: "[Na+] ‚âà 140 mEq/L y [K+] ‚âà 4 mEq/L", 
            exp: "Valores fisiol√≥gicos normales: Sodio alto fuera, Potasio bajo fuera." 
        },
        { 
            q: "El trastorno √°cido-base resultante de una hemorragia aguda intensa sin compensaci√≥n es (Repetida):", 
            opts: ["Una acidosis metab√≥lica", "Una acidosis respiratoria primaria", "Una alcalosis respiratoria primaria", "Una alcalosis metab√≥lica primaria", "Ausencia de alteraci√≥n del equilibrio √°cido-base"], 
            a: "Una acidosis metab√≥lica", 
            exp: "Acidosis l√°ctica por hipoperfusi√≥n." 
        },
        { 
            q: "En una acidosis respiratoria descompensada:", 
            opts: ["La perfusi√≥n con bicarbonato s√≥dico puede ayudar a corregir el pH", "Respirar una atm√≥sfera rica en CO2 es la mejor medida", "El equilibrio CO2 + H2O ‚áå H+ + HCO3‚àí no se modifica", "La pCO2 est√° disminuida"], 
            a: "La perfusi√≥n con bicarbonato s√≥dico puede ayudar a corregir el pH", 
            exp: "Si el pH es cr√≠tico, aportar base (bicarbonato) ayuda a neutralizar la acidez, aunque lo principal es tratar la causa respiratoria." 
        },
        { 
            q: "Una soluci√≥n de HCl tiene una concentraci√≥n de 3,26 √ó 10‚Åª2 M. ¬øCu√°l es su pH aproximado? (Repetida)", 
            opts: ["1,49", "12,5", "2,0", "3,3"], 
            a: "1,49", 
            exp: "-log(0,0326) = 1,486." 
        },
        { 
            q: "En conjunto, ¬øcu√°l es la principal fuente de √°cido metab√≥lico en el organismo?", 
            opts: ["El CO2 producido en el ciclo de los √°cidos tricarbox√≠licos", "La ingesta de √°cidos fuertes en la dieta", "La filtraci√≥n de bicarbonato en el ri√±√≥n", "La producci√≥n de amonio en el intestino"], 
            a: "El CO2 producido en el ciclo de los √°cidos tricarbox√≠licos", 
            exp: "La producci√≥n de '√°cido vol√°til' (CO2) es inmensamente superior a la de √°cidos fijos (sulf√∫rico, fosf√≥rico)." 
        },
        { 
            q: "Mensaje final:", 
            opts: ["Gracias por la ayuda a todos los que han colaborado en estos apuntes", "Fin del test"], 
            a: "Gracias por la ayuda a todos los que han colaborado en estos apuntes", 
            exp: "¬°√Ånimo con el estudio!" 
        }
    ];

    // --- ASIGNAR IDs √öNICOS ---
    quizData.forEach((item, index) => {
        item.id = index;
    });

    // --- GESTI√ìN DE ESTADO ---
    let markedQuestions = new Set();
    let failedQuestions = new Set();

    function shuffleArray(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    const container = document.getElementById('quiz-container');

    // Funci√≥n principal
    function renderQuiz(questionsToLoad = quizData) {
        container.innerHTML = "";
        document.getElementById("restart-menu").style.display = "none";
        document.getElementById("finish-btn").style.display = "inline-block";

        if(questionsToLoad.length === 0) {
            container.innerHTML = "<p style='text-align:center; padding:20px; color:#6b7280;'>No hay preguntas para mostrar en esta selecci√≥n.</p>";
            return;
        }

        questionsToLoad.forEach((item, displayIndex) => {
            const card = document.createElement('div');
            card.className = 'question-card';

            // Checkbox Marcar
            const markContainer = document.createElement("div");
            markContainer.className = "mark-container";
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = `mark-${item.id}`;
            if(markedQuestions.has(item.id)) checkbox.checked = true;

            checkbox.onchange = (e) => {
                if(e.target.checked) markedQuestions.add(item.id);
                else markedQuestions.delete(item.id);
            };

            const label = document.createElement("label");
            label.htmlFor = `mark-${item.id}`;
            label.innerText = "Marcar para revisar";
            markContainer.appendChild(checkbox);
            markContainer.appendChild(label);
            card.appendChild(markContainer);

            // Pregunta
            const header = document.createElement('div');
            header.className = 'question-header';
            header.textContent = `Pregunta ${item.id + 1}`; 
            card.appendChild(header);

            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = item.q;

            // --- INSERCI√ìN DE DIAGRAMAS ---
            if (item.id === 1) { // Agua
                 questionText.innerHTML += `<span class='img-tag'></span>`;
            } else if (item.id === 12 || item.id === 25) { // Hemoglobina / Efecto Bohr
                 questionText.innerHTML += `<span class='img-tag'></span>`;
            } else if (item.id === 7) { // Gibbs-Donnan
                 questionText.innerHTML += `<span class='img-tag'></span>`;
            } else if (item.id === 31) { // T√∫bulo renal
                 questionText.innerHTML += `<span class='img-tag'></span>`;
            } else if (item.id === 24) { // Anhidrasa carb√≥nica
                 questionText.innerHTML += `<span class='img-tag'></span>`;
            } else if (item.id === 36) { // Acid-Base Disorders
                 questionText.innerHTML += `<span class='img-tag'></span>`;
            } else if (item.id === 10) { // Buffers
                 questionText.innerHTML += `<span class='img-tag'></span>`;
            }

            card.appendChild(questionText);

            // Opciones
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options-container';

            let optionsObj = item.opts.map(opt => ({
                text: opt,
                isCorrect: opt === item.a
            }));
            optionsObj = shuffleArray(optionsObj);

            // Explicaci√≥n
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'explanation';
            explanationDiv.innerHTML = `<strong>Explicaci√≥n:</strong> ${item.exp}`;

            optionsObj.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt.text;

                btn.onclick = () => {
                    const allBtns = optionsDiv.querySelectorAll('.option-btn');
                    allBtns.forEach(b => b.disabled = true);

                    if (opt.isCorrect) {
                        btn.classList.add('correct');
                    } else {
                        btn.classList.add('incorrect');
                        failedQuestions.add(item.id);
                        
                        allBtns.forEach(b => {
                            if (b.textContent === item.a) b.classList.add('correct');
                        });
                    }
                    explanationDiv.classList.add('visible');
                };
                optionsDiv.appendChild(btn);
            });

            card.appendChild(optionsDiv);
            card.appendChild(explanationDiv);
            container.appendChild(card);
        });
    }

    // --- Control Final ---
    function showEndOptions() {
        document.getElementById("finish-btn").style.display = "none";
        document.getElementById("restart-menu").style.display = "flex";
        document.getElementById("controls-area").scrollIntoView({behavior: "smooth"});
        
        document.getElementById("stats-summary").innerHTML = `
            Preguntas marcadas: <strong>${markedQuestions.size}</strong><br>
            Preguntas falladas en esta sesi√≥n: <strong>${failedQuestions.size}</strong>
        `;
    }

    function restartQuiz(mode) {
        let subset = [];
        if (mode === 'all') subset = quizData;
        else if (mode === 'marked') subset = quizData.filter(q => markedQuestions.has(q.id));
        else if (mode === 'failed') subset = quizData.filter(q => failedQuestions.has(q.id));
        else if (mode === 'failed_marked') subset = quizData.filter(q => failedQuestions.has(q.id) || markedQuestions.has(q.id));

        if(mode !== 'all') failedQuestions.clear(); 
        else {
            failedQuestions.clear();
            markedQuestions.clear();
        }

        renderQuiz(subset);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    renderQuiz();
</script>

</body>
</html>
