<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Receptores y Transducción de Señales</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --correct: #27ae60;
            --incorrect: #e74c3c;
            --marked: #f1c40f;
            --bg: #f4f7f6;
            --text: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            height: 100vh;
            color: var(--text);
            overflow: hidden;
        }

        /* --- SIDEBAR (Índice) --- */
        #sidebar {
            width: 80px;
            background: var(--primary);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            overflow-y: auto;
            border-right: 1px solid #ddd;
            flex-shrink: 0;
        }

        .nav-dot {
            width: 45px;
            height: 45px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9em;
            transition: 0.2s;
            position: relative;
            font-weight: 600;
        }

        .nav-dot:hover { background: var(--accent); }
        .nav-dot.active { background: var(--accent); transform: scale(1.1); box-shadow: 0 0 10px rgba(0,0,0,0.3); }
        
        .nav-dot.status-correct { background: var(--correct); }
        .nav-dot.status-wrong { background: var(--incorrect); }
        
        .nav-dot.is-marked::after {
            content: '★';
            position: absolute;
            top: -5px;
            right: -5px;
            color: var(--marked);
            font-size: 14px;
            text-shadow: 0 1px 2px black;
        }

        /* --- MAIN CONTENT --- */
        #main-content {
            flex: 1;
            padding: 20px 40px;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            min-height: 60vh;
        }

        h1, h2 { color: var(--primary); }

        /* --- PANTALLAS (Setup, Quiz, Results) --- */
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.4s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Setup & Results Buttons */
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            background: var(--accent);
            color: white;
        }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        button.secondary { background: #95a5a6; }
        button.danger { background: var(--incorrect); }

        /* --- PREGUNTA --- */
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .q-number { font-size: 1.2em; font-weight: bold; color: var(--accent); }
        
        .mark-toggle {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        .mark-toggle input { margin-right: 8px; transform: scale(1.2); }

        .question-text { font-size: 1.2em; line-height: 1.5; margin-bottom: 25px; }

        .options-grid { display: grid; gap: 10px; }

        .option-btn {
            background: #fff;
            border: 2px solid #e0e0e0;
            color: var(--text);
            text-align: left;
            padding: 15px 20px;
            font-size: 1em;
            border-radius: 8px;
            position: relative;
        }

        .option-btn:hover:not(:disabled) { border-color: var(--accent); background: #f9fcff; }
        
        .option-btn.correct { border-color: var(--correct); background: #e8f8f5; color: #155724; }
        .option-btn.wrong { border-color: var(--incorrect); background: #fdf2f2; color: #721c24; }
        
        .option-btn:disabled { cursor: default; }

        /* --- FEEDBACK --- */
        .feedback-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: #eef7fd;
            border-left: 5px solid var(--accent);
            display: none;
        }
        .feedback-box strong { display: block; margin-bottom: 5px; }

        /* --- NAVIGATION FOOTER --- */
        .quiz-footer {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        /* --- RESULTS METRICS --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value { font-size: 2em; font-weight: bold; color: var(--primary); }
        .stat-label { font-size: 0.9em; color: #7f8c8d; }

    </style>
</head>
<body>

    <div id="sidebar">
        </div>

    <div id="main-content">
        
        <div id="setup-screen" class="container screen active" style="text-align: center;">
            <h1>Quiz de Receptores</h1>
            <p>50 Preguntas sobre transducción de señales, farmacología y receptores.</p>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
            <h3>¿Cómo quieres comenzar?</h3>
            <div class="btn-group">
                <button onclick="startQuiz('ordered')">Orden Original (1-50)</button>
                <button onclick="startQuiz('random')">Orden Aleatorio</button>
            </div>
        </div>

        <div id="quiz-screen" class="container screen">
            <div class="question-header">
                <span class="q-number" id="q-index-display">Pregunta 1</span>
                <label class="mark-toggle">
                    <input type="checkbox" id="mark-checkbox" onchange="toggleMark()"> 
                    <span>Marcar para revisar</span>
                </label>
            </div>

            <div class="question-text" id="q-text"></div>

            <div class="options-grid" id="options-container">
                </div>

            <div class="feedback-box" id="feedback">
                <strong>Corrección:</strong>
                <span id="feedback-text"></span>
            </div>

            <div class="quiz-footer">
                <button class="secondary" onclick="finishQuiz()">Finalizar Quiz</button>
                <div>
                    <button id="btn-prev" class="secondary" onclick="navigate(-1)">Anterior</button>
                    <button id="btn-next" onclick="navigate(1)">Siguiente</button>
                </div>
            </div>
        </div>

        <div id="results-screen" class="container screen" style="text-align: center;">
            <h1>Resultados</h1>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="res-score">0%</div>
                    <div class="stat-label">Aciertos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="res-wrong" style="color: var(--incorrect)">0</div>
                    <div class="stat-label">Falladas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="res-marked" style="color: var(--marked)">0</div>
                    <div class="stat-label">Marcadas</div>
                </div>
            </div>

            <h3>¿Qué deseas hacer ahora?</h3>
            <div class="btn-group">
                <button onclick="retry('all')">Repetir Completo</button>
                <button class="secondary" onclick="retry('failed')">Repetir Falladas</button>
                <button class="secondary" style="background:var(--marked); color: #333;" onclick="retry('marked')">Repetir Marcadas</button>
                <button class="secondary" onclick="retry('failed_marked')">Repetir Falladas + Marcadas</button>
            </div>
            <br>
            <button class="secondary" onclick="goToSetup()">Volver al Inicio</button>
        </div>

    </div>

<script>
    // --- DATOS DE LAS PREGUNTAS (LITERALES) ---
    const rawData = [
        { id: 1, q: "El proceso por el cual una señal química externa se transforma en una señal intracelular que desencadena una respuesta biológica se denomina:", options: ["Transfección.", "Transducción de señal.", "Transcripción génica.", "Potencial de acción."], correctText: "Transducción de señal.", expl: "Respuesta: B" },
        { id: 2, q: "¿Qué determina que una célula responda a una señal y otra célula vecina no lo haga ante la misma molécula?", options: ["La cantidad de ATP disponible en la célula.", "La presencia del receptor específico para ese ligando en la célula diana.", "El tamaño de la célula.", "La temperatura del medio extracelular."], correctText: "La presencia del receptor específico para ese ligando en la célula diana.", expl: "Respuesta: B (El profesor insiste: \"reconocen de forma selectiva y específica\")." },
        { id: 3, q: "En la farmacología de los receptores, un antagonista se define como:", options: ["Un ligando que se une al receptor y lo activa desencadenando la respuesta máxima.", "Una molécula que destruye el receptor.", "Un ligando que se une al receptor pero no lo activa, bloqueando la unión del agonista.", "Una enzima que degrada al ligando endógeno."], correctText: "Un ligando que se une al receptor pero no lo activa, bloqueando la unión del agonista.", expl: "Respuesta: C" },
        { id: 4, q: "¿Qué fenómeno ocurre cuando una célula está expuesta de forma continua y prolongada a altas concentraciones de un ligando (ej. tolerancia a drogas)?", options: ["Hipersensibilización del receptor.", "Regulación a la baja (down-regulation) o desensibilización de los receptores (endocitosis).", "Aumento de la afinidad del receptor.", "Síntesis masiva de nuevos receptores."], correctText: "Regulación a la baja (down-regulation) o desensibilización de los receptores (endocitosis).", expl: "Respuesta: B" },
        { id: 5, q: "La especificidad de la comunicación celular depende fundamentalmente de:", options: ["La solubilidad del ligando en agua.", "El encaje estructural preciso entre el ligando y el sitio de unión del receptor.", "La velocidad de difusión del ligando.", "El pH del medio."], correctText: "El encaje estructural preciso entre el ligando y el sitio de unión del receptor.", expl: "Respuesta: B" },
        { id: 6, q: "¿Qué característica físico-química debe tener obligatoriamente una molécula señal para actuar sobre receptores intracelulares (nucleares o citosólicos)?", options: ["Debe ser hidrofílica y de alto peso molecular.", "Debe ser lipofílica (hidrofóbica) o un gas para atravesar la membrana plasmática.", "Debe estar cargada positivamente.", "Debe ser una proteína grande."], correctText: "Debe ser lipofílica (hidrofóbica) o un gas para atravesar la membrana plasmática.", expl: "Respuesta: B (Ej. Hormonas esteroideas, NO)." },
        { id: 7, q: "En el mecanismo de acción de la testosterona (explicado en el audio), ¿qué función cumplen las proteínas chaperonas unidas al receptor en el citoplasma?", options: ["Degradan la testosterona.", "Estabilizan el receptor y lo mantienen inactivo hasta que llega la hormona.", "Transportan el receptor al núcleo antes de que llegue la hormona.", "Fosforilan al receptor."], correctText: "Estabilizan el receptor y lo mantienen inactivo hasta que llega la hormona.", expl: "Respuesta: B" },
        { id: 8, q: "¿Por qué la respuesta celular mediada por receptores intracelulares (ej. hormonas esteroideas) es considerablemente más lenta que la de los receptores de membrana?", options: ["Porque la hormona tarda mucho en entrar a la célula.", "Porque implica la translocación al núcleo y la regulación de la expresión génica (transcripción y traducción).", "Porque no hay amplificación de señal.", "Porque el receptor tiene poca afinidad."], correctText: "Porque implica la translocación al núcleo y la regulación de la expresión génica (transcripción y traducción).", expl: "Respuesta: B (Pregunta directa del profesor en el audio)." },
        { id: 9, q: "Una vez activado el receptor intracelular por el ligando, su función principal en el núcleo es actuar como:", options: ["Una quinasa.", "Un canal iónico.", "Un factor de transcripción que se une a secuencias específicas del ADN.", "Una polimerasa."], correctText: "Un factor de transcripción que se une a secuencias específicas del ADN.", expl: "Respuesta: C" },
        { id: 10, q: "¿Cuál de los siguientes ligandos actuaría a través de un receptor intracelular?", options: ["Insulina.", "Adrenalina.", "Cortisol o Testosterona.", "Acetilcolina."], correctText: "Cortisol o Testosterona.", expl: "Respuesta: C" },
        { id: 11, q: "Los receptores acoplados a canales iónicos (ionotrópicos) se caracterizan por:", options: ["Generar respuestas muy rápidas (milisegundos).", "Requerir la síntesis de proteínas.", "Activar siempre proteínas G.", "Ser exclusivos de células no excitables."], correctText: "Generar respuestas muy rápidas (milisegundos).", expl: "Respuesta: A (Comparados con el potencial de acción en el audio)." },
        { id: 12, q: "¿Cuál es el mecanismo básico de activación de un receptor canal?", options: ["Fosforilación del canal.", "Unión del ligando → cambio conformacional → apertura del poro.", "Endocitosis del canal.", "Unión a ADN."], correctText: "Unión del ligando → cambio conformacional → apertura del poro.", expl: "Respuesta: B" },
        { id: 13, q: "Un ejemplo clásico de ligando que actúa sobre receptores acoplados a canales iónicos mencionado en el audio es:", options: ["Insulina.", "GABA o Glutamato (neurotransmisores).", "Hormona del crecimiento.", "Estrógenos."], correctText: "GABA o Glutamato (neurotransmisores).", expl: "Respuesta: B" },
        { id: 14, q: "El receptor de insulina pertenece a la familia de:", options: ["Receptores acoplados a proteína G (GPCR).", "Canales iónicos.", "Receptores con actividad enzimática intrínseca (Tirosina Quinasa).", "Receptores nucleares."], correctText: "Receptores con actividad enzimática intrínseca (Tirosina Quinasa).", expl: "Respuesta: C" },
        { id: 15, q: "¿Qué evento molecular ocurre inmediatamente después de que la insulina se une a su receptor dimérico?", options: ["Apertura de un canal de sodio.", "Acercamiento de las subunidades y autofosforilación en residuos de tirosina de la parte intracelular.", "Activación de la Adenilato Ciclasa.", "Translocación al núcleo."], correctText: "Acercamiento de las subunidades y autofosforilación en residuos de tirosina de la parte intracelular.", expl: "Respuesta: B (Explicado detalladamente como mecanismo de \"bisagra\")." },
        { id: 16, q: "Una de las vías de señalización activadas por la insulina (vía PI3K/Akt) tiene como efecto final rápido en células musculares y adiposas:", options: ["La síntesis de ADN.", "La translocación de vesículas con transportadores GLUT-4 a la membrana para captar glucosa.", "La apertura de canales de potasio.", "La degradación del receptor."], correctText: "La translocación de vesículas con transportadores GLUT-4 a la membrana para captar glucosa.", expl: "Respuesta: B (Punto clave de integración metabólica)." },
        { id: 17, q: "Además de los efectos metabólicos rápidos, los receptores tirosina quinasa (como el de insulina o factores de crecimiento) activan la vía de las MAP-kinasas para regular:", options: ["La contracción muscular inmediata.", "La expresión génica, proliferación y supervivencia celular.", "La apertura de canales de cloro.", "La digestión celular."], correctText: "La expresión génica, proliferación y supervivencia celular.", expl: "Respuesta: B" },
        { id: 18, q: "En el contexto de la señalización por insulina, ¿qué define a la fosforilación en cascada?", options: ["Que el receptor se rompe.", "Que una quinasa activa fosforila a otra, amplificando la señal hasta llegar al efector.", "Que el fosfato sale de la célula.", "Que se gasta todo el ATP celular."], correctText: "Que una quinasa activa fosforila a otra, amplificando la señal hasta llegar al efector.", expl: "Respuesta: B" },
        { id: 19, q: "Los receptores acoplados a proteínas G (GPCR) se caracterizan estructuralmente por:", options: ["Tener un solo paso transmembrana.", "Ser canales iónicos.", "Atravesar la membrana plasmática 7 veces (7 dominios transmembrana).", "Estar libres en el citoplasma."], correctText: "Atravesar la membrana plasmática 7 veces (7 dominios transmembrana).", expl: "Respuesta: C" },
        { id: 20, q: "El mecanismo de activación de la proteína G heterotrimérica (α, β, γ) tras la unión del ligando al receptor consiste en:", options: ["La fosforilación de la subunidad alfa.", "El intercambio de GDP por GTP en la subunidad alfa y su disociación del complejo βγ.", "La unión de las tres subunidades.", "La hidrólisis de GTP a GDP."], correctText: "El intercambio de GDP por GTP en la subunidad alfa y su disociación del complejo βγ.", expl: "Respuesta: B" },
        { id: 21, q: "¿Qué enzima efectora es activada por la subunidad αs (estimuladora) de una proteína G?", options: ["Fosfolipasa C.", "Adenilato Ciclasa (o Adenilil ciclasa).", "Fosfodiesterasa.", "Tirosina quinasa."], correctText: "Adenilato Ciclasa (o Adenilil ciclasa).", expl: "Respuesta: B" },
        { id: 22, q: "La activación de la Adenilato Ciclasa provoca el aumento de qué segundo mensajero:", options: ["Calcio (Ca2+).", "IP3.", "AMP cíclico (AMPc).", "GMP cíclico."], correctText: "AMP cíclico (AMPc).", expl: "Respuesta: C" },
        { id: 23, q: "El AMP cíclico (AMPc) ejerce su función principalmente activando a:", options: ["La Proteína Quinasa A (PKA).", "La Proteína Quinasa C (PKC).", "La Calmodulina.", "Los canales de sodio directamente."], correctText: "La Proteína Quinasa A (PKA).", expl: "Respuesta: A" },
        { id: 24, q: "Si un receptor está acoplado a una proteína Gq, la enzima efectora activada es la Fosfolipasa C (PLC), que genera:", options: ["Solo AMPc.", "IP3 (Inositol trifosfato) y DAG (Diacilglicerol).", "GMPc.", "Óxido Nítrico."], correctText: "IP3 (Inositol trifosfato) y DAG (Diacilglicerol).", expl: "Respuesta: B" },
        { id: 25, q: "El IP3 generado por la vía de la Fosfolipasa C actúa sobre el retículo endoplasmático para:", options: ["Sintetizar proteínas.", "Liberar Calcio (Ca2+) almacenado hacia el citosol.", "Guardar calcio.", "Activar la adenilato ciclasa."], correctText: "Liberar Calcio (Ca2+) almacenado hacia el citosol.", expl: "Respuesta: B" },
        { id: 26, q: "El calcio liberado al citosol actúa frecuentemente uniéndose a una proteína sensora de calcio llamada:", options: ["Calmodulina.", "Clatrina.", "Actina.", "Albúmina."], correctText: "Calmodulina.", expl: "Respuesta: A" },
        { id: 27, q: "¿Qué mecanismo apaga la señal de la proteína G (vuelta al estado inactivo)?", options: ["La actividad GTPasa intrínseca de la subunidad α que hidroliza el GTP a GDP.", "La destrucción de la proteína G.", "La fosforilación del receptor.", "La falta de ATP."], correctText: "La actividad GTPasa intrínseca de la subunidad α que hidroliza el GTP a GDP.", expl: "Respuesta: A" },
        { id: 28, q: "Según el audio, ¿qué porcentaje aproximado de fármacos actúan sobre receptores acoplados a proteínas G?", options: ["10%", "50%", "90%", "Ninguno."], correctText: "50%", expl: "Respuesta: B (Dato enfatizado para mostrar relevancia clínica)." },
        { id: 29, q: "En la Diabetes Mellitus Tipo 1, el fallo en la señalización radica en:", options: ["Los receptores de insulina no funcionan.", "La destrucción autoinmune de las células beta pancreáticas, por lo que no se produce insulina (falta el ligando).", "Exceso de insulina.", "Fallo en la proteína G."], correctText: "La destrucción autoinmune de las células beta pancreáticas, por lo que no se produce insulina (falta el ligando).", expl: "Respuesta: B" },
        { id: 30, q: "El tratamiento lógico para la Diabetes Tipo 1 es:", options: ["Dieta exclusivamente.", "Administración exógena de insulina.", "Fármacos que aumenten la sensibilidad del receptor.", "Antibióticos."], correctText: "Administración exógena de insulina.", expl: "Respuesta: B" },
        { id: 31, q: "En la Diabetes Mellitus Tipo 2, el problema principal se describe como:", options: ["Ausencia total de insulina.", "Resistencia a la insulina (fallo en el receptor o en la transducción de señal post-receptor) a pesar de haber insulina.", "Destrucción del páncreas.", "Falta de glucosa."], correctText: "Resistencia a la insulina (fallo en el receptor o en la transducción de señal post-receptor) a pesar de haber insulina.", expl: "Respuesta: B" },
        { id: 32, q: "¿Qué fármaco mencionado en el audio como \"el más vendido en 2023\" es un análogo del GLP-1 y actúa sobre GPCRs para tratar diabetes y obesidad?", options: ["Morfina.", "Semaglutida (Ozempic/Wegovy).", "Aspirina.", "Insulina."], correctText: "Semaglutida (Ozempic/Wegovy).", expl: "Respuesta: B" },
        { id: 33, q: "El Óxido Nítrico (NO) es una molécula señalizadora gaseosa que:", options: ["Se une a receptores de membrana.", "Atraviesa la membrana y activa a la Guanilato Ciclasa citosólica generando GMPc.", "Activa la Adenilato Ciclasa.", "Actúa como factor de transcripción en el núcleo."], correctText: "Atraviesa la membrana y activa a la Guanilato Ciclasa citosólica generando GMPc.", expl: "Respuesta: B" },
        { id: 34, q: "El efecto fisiológico principal del Óxido Nítrico (NO) en el sistema cardiovascular es:", options: ["Vasoconstricción.", "Vasodilatación (relajación del músculo liso vascular).", "Coagulación.", "Aumento de la frecuencia cardíaca."], correctText: "Vasodilatación (relajación del músculo liso vascular).", expl: "Respuesta: B" },
        { id: 35, q: "Fármacos como el Sildenafilo (Viagra) actúan en la vía del NO:", options: ["Produciendo más NO.", "Inhibiendo a la fosfodiesterasa que degrada el GMPc, manteniendo la vasodilatación.", "Bloqueando el receptor de NO.", "Destruyendo el GMPc."], correctText: "Inhibiendo a la fosfodiesterasa que degrada el GMPc, manteniendo la vasodilatación.", expl: "Respuesta: B" },
        { id: 36, q: "¿Por qué una misma molécula señal (ej. Acetilcolina) puede producir contracción en el músculo esquelético y disminución de la frecuencia cardíaca en el corazón?", options: ["Porque la molécula cambia de forma.", "Porque activa diferentes tipos de receptores (Nicotínico vs Muscarínico) acoplados a diferentes maquinarias intracelulares.", "Porque el corazón no tiene receptores.", "Porque depende de la temperatura."], correctText: "Porque activa diferentes tipos de receptores (Nicotínico vs Muscarínico) acoplados a diferentes maquinarias intracelulares.", expl: "Respuesta: B" },
        { id: 37, q: "La amplificación de la señal en una cascada de transducción significa que:", options: ["La señal se hace más ruidosa.", "Una sola molécula de ligando puede generar la activación de millones de moléculas efectoras finales (ej. enzimas o glucosa liberada).", "Se necesita mucho ligando para poco efecto.", "La señal sale de la célula."], correctText: "Una sola molécula de ligando puede generar la activación de millones de moléculas efectoras finales (ej. enzimas o glucosa liberada).", expl: "Respuesta: B" },
        { id: 38, q: "Los inhibidores de la fosfodiesterasa (como la cafeína o fármacos) provocan:", options: ["Una disminución de los niveles de AMPc o GMPc.", "Un aumento y prolongación de la señal de los segundos mensajeros (AMPc/GMPc) al impedir su degradación.", "El cierre de los canales iónicos.", "La inactivación de la PKA."], correctText: "Un aumento y prolongación de la señal de los segundos mensajeros (AMPc/GMPc) al impedir su degradación.", expl: "Respuesta: B" },
        { id: 39, q: "Si mutamos la subunidad α de una proteína Gs de forma que no pueda hidrolizar GTP a GDP (pierde actividad GTPasa), ¿qué consecuencia celular esperamos?", options: ["La vía de señalización no se activará nunca.", "La Adenilato Ciclasa estará permanentemente activa, produciendo AMPc sin control (como ocurre con la toxina del cólera).", "El receptor se degradará.", "La célula morirá por falta de señal."], correctText: "La Adenilato Ciclasa estará permanentemente activa, produciendo AMPc sin control (como ocurre con la toxina del cólera).", expl: "Respuesta: B (Deducción basada en el mecanismo de apagado)." },
        { id: 40, q: "¿Qué ventaja tiene el uso de cascadas de segundos mensajeros frente a la apertura directa de un canal?", options: ["Es más rápido.", "Permite la amplificación de la señal y una regulación más compleja (integración).", "No gasta energía.", "Es más simple."], correctText: "Permite la amplificación de la señal y una regulación más compleja (integración).", expl: "Respuesta: B" },
        { id: 41, q: "¿Cuál de las siguientes es una proteína \"interruptor\" que está activa unida a GTP e inactiva unida a GDP?", options: ["Tirosina quinasa.", "Proteína G (tanto heterotrimérica como Ras).", "Adenilato ciclasa.", "Calmodulina."], correctText: "Proteína G (tanto heterotrimérica como Ras).", expl: "Respuesta: B" },
        { id: 42, q: "¿Qué ocurre con los receptores de membrana tras ser activados para evitar una sobreestimulación?", options: ["Nada, siguen activos siempre.", "Sufren desensibilización, endocitosis y/o degradación lisososomal.", "Se duplican.", "Se convierten en ligandos."], correctText: "Sufren desensibilización, endocitosis y/o degradación lisososomal.", expl: "Respuesta: B" },
        { id: 43, q: "En la vía de la Gq → PLC, el Diacilglicerol (DAG) se queda en la membrana y junto con el calcio activa a:", options: ["Proteína Quinasa A (PKA).", "Proteína Quinasa C (PKC).", "Proteína Quinasa G (PKG).", "Tirosina Quinasa."], correctText: "Proteína Quinasa C (PKC).", expl: "Respuesta: B" },
        { id: 44, q: "Las citoquinas suelen actuar a través de receptores que:", options: ["Son canales iónicos.", "Son GPCR.", "No tienen actividad enzimática intrínseca pero reclutan quinasas citosólicas (vía JAK-STAT) para ir al núcleo.", "Son hormonas esteroideas."], correctText: "No tienen actividad enzimática intrínseca pero reclutan quinasas citosólicas (vía JAK-STAT) para ir al núcleo.", expl: "Respuesta: C" },
        { id: 45, q: "¿Cuál es el \"Primer mensajero\" en un sistema de comunicación celular?", options: ["El AMPc.", "El ligando extracelular (hormona, neurotransmisor).", "La proteína G.", "El receptor."], correctText: "El ligando extracelular (hormona, neurotransmisor).", expl: "Respuesta: B" },
        { id: 46, q: "La fosforilación de proteínas es un mecanismo reversible regulado por el equilibrio entre:", options: ["Quinasas (ponen fosfato) y Fosfatasas (quitan fosfato).", "Quinasas y Proteasas.", "Sintetasas y Liasas.", "Receptores y ligandos."], correctText: "Quinasas (ponen fosfato) y Fosfatasas (quitan fosfato).", expl: "Respuesta: A" },
        { id: 47, q: "¿Qué tipo de receptor mediaría una respuesta de huida rápida (ej. contracción muscular)?", options: ["Receptor nuclear de cortisol.", "Receptor acoplado a canal iónico (Nicotínico).", "Receptor de insulina.", "Receptor de factor de crecimiento."], correctText: "Receptor acoplado a canal iónico (Nicotínico).", expl: "Respuesta: B" },
        { id: 48, q: "El concepto de \"afinidad\" se refiere a:", options: ["La capacidad del receptor de distinguir entre señales.", "La fuerza con la que el ligando se une al receptor (Kd).", "La velocidad de la respuesta.", "El número de receptores."], correctText: "La fuerza con la que el ligando se une al receptor (Kd).", expl: "Respuesta: B" },
        { id: 49, q: "La toxina colérica modifica la proteína Gs impidiendo la hidrólisis de GTP. Esto causa diarrea masiva porque:", options: ["Se cierran los canales de cloro.", "Aumenta masivamente el AMPc en células intestinales, abriendo canales de Cl- y arrastrando agua.", "Se inhibe la adenilato ciclasa.", "Se destruye el intestino."], correctText: "Aumenta masivamente el AMPc en células intestinales, abriendo canales de Cl- y arrastrando agua.", expl: "Respuesta: B (Aplicación clínica clásica de GPCR)." },
        { id: 50, q: "¿Qué afirmación es CORRECTA sobre la transducción de señales?", options: ["Todas las células responden igual a la misma señal.", "Una misma señal puede generar respuestas diferentes en distintos tipos celulares (ej. adrenalina en corazón vs intestino).", "Los receptores de membrana siempre van al núcleo.", "No requiere gasto de energía."], correctText: "Una misma señal puede generar respuestas diferentes en distintos tipos celulares (ej. adrenalina en corazón vs intestino).", expl: "Respuesta: B" }
    ];

    // --- VARIABLES DE ESTADO ---
    let quizState = {
        activeQuestions: [], // Array de índices de rawData
        currentIndex: 0,
        answers: {}, // { questionId: { selectedOpt: string, isCorrect: bool, timestamp: int } }
        marks: {},   // { questionId: bool }
        shuffledOptionsMap: {} // { questionId: [string, string, ...] }
    };

    // --- FUNCIONES DE LÓGICA ---

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // Inicializar Quiz
    function startQuiz(mode) {
        // Preparar preguntas
        let indices = rawData.map((_, i) => i);
        
        if (mode === 'random') {
            shuffleArray(indices);
        }

        // Resetear estado de respuestas si es un inicio "fresco"
        // (Si venimos de un retry parcial, mantenemos algunas cosas, pero startQuiz es para inicio total)
        if(quizState.activeQuestions.length === 0 || mode) {
             quizState.activeQuestions = indices;
             quizState.currentIndex = 0;
             quizState.answers = {};
             quizState.marks = {};
             quizState.shuffledOptionsMap = {};
        }

        buildSidebar();
        loadQuestion();
        switchScreen('quiz-screen');
    }

    // Lógica de Retry
    function retry(type) {
        let indicesToPlay = [];
        const allIndices = rawData.map((_, i) => i);

        if (type === 'all') {
            indicesToPlay = allIndices;
            quizState.answers = {};
            quizState.marks = {};
        } else if (type === 'failed') {
            indicesToPlay = allIndices.filter(idx => {
                const qId = rawData[idx].id;
                const ans = quizState.answers[qId];
                return !ans || !ans.isCorrect;
            });
            // Limpiar respuestas de las que vamos a reintentar
            indicesToPlay.forEach(idx => delete quizState.answers[rawData[idx].id]);
        } else if (type === 'marked') {
            indicesToPlay = allIndices.filter(idx => quizState.marks[rawData[idx].id]);
            // No borramos respuestas, solo navegamos por ellas, O si el usuario quiere re-responder?
            // Asumiremos que quiere re-hacerlas, borramos respuesta.
            indicesToPlay.forEach(idx => delete quizState.answers[rawData[idx].id]);
        } else if (type === 'failed_marked') {
            indicesToPlay = allIndices.filter(idx => {
                const qId = rawData[idx].id;
                const ans = quizState.answers[qId];
                const isFailed = !ans || !ans.isCorrect;
                const isMarked = quizState.marks[qId];
                return isFailed || isMarked;
            });
            indicesToPlay.forEach(idx => delete quizState.answers[rawData[idx].id]);
        }

        if (indicesToPlay.length === 0) {
            alert("No hay preguntas que cumplan ese criterio.");
            return;
        }

        // Siempre mezclar al reiniciar una sesión
        shuffleArray(indicesToPlay);
        
        quizState.activeQuestions = indicesToPlay;
        quizState.currentIndex = 0;
        quizState.shuffledOptionsMap = {}; // Resetear orden de opciones
        
        buildSidebar();
        loadQuestion();
        switchScreen('quiz-screen');
    }

    function goToSetup() {
        switchScreen('setup-screen');
    }

    // Renderizar Sidebar
    function buildSidebar() {
        const sb = document.getElementById('sidebar');
        sb.innerHTML = '';
        quizState.activeQuestions.forEach((rawIdx, i) => {
            const qData = rawData[rawIdx];
            const dot = document.createElement('div');
            dot.className = 'nav-dot';
            dot.textContent = i + 1;
            dot.id = `dot-${i}`;
            dot.onclick = () => {
                quizState.currentIndex = i;
                loadQuestion();
            };
            sb.appendChild(dot);
        });
        updateSidebarStatus();
    }

    function updateSidebarStatus() {
        quizState.activeQuestions.forEach((rawIdx, i) => {
            const dot = document.getElementById(`dot-${i}`);
            const qId = rawData[rawIdx].id;
            
            // Active
            if (i === quizState.currentIndex) dot.classList.add('active');
            else dot.classList.remove('active');

            // Answered Status
            dot.classList.remove('status-correct', 'status-wrong');
            if (quizState.answers[qId]) {
                if (quizState.answers[qId].isCorrect) dot.classList.add('status-correct');
                else dot.classList.add('status-wrong');
            }

            // Marked Status
            if (quizState.marks[qId]) dot.classList.add('is-marked');
            else dot.classList.remove('is-marked');
        });
    }

    // Cargar Pregunta
    function loadQuestion() {
        const rawIdx = quizState.activeQuestions[quizState.currentIndex];
        const data = rawData[rawIdx];
        
        // Texto
        document.getElementById('q-index-display').textContent = `Pregunta ${quizState.currentIndex + 1} de ${quizState.activeQuestions.length}`;
        document.getElementById('q-text').textContent = data.q;
        
        // Marcado
        document.getElementById('mark-checkbox').checked = !!quizState.marks[data.id];

        // Opciones (Mezclar si no están ya mezcladas para esta sesión)
        if (!quizState.shuffledOptionsMap[data.id]) {
            quizState.shuffledOptionsMap[data.id] = shuffleArray([...data.options]);
        }
        const currentOptions = quizState.shuffledOptionsMap[data.id];

        const optsContainer = document.getElementById('options-container');
        optsContainer.innerHTML = '';

        const existingAnswer = quizState.answers[data.id];

        currentOptions.forEach(optText => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = optText;
            
            if (existingAnswer) {
                btn.disabled = true;
                if (optText === data.correctText) btn.classList.add('correct');
                else if (optText === existingAnswer.selectedOpt && !existingAnswer.isCorrect) btn.classList.add('wrong');
            } else {
                btn.onclick = () => handleAnswer(data, optText);
            }
            
            optsContainer.appendChild(btn);
        });

        // Feedback
        const feedbackBox = document.getElementById('feedback');
        if (existingAnswer) {
            feedbackBox.style.display = 'block';
            document.getElementById('feedback-text').textContent = data.expl;
        } else {
            feedbackBox.style.display = 'none';
        }

        // Botones nav
        document.getElementById('btn-prev').disabled = quizState.currentIndex === 0;
        document.getElementById('btn-next').disabled = quizState.currentIndex === quizState.activeQuestions.length - 1;

        updateSidebarStatus();
    }

    function handleAnswer(data, selectedText) {
        const isCorrect = (selectedText === data.correctText);
        
        quizState.answers[data.id] = {
            selectedOpt: selectedText,
            isCorrect: isCorrect
        };

        loadQuestion(); // Recargar para mostrar estado
    }

    function toggleMark() {
        const rawIdx = quizState.activeQuestions[quizState.currentIndex];
        const qId = rawData[rawIdx].id;
        quizState.marks[qId] = !quizState.marks[qId];
        updateSidebarStatus();
    }

    function navigate(dir) {
        const newIndex = quizState.currentIndex + dir;
        if (newIndex >= 0 && newIndex < quizState.activeQuestions.length) {
            quizState.currentIndex = newIndex;
            loadQuestion();
        }
    }

    function finishQuiz() {
        // Calcular stats
        let correct = 0;
        let answered = 0;
        let marked = 0;

        // Iterar sobre las preguntas que estaban activas en esta sesión
        quizState.activeQuestions.forEach(rawIdx => {
            const qId = rawData[rawIdx].id;
            if (quizState.answers[qId]) {
                answered++;
                if (quizState.answers[qId].isCorrect) correct++;
            }
            if (quizState.marks[qId]) marked++;
        });

        const total = quizState.activeQuestions.length;
        const score = total === 0 ? 0 : Math.round((correct / total) * 100);

        document.getElementById('res-score').textContent = `${score}%`;
        document.getElementById('res-wrong').textContent = (answered - correct);
        document.getElementById('res-marked').textContent = marked;

        switchScreen('results-screen');
    }

</script>
</body>
</html>
