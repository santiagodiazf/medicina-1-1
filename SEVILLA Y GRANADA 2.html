<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Biolog√≠a Parte 2 (Preguntas 81-160)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .quiz-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 800px;
            padding: 30px;
            text-align: left;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #eef2f5;
            padding-bottom: 15px;
        }

        .progress {
            font-weight: 600;
            color: #7f8c8d;
        }

        .score {
            color: #2980b9;
            font-weight: bold;
            font-size: 1.1em;
        }

        /* --- Estilo para la pesta√±a de marcar --- */
        .mark-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            font-size: 0.95em;
            color: #e67e22;
            font-weight: 600;
            width: fit-content;
        }
        
        .mark-container input {
            margin-right: 8px;
            transform: scale(1.3);
            cursor: pointer;
        }

        .question {
            font-size: 1.25em;
            margin-bottom: 20px;
            color: #2c3e50;
            line-height: 1.5;
            font-weight: 500;
        }

        .options {
            list-style-type: none;
            padding: 0;
        }

        .option-btn {
            background-color: #fff;
            border: 2px solid #eef2f5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            color: #34495e;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not([disabled]) {
            background-color: #f8f9fa;
            border-color: #bdc3c7;
        }

        /* Estados de respuesta */
        .correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            color: #155724 !important;
        }

        .incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            color: #721c24 !important;
        }

        .next-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: none;
            margin-top: 25px;
            float: right;
            transition: background 0.2s;
        }

        .next-btn:hover {
            background-color: #2980b9;
        }

        .result-container {
            text-align: center;
            display: none;
        }

        /* --- Estilos para botones de repetici√≥n --- */
        .retry-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        .restart-btn {
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: opacity 0.2s;
        }

        .restart-btn:hover { opacity: 0.9; }
        .restart-btn:disabled { background-color: #ccc; cursor: not-allowed; opacity: 0.7; }

        .btn-all { background-color: #3498db; }
        .btn-failed { background-color: #e74c3c; }
        .btn-marked { background-color: #f39c12; }
        .btn-mixed { background-color: #8e44ad; }

        @media (max-width: 600px) {
            .retry-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="quiz-container" id="quiz-box">
    <div class="header">
        <span class="progress" id="progress">Pregunta 1 de 80</span>
        <span class="score" id="score">Aciertos: 0</span>
    </div>
    
    <label class="mark-container">
        <input type="checkbox" id="mark-checkbox" onchange="toggleMark()">
        <span>üö© Marcar para revisar</span>
    </label>

    <div class="question" id="question-text">Cargando...</div>
    <div class="options" id="options-container"></div>
    <button class="next-btn" id="next-btn" onclick="nextQuestion()">Siguiente Pregunta</button>
</div>

<div class="quiz-container result-container" id="result-box">
    <h2>¬°Sesi√≥n Finalizada!</h2>
    <p style="font-size: 1.3em; margin: 20px 0;">
        Puntuaci√≥n Global: <span id="final-score" style="font-weight:bold; color:#27ae60;"></span> de <span id="total-questions"></span>
    </p>
    <p id="mode-indicator" style="color: #7f8c8d; font-size: 0.9em;"></p>

    <h3>¬øQu√© deseas hacer ahora?</h3>
    <div class="retry-grid">
        <button class="restart-btn btn-all" onclick="initQuiz('all')">üîÑ Repetir Completo</button>
        <button class="restart-btn btn-failed" id="btn-failed" onclick="initQuiz('failed')">‚ùå Repetir Falladas</button>
        <button class="restart-btn btn-marked" id="btn-marked" onclick="initQuiz('marked')">üö© Repetir Marcadas</button>
        <button class="restart-btn btn-mixed" id="btn-mixed" onclick="initQuiz('mixed')">‚ùå + üö© Falladas y Marcadas</button>
    </div>
</div>

<script>
    // Preguntas originales (Datos puros)
    const rawQuestions = [
        // --- FINAL BLOQUE 2: Embriolog√≠a ---
        { q: "En el desarrollo embrionario, los somitas se originan a partir", options: ["Mesodermo extraembrionario", "Mesodermo paraxial", "Mesodermo intermedio", "Mesodermo lateral"], correct: 1 },
        { q: "¬øCu√°l de las siguientes afirmaciones sobre el cord√≥n umbilical no es correcta?", options: ["Contiene restos del alantoides", "Contiene vellosidades coriales", "Contiene los vasos umbilicales", "Contiene mes√©nquima"], correct: 1 },
        { q: "El sistema nervioso es", options: ["Mesod√©rmico", "Notocordal", "Endod√©rmico", "Ectod√©rmico"], correct: 3 },
        { q: "¬øCu√°l de los siguientes componentes embrionario aparece antes?", options: ["Mes√©nquima", "Celoma extraembrionario", "Cavidad amni√≥tica", "Membrana de Heuser."], correct: 1 },
        { q: "Los gemelos que comparten cavidad amni√≥tica son:", options: ["Monocig√≥ticos y bicoriales", "Monocig√≥ticos, monocoriales y monoamni√≥ticos", "Monocig√≥ticos, bicoriales y monoamni√≥ticos", "Dicig√≥ticos"], correct: 1 },
        { q: "Como consecuencia de la delimitaci√≥n longitudinal y transversal del embri√≥n, es falso que:", options: ["El esbozo cardiaco adopta una localizaci√≥n ventral", "El saco vitelino se divide en dos cavidades", "La cavidad amni√≥tica rodea al embri√≥n", "El celoma extraembrionario desaparece"], correct: 2 },
        { q: "¬øCu√°l de los siguientes fen√≥menos no se produce como consecuencia de la fecundaci√≥n?", options: ["Uni√≥n de los pron√∫cleos masculino y femenino", "Restablecimiento del n√∫mero haploide de cromosomas", "Bloqueo de la polispermia", "Activaci√≥n del metabolismo ovular"], correct: 1 },
        { q: "La adici√≥n de una cadena de ubiquitina a una prote√≠na blanco provoca:", options: ["Su modificaci√≥n por chaperonas moleculares", "Su activaci√≥n por una quinasa", "Su destrucci√≥n v√≠a proteasoma", "Su incorporaci√≥n a la membrana de un org√°nulo"], correct: 2 },
        { q: "¬øCu√°l de los siguientes microscopios no es electr√≥nico?", options: ["Alto voltaje", "Transmisi√≥n", "Nomarski", "Barrido"], correct: 2 },

        // --- BLOQUE 3: Biolog√≠a Molecular ---
        { q: "La ADN polimerasa", options: ["Tiene actividad exonucleasa 5'-3'", "Tiene actividad polimerasa 3'-5'", "Realiza el ensamblaje instant√°neo de la cadena de ADN...", "Tiene actividad exonucleasa 5'-3' y 3'-5'"], correct: 3 },
        { q: "La Helicasa", options: ["Participa en la replicaci√≥n del ADN", "Rompe los puentes de hidr√≥geno del ADN", "Es una de las principales enzimas en los procesos gen√©ticos", "Todas son correctas"], correct: 3 },
        { q: "¬øQu√© enzima se encarga de sintetizar ARN cebadores o primers?", options: ["Topoisomerasa I", "Topoisomerasa II", "Primasa", "Helicasa"], correct: 2 },
        { q: "Referido al origen de replicaci√≥n en eucariotas", options: ["Hay uno en cada bucle de la fibra de cromatina de 300nm", "Son de peque√±o tama√±o", "Hay un solo bucle en cada mol√©cula de ADN", "Es reconocido por la ADN polimerasa"], correct: 0 },
        { q: "Las prote√≠nas SSB", options: ["Son enzimas quinasas", "Forman parte del complejo proteico de reconocimiento de origen", "Se unen a la burbuja de replicaci√≥n para evitar que lo puentes de hidr√≥geno vuelvan a unirse", "Ninguna es correcta"], correct: 2 },
        { q: "C√≥mo act√∫an las topoisomerasas", options: ["Evitan el sobreenrollamiento mediante la rotaci√≥n del ADN", "Evitan el que se unan los puentes de hidr√≥geno...", "Evitan en sobreenrollamiento mediante el core...", "Forman parte del complejo de reconocimiento..."], correct: 0 },
        { q: "¬øQu√© es la PCNA?", options: ["Una enzima que participa en el proceso de transcripci√≥n", "Una enzima que no participa directamente en el proceso de traducci√≥n", "Una enzima que mantiene unida a la ADNpol al ADN", "Ninguna es correcta"], correct: 2 },
        { q: "La telomerasa", options: ["Es una enzima presente en los embriones", "Es una enzima presente en la c√©lulas cancer√≠genas", "Es una enzima que alarga los tel√≥meros", "Todas son correctas"], correct: 3 },
        { q: "¬øQu√© enzima tiene actividad retrotranscriptasa?", options: ["La ADN polimerasa", "La primasa", "La Telomerasa", "La √∫nica con esta capacidad es la retrotranscriptasa de los virus"], correct: 2 },
        { q: "C√≥mo es la distribuci√≥n de histonas en la cadena de ADN hija?", options: ["Es al azar, mezclando histonas viejas y nuevas", "Es controlada, mezclando histonas viejas y nuevas", "Se sintetizan nuevas histonas para la cadena nueva", "Se a√±aden histonas viejas a la nueva cadena"], correct: 1 },
        { q: "La transcripci√≥n", options: ["Solo se replica una hebra por lo que es un proceso sim√©trico", "Se necesita tambi√©n un ARN cebador", "Se lleva a cabo en direcci√≥n 3'-5'", "Se emplean ATP, GTP, CTP, UTP"], correct: 3 },
        { q: "En la transcripci√≥n", options: ["La hebra molde es la informativa", "La hebra no molde es la informativa", "La hebra molde es la codificante", "La hebra no molde tiene sentido - y la molde +"], correct: 1 },
        { q: "La iniciaci√≥n termina cuando", options: ["Se a√±aden los primero 100 nucle√≥tidos", "Se sintetiza el primer ARN cebador", "Se reconoce el promotor", "Se liberan los factores generales de la transcripci√≥n"], correct: 2 },
        { q: "En las procariotas", options: ["Existen las secuencias de consenso en la posici√≥n +1", "No existe promotor, sino que la transcripci√≥n empieza en cualquier lugar", "Existen las secuencias de consenso en la posici√≥n-10 y -35", "No existen las secuencias de consenso, son propias de eucariotas"], correct: 3 },
        { q: "El factor sigma", options: ["Se encuentra unido a la ARN polimerasa", "Reconoce el promotor en procariotas", "Se separa tras iniciarse la s√≠ntesis", "Todas son correctas"], correct: 1 },
        { q: "La s√≠ntesis de ARNm en eucariotas es llevada a cabo por", options: ["ARN polimerasa", "ARN pol I", "ARN pol II", "ARN pol III"], correct: 0 },
        { q: "¬øC√≥mo se lleva a cabo el desprendimiento del ADN de las histonas durante la transcripci√≥n?", options: ["Mediante el factor liberador de los nucleosomas", "Mediante complejos enzim√°ticos", "Mediante factores de transcripci√≥n", "El ADN no se separa de las histonas"], correct: 2 },
        { q: "La vida de un ARN es m√°s larga cuanto...", options: ["M√°s larga es su caperuza", "M√°s larga es su cola o poli A", "M√°s larga es la hebra", "Todos tienen la misma vida"], correct: 3 },
        { q: "¬øCu√°ndo se a√±ade la caperuza en eucariotas?", options: ["Al inicio de la transcripci√≥n", "Al final de la transcripci√≥n", "Durante la transcripci√≥n", "No se a√±ade"], correct: 1 },
        { q: "¬øCu√°ndo se a√±ade la cola o poli A en eucariotas?", options: ["Al inicio de la transcripci√≥n", "Al final de la transcripci√≥n", "Durante la transcripci√≥n", "No se a√±ade"], correct: 1 },
        { q: "¬øCu√°ndo se a√±ade la caperuza en procariotas?", options: ["Al inicio de la transcripci√≥n", "Al final de la transcripci√≥n", "Durante la transcripci√≥n", "No se a√±ade"], correct: 3 },
        { q: "¬øQu√© proceso es m√°s r√°pido? ¬øReplicaci√≥n o transcripci√≥n?", options: ["Transcripci√≥n", "Replicaci√≥n", "Los dos son r√°pidos", "Los dos son lentos"], correct: 0 },
        { q: "¬øQu√© diferencia hay entre intr√≥n y ADN espaciador?", options: ["Ninguna, es lo mismo", "Los intrones no se transcriben y los ADN espaciadores si", "Los ADN espaciadores no se transcriben y los intrones s√≠", "Los intrones no se traducen y los ADN espaciadores s√≠"], correct: 2 },
        { q: "¬øQu√© tipo de ARN se transcribe en el nucleolo?", options: ["ARNr", "ARNnso", "ARNsn", "ARNt"], correct: 0 },
        { q: "¬øEn qu√© cromosomas se encuentran las unidades de transcripci√≥n de los ARNr?", options: ["En el brazo corto de los cromosomas acroc√©ntricos", "En el brazo largo de los cromosomas submetac√©ntricos", "En el extremo de los cromosomas metac√©ntricos", "En los cromosomas teloc√©ntricos"], correct: 0 },
        { q: "¬øEn qu√© partes est√°n divididos los organizadores nucleolares?", options: ["ADN espaciador y ADN transcribible", "Unidad de transcripci√≥n y unidad espaciadora", "Unidad de transcripci√≥n y ADN espaciador", "No est√°n divididos"], correct: 2 },
        { q: "Elige la secuencia correcta de cortes de pre-ARNr", options: ["ARNr 45s - ARNr 41s - ARNr 18s y ARNr 32s...", "ARNr 41s - ARNr 18s y ARNr 32s...", "ARNr 45s - ARNr 41s-ARNr 20s...", "ARNr 45s - ARNr 18s y ARNr 32s..."], correct: 3 },
        { q: "El proceso de cortes es llevado a cabo por", options: ["ARNsno", "Complejos prot√©icos", "Enzimas liasas", "a y b son correctas"], correct: 3 },
        { q: "El ARNsno se transcribe", options: ["En el nucleolo por la ARNpol I", "En el nucleolo por la ARN pol III", "En el n√∫cleo por la ARN pol I", "En el n√∫cleo por la ARN pol III"], correct: 3 },
        { q: "El promotor de ARNsno se encuentra en", options: ["Dentro de la secuencia codificada", "Antes de la secuencia codifcada", "Despu√©s de la secuencia codificada", "No presenta promotor"], correct: 0 },
        { q: "¬øDe qu√© se encarga la aminoacil-ARNt sintasa?", options: ["De sintetizar los ARNt", "Participa en el proceso de maduraci√≥n de los ARNt", "Cataliza la uni√≥n del ARNt a su respectivo Aa", "Es un factor de iniciaci√≥n"], correct: 2 },
        { q: "¬øC√≥mo se inicia la traducci√≥n en procariotas?", options: ["La subunidad menor se une a la caperuza 5' hasta encontrar la secuencia de iniciaci√≥n", "La subunidad menor se une a la secuencia de iniciaci√≥n", "La subunidad menor junto con los factores de iniciaci√≥n se une a un lugar aleatorio del ARNm", "Ninguna es correcta"], correct: 1 },
        { q: "¬øC√≥mo se inicia la traducci√≥n en eucariotas?", options: ["La subunidad menor se une a la caperuza 5' hasta encontrar la secuencia de iniciaci√≥n", "La subunidad menor se une a la secuencia de iniciaci√≥n", "La subunidad menor junto con los factores de iniciaci√≥n se une a un lugar aleatorio del ARNm", "Ninguna es correcta"], correct: 0 },
        { q: "¬øPor qu√© est√° formado el complejo de pre-iniciaci√≥n?", options: ["El ARNt, la subunidad menor y el ARNm", "El ARNt y la subunidad menor", "La subunidad menor y el ARNm", "El complejo de pre-iniciaci√≥n no existe"], correct: 2 },
        { q: "Prote√≠na que recubre al ERGIC", options: ["Cop I", "BAD", "Cop II", "No est√° recubierto por ninguna prote√≠na"], correct: 2 },
        { q: "La N-glucosilaciones se producen en", options: ["RE", "Golgi", "Ambos", "Ninguno"], correct: 2 },
        { q: "Las prote√≠nas sintetizadas por ribosomas libres son", options: ["Perif√©ricas", "Transmembrana", "Fibrosas", "Todas son correctas"], correct: 3 },
        { q: "Las prote√≠nas sintetizadas por ribosomas adosados al RE son", options: ["Perif√©ricas", "Transmembrana", "Fibrosas", "Todas son correctas"], correct: 1 },
        { q: "El ligando del transloc√≥n es", options: ["Secuencia de localizaci√≥n", "Un bloqueante del sitio A", "Part√≠cula de reconocimiento de la se√±al", "By c son correctas"], correct: 2 },
        { q: "Las prote√≠nas transmembrana permanecen unidas a la membrana mediante", options: ["Secuencias hidrof√≠licas", "Prote√≠nas de adhesi√≥n", "Interacciones hidrof√≥bicas", "Secuencias topog√©nicas"], correct: 2 },
        { q: "El dolicol fosfato", options: ["En un √°cido graso que act√∫a como transportador", "Es un glucol√≠pido precursor de las glucosilaciones", "Es un l√≠pido de membrana que act√∫a como transportador", "Es un l√≠pido que tiene funciones reguladoras"], correct: 2 },
        { q: "Las mol√©culas plegadas incorrectamente", options: ["Se degradan en el proteosoma", "Son transportadas por la ubiquitina", "Son transportadas por la ubiquinona", "A y b son correctas"], correct: 3 },
        { q: "La citid√≠n difosfocolina", options: ["Es una enzima que participa en el proceso de glucosilaci√≥n", "Es un l√≠pido de membrana", "Es un precursor de los l√≠pidos", "Es una prote√≠na transmembrana"], correct: 2 },
        { q: "El citocromo p450", options: ["Participa en los procesos de dextoxificaci√≥n", "Se encuentra en el RER", "Realiza el proceso mediante la hidr√≥lisis de las sustancias", "Todas son correctas"], correct: 0 },
        { q: "La prote√≠na cop I", options: ["Recubre ves√≠culas de transporte retr√≥grado", "Recubre ves√≠culas que van del Golgi al RE", "Recubre ves√≠culas de transporte anter√≥grado", "Recubre las ves√≠culas del ERGIC"], correct: 1 },
        { q: "El Ph", options: ["Es m√°s √°cido en la cara cis", "Es m√°s √°cido en la cara trans", "Va haci√©ndose m√°s b√°sico hasta los lisosomas", "No cambia"], correct: 1 },
        { q: "La prote√≠na Rab", options: ["Funciona de manera complementaria a SNARE", "Le indica a la ves√≠cula a qu√© membrana se tiene que unir", "Es una GTPasa", "Todas son correctas"], correct: 3 },
        { q: "La adici√≥n de residuos az√∫cares a l√≠pidos se produce en", options: ["REL", "RER", "Golgi", "A y c son correctas"], correct: 2 },
        { q: "¬øQu√© ves√≠culas est√°n cubiertas de clatrina?", options: ["Secreci√≥n constitutiva", "Secreci√≥n regulada", "Ambas", "Ninguna"], correct: 3 },
        { q: "¬øQu√© ves√≠culas necesitan una se√±al para ser liberadas?", options: ["Secreci√≥n constitutiva", "Secreci√≥n regulada", "Ambas", "Ninguna"], correct: 1 },
        { q: "Los lisosomas", options: ["Son org√°nulos muy heterog√©neos", "Participan en el tr√°fico vesicular", "Poseen dos membranas", "Todas son correctas"], correct: 0 },
        { q: "¬øQu√© membrana es m√°s permeable a H+?", options: ["Mitocondrial interna", "Mitocondrial externa", "Las dos son muy permeables", "Ninguna es permeable"], correct: 1 },
        { q: "La prote√≠na Bcl2 est√° implicada en", options: ["Apoptosis", "Detoxificaci√≥n", "Transporte", "Es una enzima"], correct: 0 },
        { q: "El citocromo c es el encargado de", options: ["Participa en la cadena transportadora de electrones", "Cede los electrones del complejo 1 al 3", "Participa en apoptosis", "Las respuestas a y c son correctas"], correct: 3 },
        { q: "¬øCu√°ntas prote√≠nas son reconocidas por el ADN mitocondrial?", options: ["13", "37", "25", "63"], correct: 0 },

        // --- BLOQUE 4: Examen General ---
        { q: "En el fraccionamiento celular mediante centrifugaci√≥n diferencial, el orden de sedimentaci√≥n de sus fracciones es respectivamente:", options: ["1¬∫ nuclear, 2¬∫ mitocondrial, 3¬∫ micros√≥mica y 4¬∫ soluble", "1¬∞ mitocondrial, 2¬∫ microsomica, 3¬∫ soluble y 4¬∫ nuclear", "1¬∫ nuclear, 2¬∫ micros√≥mica, 3¬∫ mitocondrial y 4¬∫ soluble", "1¬∞ nuclear, 2¬∫ soluble, 3¬∫ mitocondrial y 4¬∫ micros√≥mica"], correct: 0 },
        { q: "Sobre las mol√©culas de adhesi√≥n celular (CAM) podemos afirmar que:", options: ["Las cadherinas s√≥lo establecen uniones heter√≥filas", "Las inmunoglobulinas s√≥lo establecen uniones hom√≥filas", "Las integrinas y selectinas establecen uniones tanto hom√≥filas como heter√≥filas", "Todas las CAM presentan un dominio citos√≥lico y otro extracelular"], correct: 3 },
        { q: "La fluidez de las membranas es mayor mientras", options: ["M√°s largas sean las cadenas hidrocarbonadas de los fosfol√≠pidos", "M√°s enlaces insaturados presenten las cadenas hidrocarbonadas", "Mayor concentraci√≥n de colesterol haya en la bicapa", "M√°s interact√∫en entre s√≠ las cadenas hidrocarbonadas"], correct: 1 },
        { q: "Cu√°l de las siguientes afirmaciones sobre las uniones de anclaje es falsa?", options: ["Presentan prote√≠nas de adhesi√≥n intracelular", "Presentan glucoprote√≠nas transmembrana de uni√≥n", "Conectan el citoesqueleto entre las c√©lulas adyacentes...", "Se llaman tambi√©n uniones ocluyentes porque sellan las membranas plasm√°ticas de c√©lulas adyacentes"], correct: 3 },
        { q: "Cu√°l de las siguientes afirmaciones sobre el desmosoma es falsa?", options: ["Es una uni√≥n c√©lula-c√©lula", "Conecta filamentos de actina entre c√©lulas adyacentes", "Las prote√≠nas de adhesi√≥n forman una placa citopl√°smica", "Las prote√≠nas transmembrana son del tipo de las cadherinas"], correct: 1 },
        { q: "El glucoc√°lix:", options: ["Se extiende hacia el interior de la c√©lula", "Sus componentes principales son los l√≠pidos anfip√°ticos", "Es un tipo especial de uni√≥n celular", "Constituye el componente carbohidratado de la membrana plasm√°tica"], correct: 3 },
        { q: "Cu√°l de las siguientes afirmaciones sobre el n√∫cleo es falsa?", options: ["Contiene la informaci√≥n gen√©tica", "Dirige las actividades celulares", "Replica el material gen√©tico", "Transcribe y traduce la informaci√≥n"], correct: 3 },
        { q: "El espacio perinuclear:", options: ["Est√° limitado por las dos membranas nucleares", "Est√° en comunicaci√≥n con las cisternas del Golgi", "Es visible al microscopio √≥ptico", "Se hace m√°s patente en c√©lulas procariotas"], correct: 0 },
        { q: "Los complejos de los poros son de naturaleza:", options: ["Proteica", "Ribonucleoproteica", "Lip√≠dica", "Desconocida"], correct: 0 },
        { q: "A trav√©s de los poros de la envoltura nuclear no pasan:", options: ["Prote√≠nas enzim√°ticas y estructurales", "Part√≠culas ribonucleoproteicas", "Nucle√≥tidos", "Polirribosomas"], correct: 3 },
        { q: "Cu√°l de las siguientes afirmaciones sobre los complejos de los poros es falsa?", options: ["Controlan todos los intercambios nucleo-citoplasma", "Las unidades proteicas que lo forman se disponen seg√∫n un patr√≥n octogonal", "Sus componentes moleculares son esencialmente ADN, ARN y prote√≠nas", "Disminuyen considerablemente el tama√±o de los poros nucleares"], correct: 2 },
        { q: "En una mol√©cula de ADN en la que el 15% de los nucle√≥tidos son de timina cu√°l ser√° el porcentaje de citosina?", options: ["15%", "35%", "70%", "30%"], correct: 1 },
        { q: "Cu√°l es la enzima que sintetiza el cebador", options: ["Primasa", "Helicasa", "Topoisomerasa", "ADN polimerasa"], correct: 0 },
        { q: "Cu√°l es la causa de que los cromosomas de las c√©lulas eucariotas tengan m√°s de un punto de origen de replicaci√≥n?", options: ["Su forma", "Su tama√±o", "Su composici√≥n", "Su actividad"], correct: 1 },
        { q: "La transcripci√≥n se realiza:", options: ["Previa a la traducci√≥n", "De forma simult√°nea a la replicaci√≥n", "Preferentemente en c√©lulas mit√≥ticas", "Preferentemente en c√©lulas eucariotas"], correct: 0 },
        { q: "C√≥mo se llaman las prote√≠nas que reconocen la se√±al de localizaci√≥n nuclear?", options: ["Transportinas", "Nucleoporinas", "Exportinas", "Importinas"], correct: 3 }
    ];

    // Inicializaci√≥n del estado de las preguntas
    // Creamos una copia de las preguntas a√±adiendo propiedades de estado
    // state: null (sin responder), 'correct', 'incorrect'
    // marked: boolean (marcada o no)
    let questions = rawQuestions.map(q => ({...q, state: null, marked: false}));

    // Variables de control de flujo
    let quizIndices = []; // Array con los √≠ndices de las preguntas que tocan en esta ronda
    let currentStep = 0;  // √çndice dentro de quizIndices
    let answered = false;

    // Referencias al DOM
    const questionElement = document.getElementById("question-text");
    const optionsContainer = document.getElementById("options-container");
    const nextBtn = document.getElementById("next-btn");
    const progressText = document.getElementById("progress");
    const scoreText = document.getElementById("score");
    const quizBox = document.getElementById("quiz-box");
    const resultBox = document.getElementById("result-box");
    const finalScore = document.getElementById("final-score");
    const totalQuestionsSpan = document.getElementById("total-questions");
    const markCheckbox = document.getElementById("mark-checkbox");
    const modeIndicator = document.getElementById("mode-indicator");

    // Funci√≥n para iniciar el Quiz (Primera vez o Repeticiones)
    function initQuiz(mode = 'all') {
        if (mode === 'all') {
            // Reinicio completo: limpiamos estados
            questions = rawQuestions.map(q => ({...q, state: null, marked: false}));
            quizIndices = questions.map((_, i) => i);
            modeIndicator.innerText = "Modo: Test Completo";
        } else if (mode === 'failed') {
            // Filtramos solo las que estaban incorrectas
            quizIndices = questions
                .map((q, i) => ({...q, originalIndex: i}))
                .filter(q => q.state === 'incorrect')
                .map(q => q.originalIndex);
            modeIndicator.innerText = "Modo: Repaso de Falladas";
        } else if (mode === 'marked') {
            // Filtramos solo las marcadas
            quizIndices = questions
                .map((q, i) => ({...q, originalIndex: i}))
                .filter(q => q.marked)
                .map(q => q.originalIndex);
            modeIndicator.innerText = "Modo: Repaso de Marcadas";
        } else if (mode === 'mixed') {
            // Falladas O Marcadas
            quizIndices = questions
                .map((q, i) => ({...q, originalIndex: i}))
                .filter(q => q.marked || q.state === 'incorrect')
                .map(q => q.originalIndex);
            modeIndicator.innerText = "Modo: Falladas + Marcadas";
        }

        // Si no hay preguntas en esa categor√≠a
        if (quizIndices.length === 0) {
            alert("No hay preguntas en esta categor√≠a para repasar.");
            return;
        }

        currentStep = 0;
        quizBox.style.display = "block";
        resultBox.style.display = "none";
        loadQuestion();
        updateScoreDisplay();
    }

    function loadQuestion() {
        answered = false;
        nextBtn.style.display = "none";
        
        // Recuperamos la pregunta real usando el √≠ndice guardado en quizIndices
        const realIndex = quizIndices[currentStep];
        const currentQuestion = questions[realIndex];
        
        // Actualizar textos
        questionElement.innerText = `${realIndex + 81}. ${currentQuestion.q}`; // +81 porque es la parte 2
        progressText.innerText = `Pregunta ${currentStep + 1} de ${quizIndices.length}`;
        
        // Sincronizar el checkbox
        markCheckbox.checked = currentQuestion.marked;

        // Limpiar opciones anteriores
        optionsContainer.innerHTML = "";

        // Generar botones de opci√≥n
        currentQuestion.options.forEach((option, index) => {
            const button = document.createElement("button");
            button.innerText = option;
            button.classList.add("option-btn");
            button.onclick = () => checkAnswer(index, button);
            optionsContainer.appendChild(button);
        });
    }

    // Funci√≥n que se ejecuta al clicar el checkbox
    function toggleMark() {
        const realIndex = quizIndices[currentStep];
        questions[realIndex].marked = markCheckbox.checked;
    }

    function checkAnswer(selectedIndex, selectedButton) {
        if (answered) return;
        answered = true;

        const realIndex = quizIndices[currentStep];
        const currentQuestion = questions[realIndex];
        const allButtons = optionsContainer.children;

        if (selectedIndex === currentQuestion.correct) {
            selectedButton.classList.add("correct");
            currentQuestion.state = 'correct';
        } else {
            selectedButton.classList.add("incorrect");
            // Mostrar la correcta
            allButtons[currentQuestion.correct].classList.add("correct");
            currentQuestion.state = 'incorrect';
        }
        
        // Actualizamos la puntuaci√≥n global en tiempo real
        updateScoreDisplay();

        // Deshabilitar botones
        for (let btn of allButtons) {
            btn.disabled = true;
            btn.style.cursor = "default";
        }

        nextBtn.style.display = "block";
    }

    function nextQuestion() {
        currentStep++;
        if (currentStep < quizIndices.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }

    // Calcula cu√°ntas preguntas est√°n correctas en el total del array
    function getGlobalScore() {
        return questions.filter(q => q.state === 'correct').length;
    }

    function updateScoreDisplay() {
        scoreText.innerText = `Aciertos Globales: ${getGlobalScore()}`;
    }

    function showResults() {
        quizBox.style.display = "none";
        resultBox.style.display = "block";
        
        const finalScoreVal = getGlobalScore();
        finalScore.innerText = finalScoreVal;
        totalQuestionsSpan.innerText = questions.length;

        // Configurar botones de reinicio (deshabilitar si no hay preguntas)
        const failedCount = questions.filter(q => q.state === 'incorrect').length;
        const markedCount = questions.filter(q => q.marked).length;
        const mixedCount = questions.filter(q => q.state === 'incorrect' || q.marked).length;

        document.getElementById('btn-failed').disabled = (failedCount === 0);
        document.getElementById('btn-failed').innerText = `‚ùå Repetir Falladas (${failedCount})`;

        document.getElementById('btn-marked').disabled = (markedCount === 0);
        document.getElementById('btn-marked').innerText = `üö© Repetir Marcadas (${markedCount})`;

        document.getElementById('btn-mixed').disabled = (mixedCount === 0);
        document.getElementById('btn-mixed').innerText = `‚ùå + üö© Falladas y Marcadas (${mixedCount})`;
    }

    // Arrancar el test completo al cargar la p√°gina
    initQuiz('all');
</script>

<script>
// L√≥gica para guardar nota y volver al men√∫ (Index)
(function() {
    const params = new URLSearchParams(window.location.search);
    const testId = params.get('id');

    if (testId) {
        const resultBox = document.getElementById('result-box');
        
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (resultBox.style.display === 'block') {
                    
                    const scoreText = document.getElementById('final-score').innerText;
                    const aciertos = parseInt(scoreText);
                    const total = rawQuestions.length; // Siempre sobre el total original
                    const porcentaje = Math.round((aciertos / total) * 100);

                    let intentos = parseInt(localStorage.getItem('intentos_' + testId) || 0);
                    localStorage.setItem('intentos_' + testId, intentos + 1);

                    let notaMax = localStorage.getItem('nota_' + testId);
                    if (!notaMax || porcentaje > parseInt(notaMax)) {
                        localStorage.setItem('nota_' + testId, porcentaje);
                    }

                    if (!document.getElementById('btn-volver-menu')) {
                        const btn = document.createElement('button');
                        btn.id = 'btn-volver-menu';
                        btn.innerText = "üè† Volver al √çndice";
                        btn.style.cssText = "display:block; margin: 20px auto; padding: 15px 30px; background: #2c3e50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;";
                        btn.onclick = function() { window.location.href = 'index.html'; };
                        resultBox.appendChild(btn);
                    }
                }
            });
        });

        observer.observe(resultBox, { attributes: true, attributeFilter: ['style'] });
    }
})();
</script>

</body>
</html>
