<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Anatomía - Tema 25: Hígado</title>
    <style>
        :root {
            --primary-color: #922b21; /* Rojo Hígado */
            --secondary-color: #c0392b;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --background-color: #f9ebea;
            --card-background: #ffffff;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #bdc3c7;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 15px;
            text-align: center;
            background-color: #1a252f;
            border-bottom: 1px solid #34495e;
        }

        .sidebar-header h2 { margin: 0; font-size: 1.1rem; }
        
        .sidebar-controls {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .sidebar-stats { font-size: 0.9rem; color: #bdc3c7; }

        .finish-btn-side {
            background-color: #f1c40f;
            border: none;
            border-radius: 4px;
            color: #2c3e50;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            width: 80%;
            transition: 0.2s;
        }
        .finish-btn-side:hover { background-color: #f39c12; }

        .sidebar-nav {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 5px;
            align-content: start;
        }

        .nav-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 4px;
            background-color: #34495e;
            color: white;
            cursor: pointer;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: 0.2s;
        }

        .nav-btn:hover { background-color: var(--secondary-color); }
        .nav-btn.correct { background-color: var(--success-color); }
        .nav-btn.incorrect { background-color: var(--error-color); }
        .nav-btn.marked { border: 2px solid #f1c40f; color: #f1c40f; font-weight: bold; }

        /* MAIN CONTENT */
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 30px;
            scroll-behavior: smooth;
        }

        .container { max-width: 900px; margin: 0 auto; }

        h1 { color: var(--primary-color); border-bottom: 3px solid var(--secondary-color); padding-bottom: 10px; }

        .question-card {
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--secondary-color);
            scroll-margin-top: 20px;
        }

        .question-header-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .bookmark-btn {
            background: none;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            cursor: pointer;
            color: #95a5a6;
            padding: 2px 8px;
        }
        .bookmark-btn.active { color: #f39c12; border-color: #f39c12; background: #fef9e7; }

        .question-text { font-size: 1.1rem; color: #2c3e50; margin-bottom: 15px; font-weight: 600; line-height: 1.4; }

        .options-grid { display: flex; flex-direction: column; gap: 8px; }

        .option-btn {
            padding: 10px 15px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            text-align: left;
            transition: 0.2s;
            font-size: 1rem;
        }

        .option-btn:hover:not(.disabled) { background-color: #fadbd8; border-color: var(--primary-color); }
        
        .option-btn.correct { background-color: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.incorrect { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }
        .option-btn.disabled { cursor: default; opacity: 0.7; }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
            font-size: 0.9rem;
        }
        .feedback.show { display: block; }
        .feedback.success { background-color: #e8f8f5; color: #0e6251; }
        .feedback.error { background-color: #fdedec; color: #78281f; }

        /* RESULT PANEL */
        .results-panel {
            background: #2c3e50;
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-top: 40px;
            display: none;
            margin-bottom: 50px;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            background: var(--secondary-color);
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: transform 0.1s;
        }
        .action-btn:hover { background: #922b21; transform: scale(1.05); }
        .action-btn:active { transform: scale(0.95); }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .sidebar { width: 100%; height: 170px; border-right: none; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
            .sidebar-nav { grid-template-columns: repeat(8, 1fr); max-height: 150px; }
            .main-content { overflow: visible; }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2>Tema 25: Hígado</h2>
        <div class="sidebar-controls">
            <div class="sidebar-stats"><span id="progress-text">0/77</span> respondidas</div>
            <button class="finish-btn-side" onclick="showResults(true)">Finalizar Test</button>
        </div>
    </div>
    <div id="sidebar-nav" class="sidebar-nav"></div>
</div>

<div class="main-content">
    <div class="container">
        <h1>Anatomía del Hígado 

[Image of liver anatomy]
</h1>
        <div id="questions-list"></div>
        
        <div id="results-panel" class="results-panel">
            <h2>Test Finalizado</h2>
            <p id="score-text" style="font-size: 1.4rem; margin: 15px 0;"></p>
            <div class="action-buttons">
                <button class="action-btn" onclick="resetQuiz('all')">Repetir Todo</button>
                <button class="action-btn" onclick="resetQuiz('wrong')">Repetir Falladas</button>
                <button class="action-btn" onclick="resetQuiz('marked')">Repetir Marcadas</button>
                <button class="action-btn" onclick="resetQuiz('wrong_marked')">Falladas + Marcadas</button>
            </div>
        </div>
    </div>
</div>

<script>
    // BASE DE DATOS - TEMA 25 HÍGADO
    const dbQuestions = [
        { id: 1, original: "Extra", q: "La cara visceral del hígado no se relaciona mediante una faceta con:", options: ["Riñón derecho", "Bazo", "Colon ascendente", "Esófago"], correct: 1, exp: "El bazo se encuentra en el hipocondrio izquierdo, lejos de la cara visceral hepática (derecha/central)." },
        { id: 2, original: "1", q: "La confluencia de los ligamentos coronarios del hígado va a formar la siguiente estructura:", options: ["Ligamento triangular", "Ligamento falciforme", "Ligamento redondo", "Epiplón menor"], correct: 0, exp: "Los extremos de los ligamentos coronarios forman los ligamentos triangulares izquierdo y derecho." },
        { id: 3, original: "2", q: "El ligamento venoso y la vena cava inferior constituyen los límites del lóbulo:", options: ["Caudado (de Spiegel)", "Cuadrado", "Izquierdo", "Derecho"], correct: 0, exp: "El lóbulo caudado se sitúa dorsalmente, entre la VCI y el ligamento venoso." },
        { id: 4, original: "Extra", q: "El vértice del receso hepatorrenal, su limite craneal, es:", options: ["La hoja inferior del ligamento coronario", "Hoja superior del coronario", "Falciforme", "Triangular"], correct: 0, exp: "Límite superior de la Bolsa de Morrison." },
        { id: 5, original: "3", q: "La arteria cística nace, más frecuentemente, de:", options: ["Tronco celiaco", "Arteria coronaria estomáquica (gástrica izquierda)", "Arteria esplénica", "Arteria hepática propia derecha"], correct: 3, exp: "Rama de la hepática derecha en el triángulo de Calot." },
        { id: 6, original: "4", q: "En el pedículo hepático, la vena porta se encuentra:", options: ["Anterior a la vía biliar y lateral a la arteria hepática", "Posterior a la vía biliar y a la arteria hepática", "Medial a la vía biliar y a la arteria cística", "Medial a la vía biliar y a la arteria pilórica"], correct: 1, exp: "La vena porta es el elemento más posterior del pedículo hepático." },
        { id: 7, original: "5", q: "El sistema de la vena porta se forma por la unión de las venas:", options: ["Pilórica y esplénica", "Mesentérica superior, mesentérica inferior y esplénica", "Mesentérica superior, mesentérica inferior y pancreática", "Hepática superior, mesentérica inferior y esplénica"], correct: 1, exp: "Tronco esplenomesentérico + VMS." },
        { id: 8, original: "6", q: "Las venas suprahepáticas (venas hepáticas) desembocan en:", options: ["Venas renales", "Vena porta", "Vena hepática", "Vena cava inferior"], correct: 3, exp: "Drenan el hígado hacia la VCI justo bajo el diafragma." },
        { id: 9, original: "7", q: "El pedículo hepático es, de delante hacia atrás:", options: ["Conducto hepático, vena porta, arteria hepática", "Arteria hepática, vena porta, conducto hepático", "Conducto hepático/Arteria hepática (plano anterior), vena porta (plano posterior)", "Arteria hepática, conducto hepático, vena porta"], correct: 2, exp: "Nota: El texto da varias opciones confusas. El orden clásico es: Vía biliar (derecha/ant) y Arteria (izquierda/ant) están delante de la Vena Porta (posterior). Seleccionamos la opción que pone a la porta al final (atrás)." },
        { id: 10, original: "8", q: "Sobre el cístico, indique la correcta:", options: ["Es el ducto de conexión de la vesícula biliar", "Drena en la tercera porción del duodeno", "Bolsa piriforme de colección de las sales biliares", "Se forma por la confluencia del conducto hepático derecho e izquierdo"], correct: 0, exp: "Conecta la vesícula con el colédoco." },
        { id: 11, original: "9", q: "El ligamento suspensorio del hígado (Falciforme):", options: ["Llega hasta la pared anterior del abdomen", "Se continua directamente como epiplón mayor", "Lleva la vena vitelina obliterada", "Pasa por delante del pancreas"], correct: 0, exp: "Une la cara diafragmática del hígado a la pared abdominal anterior." },
        { id: 12, original: "10", q: "El área desnuda del hígado queda adherido al diafragma gracias a:", options: ["La hoja superior del ligamento coronario (y tejido conectivo)", "Grasa perirrenal", "Fascia diafragmática", "Peritoneo parietal"], correct: 0, exp: "Está delimitada por las hojas del ligamento coronario." },
        { id: 13, original: "11", q: "El ligamento suspensorio o falciforme del hígado: (Repetida)", options: ["Llega hasta la pared anterior del abdomen", "Se continua directamente como epiplon mayor", "Lleva la vena vitelina obliterada", "Pasa por delante del páncreas"], correct: 0, exp: "Repetida." },
        { id: 14, original: "12", q: "No existen anastomosis porto - cava a nivel:", options: ["Esofágico", "Esplénico", "Hemorroidal", "Umbilical"], correct: 1, exp: "El bazo (esplénico) es sistema porta puro, no una zona de transición anatómica con la cava en condiciones normales." },
        { id: 15, original: "13", q: "El límite posterior del hiato epiploico (de Winslow) es:", options: ["La columna vertebral", "El pilar derecho del diafragma", "La vena cava inferior", "El pedículo hepático"], correct: 2, exp: "La VCI cubierta de peritoneo parietal." },
        { id: 16, original: "14", q: "La impresión del ángulo hepático del colon en el lóbulo derecho del hígado se encuentra:", options: ["En la cara inferior del lóbulo derecho, por delante y afuera de la impresión duodenal", "Por detrás y afuera de la impresión renal", "En la cara anterior del lóbulo derecho", "A la izquierda del arco"], correct: 0, exp: "Es una impresión anterior e inferior." },
        { id: 17, original: "15", q: "La arteria cística nace, más frecuentemente de: (Repetida)", options: ["Tronco celiaco", "Coronaria estomáquica", "Esplénica", "Hepática derecha"], correct: 3, exp: "Repetida." },
        { id: 18, original: "16", q: "En el pedículo hepático, la vena porta se encuentra: (Repetida)", options: ["Anterior", "Posterior a la vía biliar y a la arteria hepática", "Medial", "Lateral"], correct: 1, exp: "Repetida: Posterior." },
        { id: 19, original: "17", q: "El sistema de la vena porta se forma por la unión de las venas: (Repetida)", options: ["Pilórica y esplénica", "Mesentérica superior, mesentérica inferior y esplénica", "Pancreática", "Hepática superior"], correct: 1, exp: "Repetida." },
        { id: 20, original: "18", q: "Las venas suprahepáticas (venas hepáticas) desembocan en: (Repetida)", options: ["Venas renales", "Venas porta", "Vena hepática", "Vena cava inferior"], correct: 3, exp: "Repetida." },
        { id: 21, original: "19", q: "Las ramas del tronco celíaco son las arterias:", options: ["Esplénica, pilórica, cística", "Coronaria, esplénica, cística", "Coronaria, esplénica, hepática común", "Gastroduodenal, esplénica, hepática"], correct: 2, exp: "Repetida: Gástrica Izq, Esplénica, Hepática Común." },
        { id: 22, original: "20", q: "El hígado lo encontramos fundamentalmente en:", options: ["Hipocondrio derecho", "Mesogastrio", "Flanco derecho", "Fosa iliaca derecha"], correct: 0, exp: "Ocupa el hipocondrio derecho y parte del epigastrio." },
        { id: 23, original: "21", q: "Porción del hígado libre de recubrimiento peritoneal:", options: ["Cuadrado", "Caudado", "Área desnuda", "Lóbulo izquierdo", "Hoja inferior"], correct: 2, exp: "El área desnuda está en contacto directo con el diafragma." },
        { id: 24, original: "22", q: "Lóbulo hepático situado entre la fosa de la vesícula biliar y la fisura del ligamento redondo:", options: ["Cuadrado", "Caudado", "Área desnuda", "Lóbulo izquierdo"], correct: 0, exp: "Lóbulo Cuadrado (cara visceral anterior)." },
        { id: 25, original: "23", q: "El ligamento redondo se encuentra en el borde libre del:", options: ["Mesogastrio dorsal", "Hoja inferior del ligamento coronario", "Ligamento falciforme", "Epiplón menor"], correct: 2, exp: "Resto de la vena umbilical." },
        { id: 26, original: "24", q: "El éstasis y acúmulo de la bilis en el colédoco puede venir condicionado por:", options: ["Conducto pancreático principal", "Esfínter de Oddi", "Papila duodenal menor", "Ampolla de Váter"], correct: 1, exp: "El esfínter de Oddi regula la salida de bilis." },
        { id: 27, original: "25", q: "La vesícula biliar posee una característica anatómica clave que condiciona la clínica de los cálculos biliares:", options: ["El recubrimiento peritoneal", "La posición", "La forma piriforme", "Las válvulas de la mucosa en un cuello flexionado (Válvulas de Heister)"], correct: 3, exp: "Las válvulas espirales de Heister en el cístico dificultan la salida de cálculos." },
        { id: 28, original: "26", q: "Porción del hígado libre de recubrimiento peritoneal: (Repetida)", options: ["Cuadrado", "Caudado", "Área desnuda", "Lóbulo izquierdo"], correct: 2, exp: "Repetida." },
        { id: 29, original: "27", q: "Lóbulo hepático situado entre la fosa de la vesícula biliar y la fisura del ligamento redondo: (Repetida)", options: ["Cuadrado", "Caudado", "Área desnuda", "Lóbulo izquierdo"], correct: 0, exp: "Repetida." },
        { id: 30, original: "28", q: "¿Qué lóbulo del hígado está limitado por la fosa de la vesícula biliar y el ligamento falciforme?", options: ["Lóbulo izquierdo", "Lóbulo derecho", "Lóbulo cuadrado", "Lóbulo caudado"], correct: 2, exp: "El ligamento redondo (en el borde libre del falciforme) es el límite izquierdo del cuadrado." },
        { id: 31, original: "31", q: "La confluencia de los ligamentos coronarios del hígado van a formar la siguiente estructura:", options: ["Ligamento falciforme", "Ligamento de Arancio", "Ligamento redondo", "Ligamento triangular"], correct: 3, exp: "Repetida." },
        { id: 32, original: "32", q: "El ligamento venoso y la vena cava inferior constituyen los límites del lóbulo:", options: ["Izquierdo", "Derecho", "Caudado", "Cuadrado"], correct: 2, exp: "Repetida: Caudado." },
        { id: 33, original: "33", q: "El mesogastrio ventral que organiza el ligamento falciforme separa los lóbulos hepáticos en:", options: ["Lóbulos cuadrado y caudado", "Cara parietocostal", "Área desnuda", "Cara visceral (Divide anatómicamente Izq/Der en la cara diafragmática)"], correct: 3, exp: "En la cara diafragmática divide el hígado en lóbulos derecho e izquierdo anatómicos." },
        { id: 34, original: "34", q: "El ligamento redondo se encuentra en el borde libre del (Repetida)", options: ["Epiplón menor", "Epiplón mayor", "Ligamento frenocólico", "Mesogastrio ventral (Ligamento falciforme)"], correct: 3, exp: "El falciforme deriva del mesogastrio ventral." },
        { id: 35, original: "35", q: "Cuáles de los siguientes signos clínicos NO suelen asociarse con espacios compartidos de drenaje venoso porto-cavos:", options: ["Hemorragias digestivas altas (Varices)", "Úlceras duodenales", "Hemorroides", "Metástasis hepáticas de tumores pélvicos"], correct: 1, exp: "Las úlceras duodenales son pépticas, no vasculares porto-cava." },
        { id: 36, original: "36", q: "La hoja superior del ligamento coronario es la reflexión de peritoneo que delimita:", options: ["Lecho biliar", "Surco Arancio", "Ligamento hepatorrenal", "El receso subfrénico"], correct: 3, exp: "Delimita el espacio subfrénico." },
        { id: 37, original: "37", q: "Indique de los siguientes ligamentos cual es un medio de fijación inconstante:", options: ["Ligamento hepato-renal", "Coronario", "Triangular", "Falciforme"], correct: 0, exp: "El hepatorrenal es un pliegue peritoneal a veces no considerado ligamento suspensorio fuerte." },
        { id: 38, original: "38", q: "Que estructura NO SE RELACIONA con el lóbulo tuberoso o derecho de la división clásica del hígado:", options: ["Riñón derecho", "Colon", "Duodeno", "Antro pilórico"], correct: 3, exp: "El antro se relaciona más con el lóbulo cuadrado/izquierdo. El lóbulo derecho tiene impresiones renal, cólica y duodenal." },
        { id: 39, original: "39", q: "El hígado se encuentra en el espacio:", options: ["Supramesocólico", "Inframesocólico", "Mesentérico", "Paracólico"], correct: 0, exp: "Por encima del mesocolon transverso." },
        { id: 40, original: "40", q: "El ligamento que divide al hígado en izquierdo y derecho es el denominado:", options: ["Falciforme", "Coronarios", "Triangulares", "Arancio"], correct: 0, exp: "En la cara diafragmática." },
        { id: 41, original: "41", q: "La zona del hígado que no presenta recubrimiento de peritoneo se denomina:", options: ["Proceso unciforme", "Area desnuda", "Ligamento de Arancio", "B y C"], correct: 1, exp: "Área desnuda." },
        { id: 42, original: "42", q: "La Bolsa de Morrison corresponde a:", options: ["Receso hepatoduodenal", "Receso hepatorrenal", "Receso gastrohepático", "Todas"], correct: 1, exp: "Espacio hepatorrenal." },
        { id: 43, original: "43", q: "Por el ligamento hepatoduodenal discurre:", options: ["Vena porta", "Conducto colédoco", "Arteria hepática", "Todas las anteriores"], correct: 3, exp: "Tríada portal." },
        { id: 44, original: "44", q: "Relacione: Lóbulo caudado del hígado", options: ["Límite posterior del hiato de Winslow", "Límite anterior del hiato de Winslow", "Límite superior del hiato de Winslow", "Límite inferior del hiato de Winslow"], correct: 2, exp: "Techo del hiato." },
        { id: 45, original: "45", q: "Relacione: Vena cava inferior", options: ["Límite posterior del hiato de Winslow", "Límite anterior", "Límite superior", "Límite inferior"], correct: 0, exp: "Pared posterior." },
        { id: 46, original: "46", q: "Relacione: Bulbo o ampolla duodenal (1ª porción)", options: ["Límite posterior", "Límite anterior", "Límite superior", "Límite inferior del hiato de Winslow"], correct: 3, exp: "Suelo del hiato." },
        { id: 47, original: "47", q: "Relacione: Epiplon menor (Lig hepatoduodenal)", options: ["Límite posterior", "Límite anterior del hiato de Winslow", "Límite superior", "Límite inferior"], correct: 1, exp: "Pared anterior." },
        { id: 48, original: "48", q: "Relacione: Hoja inferior del ligamento coronario", options: ["Límite posterior", "Anterior", "Superior", "Límite del área desnuda (inferior)"], correct: 3, exp: "Nota: Esta opción no encaja en el esquema Winslow. Es el límite inferior del área desnuda." },
        { id: 49, original: "49", q: "La vena porta no nace de la confluencia de una de estas venas:", options: ["Vena esplénica", "Vena mesentérica superior", "Vena gástrica (drena en ella, no la forma)", "Todas son falsas"], correct: 2, exp: "La gástrica es afluente, no formadora." },
        { id: 50, original: "50", q: "La hoja superior del ligamento coronario es el peritoneo parietal que se refleja tapizando:", options: ["Cara visceral", "Cara anterior estómago", "Área desnuda", "Cara parietal (diafragmática) del hígado"], correct: 3, exp: "Refleja el peritoneo del diafragma al hígado." },
        { id: 51, original: "51", q: "La cara visceral del hígado no se limita una faceta, que señala una relación con:", options: ["Bazo", "Colon ascendente", "Riñón derecho", "Estómago"], correct: 0, exp: "Repetida: Bazo." },
        { id: 52, original: "52", q: "¿Qué lóbulo del hígado está limitado por la fosa de la vésicula biliar y el ligamento falciforme?: (Repetida)", options: ["Izquierdo", "Derecho", "Cuadrado", "Caudado"], correct: 2, exp: "Repetida: Cuadrado." },
        { id: 53, original: "53", q: "Sobre el cístico, indique la correcta: (Repetida)", options: ["Ducto de conexión de la vesícula biliar", "Drena duodeno", "Bolsa piriforme", "Confluencia hepáticos"], correct: 0, exp: "Repetida." },
        { id: 54, original: "54", q: "La arteria cística es rama de: (Repetida)", options: ["Tronco celiaco", "Gastroduodenal", "Arteria hepática propia", "Gástrica izquierda"], correct: 2, exp: "Repetida." },
        { id: 55, original: "55", q: "La cara visceral del hígado no se limita una faceta, que señala relación con: (Repetida)", options: ["Colon ascendente", "Riñón derecho", "Estómago", "Vesículas seminales (biliar?)"], correct: 3, exp: "Repetida: Vesículas seminales." },
        { id: 56, original: "56", q: "Cuáles de los siguientes signos colínicos no suelen asociarse con espacios compartidos de drenaje venoso porto - cavos: (Repetida)", options: ["Hemorragias digestivas altas", "Úlceras duodenales", "Hemorroides", "Metástasis"], correct: 1, exp: "Repetida: Úlceras." },
        { id: 57, original: "57", q: "El nombre del conducto por el que discurrían los vasos umbilicales en el hígado recibe el nombre de:", options: ["Conducto de Silvio", "Cisura de Rolando", "Conducto de Rapoport", "Conducto de Arancio (Conducto Venoso)", "Ninguna"], correct: 3, exp: "Conducto venoso de Arancio." },
        { id: 58, original: "58", q: "Relacione: Ampolla de Váter", options: ["Papila mayor", "Papila menor", "Hepático común", "Válvula ileocecal"], correct: 0, exp: "Repetida." },
        { id: 59, original: "59", q: "Relacione: Conducto hepático derecho", options: ["Papila mayor", "Papila menor", "Se une al izquierdo para formar el conducto hepático común", "Válvula ileocecal"], correct: 2, exp: "Repetida." },
        { id: 60, original: "60", q: "Relacione: Conducto colédoco", options: ["Papila mayor", "Papila menor", "Hepático común", "Válvula ileocecal"], correct: 0, exp: "Repetida." },
        { id: 61, original: "61", q: "Relacione: Conducto de Wirsung", options: ["Papila mayor", "Papila menor", "Hepático común", "Válvula ileocecal"], correct: 0, exp: "Repetida." },
        { id: 62, original: "62", q: "Relacione: Conducto de Santorini", options: ["Papila mayor", "Papila menor", "Hepático común", "Válvula ileocecal"], correct: 1, exp: "Repetida." },
        { id: 63, original: "63", q: "La confluencia de los ligamentos coronarios del hígado van a formar: (Repetida)", options: ["Falciforme", "Arancio", "Redondo", "Ligamento triangular"], correct: 3, exp: "Repetida." },
        { id: 64, original: "64", q: "EI Ligamento venoso y la vena cava inferior constituyen los límites del lóbulo: (Repetida)", options: ["Izquierdo", "Derecho", "Caudado", "Cuadrado"], correct: 2, exp: "Repetida." },
        { id: 65, original: "65", q: "¿Qué lóbulo del hígado está limitado por la fosa de la vésicula biliar y el ligamento falciforme?: (Repetida 3)", options: ["Izquierdo", "Derecho", "Cuadrado", "Caudado"], correct: 2, exp: "Repetida." },
        { id: 66, original: "62 (Extra)", q: "Un residente durante una colistectomía –resección de la vesícula biliar- pinzó accidentalmente el ligamento hepatoduodenal en vez de la arteria cística. ¿Cuál de los siguientes vasos estará probablemente afectado?", options: ["Arteria hepática propia", "Arteria gástrica izquierda", "Arteria esplénica", "Arteria mesentérica superior"], correct: 0, exp: "La hepática propia va por el ligamento." },
        { id: 67, original: "52 (Extra)", q: "Entre las características del sistema porta hepático NO SE ENCUENTRA:", options: ["Drena tubo digestivo", "Carece de válvulas", "Alcanzar la presión venosa en el sistema portal valores menores a los del sistema venoso central", "Transporta nutrientes"], correct: 2, exp: "La presión portal es mayor que la de la Cava." },
        { id: 68, original: "53 (Extra)", q: "Con respecto a la cara visceral del hígado indique qué afirmación ES CIERTA:", options: ["Se encuentra la línea de Cantlie, que divide el hígado en dos (funcionales)", "Es totalmente lisa", "No tiene impresiones", "Está cubierta de pleura"], correct: 0, exp: "Línea de Cantlie (Cava - Vesícula)." },
        { id: 69, original: "54", q: "Lóbulo hepático situado entre la fosa de la vesícula biliar y la fisura del ligamento redondo (Repetida 4)", options: ["Cuadrado", "Caudado", "Área desnuda", "Izquierdo"], correct: 0, exp: "Repetida." },
        { id: 70, original: "55", q: "Vesícula biliar (Repetida)", options: ["Bolsa piriforme de colección de las sales biliares", "Confluencia hepáticos", "Drena duodeno", "Ducto"], correct: 0, exp: "Repetida." },
        { id: 71, original: "56", q: "Una señora con dolor intenso en la región escapular derecha, no relacionada con los movimientos del miembro superior nos debe hacer pensar en:", options: ["Úlceras pépticas", "Cólico nefrítico", "Carcinoma hepático", "Patologías litiásicas de la vía biliar (Cólico biliar)"], correct: 3, exp: "Dolor referido (Signo de Boas/Irritación frénica)." },
        { id: 72, original: "57", q: "El área desnuda del hígado queda adherido a:", options: ["Fascia de Scarpa", "Al peritoneo parietal", "A la fascia del músculo diafragma", "Grasa pararrenal"], correct: 2, exp: "Contacto directo diafragmático." },
        { id: 73, original: "58", q: "La hoja superior del ligamento coronario es el peritoneo parietal que se refleja, tapizando: (Repetida)", options: ["Visceral", "Anterior estómago", "Área desnuda", "Cara parietal del hígado"], correct: 3, exp: "Repetida." },
        { id: 74, original: "59", q: "La cara visceral del hígado no se limita a una faceta, que señala una relación con: (Repetida)", options: ["Bazo", "Colon", "Riñón", "Estómago"], correct: 0, exp: "Repetida." },
        { id: 75, original: "2 (Extra)", q: "El mesogastrio ventral que organiza el ligamento falciforme separa los lóbulos hepáticos en: (Repetida)", options: ["Visceral", "Parietocostal", "Área desnuda", "Lóbulos cuadrado y caudado (Anatómicos Izq/Der)"], correct: 3, exp: "Repetida." },
        { id: 76, original: "5 (Extra)", q: "La arteria cística es en última instancia rama de: (Repetida)", options: ["Renal", "Hepática común", "Hepática propia", "Gastroduodenal"], correct: 2, exp: "Repetida." },
        { id: 77, original: "11 (Extra)", q: "Qué elemento no contiene el pedículo hepático en su trayecto por el epiplón menor", options: ["Venas suprahepáticas", "Arteria hepática propia", "Vena porta", "Colédoco"], correct: 0, exp: "Las suprahepáticas están fuera del pedículo, drenando arriba." }
    ];

    let currentQuestions = [...dbQuestions];
    let markedIds = new Set();
    let userAnswers = {};

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function renderQuiz() {
        const list = document.getElementById('questions-list');
        const nav = document.getElementById('sidebar-nav');
        const resultsPanel = document.getElementById('results-panel');
        
        list.innerHTML = '';
        nav.innerHTML = '';
        resultsPanel.style.display = 'none';

        if(currentQuestions.length === 0) {
            list.innerHTML = `<div class="question-card"><p>No hay preguntas para los criterios seleccionados.</p></div>`;
            return;
        }

        currentQuestions.forEach((q, index) => {
            const btn = document.createElement('a');
            btn.href = `#q-${q.id}`;
            btn.className = 'nav-btn';
            btn.innerText = index + 1;
            btn.id = `nav-btn-${q.id}`;
            
            if (userAnswers[q.id] === true) btn.classList.add('correct');
            if (userAnswers[q.id] === false) btn.classList.add('incorrect');
            if (markedIds.has(q.id)) btn.classList.add('marked');

            nav.appendChild(btn);

            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-${q.id}`;

            const originalOptions = q.options.map((text, i) => ({ text: text, isCorrect: i === q.correct }));
            const finalOptions = shuffle(originalOptions);

            let optionsHTML = '';
            finalOptions.forEach(opt => {
                const safeText = opt.text.replace(/'/g, "&#39;"); 
                optionsHTML += `<button class="option-btn" onclick="handleAnswer(${q.id}, ${opt.isCorrect}, this)">${opt.text}</button>`;
            });

            const isMarked = markedIds.has(q.id);

            card.innerHTML = `
                <div class="question-header-row">
                    <span>Pregunta ${index + 1} (Ref: ${q.original})</span>
                    <button class="bookmark-btn ${isMarked ? 'active' : ''}" onclick="toggleMark(${q.id}, this)">
                        ${isMarked ? '★ Marcada' : '☆ Marcar'}
                    </button>
                </div>
                <div class="question-text">${q.q}</div>
                <div class="options-grid" id="opts-${q.id}">
                    ${optionsHTML}
                </div>
                <div class="feedback" id="feed-${q.id}"></div>
            `;
            list.appendChild(card);
        });
        updateProgress();
    }

    function handleAnswer(id, isCorrect, btn) {
        if (userAnswers.hasOwnProperty(id)) return;
        
        userAnswers[id] = isCorrect;
        const navBtn = document.getElementById(`nav-btn-${id}`);
        const feedback = document.getElementById(`feed-${id}`);
        const container = document.getElementById(`opts-${id}`);
        const qData = dbQuestions.find(x => x.id === id);

        const allBtns = container.querySelectorAll('.option-btn');
        allBtns.forEach(b => {
            b.classList.add('disabled');
            b.onclick = null;
            const correctText = qData.options[qData.correct];
            if (b.innerText === correctText) b.classList.add('correct');
        });

        if (isCorrect) {
            feedback.innerHTML = `<strong>¡Correcto!</strong><br>${qData.exp}`;
            feedback.className = 'feedback success show';
            if(navBtn) navBtn.classList.add('correct');
        } else {
            btn.classList.add('incorrect');
            feedback.innerHTML = `<strong>Incorrecto.</strong><br>${qData.exp}`;
            feedback.className = 'feedback error show';
            if(navBtn) navBtn.classList.add('incorrect');
        }
        updateProgress();
    }

    function toggleMark(id, btn) {
        const navBtn = document.getElementById(`nav-btn-${id}`);
        if (markedIds.has(id)) {
            markedIds.delete(id);
            btn.innerHTML = '☆ Marcar';
            btn.classList.remove('active');
            if(navBtn) navBtn.classList.remove('marked');
        } else {
            markedIds.add(id);
            btn.innerHTML = '★ Marcada';
            btn.classList.add('active');
            if(navBtn) navBtn.classList.add('marked');
        }
    }

    function updateProgress() {
        const count = Object.keys(userAnswers).length;
        const total = currentQuestions.length;
        document.getElementById('progress-text').innerText = `${count}/${total} respondidas`;
        
        if (count === total && total > 0) {
            showResults(false);
        }
    }

    function showResults(manualFinish = false) {
        const panel = document.getElementById('results-panel');
        let correct = 0;
        Object.values(userAnswers).forEach(v => { if(v) correct++; });
        
        const total = currentQuestions.length;
        
        document.getElementById('score-text').innerText = `Has acertado ${correct} de ${total}`;
        panel.style.display = 'block';
        
        if(manualFinish) {
            panel.scrollIntoView({ behavior: 'smooth' });
        } else {
            setTimeout(() => panel.scrollIntoView({ behavior: 'smooth' }), 100);
        }
    }

    function resetQuiz(mode) {
        let nextIds = [];

        if (mode === 'all') {
            nextIds = dbQuestions.map(q => q.id);
        } else if (mode === 'wrong') {
            nextIds = Object.keys(userAnswers).filter(id => userAnswers[id] === false).map(Number);
        } else if (mode === 'marked') {
            nextIds = Array.from(markedIds);
        } else if (mode === 'wrong_marked') {
            const wrong = Object.keys(userAnswers).filter(id => userAnswers[id] === false).map(Number);
            const marked = Array.from(markedIds);
            nextIds = [...new Set([...wrong, ...marked])];
        }

        if (nextIds.length === 0) {
            alert("No hay preguntas para los criterios seleccionados.");
            return;
        }

        userAnswers = {};
        currentQuestions = dbQuestions.filter(q => nextIds.includes(q.id));
        renderQuiz();
        document.querySelector('.main-content').scrollTop = 0;
    }

    renderQuiz();
</script>
</body>
</html>