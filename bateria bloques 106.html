<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Bioqu√≠mica - 106 Preguntas</title>
    <style>
        :root {
            --primary: #8e44ad;    /* Morado/Violeta para diferenciar */
            --secondary: #2c3e50;
            --success: #27ae60;
            --error: #c0392b;
            --warning: #f39c12;
            --bg: #fdfefe;
            --card-bg: #ffffff;
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; background-color: var(--bg); height: 100vh; display: flex; overflow: hidden; color: #333; }

        /* SIDEBAR */
        #sidebar { width: 300px; background: var(--secondary); color: white; display: flex; flex-direction: column; flex-shrink: 0; box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 100; }
        .sb-header { padding: 20px; background: rgba(0,0,0,0.2); text-align: center; border-bottom: 1px solid #34495e; }
        .sb-info { padding: 10px; text-align: center; font-size: 0.9rem; color: #bdc3c7; }
        
        #nav-grid { flex: 1; overflow-y: auto; padding: 10px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; align-content: start; }
        .nav-btn { aspect-ratio: 1; border: none; background: rgba(255,255,255,0.1); color: #bdc3c7; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.8rem; position: relative; }
        .nav-btn:hover { background: rgba(255,255,255,0.3); color: white; }
        .nav-btn.active { background: white; color: var(--secondary); transform: scale(1.1); z-index: 2; box-shadow: 0 0 10px var(--primary); }
        .nav-btn.correct { background: var(--success); color: white; }
        .nav-btn.wrong { background: var(--error); color: white; }
        .nav-btn.marked::after { content: ''; position: absolute; top: 2px; right: 2px; width: 6px; height: 6px; background: var(--warning); border-radius: 50%; border: 1px solid white; }

        /* MAIN */
        #main { flex: 1; display: flex; flex-direction: column; position: relative; }
        .top-bar { height: 60px; background: white; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .timer { font-family: monospace; font-size: 1.2rem; background: #eee; padding: 5px 10px; border-radius: 5px; color: var(--primary); font-weight: bold; }

        #quiz-area { flex: 1; overflow-y: auto; padding: 40px; scroll-behavior: smooth; }
        .q-container { max-width: 800px; margin: 0 auto 100px auto; }

        .q-card { background: var(--card-bg); padding: 30px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 5px solid transparent; transition: 0.3s; }
        .q-card.current { border-left-color: var(--primary); transform: translateX(5px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        
        .q-meta { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 0.85rem; color: #7f8c8d; font-weight: bold; text-transform: uppercase; }
        .q-text { font-size: 1.15rem; font-weight: 600; margin-bottom: 20px; line-height: 1.5; }

        .opt-btn { display: block; width: 100%; text-align: left; padding: 15px; margin-bottom: 10px; border: 2px solid #f0f0f0; background: #f9f9f9; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1rem; color: #444; }
        .opt-btn:hover:not(:disabled) { border-color: var(--primary); background: #fdf8ff; }
        .opt-btn.correct { background: #d4edda; border-color: var(--success); color: #155724; }
        .opt-btn.wrong { background: #f8d7da; border-color: var(--error); color: #721c24; }
        .opt-btn:disabled { cursor: default; opacity: 0.7; }

        .feedback { margin-top: 15px; padding: 15px; background: #e8f8f5; border-left: 4px solid var(--success); border-radius: 4px; display: none; animation: slideIn 0.3s; }
        .tools { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; }
        .mark-label { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #7f8c8d; cursor: pointer; }
        .mark-label input { transform: scale(1.2); accent-color: var(--warning); }

        /* MODALS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: white; padding: 40px; border-radius: 12px; width: 90%; max-width: 500px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; transition: transform 0.1s; }
        .btn:hover { transform: scale(1.02); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        
        .retry-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .btn-retry { font-size: 0.9rem; padding: 12px; color: white; }
        .r-fail { background: var(--error); }
        .r-mark { background: var(--warning); }
        .r-mix { background: #8e44ad; grid-column: span 2; }
        .r-all { background: var(--secondary); grid-column: span 2; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="start-screen" class="modal">
        <div class="modal-box">
            <h1 style="color:var(--secondary); margin-bottom:5px;">Bioqu√≠mica M√©dica</h1>
            <h2 style="color:var(--primary); margin-top:0;">Examen 106 Preguntas</h2>
            <p>Bater√≠a Completa</p>
            
            <div style="text-align:left; background:#f8f9fa; padding:20px; border-radius:8px; margin:20px 0;">
                <p style="font-size:0.9rem; color:#7f8c8d; margin-bottom:15px;">
                    ‚ÑπÔ∏è Las respuestas (a, b, c, d) se mezclar√°n autom√°ticamente.
                </p>
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer; font-size:1.1rem; margin-bottom:10px;">
                    <input type="checkbox" id="shuffle-questions" checked> 
                    <strong>¬øMezclar orden de las preguntas?</strong>
                </label>
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer; font-size:1.1rem;">
                    <input type="checkbox" id="timer-check"> 
                    Activar Temporizador
                </label>
            </div>

            <button class="btn btn-primary" onclick="initQuiz()">COMENZAR TEST</button>
        </div>
    </div>

    <div id="result-screen" class="modal" style="display:none;">
        <div class="modal-box">
            <h2>Resultados</h2>
            <div style="font-size:3.5rem; font-weight:800; color:var(--primary);" id="score">0%</div>
            
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin:20px 0;">
                <div style="background:#eafaf1; padding:10px; border-radius:5px; color:var(--success)">‚úÖ <b id="r-ok">0</b></div>
                <div style="background:#fdedec; padding:10px; border-radius:5px; color:var(--error)">‚ùå <b id="r-ko">0</b></div>
                <div style="background:#fef9e7; padding:10px; border-radius:5px; color:var(--warning)">üö© <b id="r-mk">0</b></div>
            </div>

            <div class="retry-grid">
                <button class="btn btn-retry r-fail" onclick="retry('failed')">Solo Falladas</button>
                <button class="btn btn-retry r-mark" onclick="retry('marked')">Solo Marcadas</button>
                <button class="btn btn-retry r-mix" onclick="retry('failed_marked')">Falladas + Marcadas</button>
                <button class="btn btn-retry r-all" onclick="retry('all')">Reiniciar Todo</button>
            </div>
        </div>
    </div>

    <div id="sidebar">
        <div class="sb-header">
            <h3>Navegaci√≥n</h3>
        </div>
        <div class="sb-info">
            <span id="prog-text">0 / 106</span>
        </div>
        <div id="nav-grid"></div>
        <div style="padding:20px;">
            <button class="btn btn-secondary" onclick="finish()">Finalizar</button>
        </div>
    </div>

    <div id="main">
        <div class="top-bar">
            <strong>Examen 106 Preguntas</strong>
            <div class="timer" id="timer">00:00</div>
        </div>
        <div id="quiz-area">
            <div class="q-container" id="questions-wrapper"></div>
        </div>
    </div>

    <script>
        // BASE DE DATOS (106 Preguntas)
        const fullDB = [
            { id: 1, q: "1) En el mecanismo de se√±alizaci√≥n de la hormona del crecimiento, la uni√≥n a su receptor produce:", o: ["Que se acople a prote√≠na G", "Activaci√≥n v√≠a JAK2/STAT 5", "Liberaci√≥n de AMPc", "Activaci√≥n de fosfolipasa C"], c: 1 },
            { id: 2, q: "2) Los enlaces Œ±(1-6) del almid√≥n son hidrolizados por:", o: ["Amilasa", "Glucosidasa", "Lactasa", "Isomaltasa", "Endosacaridasa"], c: 3 },
            { id: 3, q: "3) En relaci√≥n con las disacaridasas, se√±ale la respuesta correcta:", o: ["El producto final de su acci√≥n catal√≠tica es siempre glucosa", "No tienen especificidad de sustrato", "Su centro catal√≠tico se sit√∫a hacia el interior del epitelio intestinal", "No est√°n ligadas a la membrana del epitelio intestinal", "Son todas inducibles excepto la lactasa"], c: 4 },
            { id: 4, q: "4) Con respecto a la digesti√≥n de los l√≠pidos, se√±alar la respuesta incorrecta:", o: ["Los triglic√©ridos procedentes de la dieta pasan al sistema circulatorio como VLDL", "Los triglic√©ridos procedentes de la dieta pasan al sistema circulatorio como quilomicrones", "Las micelas est√°n formadas por sales biliares, lipasa pancre√°tica y triglic√©ridos", "La lipasa pancre√°tica produce la hidr√≥lisis de los triglic√©ridos en las micelas", "En los enterocitos se produce la res√≠ntesis de triglic√©ridos a partir de √°cidos grasos y glicerol"], c: 0 },
            { id: 5, q: "5) En relaci√≥n con las lipoprote√≠nas, se√±ale la respuesta correcta:", o: ["Las HDL transportan colesterol desde el h√≠gado a los tejidos", "Los quilomicrones transportan colesterol", "Las LDL transportan grasa ex√≥gena", "Las VLDL transportan grasa end√≥gena", "Los quilomicrones transportan grasa end√≥gena"], c: 3 },
            { id: 6, q: "6) Con respecto a la digesti√≥n de prote√≠nas, se√±alar la respuesta correcta:", o: ["Los pepsin√≥genos se activan con el pH alcalino del est√≥mago", "El resultado de la fase g√°strica de la digesti√≥n de prote√≠nas son todos amino√°cidos libres", "La absorci√≥n de amino√°cidos tiene lugar en el est√≥mago", "Los oligop√©ptidos se absorben en el est√≥mago", "El HCl del est√≥mago produce la desnaturalizaci√≥n de las prote√≠nas"], c: 4 },
            { id: 7, q: "7) ¬øQu√© mol√©cula se libera junto a la insulina de forma equimolecular por c√©lulas beta del p√°ncreas endocrino?", o: ["Polip√©ptido pancre√°tico", "Glucag√≥n", "Amilina", "P√©ptido C"], c: 3 },
            { id: 8, q: "8) ¬øCu√°l es la respuesta correcta en relaci√≥n a los efectos de la malnutrici√≥n proteico-cal√≥rica?", o: ["Aumenta el transporte de glucosa", "Disminuye la actividad Na‚Å∫/K‚Å∫-ATPasa", "Aumenta la actividad Na‚Å∫/K‚Å∫-ATPasa", "Aumenta la actividad de la enzima lipoprote√≠n-lipasa"], c: 1 },
            { id: 9, q: "9) Determinante m√°s importante del gasto energ√©tico:", o: ["Actividad f√≠sica", "Temperatura ambiental", "Cantidad de agua ingerida", "Calidad del sue√±o"], c: 0 },
            { id: 10, q: "10) Estructura de la vitamina E:", o: ["Pirimidina", "Indol", "Cromano", "Purina"], c: 2 },
            { id: 11, q: "11) Transportador del ascorbato de la luz intestinal al enterocito:", o: ["GLUT5", "SGLT2", "MCT1", "SVCT1 dependiente de sodio"], c: 3 },
            { id: 12, q: "12) Transportador del todo-trans-retinal:", o: ["Hemoglobina", "Transtirretina", "Ceruloplasmina", "Alb√∫mina"], c: 3 },
            { id: 13, q: "13) Valor biol√≥gico de las prote√≠nas:", o: ["Nitr√≥geno retenido / nitr√≥geno absorbido", "Nitr√≥geno excretado / nitr√≥geno ingerido", "Energ√≠a total / energ√≠a excretada", "Amino√°cidos esenciales / amino√°cidos no esenciales"], c: 0 },
            { id: 14, q: "14) PG proinflamatorias:", o: ["PGI3", "PGD1", "PGE1", "PG2"], c: 3 },
            { id: 15, q: "15) Actuaci√≥n vitamina A:", o: ["Gen√≥mica", "Osm√≥tica", "Enzim√°tica directa", "Electrol√≠tica"], c: 0 },
            { id: 16, q: "16) La ingesta diaria que se considera adecuada para cubrir las necesidades de la mitad de los individuos sanos:", o: ["L√≠mite Superior Tolerable", "Ingesta Diaria Recomendada", "Requerimiento Promedio Estimado", "Valor Energ√©tico Total"], c: 2 },
            { id: 17, q: "17) Se√±ala la verdadera:", o: ["La lactasa hidroliza enlaces beta 1-4 de la sacarosa", "La maltasa hidroliza enlaces beta 1-6 del gluc√≥geno", "La amilasa salival hidroliza enlaces beta 1-4 del almid√≥n", "La isomaltasa (dextrinasa) hidroliza enlaces alfa 1-6 del almid√≥n"], c: 3 },
            { id: 18, q: "18) Se√±ala la falsa:", o: ["Las disacaridasas hidrolizan disac√°ridos en monosac√°ridos", "Las disacaridasas permiten a los disac√°ridos pasar de la luz intestinal al enterocito", "Los monosac√°ridos resultantes son absorbidos por transportadores espec√≠ficos", "La lactasa hidroliza lactosa"], c: 1 },
            { id: 19, q: "19) ¬øC√≥mo sale la glucosa del enterocito a la sangre?", o: ["GLUT2", "SGLT1", "GLUT4", "Na‚Å∫/K‚Å∫-ATPasa"], c: 0 },
            { id: 20, q: "20) Elige la correcta:", o: ["Los monosac√°ridos inhiben la secreci√≥n de gastrina", "Los √°cidos grasos libres estimulan la secreci√≥n de insulina directamente", "Los oligop√©ptidos de la digesti√≥n g√°strica estimulan la secreci√≥n de CCK por c√©lulas endocrinas duodenales", "La secretina se libera por presencia de almidones"], c: 2 },
            { id: 21, q: "21) Se√±ala la falsa:", o: ["La tripsina es una endopeptidasa", "La pepsina es exopeptidasa", "La quimotripsina hidroliza enlaces internos", "Las carboxipeptidasas son exopeptidasas"], c: 1 },
            { id: 22, q: "22) En el ciclo de Meister (Œ≥-glutamilo):", o: ["La GGT descompone glutamato en amon√≠aco", "La Œ≥-glutamilciste√≠na se forma directamente de glutamato y glicina", "La GGT transfiere el Œ≥-glutamilo a amino√°cidos √°cidos", "La GGT cataliza la transferencia del Œ≥-glutamilo a amino√°cidos neutros"], c: 3 },
            { id: 23, q: "23) Presenta prote√≠na desacoplante:", o: ["M√∫sculo esquel√©tico", "H√≠gado", "Tejido adiposo blanco", "Tejido adiposo marr√≥n"], c: 3 },
            { id: 24, q: "24) Elige la verdadera:", o: ["Resistina s√©rica aumenta con obesidad", "Adiponectina s√©rica aumenta con obesidad", "Leptina disminuye con aumento de tejido adiposo", "Resistina no est√° relacionada con tejido adiposo"], c: 0 },
            { id: 25, q: "25) Se√±ala la falsa:", o: ["MHC I presenta p√©ptidos end√≥genos a CD8+", "MHC II presenta p√©ptidos ex√≥genos a CD4+", "MHC I presenta motivos ITAM", "MHC I en la mayor√≠a de c√©lulas nucleadas"], c: 2 },
            { id: 26, q: "26) Se√±ala la falsa:", o: ["TEXs pueden modular respuesta inmune", "TEXs transportan mol√©culas bioactivas", "TEXs participan en comunicaci√≥n intercelular", "TEXs inducen proliferaci√≥n de linfocitos T"], c: 3 },
            { id: 27, q: "27) En relaci√≥n con el cromosoma de Philadelphia, se√±ala la incorrecta:", o: ["BCR-ABL produce tirosina quinasa constitutivamente activa", "La prote√≠na BCR es una kinasa hiperactiva", "t(9;22) da lugar al cromosoma de Philadelphia", "BCR-ABL implicada en LMC"], c: 1 },
            { id: 28, q: "28) Se√±ala la falsa:", o: ["P53 induce genes supresores tumorales", "P53 activa P18", "P53 puede causar arresto del ciclo", "P53 est√° implicada en apoptosis"], c: 1 },
            { id: 29, q: "29) Receptor m√°s activo de la somatostatina:", o: ["STT1", "STT5", "STT2", "STT4"], c: 2 },
            { id: 30, q: "30) V√≠a de se√±alizaci√≥n de somatocrinina:", o: ["AMPc y fosfolipasa A2", "Tirosina quinasa del receptor", "JAK/STAT", "Adenilato ciclasa y calcio-calmodulina"], c: 3 },
            { id: 31, q: "31) V√≠a de se√±alizaci√≥n de IGF-1:", o: ["Receptor acoplado a prote√≠na G", "JAK/STAT", "Tirosina kinasa", "Canal i√≥nico voltaje-dependiente"], c: 2 },
            { id: 32, q: "32) Si hay niveles elevados de TSH, ¬øqu√© cabr√≠a esperar de las hormonas tiroideas?", o: ["Niveles normales", "Niveles bajos", "Niveles altos", "Variabilidad extrema sin patr√≥n definido"], c: 1 },
            { id: 33, q: "33) ¬øC√≥mo pasa el yodo de la c√©lula tiroidea al coloide?", o: ["Pendrina", "Tiroglobulina", "NIS (simportador Na‚Å∫-I‚Åª)", "Tiroxina"], c: 0 },
            { id: 34, q: "34) ¬øPor qu√© la glucosa es mediador para la liberaci√≥n de insulina?", o: ["Bloquea canales de calcio", "Disminuye potasio intracelular", "Inhibe s√≠ntesis nuclear de insulina", "Aumenta metabolismo e incrementa cociente ATP/ADP"], c: 3 },
            { id: 35, q: "35) Elige la incorrecta:", o: ["Rodopsina est√° en bastones", "Rodopsina se activa al absorber un fot√≥n", "Rodopsina formada por opsina y todo-trans-retinal", "Cambio conformacional del retinal activa la transducci√≥n visual"], c: 2 },
            { id: 36, q: "36) ¬øCu√°l de los siguientes pasos (s√≠ntesis del hemo) se realiza en el citosol?", o: ["Succinil-CoA + glicina ‚Üí ALA", "ALA ‚Üí porfobilin√≥geno", "Inserci√≥n de hierro en protoporfirina IX", "Formaci√≥n de protoporfirina IX desde coproporfirin√≥geno III"], c: 1 },
            { id: 37, q: "37) ¬øQu√© hace que se separe la opsina del todo-trans-retinal?", o: ["Arrestina", "Fosfodiesterasa", "Transducina", "Guanilato ciclasa"], c: 2 },
            { id: 38, q: "38) ¬øCu√°l NO participa en la recuperaci√≥n de vitamina E?", o: ["√Åcido f√≥lico", "Lipoato / ubiquinol", "Glutati√≥n", "Vitamina C"], c: 0 },
            { id: 39, q: "39) ¬øCu√°l NO participa en el metabolismo del grupo hemo?", o: ["ALA sintetasa", "Porfobilin√≥geno desaminasa", "Glicoprote√≠na √°cida", "Ferroquelatasa"], c: 2 },
            { id: 40, q: "40) En la degradaci√≥n del grupo hemo:", o: ["Hemo oxigenasa convierte hemo en biliverdina", "Biliverdina ‚Üí bilirrubina por biliverdina reductasa", "Tras hem√≥lisis, cadenas Œ≤ de haptoglobina se unen a cadenas Œ± del grupo hemo", "Haptoglobina transporta hemoglobina libre"], c: 3 },
            { id: 41, q: "41) ¬øQu√© enzima necesita THB (BH4) como coenzima?", o: ["Fenilalanina hidroxilasa / tript√≥fano hidroxilasa", "Transaminasa", "Piruvato deshidrogenasa", "Gluc√≥geno fosforilasa"], c: 0 },
            { id: 42, q: "42) ¬øQu√© enzima cataliza dopamina ‚Üí noradrenalina?", o: ["Monoamino oxidasa", "Tirosina hidroxilasa", "Feniletanolamina N-metiltransferasa", "Dopamina Œ≤-hidroxilasa"], c: 3 },
            { id: 43, q: "43) ¬øQu√© neurotransmisor NO tiene transportador recaptador descrito?", o: ["Dopamina", "Acetilcolina / histamina", "Serotonina", "Noradrenalina"], c: 1 },
            { id: 44, q: "44) ¬øQu√© precursores emplean las c√©lulas para la s√≠ntesis de glutamato?", o: ["Acetil-CoA y piruvato", "Œ±-cetoglutarato y glutamina", "Oxaloacetato y aspartato", "Succinil-CoA y GABA"], c: 1 },
            { id: 45, q: "45) Enzima de s√≠ntesis del GABA:", o: ["Glutamato descarboxilasa", "Glutaminasa", "GABA transaminasa", "Glutamato deshidrogenasa"], c: 0 },
            { id: 46, q: "46) Elige la falsa:", o: ["Serotonina se sintetiza a partir de tript√≥fano", "MAO degrada serotonina", "Producto de degradaci√≥n: 5-HIAA", "Principal metabolito: 5-HIAA"], c: 3 },
            { id: 47, q: "47) Elige lo correcto (precursor‚ÄìNT) de neurotransmisores inhibitorios:", o: ["Glutamato‚Äìdopamina", "Serina‚Äìglicina", "Acetilcolina‚Äìnoradrenalina", "Aspartato‚Äìhistamina"], c: 1 },
            { id: 48, q: "48) Principal protector de la lipoperoxidaci√≥n externa:", o: ["Vitamina E", "Vitamina C", "Glutati√≥n peroxidasa", "Super√≥xido dismutasa"], c: 0 },
            { id: 49, q: "49) Factores de coagulaci√≥n derivados de vitamina K:", o: ["1, 3, 5 y 8", "4, 6, 11 y 12", "5, 7, 8 y 9", "2, 7, 9 y 10"], c: 3 },
            { id: 50, q: "50) Elige la falsa (gr√°nulos plaquetarios):", o: ["Gr√°nulos densos contienen factor von Willebrand", "Gr√°nulos alfa contienen factor von Willebrand", "Gr√°nulos densos almacenan ADP y calcio", "Gr√°nulos alfa contienen factor plaquetario 4"], c: 0 },
            { id: 51, q: "51) Elige la falsa (PCR):", o: ["Usa primers espec√≠ficos", "Obtenci√≥n de copias linealmente", "Desnaturalizaci√≥n ~94‚Äì95 ¬∫C", "Requiere polimerasa termoestable (Taq)"], c: 1 },
            { id: 52, q: "52) El latirismo se produce por deficiencia de:", o: ["Prolil hidroxilasa", "Lisil oxidasa", "Colagenasa", "Elastasa"], c: 1 },
            { id: 53, q: "53) Elige la incorrecta respecto a s√≠ntesis de col√°geno:", o: ["Hidroxilaci√≥n de prolina requiere vitamina C", "Prolil hidroxilasa hidroxila prolina", "S√≠ntesis comienza en RER", "O-glucosilaci√≥n por adici√≥n de gl√∫cidos a hidroxiprolina"], c: 3 },
            { id: 54, q: "54) ¬øQu√© mol√©cula convierte fibrin√≥geno en fibrina?", o: ["Trombina", "Plasmina", "Protrombina", "Factor XIII"], c: 0 },
            { id: 55, q: "55) ¬øCu√°l es falsa respecto a h√≠gado fibr√≥tico?", o: ["Activaci√≥n de c√©lulas estrelladas", "Dep√≥sito col√°geno I y III en espacio de Disse", "Acumulaci√≥n de amonio", "Alteraci√≥n arquitectura hep√°tica normal"], c: 2 },
            { id: 56, q: "56) Tejido adiposo marr√≥n:", o: ["Carece de mitocondrias", "Se forma por sobreexpresi√≥n de EBF2", "Almacena l√≠pidos en una √∫nica gota grande", "No expresa UCP-1"], c: 1 },
            { id: 57, q: "57) Filamento grueso sarc√≥mero (verdadera):", o: ["Papa√≠na ‚Üí meromiosina ligera y pesada", "Tripsina ‚Üí dos meromiosinas pesadas", "Papa√≠na ‚Üí dos meromiosinas ligeras", "Se llama actomiosina", "Tripsina ‚Üí meromiosina ligera y pesada"], c: 4 },
            { id: 58, q: "58) Ecuaci√≥n de Weir (incorrecta):", o: ["Incluye factor actividad f√≠sica", "Requiere producci√≥n de CO", "Necesita consumo de ox√≠geno", "Tiene en cuenta nitr√≥geno excretado"], c: 1 },
            { id: 59, q: "59) Formaci√≥n de √°cido retinoico (correcta):", o: ["Del retinol por oxidaci√≥n reversible intestinal", "Oxidaci√≥n reversible de beta carotenos por aldeh√≠do oxidasa", "Oxidaci√≥n irreversible del retinal por aldeh√≠do deshidrogenasa", "Reducci√≥n espont√°nea por bacterias intestinales"], c: 2 },
            { id: 60, q: "60) Receptores del √°cido retinoico:", o: ["Receptores nucleares", "Activan fosfolipasa C", "Receptores de superficie acoplados a prote√≠na G", "Receptores de superficie con actividad tiros√≠n kinasa"], c: 0 },
            { id: 61, q: "61) Beneficios cardiovasculares de monoinsaturados:", o: ["Bloquean absorci√≥n intestinal de colesterol", "Favorecen formaci√≥n de VLDL", "‚Üë HDL y ‚Üì LDL", "‚Üì HDL y ‚Üë LDL"], c: 2 },
            { id: 62, q: "62) Caquexia neopl√°sica: tejidos con mayor desgaste:", o: ["Ri√±√≥n y suprarrenales", "M√∫sculo y tejido adiposo", "H√≠gado y cerebro", "Exclusivamente cerebro"], c: 1 },
            { id: 63, q: "63) Lactasa escinde lactosa en:", o: ["Dos galactosas", "Galactosa y fructosa", "Galactosa y glucosa", "Fructosa y glucosa"], c: 2 },
            { id: 64, q: "64) Œ±-amilasa (incorrecta):", o: ["Se produce en gl√°ndulas salivares", "Hidroliza Œ±(1-4) internos", "Hidroliza Œ±(1-6)", "Produce maltosa, maltotriosa y Œ±-dextrina"], c: 2 },
            { id: 65, q: "65) Digesti√≥n l√≠pidos (incorrecta):", o: ["Micelas: sales biliares, lipasa pancre√°tica y triglic√©ridos", "TG dieta pasan como VLDL", "TG dieta pasan como quilomicrones", "Lipasa pancre√°tica hidroliza TG en micelas"], c: 1 },
            { id: 66, q: "66) Quilomicrones (correcta):", o: ["Transporte inverso colesterol", "Transporte grasa ex√≥gena", "Apo caracter√≠stica: ApoB100", "Asociaci√≥n TG y sales biliares"], c: 1 },
            { id: 67, q: "67) Œ≥-glutamiltranspeptidasa (correcta):", o: ["Aceptores principales son √°cidos", "Transfiere ciste√≠na del glutati√≥n", "Transfiere Œ≥-glutamil del glutati√≥n", "Transfiere glicina del glutati√≥n"], c: 2 },
            { id: 68, q: "68) Fase final digesti√≥n prote√≠nas (incorrecta):", o: ["Carboxipeptidasas de membrana ‚Üí di/trip√©ptidos", "Peptidasas intracelulares ‚Üí amino√°cidos", "Pueden entrar dip√©ptidos", "Aminopeptidasas de membrana ‚Üí di/trip√©ptidos"], c: 0 },
            { id: 69, q: "69) ¬øPor qu√© el tejido adiposo pardo regula termog√©nesis?", o: ["Prote√≠na desacoplante mitocondrial", "Mayor actividad complejo I", "Factor miog√©nico Myf5", "Aumentada fosforilaci√≥n oxidativa"], c: 0 },
            { id: 70, q: "70) Adiponectina (incorrecta):", o: ["Favorece GLUT-4", "Favorece entrada glucosa al m√∫sculo", "Aumenta gluconeog√©nesis hep√°tica", "Disminuye producci√≥n de glucosa hep√°tica"], c: 2 },
            { id: 71, q: "71) No forma parte del sistema inmune innato:", o: ["Anticuerpos", "Macr√≥fagos", "Neutr√≥filos", "Linfocitos"], c: 0 },
            { id: 72, q: "72) CD3 y Œ∂ (ITAM): ¬øqu√© otra estructura tambi√©n tiene ITAM?", o: ["MHC I", "BCR", "MHC II", "IgD"], c: 1 },
            { id: 73, q: "73) Hormona de crecimiento (incorrecta):", o: ["Puede actuar directamente", "Favorece IGF-1", "Se une a prote√≠nas transportadoras", "No puede ejercer acci√≥n directa sobre tejidos diana"], c: 3 },
            { id: 74, q: "74) Se√±alizaci√≥n somatostatina (correcta):", o: ["Receptores nucleares", "Prote√≠na G activadora", "Descenso de AMPc", "‚Üë Ca¬≤‚Å∫ intracelular"], c: 2 },
            { id: 75, q: "75) Pregnenolona ‚Üí 17-OH pregnenolona (enzima):", o: ["3Œ≤-HSD", "17,20-liasa/desmolasa", "17Œ±-hidroxilasa", "17Œ≤-HSD"], c: 2 },
            { id: 76, q: "76) 11-desoxicorticosterona ‚Üí corticosterona (enzima):", o: ["21Œ±-hidroxilasa", "3Œ≤-HSD", "11Œ≤-hidroxilasa", "11Œ±-hidroxilasa"], c: 2 },
            { id: 77, q: "77) Se√±alizaci√≥n TRH (correcta):", o: ["JAK/STAT", "Adenilato ciclasa", "Liberaci√≥n Ca¬≤‚Å∫ intracelular", "Receptor nuclear"], c: 2 },
            { id: 78, q: "78) Se√±alizaci√≥n TSH:", o: ["Inhibe fosfatidilinositol", "Disminuye AMPc", "Receptor tiros√≠n kinasa", "Estimula adenilato ciclasa"], c: 3 },
            { id: 79, q: "79) Se√±alizaci√≥n insulina (cierto):", o: ["Fosforila adenilatociclasa", "Desfosforila prote√≠na fosfatasa 1", "Fosforila prote√≠na fosfatasa 1", "Desfosforila adenilato ciclasa"], c: 2 },
            { id: 80, q: "80) Hormona GI que facilita secreci√≥n de bicarbonato:", o: ["Bombesina", "Secretina", "CCK", "Gastrina"], c: 1 },
            { id: 81, q: "81) Crecimiento celular (incorrecta):", o: ["‚Üë Ca¬≤‚Å∫ intracelular", "Reorganiza actina", "Activa factores transcripci√≥n", "‚Üë H‚Å∫ intracelular"], c: 3 },
            { id: 82, q: "82) No es segundo mensajero:", o: ["AMPc", "GMPc", "ATP", "Inositol 3P"], c: 2 },
            { id: 83, q: "83) Cascada fotorrecepci√≥n:", o: ["Rodopsina ‚Üí metarrodopsina III (activa)", "Se cierran canales de sodio", "‚Üë AMPc citoplasm√°tico", "11-cis-retinal no cambia"], c: 1 },
            { id: 84, q: "84) Rodopsina se localiza:", o: ["Segmento interno", "Mitocondrias del segmento interno", "Segmento externo", "Cilio de uni√≥n"], c: 2 },
            { id: 85, q: "85) BH4/THB (incorrecta):", o: ["Se sintetiza desde GTP", "Primera enzima: GTP ciclohidrolasa I", "Coenzima de descarboxilasas de AA arom√°ticos", "√öltimo paso: sepiapterina reductasa"], c: 2 },
            { id: 86, q: "86) L-DOPA ‚Üí dopamina (enzima):", o: ["DOPA descarboxilasa", "Tirosina descarboxilasa", "Dopamina sintetasa", "Dopamina Œ≤-hidroxilasa"], c: 0 },
            { id: 87, q: "87) S√≠ntesis de GABA (enzima):", o: ["Glutamato descarboxilasa", "GABA hidroxilasa", "GABA sintetasa", "Glutamato deshidrogenasa"], c: 0 },
            { id: 88, q: "88) Acetilcolina (incorrecta):", o: ["Acetil-CoA viene de descarboxilaci√≥n piruvato", "Colina entra por ChT dependiente de Na‚Å∫", "Catabolismo ocurre dentro de c√©lula colin√©rgica tras recaptaci√≥n", "Se introduce en ves√≠culas por VAChT"], c: 2 },
            { id: 89, q: "89) Enfermedad de Wilson se relaciona con:", o: ["Deficiencia de haptoglobina", "Deficiencia de ceruloplasmina", "Deficiencia de prealb√∫mina", "Deficiencia de macroglobulina"], c: 1 },
            { id: 90, q: "90) No es una Œ±-globulina:", o: ["Haptoglobina", "Alb√∫mina", "Macroglobulina", "Glicoprote√≠na √°cida"], c: 1 },
            { id: 91, q: "91) Enzima que cataliza s√≠ntesis de uroporfirin√≥geno III:", o: ["Uroporfirin√≥geno quelatasa", "Porfobilin√≥geno desaminasa", "Coproporfirin√≥geno oxidasa", "Uroporfirin√≥geno decarboxilasa"], c: 0 },
            { id: 92, q: "92) S√≠ntesis de coproporfirin√≥geno III se produce por:", o: ["Descarboxilaci√≥n acetato del uroporfirin√≥geno IX", "Oxidaci√≥n propionato del uroporfirin√≥geno III", "Descarboxilaci√≥n acetato del uroporfirin√≥geno III", "Oxidaci√≥n acetato del uroporfirin√≥geno III"], c: 2 },
            { id: 93, q: "93) Precursor de 2,3-BPG en hemat√≠e:", o: ["Gliceraldeh√≠do 3-fosfato", "1,3-bifosfoglicerato", "Fosfato de dihidroxiacetona", "3-fosfoglicerato"], c: 1 },
            { id: 94, q: "94) Valores normales pO‚ÇÇ arterial:", o: ["40‚Äì75 mmHg", "80‚Äì105 mmHg", "35‚Äì45 mmHg", "120‚Äì140 mmHg"], c: 1 },
            { id: 95, q: "95) Inhibidor de fibrin√≥lisis:", o: ["Urocinasa", "Œ±2-macroglobulina", "Estreptocinasa", "Plasmin√≥geno"], c: 1 },
            { id: 96, q: "96) Prostaciclina (incorrecta):", o: ["Potente vasoconstrictor", "Inhibe agregaci√≥n plaquetaria", "Favorece efecto antitromb√≥tico endotelial", "Potente vasodilatador"], c: 0 },
            { id: 97, q: "97) Antioxidantes (incorrecta):", o: ["Glutati√≥n reductasa usa NADPH para reducir glutati√≥n", "Antioxidante protege de oxidaci√≥n", "SOD tipo 1 (Cu/Zn-SOD) est√° en mitocondrias", "Antioxidantes enzim√°ticos: SOD, catalasa, GPx"], c: 2 },
            { id: 98, q: "98) SOD (correcta):", o: ["SOD1 en mitocondria", "SOD2 tiene manganeso", "SOD1 y SOD3 tienen magnesio", "SOD2 extracelular"], c: 1 },
            { id: 99, q: "99) ¬øQu√© se produce en fase absortiva?", o: ["Producci√≥n de glucosa periportal", "Captaci√≥n de glucosa periportal", "Producci√≥n glucosa perivenosa", "Captaci√≥n glucosa perivenosa"], c: 3 },
            { id: 100, q: "100) Hepatocitos periportales/perivenosos (correcta):", o: ["Periportales cetog√©nicos", "Periportales glucol√≠ticos", "Periportales metabolismo oxidativo", "Perivenosos metabolismo oxidativo"], c: 2 },
            { id: 101, q: "101) Alteraci√≥n potencial redox (NADH/NAD) por alcohol (cierta):", o: ["Hiperglucemia", "Lactato ‚Üí piruvato", "Ac√∫mulo piruvato", "Ac√∫mulo √°cido l√°ctico (acidosis)"], c: 3 },
            { id: 102, q: "102) Acetato por ingesta de alcohol (correcta):", o: ["Act√∫a sobre factores de transcripci√≥n", "Entra en ciclo de Krebs", "Se acumula como acetato", "Se acumula como acetil-CoA"], c: 3 },
            { id: 103, q: "103) S√≠ntesis de col√°geno (incorrecta):", o: ["Disulfuro isomerasa forma puentes disulfuro N y C", "O-glucosilaciones en 5-hidroxilisina", "Se hidroxilan glicina y ciste√≠na", "Triple h√©lice comienza por extremo C-terminal"], c: 2 },
            { id: 104, q: "104) Col√°geno (correcta):", o: ["Oligosac√°ridos se unen a 5-hidroxilisina", "Hidroxilaci√≥n en glicina", "Secuencia repetida: glicina-alanina-glicina", "Uni√≥n oligosac√°ridos extracelular"], c: 0 },
            { id: 105, q: "105) Aldosterona act√∫a en nefrona a nivel de:", o: ["Asa ascendente de Henle", "T√∫bulo colector", "T√∫bulo contorneado distal", "T√∫bulo contorneado proximal"], c: 1 },
            { id: 106, q: "106) Mayor reabsorci√≥n de sodio:", o: ["T√∫bulo contorneado distal", "T√∫bulo colector", "Asa descendente de Henle", "T√∫bulo contorneado proximal"], c: 3 }
        ];

        let currentQuestions = [];
        let userState = {};
        let timerInterval;
        let seconds = 0;

        function initQuiz() {
            document.getElementById('start-screen').style.display = 'none';
            const shuffleQ = document.getElementById('shuffle-questions').checked;
            const useTimer = document.getElementById('timer-check').checked;

            currentQuestions = JSON.parse(JSON.stringify(fullDB));

            if (shuffleQ) {
                currentQuestions.sort(() => Math.random() - 0.5);
            }

            userState = {};
            renderSidebar();
            renderQuestions();

            if (useTimer) {
                document.getElementById('timer').style.display = 'block';
                timerInterval = setInterval(() => {
                    seconds++;
                    let m = Math.floor(seconds / 60).toString().padStart(2, '0');
                    let s = (seconds % 60).toString().padStart(2, '0');
                    document.getElementById('timer').innerText = `${m}:${s}`;
                }, 1000);
            }
        }

        function renderSidebar() {
            const grid = document.getElementById('nav-grid');
            grid.innerHTML = '';
            
            currentQuestions.forEach((q, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.innerText = index + 1;
                btn.onclick = () => scrollToQ(index);
                btn.id = `nav-${index}`;
                grid.appendChild(btn);
            });
            updateProgress();
        }

        function renderQuestions() {
            const container = document.getElementById('questions-wrapper');
            container.innerHTML = '';

            currentQuestions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'q-card';
                card.id = `card-${index}`;

                card.innerHTML = `
                    <div class="q-meta">
                        <span>Pregunta ${index + 1}</span>
                        <span>#${q.id}</span>
                    </div>
                    <div class="q-text">${q.q}</div>
                `;

                let options = q.o.map((text, i) => ({ text, originalIndex: i }));
                options.sort(() => Math.random() - 0.5);

                const optContainer = document.createElement('div');
                
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'opt-btn';
                    btn.innerText = opt.text;
                    btn.onclick = () => handleAnswer(index, opt.originalIndex, btn, options, q.c);
                    optContainer.appendChild(btn);
                });
                card.appendChild(optContainer);

                const fb = document.createElement('div');
                fb.className = 'feedback';
                fb.id = `fb-${index}`;
                fb.innerHTML = `<strong>Respuesta Correcta:</strong> ${q.o[q.c]}`;
                card.appendChild(fb);

                const tools = document.createElement('div');
                tools.className = 'tools';
                tools.innerHTML = `
                    <label class="mark-label">
                        <input type="checkbox" onchange="toggleMark(${index}, this.checked)">
                        Marcar para revisar
                    </label>
                `;
                card.appendChild(tools);

                container.appendChild(card);
            });
        }

        function handleAnswer(qIndex, selectedOriginalIndex, btnElement, shuffledOptions, correctIndex) {
            if (userState[qIndex] && userState[qIndex].answered) return;

            const isCorrect = selectedOriginalIndex === correctIndex;
            if (!userState[qIndex]) userState[qIndex] = {};
            userState[qIndex].answered = true;
            userState[qIndex].correct = isCorrect;

            if (isCorrect) {
                btnElement.classList.add('correct');
            } else {
                btnElement.classList.add('wrong');
                const siblings = btnElement.parentElement.children;
                for (let sib of siblings) {
                    if (sib.innerText === fullDB.find(x => x.id === currentQuestions[qIndex].id).o[correctIndex]) {
                        sib.classList.add('correct');
                    }
                }
            }

            const siblings = btnElement.parentElement.children;
            for (let sib of siblings) sib.disabled = true;

            document.getElementById(`fb-${qIndex}`).style.display = 'block';
            const navBtn = document.getElementById(`nav-${qIndex}`);
            navBtn.classList.add(isCorrect ? 'correct' : 'wrong');
            updateProgress();
        }

        function toggleMark(qIndex, isChecked) {
            if (!userState[qIndex]) userState[qIndex] = {};
            userState[qIndex].marked = isChecked;
            const navBtn = document.getElementById(`nav-${qIndex}`);
            if (isChecked) navBtn.classList.add('marked');
            else navBtn.classList.remove('marked');
        }

        function scrollToQ(index) {
            document.getElementById(`card-${index}`).scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.querySelectorAll('.q-card').forEach(c => c.classList.remove('current'));
            document.getElementById(`card-${index}`).classList.add('current');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`nav-${index}`).classList.add('active');
        }

        function updateProgress() {
            const answeredCount = Object.values(userState).filter(s => s.answered).length;
            document.getElementById('prog-text').innerText = `${answeredCount} / ${currentQuestions.length}`;
        }

        function finish() {
            clearInterval(timerInterval);
            let correct = 0, wrong = 0, marked = 0;
            
            currentQuestions.forEach((q, i) => {
                const s = userState[i];
                if (s) {
                    if (s.answered) {
                        if (s.correct) correct++; else wrong++;
                    }
                    if (s.marked) marked++;
                }
            });

            const score = Math.round((correct / currentQuestions.length) * 100);
            document.getElementById('score').innerText = score + "%";
            document.getElementById('r-ok').innerText = correct;
            document.getElementById('r-ko').innerText = wrong;
            document.getElementById('r-mk').innerText = marked;
            document.getElementById('result-screen').style.display = 'flex';
        }

        function retry(mode) {
            let nextQuestions = [];

            if (mode === 'all') {
                nextQuestions = JSON.parse(JSON.stringify(fullDB));
            } else {
                nextQuestions = currentQuestions.filter((q, i) => {
                    const s = userState[i];
                    if (!s) return false;
                    if (mode === 'failed') return s.answered && !s.correct;
                    if (mode === 'marked') return s.marked;
                    if (mode === 'failed_marked') return (s.answered && !s.correct) || s.marked;
                    return false;
                });
            }

            if (nextQuestions.length === 0) {
                alert("No hay preguntas para esta selecci√≥n.");
                return;
            }

            currentQuestions = nextQuestions;
            userState = {};
            seconds = 0;
            document.getElementById('timer').innerText = "00:00";
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'none';
            renderSidebar();
            renderQuestions();
            if (document.getElementById('timer-check').checked) {
                timerInterval = setInterval(() => {
                    seconds++;
                    let m = Math.floor(seconds / 60).toString().padStart(2, '0');
                    let s = (seconds % 60).toString().padStart(2, '0');
                    document.getElementById('timer').innerText = `${m}:${s}`;
                }, 1000);
            }
        }
    </script>
</body>
</html>