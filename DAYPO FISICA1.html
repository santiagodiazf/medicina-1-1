<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Biomec√°nica y Elasticidad</title>
    <style>
        :root {
            --primary: #2563eb; /* Azul Royal */
            --primary-dark: #1e40af;
            --primary-light: #dbeafe;
            --bg: #f8fafc; /* Gris muy claro azulado */
            --text: #1e293b;
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 30px;
            font-size: 0.95em;
            font-weight: 500;
        }

        .question-card {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 6px solid var(--primary);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .question-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* --- Checkbox para Marcar --- */
        .mark-container {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: var(--primary);
            font-weight: bold;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 10px;
        }
        .mark-container input {
            margin-right: 8px;
            transform: scale(1.3);
            cursor: pointer;
            accent-color: var(--primary);
        }
        .mark-container label {
            cursor: pointer;
        }

        .question-header {
            font-size: 0.85em;
            color: #64748b;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }

        .question-text {
            font-weight: 700;
            font-size: 1.15em;
            margin-bottom: 20px;
            color: #0f172a;
            line-height: 1.5;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            background: #fff;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-size: 1em;
            color: #334155;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            background-color: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary-dark);
            transform: translateX(5px);
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.7;
        }

        /* Estados de respuesta */
        .correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #14532d !important;
            font-weight: 600;
        }

        .incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #7f1d1d !important;
        }

        /* Caja de Explicaci√≥n */
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #eff6ff;
            border-left: 5px solid var(--primary);
            border-radius: 6px;
            display: none;
            font-size: 0.95em;
            color: #1e3a8a;
            animation: slideDown 0.3s ease-out;
        }
        .explanation.visible {
            display: block;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- √Årea de Controles --- */
        #controls-area {
            margin-top: 50px;
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
            border-top: 5px solid var(--primary);
        }

        .action-btn {
            background: var(--primary); color: white; border: none;
            padding: 12px 25px; font-size: 1.05em; border-radius: 8px;
            cursor: pointer; margin: 8px;
            transition: background 0.3s, transform 0.2s;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .action-btn:hover { 
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .restart-options {
            display: none;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        .restart-options button {
            width: 100%;
            background: #475569;
        }
        .restart-options button:hover { background: #334155; }
        .restart-options button:first-child { background: var(--primary); }
        .restart-options button:first-child:hover { background: var(--primary-dark); }

    </style>
</head>
<body>

    <h1>Test Biomec√°nica y Elasticidad</h1>
    <p class="subtitle">FM Shark Crew | Modo Estudio Avanzado</p>
    
    <div id="quiz-container"></div>

    <div id="controls-area">
        <button id="finish-btn" class="action-btn" onclick="showEndOptions()">üèÅ Finalizar revisi√≥n</button>
        
        <div id="restart-menu" class="restart-options">
            <h3>Resultados de la sesi√≥n</h3>
            <p id="stats-summary"></p>
            <button class="action-btn" onclick="restartQuiz('all')">üîÑ Rehacer todo el test</button>
            <button class="action-btn" onclick="restartQuiz('marked')">üîñ Repasar marcadas</button>
            <button class="action-btn" onclick="restartQuiz('failed')">‚ùå Repasar falladas</button>
            <button class="action-btn" onclick="restartQuiz('failed_marked')">‚ö†Ô∏è Falladas + Marcadas</button>
        </div>
    </div>

<script>
    // Datos convertidos y adaptados del original.
    // Se han ajustado textos como "a y b" para que funcionen al mezclar opciones.
    const quizData = [
        { q: "La inversi√≥n postural o tracci√≥n de inversi√≥n produce:", opts: ["un giro del centro de gravedad.", "marea mucho.", "una translaci√≥n del centro de gravedad y una alineaci√≥n tridimensional vertebral.", "una translaci√≥n del centro de gravedad."], a: "una translaci√≥n del centro de gravedad y una alineaci√≥n tridimensional vertebral.", exp: "La inversi√≥n invierte la acci√≥n de la gravedad, descomprimiendo las v√©rtebras (alineaci√≥n) y desplazando el centro de gravedad corporal hacia la cabeza." },
        { q: "Una persona realiza un ejercicio isot√≥nico cuando:", opts: ["varia la tensi√≥n muscular y la longitud del m√∫sculo permanece constante.", "varia la longitud del m√∫sculo sin variar la tensi√≥n muscular.", "empuja un mueble.", "bebe mucha bebida isot√≥nica."], a: "varia la longitud del m√∫sculo sin variar la tensi√≥n muscular.", exp: "Isot√≥nico (iso=igual, t√≥nico=tensi√≥n) implica que el m√∫sculo se acorta o alarga (cambia longitud) manteniendo una tensi√≥n constante." },
        { q: "El uso de un bast√≥n para caminar tiene como objetivo:", opts: ["reducir la fuerza muscular sobre la cadera de la pierna enferma.", "reducir la fuerza muscular en la pierna sana.", "aumentar la fuerza muscular de la pierna sana.", "caminar sobre tres apoyos."], a: "reducir la fuerza muscular sobre la cadera de la pierna enferma.", exp: "Al usar el bast√≥n en el lado opuesto, se crea un momento de fuerza que reduce la necesidad de contracci√≥n de los abductores de la cadera enferma." },
        { q: "La suspensoterapia o inmovilizaci√≥n en suspensi√≥n de un miembro:", opts: ["aumenta el peso del miembro afectado.", "elimina la gravedad y los rozamientos.", "produce entumecimientos y calambres.", "induce a tensionar los m√∫sculos antag√≥nicos."], a: "elimina la gravedad y los rozamientos.", exp: "Al suspender el miembro, se contrarresta la fuerza de la gravedad, permitiendo movimientos sin fricci√≥n contra la superficie." },
        { q: "El l√≠mite de ruptura:", opts: ["es una consecuencia de la ley de Hooke.", "Todas son falsas.", "En general es distinto seg√∫n se trate de compresi√≥n o tracci√≥n.", "es una funci√≥n del modulo de Young."], a: "En general es distinto seg√∫n se trate de compresi√≥n o tracci√≥n.", exp: "Los materiales biol√≥gicos son anisotr√≥picos; el hueso resiste mucho m√°s a la compresi√≥n que a la tracci√≥n antes de romperse." },
        { q: "Los huesos del cuerpo al ser huecos se consigue:", opts: ["menos consumo de calcio.", "menos resistencia y mas agilidad.", "menor dificultad de eliminaci√≥n de fosfato en su eliminaci√≥n.", "menos peso a igual resistencia."], a: "menos peso a igual resistencia.", exp: "Mec√°nicamente, el material en el centro (eje neutro) apenas contribuye a la resistencia a la flexi√≥n. Al ser huecos maximizan la eficiencia." },
        { q: "Un material es menos deformable cuando:", opts: ["su modulo de Young es bajo.", "su modulo de Young es alto.", "s√≥lo depende de la naturaleza del material.", "su numero de Reynolds es bajo."], a: "su modulo de Young es alto.", exp: "El M√≥dulo de Young (E) mide la rigidez. Cuanto mayor es E, m√°s tensi√≥n se necesita para deformarlo." },
        { q: "El m√≥dulo de Young expresa:", opts: ["la capacidad de elasticidad de un cuerpo.", "la capacidad calor√≠fica de un cristal.", "la resistencia intermolecular.", "la energ√≠a total de las mol√©culas de un cristal."], a: "la capacidad de elasticidad de un cuerpo.", exp: "Es la constante de proporcionalidad entre el esfuerzo aplicado y la deformaci√≥n unitaria producida en la zona el√°stica." },
        { q: "El m√≥dulo de Young:", opts: ["es una funci√≥n de la temperatura.", "es una caracter√≠stica del material del cual esta hecho el cuerpo.", "Ninguna de las tres.", "es una funci√≥n de la fuerza que se realiza."], a: "es una caracter√≠stica del material del cual esta hecho el cuerpo.", exp: "Es una propiedad intr√≠nseca del material (acero, hueso, goma), independiente de la forma o tama√±o del objeto." },
        { q: "Cuando un hueso trabaja a flexi√≥n la deformaci√≥n ser√° menor si:", opts: ["menor momento flexor.", "mayor momento de inercia geom√©trica.", "Todas las opciones mencionadas son correctas.", "mayor modulo de Young."], a: "Todas las opciones mencionadas son correctas.", exp: "La deformaci√≥n disminuye si el material es m√°s r√≠gido (Young), si es m√°s grueso geom√©tricamente (Inercia) o si la carga es menor (Momento)." },
        { q: "Los huesos est√°n constituidos de:", opts: ["material compuesto de apatito y col√°geno.", "apatito (alto modulo de Young).", "col√°geno (bajo modulo de Young).", "calcio."], a: "material compuesto de apatito y col√°geno.", exp: "El hueso es un material 'composite' natural: hidroxiapatita (dureza) y col√°geno (flexibilidad)." },
        { q: "Los huesos presentan mayor limite de rotura al trabajar a:", opts: ["compresi√≥n.", "tracci√≥n.", "cizallamiento.", "flexi√≥n."], a: "compresi√≥n.", exp: "La estructura √≥sea est√° evolutivamente dise√±ada para soportar grandes cargas de peso (compresi√≥n)." },
        { q: "Los materiales el√°sticos son aquellos que:", opts: ["Se comportan pl√°sticamente.", "est√°n compuestos de elast√≥meros.", "ninguna de las anteriores.", "recuperan su forma original cuando se les deja de aplicar una fuerza."], a: "recuperan su forma original cuando se les deja de aplicar una fuerza.", exp: "La elasticidad es la propiedad f√≠sica de volver a la forma original una vez desaparece la fuerza deformante." },
        { q: "El momento de inercia (I), ¬øde que depende?", opts: ["de su geometr√≠a porque depende de lo alejada que est√© la masa de la fibra neutra.", "del modulo de Young.", "de la fuerza aplicada.", "del material del cuerpo."], a: "de su geometr√≠a porque depende de lo alejada que est√© la masa de la fibra neutra.", exp: "El momento de inercia es una propiedad geom√©trica que indica c√≥mo se distribuye la masa respecto a un eje." },
        { q: "Las fibras musculares se pueden considerar elast√≥meros, es decir:", opts: ["se cumple la ley de Hooke.", "Son materiales r√≠gidos.", "existe proporcionalidad entra la fuerza y la deformaci√≥n ejercida por ella.", "se deforman el√°sticamente."], a: "se deforman el√°sticamente.", exp: "Aunque se deforman el√°sticamente (vuelven a su forma), los tejidos biol√≥gicos blandos no suelen seguir la Ley de Hooke (no son lineales)." },
        { q: "La operaci√≥n isom√©trica de un m√∫sculo depende de:", opts: ["el m√∫sculo realiza una fuerza constante y var√≠a su longitud.", "El m√∫sculo realiza una fuerza pero este no sufre deformaci√≥n.", "El m√∫sculo no realiza fuerza.", "el m√∫sculo se contrae sin realizar fuerza."], a: "El m√∫sculo realiza una fuerza pero este no sufre deformaci√≥n.", exp: "Isom√©trico (igual medida): El m√∫sculo genera tensi√≥n pero no hay cambio visible en la longitud." },
        { q: "Los huesos son un ejemplo de material biol√≥gico:", opts: ["simple.", "compuesto.", "blando.", "duro."], a: "compuesto.", exp: "Es un material compuesto formado por una matriz org√°nica (col√°geno) y una inorg√°nica (minerales)." },
        { q: "El uso del bast√≥n tiene como misi√≥n (Repetida):", opts: ["aumentar la fuerza muscular en la pierna sana.", "reducir la fuerza muscular sobre la cadera de la pierna enferma.", "aumentar la fuerza muscular en la pierna enferma.", "reducir la fuerza muscular sobre la cadera de la pierna sana."], a: "reducir la fuerza muscular sobre la cadera de la pierna enferma.", exp: "Al descargar peso en el bast√≥n se reduce la carga y la fuerza muscular requerida en la cadera afectada." },
        { q: "¬øEn qu√© tipo de deformaci√≥n puede aparecer pandeo?", opts: ["torsi√≥n.", "cizalladura.", "compresi√≥n.", "tracci√≥n."], a: "compresi√≥n.", exp: "El pandeo es una inestabilidad el√°stica que ocurre en elementos esbeltos (columnas, huesos largos) sometidos a compresi√≥n." },
        { q: "Cuanto mayor es el modulo de Young (E) de un material:", opts: ["m√°s deformable.", "menos fr√°gil es.", "menos deformable es el material.", "m√°s fr√°gil es."], a: "menos deformable es el material.", exp: "Un m√≥dulo de Young alto indica alta rigidez." },
        { q: "En un hueso largo sometido a flexi√≥n, la fibra central que no sufre ni compresi√≥n ni extensi√≥n se llama:", opts: ["fibra invariable.", "fibra larga.", "fibra media.", "fibra neutra."], a: "fibra neutra.", exp: "En el centro geom√©trico de la flexi√≥n existe una l√≠nea donde la tensi√≥n es cero: la fibra neutra." },
        { q: "Un ejercicio se denomina isot√≥nico cuando:", opts: ["var√≠a la longitud pero no la tensi√≥n muscular.", "var√≠a la tensi√≥n muscular conservando la longitud.", "no var√≠a ni la tensi√≥n ni la longitud muscular.", "var√≠a la postura corporal y los ejercicios respiratorios."], a: "var√≠a la longitud pero no la tensi√≥n muscular.", exp: "Isot√≥nico mantiene la tensi√≥n (tono) pero cambia la longitud (hay movimiento)." },
        { q: "Si estamos apoyados en un solo pie, la fuerza de contacto que la cadera ejerce sobre el f√©mur:", opts: ["Se compensa con la fuerza peso.", "Sigue la l√≠nea del cuello del f√©mur.", "Es horizontal.", "Es vertical para neutralizar el peso del cuerpo."], a: "Sigue la l√≠nea del cuello del f√©mur.", exp: "La fuerza resultante suele alinearse con la estructura trabecular del cuello del f√©mur." },
        { q: "El tejido muscular es:", opts: ["Muy resistente y poco deformable.", "Muy duro.", "Un material muy deformable y cumple la ley de Hooke.", "Un material muy deformable, permite movimiento y no cumple la ley de Hooke."], a: "Un material muy deformable, permite movimiento y no cumple la ley de Hooke.", exp: "El m√∫sculo es viscoel√°stico y su curva tensi√≥n-deformaci√≥n no es una l√≠nea recta (no Hooke)." },
        { q: "La fuerza ejercida por una articulaci√≥n sobre un hueso se denomina:", opts: ["Fuerza muscular.", "Fuerza de contacto.", "Fuerza gravitatoria.", "Fuerza de compresi√≥n."], a: "Fuerza de contacto.", exp: "Es la fuerza de reacci√≥n articular." },
        { q: "Los huesos constituyen un material:", opts: ["Simple.", "El√°stico poco deformable y no cumple la ley de Hooke.", "El√°stico muy deformable y poco resistente.", "El√°stico poco deformable y cumplen la ley de Hooke."], a: "El√°stico poco deformable y cumplen la ley de Hooke.", exp: "En el rango fisiol√≥gico normal, el hueso se comporta el√°sticamente y sigue aproximadamente la linealidad de Hooke." },
        { q: "La figura representa la cabeza inclinada. Las fuerzas F1, F2 y F3 son respectivamente:", opts: ["Fuerza gravitatoria, muscular y de contacto.", "Fuerza gravitatoria, de contacto y muscular.", "Fuerza muscular, de contacto y gravitatoria.", "Fuerza de contacto, gravitatoria y muscular."], a: "Fuerza gravitatoria, de contacto y muscular.", exp: "Es una palanca de 1er g√©nero: Peso (gravedad), Fulcro (contacto) y Potencia (m√∫sculo)." },
        { q: "Una persona en bipedestaci√≥n se mantendr√° en equilibrio siempre que:", opts: ["Su centro de gravedad est√© fuera de la base de sustentaci√≥n.", "La posici√≥n del centro de gravedad no interviene en el equilibrio.", "Su centro de gravedad se halle en el punto medio de su altura.", "Su centro de gravedad est√© dentro de la base de sustentaci√≥n."], a: "Su centro de gravedad est√© dentro de la base de sustentaci√≥n.", exp: "Condici√≥n fundamental de estabilidad: la proyecci√≥n vertical del CG debe caer dentro del √°rea de apoyo." },
        { q: "Si la persona de la figura pasa a la posici√≥n (1) a la (2) [Agacharse], su centro de gravedad se desplaza:", opts: ["Hacia la izquierda.", "Hacia la derecha.", "Hacia abajo.", "Hacia arriba."], a: "Hacia la izquierda.", exp: "(Nota: Se respeta la respuesta original 'Izquierda', aunque generalmente al agacharse el CG baja)." },
        { q: "¬øCu√°l de las siguientes funciones no es caracteristica de los huesos?", opts: ["locomocion.", "nutricion.", "soporte del cuerpo.", "flexibilidad y elasticidad corporal."], a: "nutricion.", exp: "Los huesos dan soporte, permiten locomoci√≥n y protegen. La nutrici√≥n no es su funci√≥n principal." },
        { q: "Si busco una posici√≥n con POCA estabilidad, puedo optar por:", opts: ["Llevar el CG al borde de la base y aumentar su altura.", "Bajar el centro de gravedad.", "Centrar la proyecci√≥n de mi centro de gravedad en mi base de sustentaci√≥n.", "Aumentar la base de sustentaci√≥n."], a: "Llevar el CG al borde de la base y aumentar su altura.", exp: "Para inestabilidad: subir el Centro de Gravedad y acercarlo al l√≠mite de la base." },
        { q: "Se dice que un cuerpo est√° en equilibrio indiferente cuando al apartarlo del punto de equilibrio:", opts: ["No tiende a volver a √©l.", "Tiende a alejarse de √©l.", "No tiende ni a recuperarlo ni a alejarse de √©l.", "Tiende a volver a √©l."], a: "No tiende ni a recuperarlo ni a alejarse de √©l.", exp: "En equilibrio indiferente (como una esfera en suelo plano), cualquier nueva posici√≥n es tambi√©n de equilibrio." },
        { q: "El momento de una fuerza con respecto a un punto 0 indica la tendencia a producir:", opts: ["Mareos.", "La rotaci√≥n de un cuerpo con respecto de punto 0.", "Rozamiento con el suelo.", "El desplazamiento del cuerpo respecto del punto 0."], a: "La rotaci√≥n de un cuerpo con respecto de punto 0.", exp: "El Momento (Torque) es la capacidad de una fuerza para producir un giro." },
        { q: "Un cuerpo se encuentra en equilibrio traslacional:", opts: ["Cuando la suma escalar de las fuerzas aplicadas es cero.", "Cuando la suma vectorial de todas las fuerzas aplicadas es cero.", "Cuando el sumatorio de los momentos es cero.", "Cuando la suma de fuerzas y momentos es cero."], a: "Cuando la suma vectorial de todas las fuerzas aplicadas es cero.", exp: "Equilibrio traslacional implica que no hay aceleraci√≥n lineal (F=ma=0)." },
        { q: "Si el sistema de la figura est√° en equilibrado, ¬øCu√°nto vale la masa de 'M'?", opts: ["3 Kg.", "1 Kg.", "2 Kg.", "4 Kg."], a: "2 Kg.", exp: "Basado en ley de la palanca." },
        { q: "La barra de la figura tiene masa 3 Kg y longitud 4m apoyada en un extremo. ¬øQu√© fuerza a 2m del extremo la equilibra?", opts: ["3 N.", "3 Kp.", "3 Kg.", "6 Kp."], a: "3 Kp.", exp: "El peso de la barra (3kp) act√∫a en su centro (a 2m). Para sostenerla ah√≠, se necesitan 3kp." }
    ];

    // --- ASIGNAR IDs ---
    quizData.forEach((item, index) => {
        item.id = index;
    });

    // --- GESTI√ìN DE ESTADO ---
    let markedQuestions = new Set();
    let failedQuestions = new Set();

    function shuffleArray(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    const container = document.getElementById('quiz-container');

    // Funci√≥n principal
    function renderQuiz(questionsToLoad = quizData) {
        container.innerHTML = "";
        document.getElementById("restart-menu").style.display = "none";
        document.getElementById("finish-btn").style.display = "inline-block";

        if(questionsToLoad.length === 0) {
            container.innerHTML = "<p style='text-align:center; padding:20px; color:#64748b;'>No hay preguntas para mostrar en esta selecci√≥n.</p>";
            return;
        }

        questionsToLoad.forEach((item, displayIndex) => {
            const card = document.createElement('div');
            card.className = 'question-card';

            // Checkbox Marcar
            const markContainer = document.createElement("div");
            markContainer.className = "mark-container";
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = `mark-${item.id}`;
            if(markedQuestions.has(item.id)) checkbox.checked = true;

            checkbox.onchange = (e) => {
                if(e.target.checked) markedQuestions.add(item.id);
                else markedQuestions.delete(item.id);
            };

            const label = document.createElement("label");
            label.htmlFor = `mark-${item.id}`;
            label.innerText = "Marcar para revisar";
            markContainer.appendChild(checkbox);
            markContainer.appendChild(label);
            card.appendChild(markContainer);

            // Pregunta
            const header = document.createElement('div');
            header.className = 'question-header';
            header.textContent = `Pregunta ${item.id + 1}`; 
            card.appendChild(header);

            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = item.q;
            card.appendChild(questionText);

            // Opciones
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options-container';

            let optionsObj = item.opts.map(opt => ({
                text: opt,
                isCorrect: opt === item.a
            }));
            optionsObj = shuffleArray(optionsObj);

            // Explicaci√≥n
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'explanation';
            explanationDiv.innerHTML = `<strong>Explicaci√≥n:</strong> ${item.exp}`;

            optionsObj.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt.text;

                btn.onclick = () => {
                    const allBtns = optionsDiv.querySelectorAll('.option-btn');
                    allBtns.forEach(b => b.disabled = true);

                    if (opt.isCorrect) {
                        btn.classList.add('correct');
                    } else {
                        btn.classList.add('incorrect');
                        failedQuestions.add(item.id);
                        
                        allBtns.forEach(b => {
                            if (b.textContent === item.a) b.classList.add('correct');
                        });
                    }
                    explanationDiv.classList.add('visible');
                };
                optionsDiv.appendChild(btn);
            });

            card.appendChild(optionsDiv);
            card.appendChild(explanationDiv);
            container.appendChild(card);
        });
    }

    // --- Control Final ---
    function showEndOptions() {
        document.getElementById("finish-btn").style.display = "none";
        document.getElementById("restart-menu").style.display = "flex";
        document.getElementById("controls-area").scrollIntoView({behavior: "smooth"});
        
        document.getElementById("stats-summary").innerHTML = `
            Preguntas marcadas: <strong>${markedQuestions.size}</strong><br>
            Preguntas falladas en esta sesi√≥n: <strong>${failedQuestions.size}</strong>
        `;
    }

    function restartQuiz(mode) {
        let subset = [];
        if (mode === 'all') subset = quizData;
        else if (mode === 'marked') subset = quizData.filter(q => markedQuestions.has(q.id));
        else if (mode === 'failed') subset = quizData.filter(q => failedQuestions.has(q.id));
        else if (mode === 'failed_marked') subset = quizData.filter(q => failedQuestions.has(q.id) || markedQuestions.has(q.id));

        if(mode !== 'all') failedQuestions.clear(); 
        else {
            failedQuestions.clear();
            markedQuestions.clear();
        }

        renderQuiz(subset);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    renderQuiz();
</script>

</body>
</html>
