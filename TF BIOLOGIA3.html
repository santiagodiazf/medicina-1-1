<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Bloque 3 - Regulaci√≥n G√©nica (Medicina C√°diz)</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f0f8ff;
            --correct-color: #d4edda;
            --correct-text: #155724;
            --incorrect-color: #f8d7da;
            --incorrect-text: #721c24;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        header {
            text-align: center;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        h1 { color: var(--primary-color); margin: 0; font-size: 1.8rem; }
        .professors { font-style: italic; color: #666; margin-top: 5px; }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: var(--secondary-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            border: 1px solid #cce5ff;
        }

        .question-card {
            display: none;
            animation: fadeIn 0.5s;
            position: relative; /* Para posicionar la marca */
        }
        .question-card.active { display: block; }

        /* Estilo para el marcador (Pesta√±a) */
        .bookmark-panel {
            position: absolute;
            top: 0;
            right: 0;
            background: #fff3cd;
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #ffeeba;
            font-size: 0.9rem;
            color: #856404;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .bookmark-panel:hover { background: #ffe8a1; }
        .bookmark-checkbox { margin-right: 8px; transform: scale(1.2); cursor: pointer; }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-right: 150px; /* Espacio para que el texto no tape la marca */
        }

        .options-grid { display: grid; gap: 10px; }
        
        .option-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
            width: 100%;
        }
        .option-btn:hover:not(:disabled) {
            background-color: #f8f9fa;
            border-color: var(--primary-color);
        }
        .option-btn:disabled { cursor: default; opacity: 0.7; }
        
        .option-btn.correct {
            background-color: var(--correct-color);
            border-color: var(--correct-text);
            color: var(--correct-text);
        }
        .option-btn.incorrect {
            background-color: var(--incorrect-color);
            border-color: var(--incorrect-text);
            color: var(--incorrect-text);
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .feedback.show { display: block; }
        .feedback-correct {
            background-color: var(--correct-color);
            color: var(--correct-text);
            border-left: 5px solid var(--correct-text);
        }
        .feedback-incorrect {
            background-color: var(--incorrect-color);
            color: var(--incorrect-text);
            border-left: 5px solid var(--incorrect-text);
        }

        .navigation {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
        }
        .nav-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            display: none;
        }
        .nav-btn:hover { background-color: #004494; }

        .results-summary {
            text-align: center;
            display: none;
        }
        
        /* Grid de botones finales */
        .action-buttons-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        .action-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            color: white;
            transition: transform 0.2s;
        }
        .action-btn:hover { transform: translateY(-2px); }
        .action-btn:disabled { background-color: #ccc !important; cursor: not-allowed; transform: none; }
        
        .btn-restart { background-color: var(--primary-color); grid-column: span 2; }
        .btn-failed { background-color: #dc3545; }
        .btn-marked { background-color: #ffc107; color: #333; }
        .btn-mixed { background-color: #6f42c1; grid-column: span 2; }

        .topic-tag {
            display: inline-block;
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #495057;
            margin-bottom: 10px;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Examen Bloque 3: Regulaci√≥n G√©nica</h1>
        <div class="professors">Medicina C√°diz - Llorca & Mu√±oz-Manchado</div>
    </header>

    <div class="stats-bar" id="statsBar">
        <div id="progress">Cargando...</div>
        <div id="score">Aciertos sesi√≥n: 0</div>
    </div>

    <div id="quiz-area"></div>

    <div id="results" class="results-summary">
        <h2>Sesi√≥n Finalizada</h2>
        <div style="font-size: 3rem; font-weight: bold; color: var(--primary-color);" id="final-score"></div>
        <p id="final-msg"></p>
        
        <div id="stats-summary" style="margin: 20px 0; color: #555;"></div>

        <div class="action-buttons-grid">
            <button class="action-btn btn-restart" onclick="startQuiz('all')">üîÑ Reiniciar Test Completo (Borrar todo)</button>
            <button class="action-btn btn-failed" id="btn-failed" onclick="startQuiz('failed')">‚ùå Repetir Falladas</button>
            <button class="action-btn btn-marked" id="btn-marked" onclick="startQuiz('marked')">‚ö†Ô∏è Repetir Marcadas</button>
            <button class="action-btn btn-mixed" id="btn-mixed" onclick="startQuiz('mixed')">‚ùå + ‚ö†Ô∏è Repetir Falladas y Marcadas</button>
        </div>
    </div>
</div>

<script>
// --- DATOS DE LAS PREGUNTAS ---
const questions = [
    // --- INTRODUCCI√ìN Y CONCEPTOS B√ÅSICOS (1-8) ---
    {
        topic: "Diferenciaci√≥n",
        question: "¬øC√≥mo se explica que una neurona y una c√©lula hep√°tica del mismo individuo sean diferentes si tienen el mismo ADN?",
        options: ["Tienen genomas distintos.", "Realizan expresi√≥n g√©nica diferencial.", "La neurona no tiene n√∫cleo.", "La c√©lula hep√°tica elimina genes innecesarios."],
        correct: 1,
        explanation: "La identidad celular depende de qu√© genes est√°n 'encendidos' o 'apagados' (expresi√≥n diferencial), no de tener diferente ADN."
    },
    {
        topic: "Definiciones",
        question: "¬øQu√© es el transcriptoma?",
        options: ["El conjunto completo de prote√≠nas de una c√©lula.", "El conjunto completo de mol√©culas de ARN presentes en una c√©lula en un momento dado.", "El conjunto de todos los genes del ADN.", "La maquinaria de degradaci√≥n de prote√≠nas."],
        correct: 1,
        explanation: "El transcriptoma refleja qu√© genes se est√°n transcribiendo activamente a ARN."
    },
    {
        topic: "Definiciones",
        question: "¬øQu√© refleja el proteoma de una c√©lula?",
        options: ["La intenci√≥n de la c√©lula.", "El conjunto de genes silenciados.", "La acci√≥n o funciones que se est√°n ejecutando (conjunto de prote√≠nas).", "La cantidad de ADN basura."],
        correct: 2,
        explanation: "Mientras el transcriptoma refleja la intenci√≥n, el proteoma (prote√≠nas activas) refleja la funci√≥n real."
    },
    {
        topic: "Regulaci√≥n",
        question: "¬øCu√°l es el principal punto de control de la expresi√≥n g√©nica en la mayor√≠a de las c√©lulas?",
        options: ["La traducci√≥n.", "El transporte del ARN.", "La transcripci√≥n (s√≠ntesis de ARN).", "La degradaci√≥n proteica."],
        correct: 2,
        explanation: "Controlar la transcripci√≥n es el paso m√°s eficiente para no desperdiciar recursos sintetizando intermediarios innecesarios."
    },
    {
        topic: "Diferenciaci√≥n",
        question: "Aproximadamente, ¬øqu√© fracci√≥n de sus genes expresa una c√©lula diferenciada t√≠pica?",
        options: ["El 100% de sus genes.", "Alrededor del 10%.", "Aproximadamente la mitad de sus genes codificantes.", "Solo 1 gen."],
        correct: 2,
        explanation: "Se estima que expresan alrededor del 50% de su repertorio g√©nico para mantener funciones b√°sicas y especializadas."
    },
    // --- REGULACI√ìN EN PROCARIOTAS (Oper√≥n Lac) (9-16) ---
    {
        topic: "Oper√≥n Lac",
        question: "¬øQu√© es un oper√≥n?",
        options: ["Un solo gen controlado por muchos promotores.", "Un conjunto de genes transcritos como una sola unidad bajo el control de un √∫nico promotor.", "Una prote√≠na reguladora.", "Un tipo de ARN bacteriano."],
        correct: 1,
        explanation: "Es una estrategia bacteriana eficiente para regular genes relacionados funcionalmente en bloque."
    },
    {
        topic: "Oper√≥n Lac",
        question: "¬øCu√°l es la fuente de energ√≠a preferida por E. coli?",
        options: ["Lactosa", "Glucosa", "Prote√≠nas", "L√≠pidos"],
        correct: 1,
        explanation: "La bacteria prefiere glucosa; solo usar√° lactosa si la glucosa no est√° disponible."
    },
    {
        topic: "Oper√≥n Lac",
        question: "¬øQu√© prote√≠na impide la transcripci√≥n del Oper√≥n Lac en ausencia de lactosa?",
        options: ["La ARN polimerasa.", "El activador CAP.", "El Represor Lac.", "La permeasa."],
        correct: 2,
        explanation: "El Represor Lac se une al operador y bloquea f√≠sicamente a la ARN polimerasa."
    },
    {
        topic: "Oper√≥n Lac",
        question: "¬øQu√© mol√©cula se√±alizadora aumenta cuando escasea la glucosa?",
        options: ["Lactosa", "AMP c√≠clico (AMPc)", "ATP", "Represor"],
        correct: 1,
        explanation: "El AMPc act√∫a como se√±al de 'hambre' de glucosa, activando a la prote√≠na CAP."
    },
    {
        topic: "Oper√≥n Lac",
        question: "¬øQu√© hace el complejo CAP-AMPc?",
        options: ["Reprime el oper√≥n.", "Degrada la lactosa.", "Act√∫a como activador ayudando a la ARN polimerasa a iniciar la transcripci√≥n.", "Exporta glucosa."],
        correct: 2,
        explanation: "CAP es un activador que recluta a la polimerasa para asegurar una transcripci√≥n eficiente cuando falta glucosa."
    },
    {
        topic: "Oper√≥n Lac",
        question: "¬øCu√°l es la condici√≥n √≥ptima para la m√°xima expresi√≥n del Oper√≥n Lac?",
        options: ["Presencia de glucosa y ausencia de lactosa.", "Presencia de glucosa y presencia de lactosa.", "Ausencia de glucosa y ausencia de lactosa.", "Ausencia de glucosa y presencia de lactosa."],
        correct: 3,
        explanation: "Sin glucosa (CAP activo) y con lactosa (Represor inactivo) se dan las condiciones para m√°xima transcripci√≥n."
    },
    // --- REGULACI√ìN EN EUCARIOTAS Y CROMATINA (17-28) ---
    {
        topic: "Eucariotas",
        question: "¬øQu√© son los Factores de Transcripci√≥n o Reguladores?",
        options: ["Prote√≠nas que reconocen y se unen a secuencias espec√≠ficas del ADN.", "Partes del ribosoma.", "Enzimas que degradan ADN.", "Secuencias de ARN."],
        correct: 0,
        explanation: "Son prote√≠nas que leen la secuencia de ADN (surco mayor) para activar o reprimir genes."
    },
    {
        topic: "Eucariotas",
        question: "¬øC√≥mo se llaman las secuencias de ADN que aumentan la transcripci√≥n y pueden estar lejos del gen?",
        options: ["Promotores", "Potenciadores (Enhancers)", "Represores (Silencers)", "Exones"],
        correct: 1,
        explanation: "Los enhancers pueden actuar a miles de pares de bases de distancia gracias al plegamiento del ADN."
    },
    {
        topic: "Cromatina",
        question: "¬øQu√© efecto tiene la acetilaci√≥n de las histonas (mediada por HATs)?",
        options: ["Condensa la cromatina e impide la transcripci√≥n.", "No tiene efecto.", "Relaja la cromatina y favorece la transcripci√≥n.", "Provoca mutaciones."],
        correct: 2,
        explanation: "A√±adir grupos acetilo elimina la carga positiva de las histonas, aflojando su uni√≥n al ADN."
    },
    {
        topic: "Cromatina",
        question: "¬øQu√© hacen los complejos remodeladores de la cromatina?",
        options: ["Sintetizan ADN.", "Utilizan ATP para deslizar los nucleosomas y exponer el ADN.", "Degradan histonas.", "Unen intrones."],
        correct: 1,
        explanation: "Mueven f√≠sicamente los nucleosomas para que la maquinaria de transcripci√≥n pueda acceder al promotor."
    },
    {
        topic: "Regulaci√≥n",
        question: "¬øQu√© es el 'c√≥digo de histonas'?",
        options: ["La secuencia de amino√°cidos de la histona.", "El patr√≥n de modificaciones qu√≠micas (acetilaci√≥n, metilaci√≥n) en las colas de las histonas.", "El c√≥digo gen√©tico del ADN.", "Un tipo de ARN."],
        correct: 1,
        explanation: "Son marcas qu√≠micas que indican a la c√©lula si una regi√≥n del genoma debe ser le√≠da o silenciada."
    },
    {
        topic: "Control Combinatorio",
        question: "¬øQu√© principio explica que con pocos reguladores se generen muchos tipos celulares?",
        options: ["Control combinatorio.", "Replicaci√≥n semiconservadora.", "Splicing alternativo.", "Mutaci√≥n aleatoria."],
        correct: 0,
        explanation: "Los reguladores act√∫an en combinaciones diferentes; como letras del alfabeto formando palabras distintas."
    },
    {
        topic: "Control Combinatorio",
        question: "¬øCu√°ntos reguladores se estima que controlan los ~24,000 genes humanos?",
        options: ["Unos 24,000 (uno por gen).", "Unos 100.", "Unos 1,000.", "Millones."],
        correct: 2,
        explanation: "Aproximadamente 1,000 factores de transcripci√≥n combinados son suficientes para la complejidad humana."
    },
    // --- DIFERENCIACI√ìN, MEMORIA Y C√âLULAS MADRE (29-42) ---
    {
        topic: "Potencia Celular",
        question: "¬øQu√© define a una c√©lula Totipotente?",
        options: ["Puede generar cualquier tipo celular, incluyendo tejidos extraembrionarios (placenta).", "Solo genera c√©lulas de la sangre.", "Puede generar las tres capas germinales pero no placenta.", "No puede dividirse."],
        correct: 0,
        explanation: "El cigoto es totipotente; tiene el potencial m√°ximo para formar un organismo completo y sus anexos."
    },
    {
        topic: "Potencia Celular",
        question: "¬øQu√© define a una c√©lula Pluripotente (como las ESC)?",
        options: ["Genera tejidos extraembrionarios.", "Genera c√©lulas de las tres capas germinales (ectodermo, mesodermo, endodermo), pero no un organismo completo por s√≠ sola.", "Solo genera un tipo celular.", "Es una c√©lula diferenciada."],
        correct: 1,
        explanation: "Las c√©lulas madre embrionarias son pluripotentes: pueden formar cualquier tejido del cuerpo, pero no placenta."
    },
    {
        topic: "Potencia Celular",
        question: "¬øQu√© es una c√©lula Multipotente?",
        options: ["Puede diferenciarse en m√∫ltiples tipos, pero limitados a un linaje (ej. sangre).", "Es igual que una pluripotente.", "Es una c√©lula cancerosa.", "Solo genera piel."],
        correct: 0,
        explanation: "Ejemplo: C√©lulas madre hematopoy√©ticas, que dan lugar a gl√≥bulos rojos, blancos y plaquetas, pero no a neuronas."
    },
    {
        topic: "Memoria Celular",
        question: "¬øCu√°l es un mecanismo de 'memoria celular' (herencia epigen√©tica)?",
        options: ["Mutaci√≥n del ADN.", "Retroalimentaci√≥n positiva de un regulador maestro.", "P√©rdida de mitocondrias.", "Cambio en la secuencia de nucle√≥tidos."],
        correct: 1,
        explanation: "Si una prote√≠na A activa su propio gen, las c√©lulas hijas heredar√°n la prote√≠na A y seguir√°n activando el gen."
    },
    {
        topic: "Epigen√©tica",
        question: "¬øQu√© efecto tiene generalmente la metilaci√≥n del ADN (en citosinas)?",
        options: ["Activa la transcripci√≥n.", "Silencia la expresi√≥n g√©nica.", "Provoca la replicaci√≥n.", "Degrada el ADN."],
        correct: 1,
        explanation: "La metilaci√≥n de citosinas en islas CpG suele atraer prote√≠nas que condensan la cromatina y apagan genes."
    },
    {
        topic: "Epigen√©tica",
        question: "¬øLa herencia epigen√©tica altera la secuencia de ADN?",
        options: ["S√≠, cambia las bases.", "No, son cambios heredables en la expresi√≥n sin cambiar la secuencia.", "Solo en bacterias.", "Depende del gen."],
        correct: 1,
        explanation: "Epigen√©tica significa 'sobre la gen√©tica'; cambia el fenotipo sin cambiar el genotipo."
    },
    {
        topic: "Reprogramaci√≥n",
        question: "¬øQu√© son las iPS (C√©lulas Madre Pluripotentes Inducidas)?",
        options: ["C√©lulas madre embrionarias naturales.", "C√©lulas adultas reprogramadas artificialmente a un estado pluripotente.", "C√©lulas del h√≠gado.", "Clones de oveja Dolly."],
        correct: 1,
        explanation: "Mediante factores de transcripci√≥n (Yamanaka factors), una c√©lula adulta puede 'rejuvenecer' a un estado tipo embrionario."
    },
    {
        topic: "Reprogramaci√≥n",
        question: "¬øQu√© demuestra la conversi√≥n directa de fibroblasto a neurona?",
        options: ["Que la diferenciaci√≥n es irreversible.", "Que la identidad celular depende de los reguladores que expresa y es pl√°stica.", "Que el ADN se pierde en la diferenciaci√≥n.", "Que las neuronas son c√©lulas madre."],
        correct: 1,
        explanation: "Demuestra que el estado diferenciado se mantiene por prote√≠nas reguladoras y puede cambiarse manipul√°ndolas."
    },
    // --- CONTROL POST-TRANSCRIPCIONAL (43-55) ---
    {
        topic: "ARN no codificante",
        question: "¬øQu√© son los ARN no codificantes (ncRNA)?",
        options: ["ARN que no se traduce a prote√≠na pero tiene funci√≥n propia.", "ARN basura sin funci√≥n.", "ARNm mal formados.", "Virus."],
        correct: 0,
        explanation: "Incluyen ARNt, ARNr, y reguladores como miRNA, siRNA y lncRNA."
    },
    {
        topic: "miRNA",
        question: "¬øCu√°l es la funci√≥n principal de los microARN (miRNA)?",
        options: ["Codificar prote√≠nas peque√±as.", "Regular la expresi√≥n g√©nica degradando ARNm o bloqueando su traducci√≥n.", "Servir de molde para el ADN.", "Formar ribosomas."],
        correct: 1,
        explanation: "Los miRNA gu√≠an al complejo RISC hacia ARNm complementarios para silenciarlos."
    },
    {
        topic: "miRNA",
        question: "¬øQu√© complejo proteico utilizan los miRNA para actuar?",
        options: ["RISC (Complejo de Silenciamiento Inducido por ARN).", "Proteasoma.", "Ribosoma.", "Spliceosoma."],
        correct: 0,
        explanation: "El miRNA se carga en RISC y act√∫a como gu√≠a de b√∫squeda."
    },
    {
        topic: "siRNA",
        question: "¬øCu√°l es el origen principal del sistema de interferencia por ARN (siRNA)?",
        options: ["Regulaci√≥n del desarrollo.", "Mecanismo de defensa contra virus (ARN de doble cadena) y transposones.", "S√≠ntesis de energ√≠a.", "Respiraci√≥n celular."],
        correct: 1,
        explanation: "Las c√©lulas reconocen el ARN de doble cadena (t√≠pico de virus) como extra√±o y lo usan para destruir al invasor."
    },
    {
        topic: "siRNA",
        question: "¬øQu√© enzima corta el ARN de doble cadena extra√±o en fragmentos peque√±os (siRNA)?",
        options: ["Dicer", "Polimerasa", "Ligasa", "Helicasa"],
        correct: 0,
        explanation: "Dicer 'trocea' el ARN viral en peque√±os fragmentos que luego arman a RISC."
    },
    {
        topic: "lncRNA",
        question: "¬øQu√© longitud m√≠nima definen a los ARN largos no codificantes (lncRNA)?",
        options: ["M√°s de 20 nucle√≥tidos.", "M√°s de 200 nucle√≥tidos.", "M√°s de 1000 nucle√≥tidos.", "Menos de 20 nucle√≥tidos."],
        correct: 1,
        explanation: "Se clasifican como largos si superan los 200 nucle√≥tidos, diferenci√°ndose de los peque√±os miRNA/siRNA."
    },
    {
        topic: "lncRNA",
        question: "¬øQu√© funci√≥n cumple el lncRNA llamado Xist?",
        options: ["Activar el cromosoma Y.", "Silenciar e inactivar uno de los cromosomas X en hembras de mam√≠feros.", "Degradar ARNm.", "Sintetizar prote√≠nas."],
        correct: 1,
        explanation: "Xist recubre el cromosoma X del que se transcribe, reclutando maquinaria para condensarlo (Cuerpo de Barr)."
    },
    {
        topic: "lncRNA",
        question: "¬øC√≥mo act√∫an los lncRNA como 'esponjas'?",
        options: ["Absorben agua.", "Secuestran miRNA para evitar que silencien sus dianas.", "Limpian la c√©lula de desechos.", "Absorben glucosa."],
        correct: 1,
        explanation: "Al unirse a los miRNA, los 'distraen' o secuestran, permitiendo que los ARNm diana de esos miRNA se expresen."
    },
    // --- DIN√ÅMICA Y EVOLUCI√ìN DEL GENOMA (56-65) ---
    {
        topic: "Variaci√≥n Gen√©tica",
        question: "¬øCu√°l es la fuente √∫ltima de variaci√≥n gen√©tica y evoluci√≥n?",
        options: ["La mitosis.", "La estabilidad del ADN.", "Las mutaciones.", "La alimentaci√≥n."],
        correct: 2,
        explanation: "Los cambios en la secuencia de ADN (mutaciones) generan la diversidad sobre la que act√∫a la selecci√≥n."
    },
    {
        topic: "Mutaciones",
        question: "¬øQu√© es una mutaci√≥n puntual?",
        options: ["Cambio en un √∫nico nucle√≥tido.", "Duplicaci√≥n de un cromosoma entero.", "P√©rdida de un brazo cromos√≥mico.", "Fusi√≥n de dos c√©lulas."],
        correct: 0,
        explanation: "Es el cambio m√°s simple, por error de replicaci√≥n o reparaci√≥n."
    },
    {
        topic: "Mutaciones",
        question: "¬øD√≥nde suelen tener mayor impacto evolutivo las mutaciones?",
        options: ["En intrones.", "En el ADN regulatorio (cambiando cu√°ndo o d√≥nde se expresa un gen).", "En regiones interg√©nicas.", "En el tel√≥mero."],
        correct: 1,
        explanation: "Cambiar la regulaci√≥n permite usar los mismos genes de formas nuevas (ej. resistencia a lactosa en adultos)."
    },
    {
        topic: "Evoluci√≥n",
        question: "¬øQu√© mecanismo permite generar nuevos genes con funciones novedosas?",
        options: ["Duplicaci√≥n g√©nica y divergencia.", "Reparaci√≥n del ADN.", "Transcripci√≥n.", "Traducci√≥n."],
        correct: 0,
        explanation: "Una copia mantiene la funci√≥n original, liberando a la otra copia para acumular mutaciones y adquirir nuevas funciones."
    },
    {
        topic: "Ejemplo Evoluci√≥n",
        question: "¬øQu√© familia de genes es un ejemplo cl√°sico de duplicaci√≥n y divergencia?",
        options: ["La familia de las globinas.", "El gen de la insulina.", "El ARN ribosomal.", "El gen p53."],
        correct: 0,
        explanation: "Las globinas (alfa, beta, mioglobina) surgieron de un ancestro com√∫n y se especializaron en distintas etapas/tejidos."
    },
    {
        topic: "Exones",
        question: "¬øQu√© es el reordenamiento de exones (Exon Shuffling)?",
        options: ["Eliminar exones durante el splicing.", "Mezclar exones de diferentes genes para crear prote√≠nas con nuevas combinaciones de dominios.", "Duplicar intrones.", "Un error de traducci√≥n."],
        correct: 1,
        explanation: "Permite una evoluci√≥n r√°pida de prote√≠nas modulares, combinando dominios funcionales preexistentes."
    },
    // --- VIRUS Y CRISPR (66-75) ---
    {
        topic: "Virus",
        question: "¬øQu√© es un virus?",
        options: ["Una c√©lula procariota.", "Un peque√±o genoma (ADN o ARN) en una cubierta proteica que requiere una c√©lula hu√©sped.", "Un org√°nulo celular.", "Una prote√≠na t√≥xica."],
        correct: 1,
        explanation: "Son par√°sitos intracelulares obligados; no tienen maquinaria propia para reproducirse."
    },
    {
        topic: "SARS-CoV-2",
        question: "¬øPor qu√© el SARS-CoV-2 tiene una tasa de mutaci√≥n relativamente baja para ser un virus de ARN?",
        options: ["Porque su polimerasa tiene actividad de correcci√≥n de pruebas.", "Porque es un virus de ADN.", "Porque no se replica.", "Porque usa la polimerasa humana."],
        correct: 0,
        explanation: "A diferencia de la mayor√≠a de virus ARN, los coronavirus tienen un mecanismo para corregir errores, favoreciendo su estabilidad."
    },
    {
        topic: "VIH",
        question: "¬øPor qu√© el VIH (retrovirus) evoluciona tan r√°pido?",
        options: ["Porque su transcriptasa inversa no corrige errores.", "Porque tiene correcci√≥n de pruebas.", "Porque es un virus de ADN estable.", "Porque infecta bacterias."],
        correct: 0,
        explanation: "La falta de correcci√≥n y la presi√≥n inmune generan una alt√≠sima variabilidad viral."
    },
    {
        topic: "Elementos M√≥viles",
        question: "¬øQu√© son los elementos gen√©ticos m√≥viles?",
        options: ["Genes que saltan de un genoma a otro.", "Paquetes de informaci√≥n gen√©tica que se mueven dentro del genoma.", "Ribosomas m√≥viles.", "C√©lulas sangu√≠neas."],
        correct: 1,
        explanation: "Contribuyen a la evoluci√≥n y plasticidad del genoma (transposones)."
    },
    {
        topic: "CRISPR-Cas",
        question: "¬øCu√°l es la funci√≥n original del sistema CRISPR-Cas en la naturaleza?",
        options: ["Edici√≥n gen√©tica en humanos.", "Inmunidad adaptativa en bacterias contra virus.", "S√≠ntesis de prote√≠nas.", "Replicaci√≥n del ADN bacteriano."],
        correct: 1,
        explanation: "Las bacterias guardan fragmentos de virus en su locus CRISPR para reconocerlos y cortarlos en futuras infecciones."
    },
    {
        topic: "CRISPR-Cas",
        question: "¬øC√≥mo se ha adaptado CRISPR para la tecnolog√≠a?",
        options: ["Como herramienta de edici√≥n gen√©tica precisa guiada por ARN.", "Para crear vacunas de ARN.", "Para secuenciar genomas.", "Para clonar ovejas."],
        correct: 0,
        explanation: "Permite dirigir la prote√≠na Cas9 a cualquier secuencia de ADN usando un ARN gu√≠a sint√©tico para cortar y editar."
    },
    {
        topic: "CRISPR-Cas",
        question: "¬øQu√© componente gu√≠a a la prote√≠na Cas al sitio espec√≠fico del ADN?",
        options: ["Una prote√≠na gu√≠a.", "Una mol√©cula de ARN gu√≠a.", "Un l√≠pido.", "La polimerasa."],
        correct: 1,
        explanation: "La especificidad de CRISPR reside en la secuencia del ARN gu√≠a complementaria a la diana."
    },
    {
        topic: "Concepto Clave",
        question: "¬øQu√© es la terapia g√©nica con CRISPR?",
        options: ["Uso de virus para matar bacterias.", "Edici√≥n o correcci√≥n de genes defectuosos en pacientes (ej. anemia falciforme).", "Uso de antibi√≥ticos.", "Transfusi√≥n de sangre."],
        correct: 1,
        explanation: "Ya es una realidad cl√≠nica para curar enfermedades gen√©ticas modificando el ADN del paciente."
    },
    {
        topic: "Concepto Clave",
        question: "¬øCu√°l es la diferencia entre un virus ARN como el SARS-CoV-2 y un retrovirus como el VIH?",
        options: ["El SARS-CoV-2 se integra en el genoma, el VIH no.", "El VIH se integra en el genoma del hu√©sped (como provirus), el SARS-CoV-2 no suele hacerlo.", "El VIH es de ADN.", "No hay diferencia."],
        correct: 1,
        explanation: "El VIH usa transcriptasa inversa para hacer ADN e integrarse; SARS-CoV-2 replica su ARN en el citoplasma."
    },
    {
        topic: "Repaso General",
        question: "Resumen: ¬øQu√© mecanismo permite que una c√©lula madre 'recuerde' su estado a trav√©s de las divisiones?",
        options: ["Herencia mendeliana.", "Herencia epigen√©tica.", "Selecci√≥n natural.", "Deriva g√©nica."],
        correct: 1,
        explanation: "La metilaci√≥n y modificaci√≥n de histonas se copian durante la divisi√≥n, perpetuando la identidad celular."
    }
];

// --- GESTI√ìN DE ESTADO ---
// Inicializamos propiedades extra en las preguntas
questions.forEach(q => {
    q.isMarked = false;       // Estado de marca
    q.userCorrect = null;     // null: no respondida, true: correcta, false: incorrecta
});

let activeIndices = []; // Lista de los √≠ndices de las preguntas activas (playlist)
let currentPlaylistIndex = 0; // Puntero dentro de la playlist
let sessionScore = 0;
let answered = false;

// Al cargar
document.addEventListener('DOMContentLoaded', () => {
    startQuiz('all');
});

// --- FUNCI√ìN PRINCIPAL DE CONTROL ---
function startQuiz(mode) {
    activeIndices = [];
    
    // 1. Crear la lista de reproducci√≥n seg√∫n el modo
    if (mode === 'all') {
        // Reinicio total: limpiamos respuestas
        questions.forEach(q => q.userCorrect = null);
        // Nota: ¬øLimpiamos las marcas? Normalmente un "Reiniciar Test" borra todo.
        questions.forEach(q => q.isMarked = false);
        
        activeIndices = questions.map((_, i) => i);
    } 
    else if (mode === 'failed') {
        activeIndices = questions
            .map((q, i) => q.userCorrect === false ? i : -1)
            .filter(i => i !== -1);
    } 
    else if (mode === 'marked') {
        activeIndices = questions
            .map((q, i) => q.isMarked ? i : -1)
            .filter(i => i !== -1);
    } 
    else if (mode === 'mixed') {
        // Falladas O marcadas
        activeIndices = questions
            .map((q, i) => (q.userCorrect === false || q.isMarked) ? i : -1)
            .filter(i => i !== -1);
    }

    // 2. Comprobaciones
    if (activeIndices.length === 0) {
        alert("No hay preguntas para este modo (ej. no has fallado o marcado ninguna).");
        return;
    }

    // 3. Resetear contadores de sesi√≥n
    currentPlaylistIndex = 0;
    sessionScore = 0;
    
    // 4. UI
    document.getElementById('results').style.display = 'none';
    document.getElementById('quiz-area').style.display = 'block';
    document.getElementById('statsBar').style.display = 'flex';
    
    loadQuestion();
}

function loadQuestion() {
    answered = false;
    
    // Obtenemos el √≠ndice REAL de la pregunta en la base de datos
    const realIndex = activeIndices[currentPlaylistIndex];
    const q = questions[realIndex];
    
    document.getElementById('progress').textContent = `Pregunta ${currentPlaylistIndex + 1} de ${activeIndices.length}`;
    document.getElementById('score').textContent = `Aciertos sesi√≥n: ${sessionScore}`;

    // Renderizado
    const quizArea = document.getElementById('quiz-area');
    
    // Checkbox state
    const markedChecked = q.isMarked ? 'checked' : '';

    let html = `
        <div class="question-card active">
            
            <label class="bookmark-panel">
                <input type="checkbox" class="bookmark-checkbox" onchange="toggleMark(${realIndex}, this)" ${markedChecked}>
                <span>Marcar para revisar</span>
            </label>

            <div class="topic-tag">${q.topic}</div>
            <div class="question-text">${q.question}</div>
            
            <div class="options-grid">
                ${q.options.map((opt, i) => `
                    <button class="option-btn" onclick="checkAnswer(${i}, ${q.correct}, this, ${realIndex})">
                        ${String.fromCharCode(65+i)}. ${opt}
                    </button>
                `).join('')}
            </div>
            
            <div id="feedback" class="feedback"></div>
            
            <div class="navigation">
                <button id="next-btn" class="nav-btn" onclick="nextQuestion()">Siguiente ‚Üí</button>
            </div>
        </div>
    `;
    
    quizArea.innerHTML = html;
}

// Funci√≥n para marcar/desmarcar (se guarda en el objeto global)
function toggleMark(realIndex, checkbox) {
    questions[realIndex].isMarked = checkbox.checked;
}

function checkAnswer(selected, correct, btn, realIndex) {
    if (answered) return;
    answered = true;

    const btns = document.querySelectorAll('.option-btn');
    const feedbackEl = document.getElementById('feedback');
    const nextBtn = document.getElementById('next-btn');

    // Deshabilitar botones
    btns.forEach(b => b.disabled = true);

    if (selected === correct) {
        sessionScore++;
        questions[realIndex].userCorrect = true; // Guardar estado
        btn.classList.add('correct');
        feedbackEl.className = 'feedback feedback-correct show';
        feedbackEl.innerHTML = `<strong>¬°Correcto!</strong> ${questions[realIndex].explanation}`;
    } else {
        questions[realIndex].userCorrect = false; // Guardar estado fallo
        btn.classList.add('incorrect');
        btns[correct].classList.add('correct');
        feedbackEl.className = 'feedback feedback-incorrect show';
        feedbackEl.innerHTML = `<strong>Incorrecto.</strong> ${questions[realIndex].explanation}`;
    }

    document.getElementById('score').textContent = `Aciertos sesi√≥n: ${sessionScore}`;
    nextBtn.style.display = 'inline-block';
}

function nextQuestion() {
    if (currentPlaylistIndex < activeIndices.length - 1) {
        currentPlaylistIndex++;
        loadQuestion();
    } else {
        showResults();
    }
}

function showResults() {
    document.getElementById('quiz-area').style.display = 'none';
    document.getElementById('statsBar').style.display = 'none';
    document.getElementById('results').style.display = 'block';

    const percent = Math.round((sessionScore / activeIndices.length) * 100);
    document.getElementById('final-score').textContent = `${sessionScore} / ${activeIndices.length}`;
    
    // Mensaje motivacional
    let msg = "";
    if(percent >= 90) msg = "¬°Excelente!";
    else if(percent >= 70) msg = "Muy bien.";
    else if(percent >= 50) msg = "Aprobado.";
    else msg = "Sigue repasando.";
    document.getElementById('final-msg').textContent = `${percent}% - ${msg}`;

    // Estad√≠sticas globales para habilitar botones
    const totalFailed = questions.filter(q => q.userCorrect === false).length;
    const totalMarked = questions.filter(q => q.isMarked === true).length;
    const totalMixed = questions.filter(q => q.userCorrect === false || q.isMarked).length;

    document.getElementById('stats-summary').innerHTML = `
        <strong>Resumen Global:</strong><br>
        Preguntas marcadas para revisi√≥n: ${totalMarked}<br>
        Preguntas falladas (hist√≥rico): ${totalFailed}
    `;

    // Habilitar/Deshabilitar botones
    document.getElementById('btn-failed').disabled = (totalFailed === 0);
    document.getElementById('btn-marked').disabled = (totalMarked === 0);
    document.getElementById('btn-mixed').disabled = (totalMixed === 0);
    
    // Actualizar textos con contadores
    document.getElementById('btn-failed').innerHTML = `‚ùå Repetir Falladas (${totalFailed})`;
    document.getElementById('btn-marked').innerHTML = `‚ö†Ô∏è Repetir Marcadas (${totalMarked})`;
}
</script>

</body>
</html>
