<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Biolog√≠a Celular - Cap√≠tulo 9 (Aleatorio)</title>
    <style>
        :root { --primary: #34495e; --secondary: #ecf0f1; --accent: #e74c3c; --success: #27ae60; --text: #2c3e50; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #fdfefe; color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .container { width: 100%; max-width: 900px; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 40px; border-top: 6px solid var(--primary); }
        
        header { border-bottom: 2px solid #ecf0f1; padding-bottom: 20px; margin-bottom: 30px; text-align: center; }
        h1 { margin: 0; color: var(--primary); font-size: 2.2rem; }
        .stats-bar { display: flex; justify-content: space-between; background: #f8f9fa; padding: 10px 20px; border-radius: 8px; font-weight: bold; color: #7f8c8d; font-size: 0.9rem; margin-top: 15px; }

        .nav-panel { display: grid; grid-template-columns: repeat(auto-fill, minmax(42px, 1fr)); gap: 8px; margin-bottom: 30px; max-height: 150px; overflow-y: auto; padding: 10px; background: #f4f6f7; border-radius: 10px; border: 1px solid #dfe6e9; }
        .nav-btn { background: white; border: 1px solid #bdc3c7; color: #7f8c8d; padding: 8px 0; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.85rem; transition: 0.2s; }
        .nav-btn:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }
        .nav-btn.active { background: var(--primary); color: white; border-color: var(--primary); transform: scale(1.1); box-shadow: 0 4px 6px rgba(52, 73, 94, 0.3); }
        .nav-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .nav-btn.incorrect { background: var(--accent); color: white; border-color: var(--accent); }
        .nav-btn.marked { border: 2px solid #f1c40f; }

        .question-card { animation: fadeIn 0.4s ease-out; }
        .q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .q-badge { background: var(--primary); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .mark-btn { background: none; border: 1px solid #f39c12; color: #f39c12; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 0.85rem; display: flex; align-items: center; gap: 5px; }
        .mark-btn.active { background: #f39c12; color: white; }

        .question-text { font-size: 1.2rem; line-height: 1.6; margin-bottom: 25px; font-weight: 500; color: #2c3e50; }
        
        .options-list { display: flex; flex-direction: column; gap: 12px; }
        .option { background: white; border: 2px solid #ecf0f1; padding: 15px 20px; border-radius: 10px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; font-size: 1rem; }
        .option:hover:not(.disabled) { border-color: var(--primary); background: #fdfefe; transform: translateX(5px); }
        .option.correct { border-color: var(--success); background: #eafaf1; color: #1e8449; }
        .option.incorrect { border-color: var(--accent); background: #fdedec; color: #c0392b; }
        .option.disabled { cursor: default; opacity: 0.8; }

        .feedback { margin-top: 25px; padding: 20px; border-radius: 10px; display: none; }
        .feedback.success { background: #eafaf1; border-left: 5px solid var(--success); }
        .feedback.error { background: #fdedec; border-left: 5px solid var(--accent); }
        .feedback h3 { margin: 0 0 10px 0; font-size: 1.1rem; }

        .controls { margin-top: 35px; display: flex; justify-content: space-between; gap: 15px; border-top: 1px solid #ecf0f1; padding-top: 25px; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; font-size: 0.95rem; text-transform: uppercase; }
        .btn-prev { background: #95a5a6; }
        .btn-next { background: var(--primary); }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        #results-modal { position: fixed; inset: 0; background: rgba(44, 62, 80, 0.9); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 40px; border-radius: 15px; width: 90%; max-width: 450px; text-align: center; }
        .score-circle { width: 120px; height: 120px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; margin: 0 auto 25px; }
        .modal-actions { display: grid; gap: 10px; margin-top: 25px; }
        .action-btn { padding: 12px; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üß¨ Cap. 9: Evoluci√≥n Gen√≥mica</h1>
        <div class="stats-bar">
            <span id="progress">Pregunta 1 / 51</span>
            <span>Aciertos: <strong id="score" style="color: var(--success)">0</strong></span>
        </div>
    </header>

    <div class="nav-panel" id="nav"></div>

    <div class="question-card">
        <div class="q-header">
            <span class="q-badge" id="q-num">Q1</span>
            <button class="mark-btn" onclick="toggleMark()">
                <span id="mark-icon">‚òÜ</span> Marcar
            </button>
        </div>
        <div class="question-text" id="q-txt">Cargando...</div>
        <div class="options-list" id="opts"></div>
        
        <div class="feedback" id="fb">
            <h3 id="fb-title"></h3>
            <p id="fb-msg"></p>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-prev" id="prev" onclick="move(-1)">Anterior</button>
        <button class="btn btn-next" id="next" onclick="move(1)">Siguiente</button>
    </div>
</div>

<div id="results-modal">
    <div class="modal-content">
        <h2>Resultados</h2>
        <div class="score-circle" id="final-score">0%</div>
        <p id="final-msg"></p>
        <div class="modal-actions">
            <button class="action-btn" style="background:var(--primary)" onclick="restart('all')">Repetir Todo</button>
            <button class="action-btn" style="background:var(--accent)" onclick="restart('failed')">Repetir Fallos</button>
            <button class="action-btn" style="background:#f39c12" onclick="restart('marked')">Repetir Marcadas</button>
        </div>
        <button onclick="document.getElementById('results-modal').style.display='none'" style="margin-top:15px; border:none; background:none; text-decoration:underline; cursor:pointer; color:#7f8c8d;">Cerrar</button>
    </div>
</div>

<script>
// Base de datos original
const rawDb = [
  {
    "id": 1,
    "q": "La mayor√≠a de los cambios gen√©ticos que ocurren en la l√≠nea germinal de un organismo:",
    "options": [
      "Son neutrales o perjudiciales y son eliminados por la selecci√≥n natural o la deriva gen√©tica.",
      "Son siempre beneficiosos.",
      "Causan c√°ncer.",
      "Se reparan inmediatamente."
    ],
    "correct": 0,
    "exp": "La mayor√≠a de las mutaciones son delet√©reas (se eliminan) o neutras (pueden fijarse por deriva). Las beneficiosas son raras."
  },
  {
    "id": 2,
    "q": "La duplicaci√≥n g√©nica es un mecanismo importante de evoluci√≥n porque:",
    "options": [
      "Permite que una copia mantenga la funci√≥n original mientras la otra puede mutar y adquirir nuevas funciones.",
      "Aumenta el tama√±o del n√∫cleo.",
      "Hace que la replicaci√≥n sea m√°s r√°pida.",
      "Elimina intrones."
    ],
    "correct": 0,
    "exp": "Crea redundancia gen√©tica, liberando una copia de la presi√≥n selectiva para explorar nuevas funciones (neofuncionalizaci√≥n)."
  },
  {
    "id": 3,
    "q": "¬øQu√© son los genes ort√≥logos?",
    "options": [
      "Genes en diferentes especies que evolucionaron a partir de un gen ancestral com√∫n por especiaci√≥n.",
      "Genes en la misma especie que surgieron por duplicaci√≥n.",
      "Genes que no tienen relaci√≥n.",
      "Genes virales."
    ],
    "correct": 0,
    "exp": "Los ort√≥logos suelen conservar la misma funci√≥n en diferentes especies (ej. hemoglobina humana y de rat√≥n)."
  },
  {
    "id": 4,
    "q": "¬øQu√© son los genes par√°logos?",
    "options": [
      "Genes relacionados dentro del mismo genoma que surgieron por duplicaci√≥n g√©nica.",
      "Genes de especies diferentes.",
      "Genes id√©nticos.",
      "Genes saltarines."
    ],
    "correct": 0,
    "exp": "Los par√°logos suelen divergir en funci√≥n dentro del mismo organismo (ej. hemoglobina alfa y beta)."
  },
  {
    "id": 5,
    "q": "La transferencia horizontal de genes es m√°s com√∫n en:",
    "options": [
      "Bacterias y arqueas (procariotas).",
      "Mam√≠feros.",
      "Plantas con flores.",
      "Humanos."
    ],
    "correct": 0,
    "exp": "Permite el intercambio r√°pido de rasgos como la resistencia a antibi√≥ticos entre especies distintas."
  },
  {
    "id": 6,
    "q": "Los transposones contribuyen a la evoluci√≥n del genoma al:",
    "options": [
      "Promover la recombinaci√≥n, alterar la regulaci√≥n g√©nica o llevarse exones a nuevos sitios (exon shuffling).",
      "Estabilizar el genoma.",
      "Impedir mutaciones.",
      "Sintetizar prote√≠nas."
    ],
    "correct": 0,
    "exp": "Aunque a menudo son 'ego√≠stas', pueden reorganizar el genoma y crear nuevas combinaciones g√©nicas."
  },
  {
    "id": 7,
    "q": "¬øQu√© porcentaje aproximado del genoma humano est√° compuesto por elementos m√≥viles (transposones y retrotransposones)?",
    "options": [
      "Casi el 50%",
      "Menos del 2%",
      "90%",
      "0%"
    ],
    "correct": 0,
    "exp": "Nuestro genoma es en gran parte un 'cementerio' de elementos virales y transponibles antiguos."
  },
  {
    "id": 8,
    "q": "El 'reloj molecular' se basa en la idea de que:",
    "options": [
      "Las secuencias de ADN acumulan mutaciones neutras a una tasa relativamente constante a lo largo del tiempo.",
      "El ADN muta cada hora.",
      "Los relojes est√°n hechos de mol√©culas.",
      "La evoluci√≥n se detiene."
    ],
    "correct": 0,
    "exp": "Permite estimar el tiempo de divergencia entre dos especies comparando sus secuencias."
  },
  {
    "id": 9,
    "q": "La sintenia se refiere a:",
    "options": [
      "La conservaci√≥n del orden de los genes en los cromosomas de especies relacionadas.",
      "La s√≠ntesis de prote√≠nas.",
      "La duplicaci√≥n de genes.",
      "La p√©rdida de genes."
    ],
    "correct": 0,
    "exp": "Bloques de genes suelen permanecer juntos durante la evoluci√≥n (ej. humano vs rat√≥n)."
  },
  {
    "id": 10,
    "q": "¬øQu√© tipo de mutaci√≥n es m√°s probable que sea neutral (sin efecto en la aptitud)?",
    "options": [
      "Una mutaci√≥n sin√≥nima en el tercer nucle√≥tido de un cod√≥n (wobble).",
      "Una mutaci√≥n que cambia el sitio activo de una enzima.",
      "Una deleci√≥n de un gen esencial.",
      "Una mutaci√≥n en el promotor."
    ],
    "correct": 0,
    "exp": "No cambia el amino√°cido codificado, por lo que la prote√≠na sigue siendo igual."
  },
  {
    "id": 11,
    "q": "El genoma humano difiere del genoma del chimpanc√© en aproximadamente:",
    "options": [
      "1-2% en secuencia de nucle√≥tidos.",
      "50%",
      "90%",
      "0.1%"
    ],
    "correct": 0,
    "exp": "Somos extremadamente similares a nivel de secuencia; las diferencias fenot√≠picas se deben mucho a la regulaci√≥n."
  },
  {
    "id": 12,
    "q": "La duplicaci√≥n del genoma completo (whole genome duplication) ha ocurrido en la evoluci√≥n de:",
    "options": [
      "Vertebrados (incluidos humanos) y muchas plantas.",
      "Solo bacterias.",
      "Solo virus.",
      "Nunca ha ocurrido."
    ],
    "correct": 0,
    "exp": "Eventos de poliploidizaci√≥n antiguos permitieron una gran expansi√≥n de familias g√©nicas en vertebrados."
  },
  {
    "id": 13,
    "q": "Los pseudogenes son:",
    "options": [
      "Copias de genes que han acumulado mutaciones y ya no son funcionales.",
      "Genes nuevos.",
      "Genes sint√©ticos.",
      "Genes virales activos."
    ],
    "correct": 0,
    "exp": "Son 'f√≥siles' gen√≥micos de genes duplicados que no fueron mantenidos por la selecci√≥n."
  },
  {
    "id": 14,
    "q": "El barajado de exones (exon shuffling) permite:",
    "options": [
      "La creaci√≥n de nuevas prote√≠nas combinando dominios funcionales preexistentes.",
      "Eliminar exones.",
      "Mezclar ADN y ARN.",
      "Destruir prote√≠nas."
    ],
    "correct": 0,
    "exp": "Es una forma r√°pida de evolucionar nuevas funciones complejas."
  },
  {
    "id": 15,
    "q": "¬øQu√© es la purificaci√≥n o selecci√≥n negativa?",
    "options": [
      "La eliminaci√≥n de mutaciones perjudiciales de la poblaci√≥n.",
      "La selecci√≥n de rasgos nuevos.",
      "La purificaci√≥n de prote√≠nas en el laboratorio.",
      "La deriva gen√©tica."
    ],
    "correct": 0,
    "exp": "Conserva las secuencias funcionalmente importantes (como los exones) impidiendo que cambien."
  },
  {
    "id": 16,
    "q": "El ADN ribos√≥mico (ARNr) es muy √∫til para construir √°rboles filogen√©ticos de especies muy distantes porque:",
    "options": [
      "Es un gen esencial altamente conservado que cambia muy lentamente.",
      "Cambia muy r√°pido.",
      "Solo existe en bacterias.",
      "Es f√°cil de secuenciar."
    ],
    "correct": 0,
    "exp": "Permite comparar organismos que divergieron hace miles de millones de a√±os (ej. el √Årbol de la Vida de Woese)."
  },
  {
    "id": 17,
    "q": "Las mutaciones en la l√≠nea germinal vs som√°tica:",
    "options": [
      "Solo las germinales se transmiten a la descendencia y contribuyen a la evoluci√≥n.",
      "Las som√°ticas se heredan.",
      "Ambas se heredan.",
      "Ninguna importa."
    ],
    "correct": 0,
    "exp": "La evoluci√≥n depende de cambios heredables (gametos)."
  },
  {
    "id": 18,
    "q": "¬øQu√© es un polimorfismo de nucle√≥tido √∫nico (SNP)?",
    "options": [
      "Una variaci√≥n en una sola base del ADN entre individuos de una poblaci√≥n.",
      "Un gen nuevo.",
      "Un cromosoma extra.",
      "Una prote√≠na mutante."
    ],
    "correct": 0,
    "exp": "Son la base de la variabilidad gen√©tica individual humana."
  },
  {
    "id": 19,
    "q": "La evoluci√≥n convergente ocurre cuando:",
    "options": [
      "Especies no relacionadas desarrollan caracter√≠sticas similares debido a presiones selectivas similares.",
      "Especies relacionadas se separan.",
      "Dos genes se fusionan.",
      "El ADN se duplica."
    ],
    "correct": 0,
    "exp": "Ejemplo: Las alas de aves e insectos, o los ojos de vertebrados y cefal√≥podos."
  },
  {
    "id": 20,
    "q": "El genoma de Fugu (pez globo) es famoso porque:",
    "options": [
      "Es muy compacto, con muy poco 'ADN basura' (intrones cortos, pocos transposones), pero tiene casi los mismos genes que el humano.",
      "Es enorme.",
      "No tiene genes.",
      "Es de ARN."
    ],
    "correct": 0,
    "exp": "Demuestra que se puede tener un genoma vertebrado funcional en mucho menos espacio."
  },
  {
    "id": 21,
    "q": "¬øQu√© mecanismo NO contribuye a la innovaci√≥n gen√≥mica?",
    "options": [
      "La reparaci√≥n perfecta del ADN (sin errores).",
      "Duplicaci√≥n de genes.",
      "Mutaci√≥n puntual.",
      "Transferencia horizontal."
    ],
    "correct": 0,
    "exp": "La evoluci√≥n requiere variabilidad; la reparaci√≥n perfecta impedir√≠a el cambio (estasis)."
  },
  {
    "id": 22,
    "q": "Los virus son considerados:",
    "options": [
      "Elementos gen√©ticos m√≥viles que pueden escapar de las c√©lulas o entrar en ellas.",
      "C√©lulas vivas.",
      "Bacterias peque√±as.",
      "Prote√≠nas puras."
    ],
    "correct": 0,
    "exp": "Co-evolucionan con sus hospedadores y son motores de transferencia gen√©tica."
  },
  {
    "id": 23,
    "q": "La familia de genes de la globina (alfa, beta, mioglobina) es un ejemplo cl√°sico de:",
    "options": [
      "Evoluci√≥n por duplicaci√≥n y divergencia.",
      "Transferencia horizontal.",
      "Evoluci√≥n convergente.",
      "P√©rdida de genes."
    ],
    "correct": 0,
    "exp": "Todos provienen de un gen ancestral de uni√≥n a ox√≠geno."
  },
  {
    "id": 24,
    "q": "¬øQu√© son los 'elementos ultra-conservados'?",
    "options": [
      "Secuencias de ADN que son id√©nticas entre especies distantes (ej. rat√≥n, humano, rata) sugiriendo una funci√≥n vital desconocida.",
      "Genes de ribosomas.",
      "Huesos de dinosaurio.",
      "ADN basura."
    ],
    "correct": 0,
    "exp": "A menudo son regiones reguladoras (enhancers) del desarrollo embrionario."
  },
  {
    "id": 25,
    "q": "La comparaci√≥n de genomas completos (Gen√≥mica comparativa) permite:",
    "options": [
      "Identificar genes, elementos reguladores y entender la historia evolutiva.",
      "Clonar personas.",
      "Curar todas las enfermedades hoy.",
      "Crear vida."
    ],
    "correct": 0,
    "exp": "Identificar qu√© es constante (funcional) y qu√© cambia (neutral) es clave."
  },
  {
    "id": 26,
    "q": "El ADN mitocondrial se hereda:",
    "options": [
      "Exclusivamente por v√≠a materna (en la mayor√≠a de animales).",
      "Por v√≠a paterna.",
      "De ambos padres.",
      "No se hereda."
    ],
    "correct": 0,
    "exp": "Permite rastrear linajes maternos (Eva mitocondrial)."
  },
  {
    "id": 27,
    "q": "Los retrovirus end√≥genos (HERVs) en el genoma humano son:",
    "options": [
      "Restos de antiguas infecciones virales que se integraron en la l√≠nea germinal.",
      "Virus activos que nos enferman.",
      "Genes humanos normales.",
      "Bacterias."
    ],
    "correct": 0,
    "exp": "Componen cerca del 8% de nuestro ADN."
  },
  {
    "id": 28,
    "q": "La 'deriva gen√©tica' es m√°s fuerte en:",
    "options": [
      "Poblaciones peque√±as.",
      "Poblaciones grandes.",
      "Poblaciones con selecci√≥n fuerte.",
      "Bacterias."
    ],
    "correct": 0,
    "exp": "Los cambios aleatorios pueden fijarse r√°pidamente si hay pocos individuos."
  },
  {
    "id": 29,
    "q": "¬øQu√© es un haplotipo?",
    "options": [
      "Un conjunto de variaciones de ADN (SNPs) que se heredan juntas.",
      "Un tipo de sangre.",
      "Un cromosoma.",
      "Una enfermedad."
    ],
    "correct": 0,
    "exp": "√ötil para mapas de asociaci√≥n gen√©tica (HapMap)."
  },
  {
    "id": 30,
    "q": "La p√©rdida de genes (gene loss) tambi√©n es evoluci√≥n. Un ejemplo es:",
    "options": [
      "La p√©rdida de genes olfativos en primates al desarrollar mejor visi√≥n.",
      "La ganancia de color.",
      "La duplicaci√≥n.",
      "El c√°ncer."
    ],
    "correct": 0,
    "exp": "'√ösalo o pi√©rdelo'; si un gen ya no es ventajoso, acumula mutaciones y se vuelve pseudog√©n."
  },
  {
    "id": 31,
    "q": "El genoma de Neandertal comparado con el humano moderno muestra:",
    "options": [
      "Que hubo cruzamiento (hibridaci√≥n) entre ambas especies.",
      "Que son totalmente diferentes.",
      "Que los Neandertales eran chimpanc√©s.",
      "No hay ADN de Neandertal."
    ],
    "correct": 0,
    "exp": "Los humanos no africanos tienen un 1-4% de ADN neandertal."
  },
  {
    "id": 32,
    "q": "Los intrones evolucionaron probablemente:",
    "options": [
      "Temprano en los eucariotas, permitiendo la diversidad modular de prote√≠nas.",
      "Ayer.",
      "En bacterias.",
      "Son errores virales."
    ],
    "correct": 0,
    "exp": "Su presencia permite el splicing alternativo y el exon shuffling."
  },
  {
    "id": 33,
    "q": "¬øQu√© enzima es clave para la movilidad de los elementos L1 (LINE-1)?",
    "options": [
      "Transcriptasa inversa.",
      "ADN polimerasa.",
      "Helicasa.",
      "Ribosoma."
    ],
    "correct": 0,
    "exp": "Copian su ARN a ADN para insertarse en otro lugar."
  },
  {
    "id": 34,
    "q": "La selecci√≥n sexual puede llevar a:",
    "options": [
      "Evoluci√≥n r√°pida de genes relacionados con la reproducci√≥n y el reconocimiento de pareja.",
      "Extinci√≥n.",
      "Estasis.",
      "Mutaciones neutras."
    ],
    "correct": 0,
    "exp": "Impulsa la divergencia r√°pida (ej. prote√≠nas del esperma)."
  },
  {
    "id": 35,
    "q": "El t√©rmino 'homolog√≠a' implica:",
    "options": [
      "Descendencia de un ancestro com√∫n.",
      "Similitud por azar.",
      "Misma funci√≥n pero distinto origen.",
      "Ninguna relaci√≥n."
    ],
    "correct": 0,
    "exp": "Es la base de la clasificaci√≥n evolutiva."
  },
  {
    "id": 36,
    "q": "Los bloques de sintenia se rompen con el tiempo debido a:",
    "options": [
      "Inversiones, translocaciones y otros reordenamientos cromos√≥micos.",
      "Duplicaciones.",
      "Mutaciones puntuales.",
      "Mitosis."
    ],
    "correct": 0,
    "exp": "Cuanto m√°s distantes son dos especies, m√°s fragmentada est√° la sintenia."
  },
  {
    "id": 37,
    "q": "¬øCu√°l es el origen m√°s probable de los intrones?",
    "options": [
      "Elementos m√≥viles o 'parasitarios' que invadieron el genoma temprano.",
      "Genes rotos.",
      "Basura celular.",
      "ADN de la dieta."
    ],
    "correct": 0,
    "exp": "Teor√≠a de los intrones tempranos vs tard√≠os."
  },
  {
    "id": 38,
    "q": "La secuenciaci√≥n de genomas antiguos (paleogen√≥mica) es dif√≠cil porque:",
    "options": [
      "El ADN se degrada y fragmenta con el tiempo y se contamina con bacterias.",
      "El ADN antiguo es radiactivo.",
      "No exist√≠a ADN antes.",
      "Es ilegal."
    ],
    "correct": 0,
    "exp": "Requiere t√©cnicas muy sensibles y limpias."
  },
  {
    "id": 39,
    "q": "La mayor√≠a del ADN humano es:",
    "options": [
      "No codificante.",
      "Codificante de prote√≠nas.",
      "ARN.",
      "Viral activo."
    ],
    "correct": 0,
    "exp": "El 98% no codifica prote√≠nas, pero tiene funciones reguladoras o estructurales."
  },
  {
    "id": 40,
    "q": "El gen FOXP2 es famoso por su relaci√≥n con:",
    "options": [
      "El desarrollo del lenguaje y el habla en humanos.",
      "El color de ojos.",
      "La altura.",
      "La digesti√≥n."
    ],
    "correct": 0,
    "exp": "Tiene mutaciones espec√≠ficas en humanos comparado con chimpanc√©s."
  },
  {
    "id": 41,
    "q": "La evoluci√≥n es un proceso que act√∫a sobre:",
    "options": [
      "Poblaciones, no individuos.",
      "Individuos solos.",
      "C√©lulas.",
      "√Åtomos."
    ],
    "correct": 0,
    "exp": "El individuo vive o muere, pero la poblaci√≥n evoluciona (cambio de frecuencias al√©licas)."
  },
  {
    "id": 42,
    "q": "¬øQu√© es la neofuncionalizaci√≥n?",
    "options": [
      "Cuando una copia g√©nica duplicada adquiere una funci√≥n totalmente nueva.",
      "Cuando se pierde un gen.",
      "Cuando un gen se repara.",
      "Cuando un gen se divide."
    ],
    "correct": 0,
    "exp": "Uno de los destinos de los genes duplicados."
  },
  {
    "id": 43,
    "q": "La tasa de mutaci√≥n es:",
    "options": [
      "Diferente en distintas partes del genoma y entre sexos.",
      "Constante siempre.",
      "Cero.",
      "Igual en todos los organismos."
    ],
    "correct": 0,
    "exp": "Es mayor en esperma (m√°s divisiones) y var√≠a seg√∫n la regi√≥n cromos√≥mica."
  },
  {
    "id": 44,
    "q": "El 'cuello de botella' poblacional:",
    "options": [
      "Reduce dr√°sticamente la diversidad gen√©tica.",
      "Aumenta la diversidad.",
      "No afecta.",
      "Crea nuevos genes."
    ],
    "correct": 0,
    "exp": "Pocos supervivientes fundan la nueva poblaci√≥n, perdiendo alelos raros."
  },
  {
    "id": 45,
    "q": "¬øQu√© t√©cnica permite ver la historia evolutiva de un gen?",
    "options": [
      "Alineamiento de secuencias y construcci√≥n de √°rboles filogen√©ticos.",
      "PCR.",
      "Electroforesis.",
      "Clonaci√≥n."
    ],
    "correct": 0,
    "exp": "Comparar las diferencias revela las relaciones de parentesco."
  },
  {
    "id": 46,
    "q": "La resistencia a la lactosa en adultos es un ejemplo de:",
    "options": [
      "Evoluci√≥n humana reciente por selecci√≥n positiva (cultura lechera).",
      "Una enfermedad.",
      "Un virus.",
      "Algo ancestral."
    ],
    "correct": 0,
    "exp": "Surgi√≥ independientemente en Europa y √Åfrica."
  },
  {
    "id": 47,
    "q": "El cromosoma Y humano est√°:",
    "options": [
      "Degenerando y perdiendo genes con el tiempo.",
      "Creciendo.",
      "Estable.",
      "Desaparecido."
    ],
    "correct": 0,
    "exp": "Al no recombinar, acumula mutaciones y pierde genes funcionales."
  },
  {
    "id": 48,
    "q": "Los genes Hox controlan:",
    "options": [
      "El plan corporal y la identidad de los segmentos antero-posteriores.",
      "El color de piel.",
      "La respiraci√≥n.",
      "La digesti√≥n."
    ],
    "correct": 0,
    "exp": "Son altamente conservados desde moscas hasta humanos (colinealidad)."
  },
  {
    "id": 49,
    "q": "¬øQu√© es la subfuncionalizaci√≥n?",
    "options": [
      "Cuando dos copias de un gen duplicado se reparten las funciones del gen ancestral.",
      "Cuando un gen muere.",
      "Cuando un gen gana funci√≥n.",
      "Ninguna."
    ],
    "correct": 0,
    "exp": "Ambas copias se vuelven esenciales para cubrir la funci√≥n total original."
  },
  {
    "id": 50,
    "q": "El an√°lisis de ADN ambiental (metagen√≥mica) permite:",
    "options": [
      "Estudiar comunidades microbianas enteras sin cultivarlas.",
      "Estudiar solo humanos.",
      "Ver virus.",
      "Nada."
    ],
    "correct": 0,
    "exp": "Ha revelado la inmensa diversidad bacteriana no cultivable."
  }
];

// Funci√≥n para barajar un array (Fisher-Yates)
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Preprocesamos la base de datos para barajar opciones
const db = rawDb.map(item => {
    // Clonamos las opciones originales
    let opts = [...item.options];
    // Guardamos la respuesta correcta en texto para no perderla
    const correctAnswerText = opts[item.correct];
    
    // Barajamos
    opts = shuffleArray(opts);
    
    // Encontramos el nuevo √≠ndice de la respuesta correcta
    const newCorrectIndex = opts.indexOf(correctAnswerText);
    
    // Retornamos el objeto modificado
    return {
        ...item,
        options: opts,
        correct: newCorrectIndex
    };
});

let currIdx = 0;
let state = new Array(db.length).fill(null); 
let marked = new Set();
let activeDb = db.map((_,i) => i);

const nav = document.getElementById('nav');
const qNum = document.getElementById('q-num');
const qTxt = document.getElementById('q-txt');
const optsList = document.getElementById('opts');
const markBtn = document.querySelector('.mark-btn');
const feedback = document.getElementById('fb');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const resModal = document.getElementById('results-modal');

function init() {
    renderNav();
    loadQ(0);
}

function renderNav() {
    nav.innerHTML = '';
    activeDb.forEach((realIdx, viewIdx) => {
        const btn = document.createElement('div');
        const s = state[realIdx];
        let cls = 'nav-btn';
        if (viewIdx === currIdx) cls += ' active';
        if (s) cls += s.ok ? ' correct' : ' incorrect';
        if (marked.has(realIdx)) cls += ' marked';
        
        btn.className = cls;
        btn.innerText = viewIdx + 1;
        btn.onclick = () => loadQ(viewIdx);
        nav.appendChild(btn);
    });
    
    // Stats
    const ok = state.filter(x => x && x.ok).length;
    document.getElementById('score').innerText = ok;
    document.getElementById('progress').innerText = `P ${currIdx + 1} / ${activeDb.length}`;
}

function loadQ(idx) {
    currIdx = idx;
    const realIdx = activeDb[idx];
    const data = db[realIdx];
    const s = state[realIdx];

    qNum.innerText = `Q${idx + 1}`;
    qTxt.innerText = data.q;
    
    // Mark
    markBtn.className = marked.has(realIdx) ? 'mark-btn active' : 'mark-btn';
    markBtn.querySelector('span').innerText = marked.has(realIdx) ? '‚òÖ' : '‚òÜ';
    
    // Options
    optsList.innerHTML = '';
    data.options.forEach((txt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.innerText = txt;
        
        if (s) {
            div.classList.add('disabled');
            if (i === data.correct) div.classList.add('correct');
            else if (i === s.sel) div.classList.add('incorrect');
        } else {
            div.onclick = () => check(realIdx, i);
        }
        optsList.appendChild(div);
    });

    // Feedback
    if (s) {
        feedback.style.display = 'block';
        feedback.className = `feedback ${s.ok ? 'success' : 'error'}`;
        document.getElementById('fb-title').innerText = s.ok ? '¬°Correcto!' : 'Incorrecto';
        document.getElementById('fb-msg').innerText = data.exp;
    } else {
        feedback.style.display = 'none';
    }

    prevBtn.disabled = idx === 0;
    nextBtn.innerText = idx === activeDb.length - 1 ? 'FINALIZAR' : 'SIGUIENTE';
    
    renderNav();
}

function check(realIdx, sel) {
    const data = db[realIdx];
    const ok = sel === data.correct;
    state[realIdx] = { sel, ok };
    loadQ(currIdx);
}

function toggleMark() {
    const r = activeDb[currIdx];
    if (marked.has(r)) marked.delete(r);
    else marked.add(r);
    loadQ(currIdx);
}

function move(dir) {
    const next = currIdx + dir;
    if (next >= 0 && next < activeDb.length) loadQ(next);
    else if (next >= activeDb.length) showRes();
}

function showRes() {
    let ok = 0;
    activeDb.forEach(i => { if (state[i] && state[i].ok) ok++; });
    const pct = Math.round((ok / activeDb.length) * 100) || 0;
    
    document.getElementById('final-score').innerText = pct + '%';
    document.getElementById('final-msg').innerText = `Aciertos: ${ok}/${activeDb.length}`;
    resModal.style.display = 'flex';
}

function restart(mode) {
    resModal.style.display = 'none';
    if (mode === 'all') {
        activeDb = db.map((_, i) => i);
        state.fill(null);
    } else if (mode === 'failed') {
        const f = [];
        db.forEach((_, i) => { if (state[i] && !state[i].ok) f.push(i); });
        if (!f.length) return alert("¬°No hay fallos!");
        activeDb = f;
        activeDb.forEach(i => state[i] = null);
    } else if (mode === 'marked') {
        const m = Array.from(marked).sort((a,b)=>a-b);
        if (!m.length) return alert("¬°No hay marcadas!");
        activeDb = m;
        activeDb.forEach(i => state[i] = null);
    }
    loadQ(0);
}

init();
</script>
</body>
</html>