<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Investigaci√≥n Avanzado: Llorca & Mu√±oz-Manchado</title>
    <style>
        :root {
            --primary: #4a235a;
            --secondary: #8e44ad;
            --success: #27ae60;
            --error: #c0392b;
            --warning: #f39c12;
            --light: #f4ecf7;
            --dark: #1a1a2e;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-top: 6px solid var(--primary);
            position: relative;
        }
        header {
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        h1 { color: var(--primary); margin: 0; font-size: 2.2rem; }
        .intro { font-size: 1.1rem; color: #555; margin-bottom: 10px; }
        
        .status-panel {
            background: #d7bde2;
            padding: 15px 25px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-bottom: 25px;
            color: var(--primary);
            border: 1px solid #af7ac5;
        }

        .question-card {
            display: none;
            animation: fadeIn 0.4s ease-out;
            position: relative; /* Para posicionar la marca */
        }
        .question-card.active { display: block; }

        /* ESTILO PARA LA PESTA√ëA DE MARCAR */
        .bookmark-panel {
            position: absolute;
            top: 0;
            right: 0;
            background: #fdf2e9;
            border: 1px solid #edbb99;
            padding: 5px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .bookmark-panel:hover { background: #fae5d3; }
        .bookmark-checkbox {
            accent-color: var(--warning);
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .researcher-tag {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        .tag-llorca { background-color: #e67e22; }
        .tag-munoz { background-color: #2980b9; }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 25px;
            font-weight: 600;
            padding-right: 120px; /* Espacio para el bookmark */
        }

        .options-list {
            display: grid;
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #d2b4de;
            padding: 16px;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            font-size: 1.05rem;
            transition: all 0.2s;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: #fdfefe;
            transform: translateX(5px);
        }

        .option-btn:disabled { cursor: default; opacity: 0.8; }

        .correct {
            background-color: #d5f5e3 !important;
            border-color: var(--success) !important;
            color: #145a32;
        }

        .incorrect {
            background-color: #fadbd8 !important;
            border-color: var(--error) !important;
            color: #7b241c;
        }

        .feedback-area {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            background: #fcf3cf;
            border-left: 6px solid #f1c40f;
            display: none;
        }
        .feedback-area.show { display: block; }
        .rationale { margin-top: 8px; font-size: 0.95rem; }

        .nav-btn {
            display: none;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1.1rem;
            margin-top: 25px;
            cursor: pointer;
            float: right;
            transition: background 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .nav-btn:hover { background: var(--secondary); }

        .results-view {
            text-align: center;
            display: none;
        }
        .final-score {
            font-size: 4rem;
            font-weight: 800;
            color: var(--primary);
            margin: 20px 0;
        }
        
        /* GRID DE BOTONES DE RESULTADO */
        .action-btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        .action-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            color: white;
        }
        .action-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .action-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.6; }
        
        .btn-full { background: var(--primary); grid-column: span 2; }
        .btn-failed { background: var(--error); }
        .btn-marked { background: var(--warning); color: #444; }
        .btn-mixed { background: var(--secondary); grid-column: span 2; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Investigaci√≥n y Biolog√≠a Celular</h1>
        <p class="intro">Uniendo la ciencia de tus profesoras (Llorca & Mu√±oz-Manchado) con el temario.</p>
    </header>

    <div class="status-panel" id="statusBar">
        <span id="q-progress">Pregunta 1 de 50</span>
        <span id="score-display">Aciertos: 0</span>
    </div>

    <div id="quiz-container">
    </div>

    <div id="results-screen" class="results-view">
        <h2>Test Completado</h2>
        <div class="final-score" id="final-number">0/0</div>
        <p id="final-text" style="font-size: 1.2rem; margin-bottom: 20px;"></p>
        
        <div id="stats-summary" style="margin-bottom: 20px; color: #555;"></div>

        <div class="action-btn-grid">
            <button class="action-btn btn-full" onclick="startQuiz('full')">üîÅ Repetir Test Completo (Reset)</button>
            <button class="action-btn btn-failed" id="btn-failed" onclick="startQuiz('failed')">‚ùå Repetir Falladas</button>
            <button class="action-btn btn-marked" id="btn-marked" onclick="startQuiz('marked')">‚ö†Ô∏è Repetir Marcadas</button>
            <button class="action-btn btn-mixed" id="btn-mixed" onclick="startQuiz('mixed')">‚ùå + ‚ö†Ô∏è Repetir Falladas y Marcadas</button>
        </div>
    </div>
</div>

<script>
// --- DATOS DEL TEST ---
// A√±adimos propiedades din√°micas: 'userMarked' y 'userCorrect' se gestionar√°n en tiempo de ejecuci√≥n.
const originalQuizData = [
    // --- PARTE 1: MERITXELL LLORCA ---
    {
        researcher: "Llorca (Neurofarmacolog√≠a)",
        topic: "Se√±alizaci√≥n Celular (Bloque 7)",
        question: "La Dra. Llorca estudia los receptores opioides en el dolor. ¬øA qu√© gran familia de receptores de superficie pertenecen estos receptores?",
        options: ["Receptores Tirosina Quinasa (RTK).", "Canales i√≥nicos.", "Receptores Acoplados a Prote√≠nas G (GPCR).", "Receptores nucleares."],
        correct: 2,
        explanation: "Los receptores opioides (mu, delta, kappa) son cl√°sicos GPCRs que modulan la excitabilidad neuronal."
    },
    {
        topic: "Se√±alizaci√≥n Celular (Bloque 7)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Al activarse un receptor de dolor tipo GPCR, ¬øqu√© subunidad de la prote√≠na G suele inhibir la adenilato ciclasa para reducir la se√±al?",
        options: ["La subunidad Gs.", "La subunidad Gi (inhibitoria).", "La subunidad Gq.", "La subunidad Ras."],
        correct: 1,
        explanation: "La investigaci√≥n en dolor a menudo se centra en prote√≠nas Gi que reducen el AMPc, disminuyendo la excitabilidad."
    },
    {
        topic: "Citoesqueleto (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Para que los receptores de dolor lleguen desde el cuerpo neuronal hasta la sinapsis, ¬øqu√© 'autopista' del citoesqueleto utilizan?",
        options: ["Filamentos intermedios.", "Microt√∫bulos.", "Actina.", "L√°mina nuclear."],
        correct: 1,
        explanation: "El transporte axonal de ves√≠culas con receptores se realiza sobre microt√∫bulos mediante motores moleculares."
    },
    {
        topic: "Membrana (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "El Locus Coeruleus (estudiado por la Dra. Llorca) libera noradrenalina. ¬øQu√© ion dispara la liberaci√≥n de este neurotransmisor en la sinapsis?",
        options: ["Entrada de Na+.", "Salida de K+.", "Entrada de Ca2+.", "Entrada de Cl-."],
        correct: 2,
        explanation: "La fusi√≥n de las ves√≠culas sin√°pticas (exocitosis) es dependiente de la entrada de calcio por canales voltaje-dependientes."
    },
    {
        topic: "Se√±alizaci√≥n (Bloque 7)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "En el dolor cr√≥nico, las neuronas pueden volverse hiperexcitables. ¬øQu√© canal i√≥nico es fundamental para generar la fase ascendente del potencial de acci√≥n que transmite el dolor?",
        options: ["Canal de K+.", "Canal de Na+ dependiente de voltaje.", "Bomba Na/K.", "Acuaporina."],
        correct: 1,
        explanation: "Los canales de sodio son la diana de muchos analg√©sicos locales porque inician el impulso nervioso."
    },
    {
        topic: "Org√°nulos (Bloque 1/5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Las neuronas del dolor requieren mucha energ√≠a para mantener sus gradientes i√≥nicos. ¬øQu√© org√°nulo es vital para suministrar este ATP en la sinapsis?",
        options: ["El n√∫cleo.", "La mitocondria.", "El lisosoma.", "El nucl√©olo."],
        correct: 1,
        explanation: "Las mitocondrias se transportan activamente a las sinapsis para alimentar las bombas i√≥nicas necesarias para la transmisi√≥n del dolor."
    },
    {
        topic: "Expresi√≥n G√©nica (Bloque 3)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "El estr√©s y el dolor pueden cambiar la expresi√≥n de genes en el cerebro a largo plazo (plasticidad). ¬øQu√© factor regula este proceso en el n√∫cleo?",
        options: ["Los ribosomas.", "Los Factores de Transcripci√≥n.", "La membrana plasm√°tica.", "El aparato de Golgi."],
        correct: 1,
        explanation: "La se√±alizaci√≥n de dolor llega al n√∫cleo activando factores de transcripci√≥n (ej. CREB) que modifican la expresi√≥n g√©nica."
    },
    {
        topic: "Citoesqueleto (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "En las neuronas que estudian, los neurofilamentos son cruciales para:",
        options: ["La contracci√≥n.", "Determinar el calibre del ax√≥n y dar soporte estructural.", "El transporte de ves√≠culas.", "La divisi√≥n celular."],
        correct: 1,
        explanation: "Los neurofilamentos (filamentos intermedios neuronales) son esenciales para la estructura y grosor del ax√≥n."
    },
    {
        topic: "T√©cnicas (Bloque 1)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Si la Dra. Llorca quiere ver d√≥nde se localiza un receptor opioide en la neurona, ¬øqu√© t√©cnica utilizar√≠a?",
        options: ["Microscop√≠a de contraste de fases.", "Inmunofluorescencia (Microscop√≠a de Fluorescencia).", "Cariotipo.", "PCR."],
        correct: 1,
        explanation: "La inmunofluorescencia permite marcar prote√≠nas espec√≠ficas (receptores) para ver su ubicaci√≥n celular."
    },
    {
        topic: "Se√±alizaci√≥n (Bloque 7)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Muchos f√°rmacos para el dolor act√∫an sobre receptores de membrana. ¬øPor qu√© no entran directamente a la c√©lula?",
        options: ["Porque son hidrof√≥bicos.", "Porque son mol√©culas grandes o hidrof√≠licas que no cruzan la bicapa lip√≠dica.", "Porque la c√©lula los expulsa.", "Porque el n√∫cleo est√° cerrado."],
        correct: 1,
        explanation: "La mayor√≠a de neurotransmisores y f√°rmacos (opioides, catecolaminas) son hidrof√≠licos y requieren receptores de superficie."
    },
    {
        topic: "Sinapsis (Bloque 7)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "El estudio de la ansiedad inducida por dolor implica la am√≠gdala. ¬øQu√© tipo de comunicaci√≥n celular es la base de los circuitos neuronales?",
        options: ["Endocrina.", "Sin√°ptica.", "Por contacto.", "Autocrina."],
        correct: 1,
        explanation: "La transmisi√≥n r√°pida y precisa entre neuronas en circuitos cerebrales es sin√°ptica."
    },
    {
        topic: "Receptores (Bloque 7)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Algunos receptores de dolor se desensibilizan (dejan de responder) tras un uso continuo. ¬øC√≥mo ocurre esto a nivel molecular?",
        options: ["El receptor se muta.", "El receptor es fosforilado y endocitado (internalizado) en ves√≠culas.", "La c√©lula muere.", "El ligando se rompe."],
        correct: 1,
        explanation: "La endocitosis de receptores GPCR es un mecanismo cl√°sico de regulaci√≥n a la baja (tolerancia)."
    },
    {
        topic: "Transporte (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "¬øQu√© prote√≠na motora transporta los receptores reci√©n sintetizados desde el cuerpo neuronal hacia el ax√≥n (anter√≥grado)?",
        options: ["Dine√≠na.", "Cinesina.", "Miosina.", "Actina."],
        correct: 1,
        explanation: "Las cinesinas llevan la carga hacia el extremo positivo (+) de los microt√∫bulos, es decir, hacia la terminal ax√≥nica."
    },
    {
        topic: "Citoesqueleto (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "El Locus Coeruleus tiene proyecciones muy largas. ¬øQu√© elemento del citoesqueleto es esencial para mantener estos axones largos?",
        options: ["Microfilamentos de actina.", "Microt√∫bulos estables.", "L√°mina nuclear.", "Centriolos."],
        correct: 1,
        explanation: "Los microt√∫bulos forman los 'ra√≠les' estructurales largos que soportan el ax√≥n."
    },
    {
        topic: "Lisosomas (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Cuando los receptores de dolor viejos son retirados de la membrana, ¬ød√≥nde son degradados?",
        options: ["En el n√∫cleo.", "En el lisosoma.", "En la mitocondria.", "En el ribosoma."],
        correct: 1,
        explanation: "La v√≠a endoc√≠tica lleva los receptores viejos al lisosoma para su digesti√≥n y reciclaje."
    },
    {
        topic: "Se√±alizaci√≥n (Bloque 7)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "¬øQu√© segundo mensajero suele disminuir cuando se activan los receptores opioides (Gi)?",
        options: ["Calcio.", "AMP c√≠clico (AMPc).", "IP3.", "Glucosa."],
        correct: 1,
        explanation: "La prote√≠na Gi inhibe la adenilato ciclasa, reduciendo los niveles de AMPc y 'apagando' la neurona."
    },
    {
        topic: "Membrana (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Para que una neurona vuelva al reposo tras transmitir dolor, ¬øqu√© bomba debe trabajar intensamente?",
        options: ["Bomba de protones.", "Bomba Na+/K+ ATPasa.", "Bomba de Cloro.", "Transportador de glucosa."],
        correct: 1,
        explanation: "Restablece los gradientes i√≥nicos alterados durante el potencial de acci√≥n."
    },
    {
        topic: "Uniones (Bloque 6)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "En el sistema nervioso, ¬øqu√© c√©lulas forman la vaina de mielina para acelerar la se√±al?",
        options: ["Neuronas.", "C√©lulas de la gl√≠a (Schwann/Oligodendrocitos).", "Fibroblastos.", "Macr√≥fagos."],
        correct: 1,
        explanation: "La interacci√≥n c√©lula-c√©lula entre neurona y gl√≠a es vital para la conducci√≥n r√°pida."
    },
    {
        topic: "N√∫cleo (Bloque 4)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Las neuronas del Locus Coeruleus tienen un n√∫cleo grande y nucl√©olo prominente. ¬øQu√© indica esto?",
        options: ["Que se est√°n dividiendo.", "Que tienen una alta tasa de s√≠ntesis de prote√≠nas (ribosomas).", "Que est√°n muertas.", "Que tienen mucho ADN."],
        correct: 1,
        explanation: "Un nucl√©olo grande indica una gran demanda de ribosomas para mantener la s√≠ntesis de neurotransmisores y prote√≠nas."
    },
    {
        topic: "Ciclo Celular (Bloque 8)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Las neuronas adultas que estudia la Dra. Llorca est√°n en una fase espec√≠fica del ciclo. ¬øCu√°l?",
        options: ["G1.", "S.", "G2.", "G0 (quiescencia permanente)."],
        correct: 3,
        explanation: "Las neuronas son c√©lulas terminalmente diferenciadas que no se dividen."
    },
    {
        topic: "Muerte Celular (Bloque 7)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "En enfermedades neurodegenerativas o dolor cr√≥nico severo, las neuronas pueden morir por excitotoxicidad (exceso de calcio). ¬øQu√© tipo de muerte es la m√°s controlada?",
        options: ["Necrosis.", "Apoptosis.", "Lisis.", "Mitosis."],
        correct: 1,
        explanation: "La apoptosis permite eliminar neuronas da√±adas sin causar inflamaci√≥n en el cerebro."
    },
    {
        topic: "Se√±alizaci√≥n (Bloque 7)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "¬øQu√© gas act√∫a como neurotransmisor retr√≥grado en las v√≠as del dolor?",
        options: ["√ìxido N√≠trico (NO).", "Ox√≠geno.", "Nitr√≥geno.", "Helio."],
        correct: 0,
        explanation: "El NO difunde desde la neurona postsin√°ptica a la presin√°ptica para modular la se√±al (plasticidad)."
    },
    {
        topic: "Ret√≠culo (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "Los receptores de dolor son prote√≠nas de membrana. ¬øD√≥nde se inicia su s√≠ntesis?",
        options: ["En ribosomas libres del citosol.", "En ribosomas unidos al Ret√≠culo Endopl√°smico Rugoso (RER).", "En el n√∫cleo.", "En el Golgi."],
        correct: 1,
        explanation: "Todas las prote√≠nas transmembrana entran en la ruta secretora a trav√©s del RER."
    },
    {
        topic: "Golgi (Bloque 5)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "¬øD√≥nde se empaquetan los neurop√©ptidos implicados en el dolor?",
        options: ["En el lisosoma.", "En el Aparato de Golgi.", "En la mitocondria.", "En el n√∫cleo."],
        correct: 1,
        explanation: "El Golgi clasifica y empaqueta las prote√≠nas en ves√≠culas secretoras."
    },
    {
        topic: "Adhesi√≥n (Bloque 6)",
        researcher: "Llorca (Neurofarmacolog√≠a)",
        question: "¬øQu√© mol√©cula de adhesi√≥n es importante para mantener la sinapsis unida?",
        options: ["Cadherinas (N-cadherina).", "Integrinas de la matriz.", "Col√°geno.", "Selectinas."],
        correct: 0,
        explanation: "Las cadherinas neuronales ayudan a pegar las membranas pre y postsin√°pticas."
    },

    // --- PARTE 2: ANA MU√ëOZ-MANCHADO ---
    {
        topic: "Expresi√≥n G√©nica (Bloque 3)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "La Dra. Mu√±oz estudia el 'transcriptoma de c√©lula √∫nica'. ¬øQu√© nos dice el transcriptoma?",
        options: ["La secuencia de ADN.", "Qu√© genes se est√°n expresando (transcribiendo a ARN) en esa c√©lula espec√≠fica.", "Qu√© prote√≠nas se degradan.", "La forma de la c√©lula."],
        correct: 1,
        explanation: "Permite identificar qu√© 'hace' cada c√©lula individualmente analizando sus ARNm."
    },
    {
        topic: "Gen√≥mica (Bloque 3)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "¬øPor qu√© dos c√©lulas del cerebro (una neurona y una gl√≠a) tienen transcriptomas diferentes?",
        options: ["Tienen diferente ADN.", "Tienen diferentes ribosomas.", "Expresan diferentes sets de genes (Regulaci√≥n diferencial).", "Una no tiene n√∫cleo."],
        correct: 2,
        explanation: "La base de la identidad celular es la expresi√≥n diferencial del mismo genoma."
    },
    {
        topic: "Enfermedad (Bloque 7)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "En la Enfermedad de Parkinson, se acumulan prote√≠nas mal plegadas (alfa-sinucle√≠na). ¬øQu√© sistema deber√≠a degradarlas normalmente?",
        options: ["El ribosoma.", "El sistema Ubiquitina-Proteasoma.", "El aparato de Golgi.", "La ADN polimerasa."],
        correct: 1,
        explanation: "El fallo en el proteasoma es una causa clave de la muerte neuronal en Parkinson."
    },
    {
        topic: "Mitocondria (Bloque 5)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "El Parkinson est√° muy ligado a fallos mitocondriales. Si la mitocondria falla, ¬øqu√© proceso se detiene?",
        options: ["La gluc√≥lisis.", "La fosforilaci√≥n oxidativa (producci√≥n de ATP).", "La transcripci√≥n.", "La mitosis."],
        correct: 1,
        explanation: "Las neuronas mueren por falta de energ√≠a (ATP) y estr√©s oxidativo."
    },
    {
        topic: "Lisosoma (Bloque 5)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "La autofagia es vital para prevenir el Parkinson. ¬øQu√© org√°nulo realiza la autofagia (digesti√≥n de org√°nulos propios)?",
        options: ["N√∫cleo.", "Ret√≠culo.", "Lisosoma.", "Peroxisoma."],
        correct: 2,
        explanation: "El lisosoma recicla las mitocondrias da√±adas (mitofagia); si falla, la neurona enferma."
    },
    {
        topic: "Diferenciaci√≥n (Bloque 7)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "La Dra. Mu√±oz investiga la diversidad celular. ¬øQu√© define el 'tipo celular' en sus estudios?",
        options: ["El tama√±o.", "El perfil espec√≠fico de expresi√≥n de ARN (firma molecular).", "La cantidad de ADN.", "El color."],
        correct: 1,
        explanation: "La transcript√≥mica clasifica las c√©lulas seg√∫n los genes que tienen activos."
    },
    {
        topic: "C√©lulas Madre (Bloque 7)",
        researcher: "Mu√±oz-Manchado (Reprogramaci√≥n)",
        question: "Su grupo 'NeurOmics' trabaja en reprogramaci√≥n. ¬øQu√© son las c√©lulas iPS que podr√≠an usarse para reparar el cerebro?",
        options: ["C√©lulas madre embrionarias.", "C√©lulas adultas reprogramadas a pluripotencia.", "C√©lulas tumorales.", "Neuronas viejas."],
        correct: 1,
        explanation: "La reprogramaci√≥n convierte c√©lulas de la piel en c√©lulas madre capaces de generar nuevas neuronas."
    },
    {
        topic: "Regulaci√≥n (Bloque 3)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "Para estudiar qu√© genes se expresan, se a√≠slan los ARNm. ¬øQu√© caracter√≠stica del ARNm eucariota permite su purificaci√≥n?",
        options: ["La cola de poli-A.", "El intr√≥n.", "La histona.", "El promotor."],
        correct: 0,
        explanation: "La cola de poli-A es la 'etiqueta' universal de los ARNm que permite separarlos del resto de ARNs."
    },
    {
        topic: "N√∫cleo (Bloque 4)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "Si queremos ver la expresi√≥n g√©nica, debemos mirar dentro del n√∫cleo. ¬øEn qu√© estado est√° la cromatina de los genes activos que ella estudia?",
        options: ["Heterocromatina (condensada).", "Eucromatina (relajada).", "Cromosoma mit√≥tico.", "ADN degradado."],
        correct: 1,
        explanation: "La eucromatina es accesible a la maquinaria de transcripci√≥n y es donde ocurre la expresi√≥n."
    },
    {
        topic: "T√©cnicas (Bloque 1)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "Para estudiar una poblaci√≥n neuronal espec√≠fica (ej. interneuronas 5-HT3a), a menudo se usan ratones transg√©nicos con prote√≠na fluorescente (GFP). ¬øPara qu√© sirve la GFP?",
        options: ["Para matar la c√©lula.", "Para visualizar y separar las c√©lulas vivas espec√≠ficas mediante fluorescencia.", "Para aumentar el ATP.", "Para te√±ir el n√∫cleo."],
        correct: 1,
        explanation: "La GFP act√∫a como un marcador luminoso que permite identificar y aislar (FACS) las c√©lulas de inter√©s."
    },
    {
        topic: "Citoesqueleto (Bloque 5)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "En el Parkinson, el transporte de dopamina falla. ¬øQu√© motores moleculares mueven las ves√≠culas de dopamina hacia la sinapsis?",
        options: ["Dine√≠nas.", "Cinesinas.", "Miosinas.", "Actinas."],
        correct: 1,
        explanation: "Las cinesinas transportan ves√≠culas hacia el extremo (+) del ax√≥n (transporte anter√≥grado)."
    },
    {
        topic: "Apoptosis (Bloque 7)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "Las neuronas dopamin√©rgicas mueren en el Parkinson. ¬øQu√© prote√≠na anti-apopt√≥tica podr√≠a protegerlas si se sobreexpresa?",
        options: ["Bax.", "Bak.", "Bcl2.", "Caspasa."],
        correct: 2,
        explanation: "Bcl2 frena la muerte celular programada; su fallo facilita la neurodegeneraci√≥n."
    },
    {
        topic: "Epigen√©tica (Bloque 3)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "Adem√°s de los genes, ¬øqu√© regula la identidad de las neuronas que estudia?",
        options: ["La temperatura.", "Marcas epigen√©ticas (metilaci√≥n del ADN y de histonas).", "La cantidad de agua.", "Los ribosomas."],
        correct: 1,
        explanation: "El epigenoma estabiliza el perfil de expresi√≥n g√©nica que define a la neurona."
    },
    {
        topic: "Splicing (Bloque 2)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "La diversidad neuronal tambi√©n se genera porque un mismo gen produce varias prote√≠nas. ¬øC√≥mo se llama este proceso?",
        options: ["Transcripci√≥n.", "Splicing Alternativo.", "Traducci√≥n.", "Replicaci√≥n."],
        correct: 1,
        explanation: "El splicing alternativo es clave en el cerebro para generar la enorme diversidad de receptores y canales."
    },
    {
        topic: "ARN no codificante (Bloque 3)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "¬øQu√© mol√©culas peque√±as de ARN podr√≠an estar desreguladas en enfermedades neurodegenerativas y silenciar genes protectores?",
        options: ["ARNm.", "miARN (microARN).", "ARNr.", "ARNt."],
        correct: 1,
        explanation: "Los microARN son reguladores maestros finos de la expresi√≥n g√©nica en el desarrollo y enfermedad."
    },
    {
        topic: "Organismos Modelo (Bloque 1)",
        researcher: "Mu√±oz-Manchado (Transcript√≥mica)",
        question: "Sus estudios suelen usar ratones. ¬øPor qu√© el rat√≥n es un buen modelo para estudiar biolog√≠a celular humana?",
        options: ["Es peque√±o.", "Comparte procesos celulares fundamentales y genes hom√≥logos con los humanos (mam√≠fero).", "No tiene c√©lulas.", "Es procariota."],
        correct: 1,
        explanation: "La conservaci√≥n evolutiva permite extrapolar hallazgos b√°sicos del rat√≥n al humano."
    },
    {
        topic: "Ciclo Celular (Bloque 8)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "¬øQu√© prote√≠na supresora de tumores tambi√©n vigila el estr√©s en las neuronas y puede inducir su muerte si hay da√±o?",
        options: ["p53.", "Ras.", "Actina.", "Col√°geno."],
        correct: 0,
        explanation: "p53 no solo act√∫a en c√°ncer; tambi√©n decide la muerte neuronal ante estr√©s oxidativo o da√±o al ADN."
    },
    {
        topic: "Transmisi√≥n (Bloque 9)",
        researcher: "Mu√±oz-Manchado (Gen√©tica)",
        question: "Algunas formas de Parkinson son hereditarias. Si la mutaci√≥n est√° en el ADN mitocondrial, ¬øqui√©n la transmite?",
        options: ["El padre.", "La madre.", "Ambos.", "Nadie."],
        correct: 1,
        explanation: "Las mitocondrias se heredan exclusivamente por v√≠a materna."
    },
    {
        topic: "C√©lulas Madre (Bloque 7)",
        researcher: "Mu√±oz-Manchado (Neurog√©nesis)",
        question: "¬øD√≥nde existen c√©lulas madre neuronales en el cerebro adulto?",
        options: ["En todo el cerebro.", "En nichos espec√≠ficos (ej. hipocampo, zona subventricular).", "No existen.", "En la meninge."],
        correct: 1,
        explanation: "Aunque escasas, existen c√©lulas madre en nichos concretos capaces de generar nuevas neuronas."
    },
    {
        topic: "Membrana (Bloque 5)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "En la neurodegeneraci√≥n, las membranas se da√±an por oxidaci√≥n. ¬øQu√© componente lip√≠dico regula la fluidez y podr√≠a alterarse?",
        options: ["Colesterol.", "Prote√≠nas.", "ADN.", "Agua."],
        correct: 0,
        explanation: "El colesterol es vital para la estabilidad y fluidez de la membrana neuronal."
    },
    {
        topic: "Se√±alizaci√≥n (Bloque 7)",
        researcher: "Mu√±oz-Manchado (Neurofarmacolog√≠a)",
        question: "El receptor 5-HT3a (serotonina) que menciona su investigaci√≥n es un canal i√≥nico. ¬øQu√© efecto tiene su apertura?",
        options: ["Cambio en la expresi√≥n g√©nica lento.", "Flujo r√°pido de iones y cambio del potencial el√©ctrico.", "S√≠ntesis de l√≠pidos.", "Divisi√≥n celular."],
        correct: 1,
        explanation: "Es un receptor ionotr√≥pico que media transmisi√≥n sin√°ptica r√°pida."
    },
    {
        topic: "Transporte Nuclear (Bloque 4)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "En algunas enfermedades (ELA), las prote√≠nas se acumulan mal en el citoplasma en lugar de ir al n√∫cleo. ¬øQu√© se√±al falla?",
        options: ["NLS (Se√±al de Localizaci√≥n Nuclear).", "Se√±al de mitocondria.", "Se√±al de membrana.", "Se√±al de muerte."],
        correct: 0,
        explanation: "El fallo en el reconocimiento de la NLS o el poro impide que prote√≠nas vitales lleguen al n√∫cleo."
    },
    {
        topic: "Citoesqueleto (Bloque 5)",
        researcher: "Mu√±oz-Manchado (Neurodegeneraci√≥n)",
        question: "¬øQu√© prote√≠na asociada a microt√∫bulos se agrega en ovillos en el Alzheimer y otras tauopat√≠as?",
        options: ["Actina.", "Tau.", "Miosina.", "Queratina."],
        correct: 1,
        explanation: "Tau estabiliza microt√∫bulos; si se hiperfosforila y agrega, el transporte axonal colapsa."
    },
    {
        topic: "Matriz Extracelular (Bloque 6)",
        researcher: "Mu√±oz-Manchado (Neurociencia)",
        question: "En el cerebro no hay col√°geno fibroso como en la piel. ¬øQu√© componente de la matriz es abundante y forma una red alrededor de las neuronas?",
        options: ["Proteoglucanos (redes perineuronales).", "Hueso.", "Grasa.", "Celulosa."],
        correct: 0,
        explanation: "La matriz cerebral es rica en proteoglucanos que regulan la plasticidad sin√°ptica."
    },
    {
        topic: "Resumen Investigaci√≥n",
        researcher: "Ambas (Conclusi√≥n)",
        question: "¬øPor qu√© es crucial la Biolog√≠a Celular para la investigaci√≥n de Llorca y Mu√±oz-Manchado?",
        options: ["Para clasificar plantas.", "Porque las enfermedades (dolor, Parkinson) son fallos en los mecanismos celulares b√°sicos (se√±alizaci√≥n, expresi√≥n, transporte).", "Para estudiar f√≥siles.", "No es importante."],
        correct: 1,
        explanation: "Su trabajo demuestra el lema del curso: 'La medicina (y la cura) comienza en la c√©lula'."
    }
];

// Estado global
let activeData = [];      // Array de objetos (referencias)
let activeQueue = [];     // Array de √≠ndices sobre activeData que vamos a jugar
let queueIndex = 0;       // Puntero en la cola actual
let currentScore = 0;
let answered = false;

// Inicializaci√≥n
originalQuizData.forEach((q, index) => {
    q.id = index;
    q.userMarked = false; // Estado persistente de marcado
    q.userCorrect = null; // null: no respondida, true: correcta, false: incorrecta
});

document.addEventListener('DOMContentLoaded', () => {
    startQuiz('full');
});

function startQuiz(mode) {
    // 1. Configurar la cola de preguntas seg√∫n el modo
    activeQueue = [];
    currentScore = 0;
    queueIndex = 0;

    if (mode === 'full') {
        // Reset completo de respuestas (mantenemos marcas? No, reset total suele ser mejor)
        originalQuizData.forEach(q => {
            q.userCorrect = null;
            q.userMarked = false; // Reset marcas tambi√©n en full reset
        });
        activeQueue = originalQuizData.map((_, i) => i);
    } 
    else if (mode === 'failed') {
        // Solo las que userCorrect === false
        activeQueue = originalQuizData
            .map((q, i) => q.userCorrect === false ? i : -1)
            .filter(i => i !== -1);
    } 
    else if (mode === 'marked') {
        // Solo las que userMarked === true
        activeQueue = originalQuizData
            .map((q, i) => q.userMarked === true ? i : -1)
            .filter(i => i !== -1);
    } 
    else if (mode === 'mixed') {
        // Union de falladas OR marcadas
        activeQueue = originalQuizData
            .map((q, i) => (q.userMarked === true || q.userCorrect === false) ? i : -1)
            .filter(i => i !== -1);
    }

    // 2. Comprobar si hay preguntas
    if (activeQueue.length === 0) {
        alert("No hay preguntas seleccionadas para este modo.");
        return;
    }

    // 3. UI Reset
    document.getElementById('results-screen').style.display = 'none';
    document.getElementById('statusBar').style.display = 'flex';
    document.getElementById('quiz-container').style.display = 'block';
    
    loadQuestion();
}

function loadQuestion() {
    const container = document.getElementById('quiz-container');
    
    // Obtener el √≠ndice real en originalQuizData
    const realIndex = activeQueue[queueIndex];
    const q = originalQuizData[realIndex];
    
    // UI Updates
    document.getElementById('q-progress').innerText = `Pregunta ${queueIndex + 1} de ${activeQueue.length}`;
    document.getElementById('score-display').innerText = `Aciertos en esta sesi√≥n: ${currentScore}`;
    
    // Researcher badge style
    let badgeClass = q.researcher.includes("Llorca") ? "tag-llorca" : "tag-munoz";
    if (q.researcher.includes("Ambas")) badgeClass = "tag-llorca";

    let html = `
        <div class="question-card active">
            
            <label class="bookmark-panel" onclick="toggleMark(${realIndex}, this)">
                <input type="checkbox" class="bookmark-checkbox" ${q.userMarked ? 'checked' : ''}>
                <span>Marcar para revisar</span>
            </label>

            <span class="researcher-tag ${badgeClass}">${q.researcher}</span>
            <div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 5px;">${q.topic}</div>
            <div class="question-text">${q.question}</div>
            <div class="options-list">
                ${q.options.map((opt, i) => `
                    <button class="option-btn" onclick="checkAnswer(${i}, ${q.correct}, this, ${realIndex})">
                        ${String.fromCharCode(65+i)}. ${opt}
                    </button>
                `).join('')}
            </div>
            <div class="feedback-area" id="feedback"></div>
            <button class="nav-btn" id="next-btn" onclick="nextQuestion()">Siguiente</button>
        </div>
    `;
    
    container.innerHTML = html;
    answered = false;
}

function toggleMark(realIndex, labelEl) {
    // Evitar que el click en el label dispare eventos extra√±os, gestionamos estado manual
    // Nota: El input checkbox cambia solo, pero necesitamos actualizar los datos
    setTimeout(() => {
        const checkbox = labelEl.querySelector('input');
        originalQuizData[realIndex].userMarked = checkbox.checked;
    }, 10);
}

function checkAnswer(selected, correct, btn, realIndex) {
    if(answered) return;
    answered = true;

    const allBtns = document.querySelectorAll('.option-btn');
    const feedback = document.getElementById('feedback');
    const nextBtn = document.getElementById('next-btn');

    allBtns.forEach(b => b.disabled = true);

    const qData = originalQuizData[realIndex];

    if(selected === correct) {
        currentScore++;
        qData.userCorrect = true; // Guardar estado
        btn.classList.add('correct');
        feedback.innerHTML = `<strong style="color:var(--success)">¬°Correcto!</strong> <div class="rationale">${qData.explanation}</div>`;
    } else {
        qData.userCorrect = false; // Guardar estado
        btn.classList.add('incorrect');
        allBtns[correct].classList.add('correct');
        feedback.innerHTML = `<strong style="color:var(--error)">Conexi√≥n Investigadora:</strong> <div class="rationale">${qData.explanation}</div>`;
    }

    feedback.classList.add('show');
    nextBtn.style.display = 'block';
    
    document.getElementById('score-display').innerText = `Aciertos en esta sesi√≥n: ${currentScore}`;
}

function nextQuestion() {
    if(queueIndex < activeQueue.length - 1) {
        queueIndex++;
        loadQuestion();
    } else {
        showResults();
    }
}

function showResults() {
    document.getElementById('statusBar').style.display = 'none';
    document.getElementById('quiz-container').style.display = 'none';
    document.getElementById('results-screen').style.display = 'block';
    
    document.getElementById('final-number').innerText = `${currentScore} / ${activeQueue.length}`;
    
    // Calcular estad√≠sticas globales para habilitar botones
    const totalFailed = originalQuizData.filter(q => q.userCorrect === false).length;
    const totalMarked = originalQuizData.filter(q => q.userMarked === true).length;
    const totalMixed = originalQuizData.filter(q => q.userMarked === true || q.userCorrect === false).length;

    document.getElementById('stats-summary').innerHTML = `
        <strong>Resumen Global:</strong><br>
        Preguntas falladas totales: ${totalFailed}<br>
        Preguntas marcadas para revisar: ${totalMarked}
    `;

    // Mensaje de √°nimo
    const percent = (currentScore / activeQueue.length) * 100;
    let msg = "";
    if(activeQueue.length > 0) {
        if(percent >= 90) msg = "¬°Excelente! Dominio total.";
        else if(percent >= 70) msg = "¬°Muy bien! Conceptos claros.";
        else if(percent >= 50) msg = "Bien, pero repasa los fallos.";
        else msg = "Sigue practicando.";
    }
    document.getElementById('final-text').innerText = msg;

    // Habilitar/Deshabilitar botones seg√∫n disponibilidad
    document.getElementById('btn-failed').disabled = (totalFailed === 0);
    document.getElementById('btn-marked').disabled = (totalMarked === 0);
    document.getElementById('btn-mixed').disabled = (totalMixed === 0);
}
</script>

</body>
</html>
