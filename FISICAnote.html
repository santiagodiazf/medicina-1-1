<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Completo de Biofísica (160 Preguntas)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; color: #333; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; }
        
        /* Stats Header */
        .stats { 
            text-align: center; margin-bottom: 20px; font-weight: bold; color: #555; 
            background: #eef; padding: 15px; border-radius: 8px; 
            position: sticky; top: 0; z-index: 100; border-bottom: 2px solid #dde;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .question-block { border-bottom: 1px solid #eee; padding: 25px 0; position: relative; }
        
        /* Estilo del botón de Marcar */
        .bookmark {
            position: absolute;
            top: 20px;
            right: 10px;
            font-size: 1.8em;
            cursor: pointer;
            color: #ddd; /* Color inactivo */
            transition: color 0.2s, transform 0.2s;
            user-select: none;
        }
        .bookmark:hover { transform: scale(1.2); }
        .bookmark.active { color: #f39c12; } /* Color activo (dorado) */
        
        .question-text { font-size: 1.15em; margin-bottom: 15px; font-weight: 600; padding-right: 40px; }
        .options { list-style: none; padding: 0; }
        .option { background: #f9f9f9; border: 1px solid #ddd; padding: 12px 15px; margin-bottom: 8px; border-radius: 5px; cursor: pointer; transition: background 0.2s; }
        .option:hover { background: #eef; }
        .option.correct { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .option.incorrect { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .option.disabled { pointer-events: none; opacity: 0.8; }
        .explanation { margin-top: 15px; padding: 15px; background-color: #e2e3e5; border-radius: 5px; font-size: 0.95em; display: none; }
        
        /* Botones finales */
        .controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 30px; }
        button { border: none; padding: 12px 20px; font-size: 1em; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        button:disabled { background-color: #ccc !important; cursor: not-allowed; opacity: 0.5; }

        .btn-wrong { background-color: #e74c3c; }
        .btn-marked { background-color: #f39c12; }
        .btn-marked-wrong { background-color: #d35400; }
        .btn-reset { background-color: #3498db; }

        .hidden { display: none; }
        #final-score { text-align: center; font-size: 1.5em; margin: 20px 0; font-weight: bold; padding: 20px; background: #f8f9fa; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Quiz Completo de Biofísica</h1>
    <div class="stats">
        Preguntas: <span id="total-count">0</span> | Aciertos: <span id="score">0</span> | Fallos: <span id="wrong">0</span> | Restantes: <span id="remaining">0</span>
    </div>

    <div id="quiz-container">
        </div>

    <div id="final-section" class="hidden">
        <div id="final-score"></div>
        <div class="controls">
            <button onclick="restartQuiz('wrong')" id="btn-retry-wrong" class="btn-wrong">Repetir Falladas</button>
            <button onclick="restartQuiz('marked')" id="btn-retry-marked" class="btn-marked">Repetir Marcadas</button>
            <button onclick="restartQuiz('marked_wrong')" id="btn-retry-marked-wrong" class="btn-marked-wrong">Repetir Marcadas y Falladas</button>
            <button onclick="restartQuiz('all')" class="btn-reset">Reiniciar Todo</button>
        </div>
    </div>
</div>

<script>
    // --- BASE DE DATOS DE PREGUNTAS (160) ---
    const allQuestions = [
        // --- BLOQUE ORIGINAL (1-100) ---
        { q: "¿Qué ocurre con el potencial de membrana (Vm) cuando una célula excitable recibe un estímulo pequeño?", opts: ["Se produce un potencial de acción inmediatamente.", "El Vm se altera de forma proporcional al estímulo y vuelve a su valor inicial.", "La célula muere por exceso de carga.", "No ocurre ningún cambio detectable."], a: 1, exp: "Estímulo subumbral genera un potencial electrotónico graduado, no un potencial de acción." },
        { q: "Un potencial generador se diferencia de un potencial de acción en que:", opts: ["Se propaga a larga distancia.", "Su amplitud es fija y no depende del estímulo.", "No se propaga a lo largo de la fibra nerviosa (es local).", "Cambia el signo del interior de la célula permanentemente."], a: 2, exp: "Es una señal local que disminuye con la distancia y es graduada." },
        { q: "El valor umbral (Em) es necesario para:", opts: ["Detener la bomba de sodio-potasio.", "Iniciar un potencial de acción.", "Mantener el estado de reposo.", "Abrir las sinapsis de forma irreversible."], a: 1, exp: "Es el voltaje crítico para abrir los canales de Na+ dependientes de voltaje masivamente." },
        { q: "En un receptor fásico, el potencial generador:", opts: ["Se mantiene mientras dura el estímulo.", "Aparece con el estímulo pero desaparece aunque este permanezca (adaptación rápida).", "Solo aparece cuando el estímulo es de dolor.", "Es una señal modulada únicamente en frecuencia."], a: 1, exp: "Los receptores fásicos se adaptan rápidamente y solo responden a cambios." },
        { q: "¿Qué tipo de modulación utiliza el potencial de acción según la amplitud del potencial generador?", opts: ["Modulación en amplitud.", "Modulación en fase.", "Modulación en frecuencia.", "No utiliza ninguna modulación."], a: 2, exp: "Mayor estímulo = mayor frecuencia de disparo de potenciales de acción." },
        { q: "La sinapsis se define funcionalmente como:", opts: ["Un cable continuo entre neuronas.", "Un interruptor que permite o no el paso de la señal.", "Una zona de vacío absoluto.", "El núcleo de la neurona."], a: 1, exp: "Actúa como un punto de decisión o control de flujo de información." },
        { q: "¿Cuál es la función principal de la electromiografía (EMG)?", opts: ["Registrar la actividad eléctrica de los músculos.", "Medir el campo magnético del corazón.", "Analizar las fases del sueño profundo.", "Detectar tumores cerebrales mediante luz."], a: 0, exp: "Registra los potenciales de acción de las unidades motoras musculares." },
        { q: "El sueño REM se caracteriza por:", opts: ["Ondas de muy baja frecuencia.", "Ausencia total de actividad cerebral.", "Actividad onírica y ondas de alta frecuencia (similares a la vigilia).", "Un descenso drástico de la frecuencia cardíaca."], a: 2, exp: "Es sueño paradójico: cuerpo paralizado pero cerebro muy activo." },
        { q: "¿Qué magnitud tienen los campos magnéticos producidos por el cuerpo humano?", opts: ["Mega Teslas (MT).", "Nano Teslas (nT) a Femto Teslas (fT).", "Gauss (G) únicamente.", "No producen campos magnéticos."], a: 1, exp: "Son extremadamente débiles (ej. cerebro ~fT, corazón ~pT)." },
        { q: "El magnetómetro SQUID basa su funcionamiento en:", opts: ["El efecto fotoeléctrico.", "Fenómenos cuánticos de la superconductividad.", "La ley de Snell.", "La desintegración beta."], a: 1, exp: "Dispositivo Superconductor de Interferencia Cuántica." },
        { q: "El ruido magnético ambiental es causado principalmente por:", opts: ["El movimiento de los músculos del paciente.", "Redes eléctricas y campos magnéticos urbanos.", "La respiración del feto.", "El uso de rayos X cercanos."], a: 1, exp: "Líneas de alta tensión, coches, etc., generan ruido mucho mayor que la señal biológica." },
        { q: "¿Cuál es el origen del campo magnético terrestre (valor aproximado)?", opts: ["10^-15 T.", "5·10^-5 T (50 µT).", "100 T.", "7·10^-11 T."], a: 1, exp: "Es aprox 50 microteslas, mucho mayor que los campos biomagnéticos." },
        { q: "El objetivo de la ergonomía en biomecánica es:", opts: ["Aumentar el peso de los objetos.", "Diseñar tareas para realizarlas sin riesgo de lesiones.", "Estudiar fluidos en reposo.", "Medir la radiactividad de los huesos."], a: 1, exp: "Adaptar el trabajo a la persona." },
        { q: "Un cuerpo está en equilibrio mientras:", opts: ["Su masa sea superior a 100 kg.", "La vertical del centro de gravedad caiga sobre la base de sustentación.", "Se encuentre en movimiento acelerado.", "Esté apoyado en un solo punto fuera de su eje."], a: 1, exp: "Condición básica de estabilidad estática." },
        { q: "¿Qué sucede con la estabilidad al separar los pies?", opts: ["Disminuye siempre.", "Aumenta al ampliar la base de sustentación.", "No afecta al equilibrio.", "Elimina la fuerza de la gravedad."], a: 1, exp: "Mayor base de sustentación = mayor estabilidad." },
        { q: "La deformación elástica es aquella que:", opts: ["Es irreversible.", "Permite al material recuperar su forma inicial al eliminar la fuerza.", "Conduce siempre a la rotura.", "Solo ocurre en metales como el acero."], a: 1, exp: "Es reversible." },
        { q: "Los elastómeros son materiales que:", opts: ["Cumplen estrictamente la Ley de Hooke.", "Son deformaciones plásticas permanentes.", "No cumplen la Ley de Hooke (comportamiento no lineal).", "No se pueden deformar."], a: 2, exp: "Su curva tensión-deformación no es recta." },
        { q: "El Módulo de Young del hueso se estima en:", opts: ["1.500 Kp/mm².", "1.800-2.800 Kp/mm² (aprox 18-28 GPa).", "24.200 Kp/mm².", "12.000 Kp/mm²."], a: 1, exp: "Es rígido pero menos que el acero." },
        { q: "En la deformación por compresión, si la fuerza es excesiva en columnas largas, ocurre:", opts: ["Tracción pura.", "Pandeo (inestabilidad lateral).", "Resonancia magnética.", "Ionización."], a: 1, exp: "Fallo estructural por flexión lateral bajo carga axial." },
        { q: "¿De qué depende el Módulo de Young (E)?", opts: ["De la longitud del objeto.", "Solo de la naturaleza del material.", "De la cantidad de fuerza aplicada.", "Del área de la sección transversal."], a: 1, exp: "Es una propiedad intrínseca del material." },
        { q: "¿Qué ocurre si los músculos abductores se paralizan al estar apoyado en un solo pie?", opts: ["La fuerza de contacto se verticaliza y la cadera cae (Trendelenburg).", "El centro de gravedad sube automáticamente.", "El peso del cuerpo disminuye.", "No hay cambios en la dirección de las fuerzas."], a: 0, exp: "Se pierde el mecanismo de palanca para equilibrar la pelvis." },
        { q: "El sistema circulatorio se rige por principios de:", opts: ["Óptica geométrica.", "Hidrostática e hidrodinámica.", "Física nuclear únicamente.", "Termodinámica de gases ideales."], a: 1, exp: "Fluidos en reposo y movimiento." },
        { q: "La ecuación de continuidad (A1·v1 = A2·v2) implica que:", opts: ["El caudal es constante en un circuito cerrado.", "La velocidad es mayor donde el área es mayor.", "La densidad del fluido cambia constantemente.", "El fluido debe ser viscoso."], a: 0, exp: "Conservación de la masa en flujo." },
        { q: "El teorema de Bernoulli describe el comportamiento de:", opts: ["Fluidos muy viscosos.", "Un fluido ideal (no viscoso) en una línea de corriente.", "Sólidos elásticos.", "Gases en expansión libre."], a: 1, exp: "Conservación de energía en fluidos ideales." },
        { q: "Según la Ley de Poiseuille, si el radio de una arteriola aumenta un 10%:", opts: ["El flujo disminuye.", "El flujo aumenta significativamente (aprox 46%).", "La resistencia vascular aumenta.", "La viscosidad de la sangre se duplica."], a: 1, exp: "El flujo depende de r a la cuarta potencia." },
        { q: "¿Cómo responde el cuerpo cuando una región necesita más riego sanguíneo?", opts: ["Disminuyendo el diámetro de las arteriolas.", "Aumentando el diámetro de las arteriolas (vasodilatación).", "Deteniendo el corazón.", "Aumentando la viscosidad de la sangre."], a: 1, exp: "Reduce la resistencia local." },
        { q: "En ejercicio intenso, la potencia realizada por el corazón puede aumentar hasta:", opts: ["2 veces.", "7,5 veces.", "50 veces.", "No varía."], a: 1, exp: "Para suplir la demanda metabólica." },
        { q: "¿Qué sucede con el trabajo del corazón en personas hipertensas?", opts: ["Disminuye porque la presión es baja.", "Es grande debido a la alta postcarga.", "Se mantiene igual que en una persona sana.", "Se anula durante la sístole."], a: 1, exp: "El corazón debe vencer mayor resistencia." },
        { q: "La unidad de viscosidad en el Sistema Internacional es:", opts: ["Poise (p).", "Pascal por segundo (Pa·s).", "Newton por metro.", "mmHg."], a: 1, exp: "Pa·s es la unidad SI." },
        { q: "Un caudal (Q) de 1 m³/s equivale a:", opts: ["1 L/min.", "60,000 L/min.", "1.000 cm³/s.", "760 torr."], a: 1, exp: "1 m³ = 1000 L; 1s = 1/60 min." },
        { q: "Las ondas sonoras se definen como:", opts: ["Ondas electromagnéticas transversales.", "Ondas mecánicas longitudinales.", "Partículas alfa en movimiento.", "Flujo de electrones en el aire."], a: 1, exp: "Necesitan medio y vibran en la dirección de propagación." },
        { q: "El rango de frecuencias audibles para el ser humano es aproximadamente:", opts: ["0 a 10 Hz.", "20 Hz a 20.000 Hz.", "1 MHz a 10 MHz.", "100.000 Hz en adelante."], a: 1, exp: "Espectro audible estándar." },
        { q: "La intensidad mínima audible (umbral) a 1000 Hz es:", opts: ["1 W/m².", "10^-12 W/m².", "120 dB.", "20 Pa."], a: 1, exp: "0 decibelios." },
        { q: "La Ley de Weber-Fechner establece que el sistema auditivo responde de forma:", opts: ["Lineal.", "Exponencial.", "Logarítmica.", "Cuadrática."], a: 2, exp: "Percibimos el volumen en escala logarítmica." },
        { q: "¿Qué ocurre con el nivel de intensidad (dB) si la intensidad física (I) se duplica?", opts: ["Se duplica el número de decibelios.", "Aumenta en aproximadamente 3 dB.", "No cambia.", "Baja a la mitad."], a: 1, exp: "10·log(2) ≈ 3." },
        { q: "La impedancia acústica (z) se calcula como:", opts: ["z = densidad · velocidad (ρ·c).", "z=P/I.", "z=λ⋅f.", "z=m⋅a."], a: 0, exp: "Resistencia del medio al sonido." },
        { q: "La sensación de 'grave' o 'agudo' está relacionada físicamente con:", opts: ["La amplitud.", "La forma de la onda (timbre).", "La frecuencia (tono).", "La impedancia del medio."], a: 2, exp: "Frecuencia = Tono." },
        { q: "La unidad que mide la sensación sonora (nivel de sonoridad) es el:", opts: ["Decibelio (dB).", "Fono.", "Sone.", "Mel."], a: 1, exp: "Ajusta los dB a la sensibilidad del oído humano." },
        { q: "¿Qué frecuencia tiene el conducto auditivo externo como resonancia fundamental?", opts: ["100 Hz.", "3.000 - 4.000 Hz.", "20.000 Hz.", "1.000 Hz."], a: 1, exp: "Amplifica las frecuencias del habla." },
        { q: "La misión principal de la cadena de huesecillos en el oído medio es:", opts: ["Producir cera.", "Acoplar impedancias (aire-líquido) amplificando la presión.", "Analizar las frecuencias del sonido.", "Proteger el cerebro del ruido."], a: 1, exp: "Sin ellos, el sonido rebotaría en la cóclea." },
        { q: "En medios disipativos, la intensidad de la onda disminuye según:", opts: ["Una línea recta.", "Una función exponencial.", "No disminuye nunca.", "Aumenta con la distancia."], a: 1, exp: "Ley de atenuación." },
        { q: "El timbre de un sonido permite distinguir:", opts: ["Un sonido fuerte de uno débil.", "Un sonido grave de uno agudo.", "Fuentes distintas con misma frecuencia e intensidad.", "El nivel de decibelios exacto."], a: 2, exp: "Depende de los armónicos." },
        { q: "El modelo atómico de Bohr postula que los electrones:", opts: ["Están quietos en el núcleo.", "Giran en órbitas definidas y emiten radiación al saltar.", "Son partículas masivas sin carga.", "No tienen energía."], a: 1, exp: "Cuantización de la energía orbital." },
        { q: "El defecto de masa en un núcleo se manifiesta como:", opts: ["Calor externo.", "Energía de enlace nuclear.", "Pérdida de electrones.", "Aumento de volumen."], a: 1, exp: "E=mc² que mantiene unido el núcleo." },
        { q: "La dualidad onda-corpúsculo indica que:", opts: ["Las ondas solo son ondas.", "Las partículas pueden comportarse como ondas y viceversa.", "La luz no tiene energía.", "El sonido es una radiación ionizante."], a: 1, exp: "Hipótesis de De Broglie." },
        { q: "¿Cuál de estas radiaciones tiene la menor longitud de onda?", opts: ["Microondas.", "Luz visible.", "Rayos Gamma.", "Ondas de radio."], a: 2, exp: "Menor longitud = Mayor frecuencia y energía." },
        { q: "¿Quién descubrió los Rayos X en 1895?", opts: ["Marie Curie.", "Wilhelm Conrad Röntgen.", "Henri Becquerel.", "Ernest Rutherford."], a: 1, exp: "Descubrimiento accidental con tubos de Crookes." },
        { q: "La capacidad de los Rayos X para penetrar la materia es mayor si:", opts: ["La densidad de la materia es alta.", "El número atómico (Z) del material es bajo.", "La longitud de onda es muy larga.", "El material es plomo grueso."], a: 1, exp: "Materiales ligeros absorben menos rayos X." },
        { q: "En la desintegración gamma (γ):", opts: ["Se emite un núcleo de Helio.", "El núcleo se desexcita emitiendo un fotón sin cambiar Z ni A.", "El número atómico (Z) aumenta en 1.", "El átomo se convierte en otro elemento químico."], a: 1, exp: "Es radiación electromagnética nuclear." },
        { q: "El periodo de semidesintegración (T1/2) es el tiempo necesario para que:", opts: ["Desaparezca todo el material radiactivo.", "La actividad se reduzca a la mitad.", "El electrón complete una órbita.", "Se duplique la masa del núcleo."], a: 1, exp: "Propiedad estadística del isótopo." },
        { q: "¿Qué unidad del SI mide la actividad radiactiva?", opts: ["Curio (Ci).", "Bequerelio (Bq).", "Gray (Gy).", "Sievert (Sv)."], a: 1, exp: "1 Bq = 1 desintegración/segundo." },
        { q: "La captura electrónica se caracteriza por la emisión de:", opts: ["Un positrón.", "Un rayo X característico.", "Una partícula alfa.", "Un neutrón."], a: 1, exp: "Reordenamiento de la corteza electrónica tras capturar un e-." },
        { q: "¿Cuál es la actividad de 1 gramo de Radio-226?", opts: ["1 Bq.", "1 Curio (Ci).", "1 Gray.", "37 Bequerelios."], a: 1, exp: "Definición original del Curio." },
        { q: "La tomografía por emisión de positrones (PET) utiliza radionúclidos que:", opts: ["Se producen en reactores nucleares gigantes.", "Son emisores de positrones de vida corta (ej. F-18).", "Emiten partículas alfa únicamente.", "Son estables para siempre."], a: 1, exp: "Se producen en ciclotrones cercanos." },
        { q: "La PET proporciona principalmente información sobre:", opts: ["Estructura anatómica de alta resolución.", "Actividad metabólica y funcional.", "El color de los órganos.", "La densidad ósea."], a: 1, exp: "Imagen funcional." },
        { q: "Un estudio de PET-TC combina:", opts: ["Sonido y luz.", "Metabolismo (PET) y Anatomía (TC).", "Rayos X y microondas.", "Magnetismo y calor."], a: 1, exp: "Fusión de imágenes." },
        { q: "La dosis absorbida mide:", opts: ["El daño biológico.", "La energía depositada por unidad de masa (J/kg).", "El número de desintegraciones por segundo.", "La carga eléctrica en el aire."], a: 1, exp: "Se mide en Grays." },
        { q: "La unidad antigua de dosis absorbida es el:", opts: ["Gray.", "rad.", "rem.", "Roentgen."], a: 1, exp: "1 Gy = 100 rads." },
        { q: "El factor ponderante (wR) para fotones (rayos X y gamma) es:", opts: ["1.", "5.", "20.", "100."], a: 0, exp: "Referencia base wR=1." },
        { q: "La dosis equivalente (HT) se mide en:", opts: ["Grays.", "Sieverts (Sv).", "Curies.", "Coulombs/kg."], a: 1, exp: "Considera el tipo de radiación." },
        { q: "¿Cuál es el factor ponderante para partículas alfa?", opts: ["1.", "10.", "20.", "0,5."], a: 2, exp: "Son altamente ionizantes y dañinas." },
        { q: "La dosis efectiva (E) tiene en cuenta:", opts: ["Solo el tipo de radiación.", "Radiación y sensibilidad de los tejidos (wT).", "Solo el tiempo de exposición.", "La distancia a la fuente únicamente."], a: 1, exp: "Riesgo global para el cuerpo." },
        { q: "En radiobiología, el 'efecto indirecto' de la radiación se debe a:", opts: ["Impacto directo en el ADN.", "Radiólisis del agua y radicales libres.", "El calentamiento global.", "La rotura de los huesos."], a: 1, exp: "Es el mecanismo predominante en rayos X y gamma." },
        { q: "Un dosímetro de termoluminiscencia (TLD) funciona mediante:", opts: ["Descarga de un condensador.", "Emisión de luz al calentar un cristal irradiado.", "Ennegrecimiento de una película.", "Registro de sonido."], a: 1, exp: "Materiales como LiF." },
        { q: "Los trabajadores expuestos de Categoría A son aquellos que pueden recibir:", opts: ["Más de 6 mSv al año.", "Solo radiación natural.", "Menos de 1 mSv al año.", "Radiación solo en los pies."], a: 0, exp: "Límite superior de clasificación." },
        { q: "¿Qué dosímetro permite una lectura directa e inmediata?", opts: ["Fotográfico.", "TLD.", "Dosímetro de pluma/electrónico.", "Ninguno."], a: 2, exp: "Para control en tiempo real." },
        { q: "Las radiaciones ópticas incluyen:", opts: ["Ondas de radio y microondas.", "Infrarrojo, luz visible y ultravioleta.", "Rayos X y Gamma.", "Campos magnéticos estáticos."], a: 1, exp: "Espectro óptico." },
        { q: "La radiación ultravioleta tipo C (UVC) es:", opts: ["Inofensiva para la piel.", "Germicida y bloqueada por la atmósfera.", "La que llega mayoritariamente a la Tierra.", "Visible para el ojo humano."], a: 1, exp: "Muy energética, usada en lámparas germicidas." },
        { q: "¿Qué aplicación médica tienen los campos magnéticos estáticos (0 Hz)?", opts: ["Radioterapia.", "Resonancia Magnética (campo principal).", "Termoterapia.", "Esterilización de material."], a: 1, exp: "Alineación de espines nucleares." },
        { q: "Las microondas pueden afectar órganos internos en el rango de longitud de onda de:", opts: ["Menos de 3 cm.", "25 cm a 200 cm (aprox).", "Más de 200 cm.", "No afectan nunca."], a: 1, exp: "Penetración suficiente para calentar tejidos profundos." },
        { q: "El láser se caracteriza por emitir luz:", opts: ["De todos los colores.", "Monocromática, coherente y direccional.", "Divergente.", "No ionizante siempre (incluso UV)."], a: 1, exp: "Propiedades clave del láser." },
        { q: "Los infrarrojos se utilizan en fisioterapia para:", opts: ["Ionizar los tejidos.", "Termoterapia superficial.", "Ver a través de los huesos.", "Enfriar zonas inflamadas."], a: 1, exp: "Calentamiento." },
        { q: "La radiación UVB ayuda a metabolizar:", opts: ["El hierro.", "La vitamina D.", "El calcio directamente.", "Los carbohidratos."], a: 1, exp: "Síntesis cutánea." },
        { q: "Las radiaciones ELF (frecuencia extremadamente baja) son usadas para:", opts: ["Comunicación con submarinos.", "Gammagrafías óseas.", "Hacer radiografías dentales.", "Calentar comida."], a: 0, exp: "Ondas kilométricas." },
        { q: "¿Qué ocurre si una persona se sitúa bajo una antena cuya longitud de onda es el doble de su altura?", opts: ["No ocurre nada.", "Resonancia y máxima absorción.", "La persona se vuelve invisible.", "La antena deja de funcionar."], a: 1, exp: "El cuerpo actúa como antena dipolo." },
        { q: "La Ley de Jurin relaciona la altura de ascenso capilar con:", opts: ["El color del líquido.", "La tensión interfacial y el radio del tubo.", "La presión atmosférica únicamente.", "La cantidad de nitrógeno."], a: 1, exp: "Fenómeno de capilaridad." },
        { q: "Un menisco es cóncavo (agua en vidrio) cuando:", opts: ["Fuerzas de adhesión > Fuerzas de cohesión.", "Fuerzas de cohesión > adhesión.", "El tubo es muy ancho.", "El líquido es mercurio."], a: 0, exp: "El líquido moja el recipiente." },
        { q: "La compliancia pulmonar es una medida de:", opts: ["La rigidez del pulmón.", "Distensibilidad (ΔV/ΔP).", "La velocidad de la sangre.", "El número de alvéolos."], a: 1, exp: "Facilidad de llenado." },
        { q: "Una compliancia muy alta se observa en:", opts: ["Fibrosis pulmonar.", "Enfisema (pérdida de elasticidad de retracción).", "Edema agudo.", "Ausencia de surfactante."], a: 1, exp: "Pulmón 'fofo', fácil de llenar pero difícil de vaciar." },
        { q: "La elastancia es el recíproco de:", opts: ["La presión.", "La compliancia.", "El volumen.", "La viscosidad."], a: 1, exp: "Resistencia a la deformación." },
        { q: "La Ley de Graham en la hematosis indica que la velocidad de difusión es:", opts: ["Proporcional a la masa molar.", "Inversamente proporcional a la raíz cuadrada de la masa molar.", "Igual para todos los gases.", "Dependiente solo del color."], a: 1, exp: "Gases ligeros difunden más rápido." },
        { q: "El cociente respiratorio (CR) se define como:", opts: ["VO2 / VCO2.", "VCO2 producido / VO2 consumido.", "Masa / Volumen.", "Presión / Temperatura."], a: 1, exp: "Ratio de intercambio gaseoso." },
        { q: "En condiciones de reposo, el valor típico del CR es:", opts: ["0,2.", "0,8.", "1,5.", "5,0."], a: 1, exp: "Dieta mixta." },
        { q: "Un valor de SpO2 inferior al 95% indica:", opts: ["Salud perfecta.", "Hipoxia (baja saturación).", "Que la persona está a nivel del mar.", "Exceso de hemoglobina."], a: 1, exp: "Saturación normal 95-100%." },
        { q: "El volumen corriente (VC) en una espirometría normal es de:", opts: ["100 mL.", "500 mL.", "3.000 mL.", "1.200 mL."], a: 1, exp: "Respiración tidal." },
        { q: "¿Qué volumen pulmonar NO se puede medir directamente con un espirómetro?", opts: ["Volumen Corriente.", "Volumen Residual (VR).", "Volumen de Reserva Inspiratoria.", "Capacidad Vital."], a: 1, exp: "Es el aire que nunca sale." },
        { q: "La capacidad pulmonar total (CPT) es la suma de:", opts: ["Solo el aire que entra y sale.", "Los 4 volúmenes primarios (VC+VRI+VRE+VR).", "El aire de la tráquea.", "El peso de los pulmones."], a: 1, exp: "Todo el aire que cabe en el pulmón." },
        { q: "La formación de imágenes en el ojo ocurre en:", opts: ["El cristalino.", "La retina.", "El nervio óptico.", "La pupila."], a: 1, exp: "Pantalla biológica." },
        { q: "La Ley de Snell describe:", opts: ["La reflexión total.", "La refracción de la luz entre medios.", "El brillo.", "La presión del ojo."], a: 1, exp: "Cambio de dirección por cambio de índice de refracción." },
        { q: "La potencia del ojo varía para enfocar mediante:", opts: ["El cambio de color.", "La acomodación del cristalino.", "El parpadeo.", "El movimiento retinal."], a: 1, exp: "Cambio de curvatura de la lente." },
        { q: "La presbicia se debe a:", opts: ["Ojo largo.", "Pérdida de elasticidad del cristalino (edad).", "Exceso de bastones.", "Opacidad."], a: 1, exp: "Vista cansada." },
        { q: "Los fotorreceptores para visión en color son:", opts: ["Bastones.", "Conos.", "Ganglionares.", "Melanocitos."], a: 1, exp: "Fotópicos." },
        { q: "¿Cuántos tipos de conos existen?", opts: ["Uno.", "Dos.", "Tres (R, G, B).", "Millones."], a: 2, exp: "Tricromacia." },
        { q: "La visión escotópica se produce en:", opts: ["Mucha luz.", "Baja iluminación (noche, bastones).", "La fovea.", "Al sol."], a: 1, exp: "Visión nocturna." },
        { q: "El sistema RGB utiliza:", opts: ["Amarillo, Cian, Magenta.", "Rojo, Verde, Azul.", "Blanco, Negro.", "UV, IR."], a: 1, exp: "Colores luz primarios." },
        { q: "Un dioptrio convergente tiene potencia:", opts: ["Cero.", "Positiva (+).", "Negativa (-).", "Infinita."], a: 1, exp: "Lentes convexas." },
        { q: "El punto remoto para un ojo emétrope está en:", opts: ["25 cm.", "El infinito.", "1 metro.", "La nariz."], a: 1, exp: "Visión lejana relajada." },
        { q: "Las lentes bifocales corrigen:", opts: ["Solo miopía.", "Presbicia combinada con ametropía.", "Daltonismo.", "Ceguera."], a: 1, exp: "Lejos y cerca." },
        { q: "¿Qué receptores son más numerosos en la retina?", opts: ["Conos.", "Bastones.", "Nervios.", "Iguales."], a: 1, exp: "Aprox 120 millones de bastones vs 6 millones de conos." },
        { q: "El color es:", opts: ["Propiedad física pura.", "Sensación psicológica (psicofísica).", "Longitud de onda sola.", "Ilusión."], a: 1, exp: "Interpretación cerebral." },
        
        // --- BLOQUE 2 (101-160) ---
        { q: "¿Qué es un modelo atómico?", opts: ["Una realidad física inalterable.", "Una representación gráfica para entender el átomo.", "Un tipo de radiación.", "Una partícula."], a: 1, exp: "Herramienta teórica explicativa." },
        { q: "¿Cuál de estas partículas es un leptón según el modelo estándar?", opts: ["Fotón.", "Gluon.", "Neutrino electrónico.", "Bosón de Higgs."], a: 2, exp: "Familia del electrón." },
        { q: "Los núcleos que tienen el mismo número másico (A) se denominan:", opts: ["Isótopos.", "Isótonos.", "Isóbaros.", "Isómeros."], a: 2, exp: "Igual masa, diferente elemento." },
        { q: "¿Qué define a los isómeros nucleares?", opts: ["Mismo Z, N y A, pero distinto estado energético.", "Distinto Z.", "Distinto A.", "Diferente posición."], a: 0, exp: "Estado metaestable (ej. Tc-99m)." },
        { q: "El número atómico (Z) determina:", opts: ["La masa.", "Las propiedades químicas del átomo.", "Neutrones.", "Excitación."], a: 1, exp: "Define el elemento." },
        { q: "¿Cuál de las siguientes se clasifica comúnmente como radiación NO ionizante en protección radiológica?", opts: ["Rayos X.", "Microondas.", "Partículas alfa.", "Gamma."], a: 1, exp: "Baja energía (radio, microondas, óptica)." },
        { q: "El efecto de 'excitación' en el átomo consiste en:", opts: ["Ionizar.", "El paso de un electrón a un nivel superior sin salir.", "Fisión.", "Emisión positrón."], a: 1, exp: "Salto cuántico sin pérdida de electrón." },
        { q: "¿Qué ocurre en una colisión inelástica de partículas cargadas?", opts: ["Se conserva energía cinética.", "Nada.", "Se conserva el momento, pero la energía cinética se transforma.", "Desaparece el electrón."], a: 2, exp: "Conversión a energía interna o radiación." },
        { q: "El espesor de semirreducción (CHR) es:", opts: ["Energía de ionización.", "Espesor para reducir la intensidad a la mitad.", "Probabilidad de atenuación.", "Alcance alfa."], a: 1, exp: "Half Value Layer." },
        { q: "¿Cuál es la fórmula para calcular la CHR?", opts: ["CHR = 0,693 / μ.", "CHR = ln(2) · μ.", "CHR = I0 / 2.", "CHR = e^-μx."], a: 0, exp: "Relación inversa con el coeficiente de atenuación." },
        { q: "¿Qué radiación tiene mayor capacidad de penetración?", opts: ["Alfa.", "Beta.", "Gamma.", "Protones."], a: 2, exp: "Fotones de alta energía sin carga." },
        { q: "La radiación ultravioleta tipo UV-C se clasifica habitualmente en el espectro de:", opts: ["No ionizante (óptica).", "Ionizante dura.", "Visible.", "Infrarroja."], a: 0, exp: "Aunque peligrosa, se engloba en radiación óptica." },
        { q: "¿Dónde se producen los rayos gamma?", opts: ["Corteza.", "En el núcleo (desexcitación).", "Tubos de vacío.", "Aceleradores."], a: 1, exp: "Origen nuclear." },
        { q: "En la emisión alfa (α), el núcleo hijo tiene:", opts: ["Z-1.", "Z-2 y A-4.", "Z+1.", "Igual Z."], a: 1, exp: "Pierde 2 protones y 2 neutrones." },
        { q: "¿Qué partícula se emite junto al electrón en la desintegración beta negativa?", opts: ["Neutrino.", "Antineutrino.", "Fotón.", "Positrón."], a: 1, exp: "Conservación número leptónico." },
        { q: "La captura electrónica produce la emisión de:", opts: ["Rayos X característicos.", "Alfa.", "Neutrón.", "Protón."], a: 0, exp: "Al llenar la vacante electrónica." },
        { q: "¿Qué técnica combina información metabólica y anatómica?", opts: ["Gammagrafía.", "PET-TC.", "RM.", "Ecografía."], a: 1, exp: "Fusión estructural y funcional." },
        { q: "En Medicina Nuclear, el periodo efectivo (Teff) siempre es:", opts: ["Mayor que el físico.", "Menor que el físico y el biológico.", "Igual al biológico.", "Infinito."], a: 1, exp: "Suma de tasas de eliminación." },
        { q: "La dosis absorbida se mide en el Sistema Internacional en:", opts: ["Sv.", "Grays (Gy).", "Bq.", "Ci."], a: 1, exp: "J/kg." },
        { q: "La dosis equivalente evalúa:", opts: ["Solo energía.", "El daño biológico según tipo de radiación.", "Riesgo a largo plazo.", "Actividad."], a: 1, exp: "Dosis absorbida x factor de peso (wR)." },
        { q: "El factor ponderante (wR) para las partículas alfa es:", opts: ["1.", "5.", "20.", "100."], a: 2, exp: "Alto daño biológico." },
        { q: "¿Qué células son muy radiorresistentes?", opts: ["Musculares y nerviosas (diferenciadas).", "Médula ósea.", "Espermatogonias.", "Endoteliales."], a: 0, exp: "Baja tasa de división." },
        { q: "Un dosímetro de pluma es de:", opts: ["Termoluminiscencia.", "Ionización gaseosa (cámara).", "Película.", "Centelleo."], a: 1, exp: "Condensador cargado." },
        { q: "¿Cuál es una ventaja de los dosímetros de pluma?", opts: ["Precisos.", "Lectura directa inmediata.", "No se descargan.", "Baratos."], a: 1, exp: "Permite ver la dosis al momento." },
        { q: "En los dosímetros fotográficos, el ennegrecimiento depende de:", opts: ["Filtro.", "Energía y dosis (tiempo).", "Temperatura.", "Humedad."], a: 1, exp: "Proporcional a la exposición." },
        { q: "El filtro de cadmio en un dosímetro se usa para detectar:", opts: ["Gamma.", "Electrones.", "Neutrones.", "Rayos X."], a: 2, exp: "Alta sección eficaz de captura." },
        { q: "La técnica radiográfica que usa colorante en arterias se llama:", opts: ["Mamografía.", "Angiografía.", "Tomografía.", "Ortopantomografía."], a: 1, exp: "Visualización vascular." },
        { q: "¿Cuál es el objetivo principal de la radioprotección?", opts: ["Eliminar radiación.", "Evitar efectos deterministas y limitar estocásticos.", "Aumentar dosis.", "No usar rayos X."], a: 1, exp: "Principio ALARA." },
        { q: "La radiosensibilidad es:", opts: ["Emitir radiación.", "Susceptibilidad al daño por radiación.", "Energía.", "Vida media."], a: 1, exp: "Ley de Bergonie y Tribondeau." },
        { q: "¿Qué radionúclido se usa típicamente para emisiones gamma en diagnóstico?", opts: ["Radio.", "Fósforo.", "Tecnecio-99m.", "Yodo alfa."], a: 2, exp: "Ideal para gammacámaras." },
        { q: "La biomecánica aplica los principios de la mecánica a:", opts: ["Máquinas.", "El organismo vivo.", "Fluidos perfectos.", "Arquitectura."], a: 1, exp: "Estudio mecánico biológico." },
        { q: "¿Qué parte de la mecánica estudia las fuerzas en cuerpos en equilibrio?", opts: ["Cinemática.", "Dinámica.", "Estática.", "Cinética."], a: 2, exp: "Suma de fuerzas = 0." },
        { q: "La fuerza normal es siempre:", opts: ["Paralela.", "Perpendicular a la superficie.", "Igual al peso.", "Fricción."], a: 1, exp: "Reacción de contacto." },
        { q: "El líquido sinovial en las articulaciones sirve para:", opts: ["Aumentar roce.", "Reducir la fricción (lubricar).", "Endurecer.", "Potenciales."], a: 1, exp: "Lubricante natural." },
        { q: "La Ley de Hooke establece una proporcionalidad entre:", opts: ["Masa-aceleración.", "Fuerza y deformación.", "Velocidad-presión.", "Viscosidad."], a: 1, exp: "Zona elástica lineal." },
        { q: "Los materiales elásticos que NO cumplen la Ley de Hooke se llaman:", opts: ["Isótropos.", "Elastómeros.", "Cristales.", "Metales."], a: 1, exp: "Comportamiento no lineal (ej. goma)." },
        { q: "El Módulo de Young (E) depende de:", opts: ["Forma.", "La naturaleza del material.", "Fuerza.", "Longitud."], a: 1, exp: "Propiedad intensiva." },
        { q: "En la deformación por flexión, la fibra que no sufre tensión se llama:", opts: ["Activa.", "Fibra neutra.", "Eje tracción.", "Crítico."], a: 1, exp: "Centro de giro de la flexión." },
        { q: "Para que el momento de inercia (I) sea grande en una viga, el material debe estar:", opts: ["Centro.", "Alejado de la fibra neutra.", "Eje óptico.", "Aleatorio."], a: 1, exp: "Resistencia a la flexión." },
        { q: "Los huesos largos son huecos porque esto permite:", opts: ["Menor resistencia.", "Optimizar resistencia/peso.", "Sangre.", "Snell."], a: 1, exp: "Eficacia mecánica." },
        { q: "El componente del hueso que aporta flexibilidad y resistencia a roturas es:", opts: ["Apatito.", "Colágeno.", "Calcio.", "Plomo."], a: 1, exp: "Matriz orgánica." },
        { q: "La sangre se comporta físicamente como:", opts: ["Sólido.", "Un fluido.", "Gas ideal.", "Plasma estático."], a: 1, exp: "Fluido complejo." },
        { q: "La hidrodinámica estudia:", opts: ["Reposo.", "Fluidos en movimiento.", "Sólidos.", "Ojo."], a: 1, exp: "Dinámica de fluidos." },
        { q: "La ecuación de continuidad establece la constancia del:", opts: ["Peso.", "Caudal.", "Volumen.", "Radio."], a: 1, exp: "Q = A·v = cte." },
        { q: "Según el teorema de Bernoulli, si la velocidad de un fluido disminuye:", opts: ["Presión baja.", "La presión aumenta.", "Energía pierde.", "Viscosidad."], a: 1, exp: "Intercambio energía cinética-presión." },
        { q: "La unidad de viscosidad en el sistema cegesimal es el:", opts: ["Pascal.", "Poise.", "Newton.", "Rayl."], a: 1, exp: "1 Poise = 0.1 Pa·s." },
        { q: "Si la tensión superficial (T) es constante, la presión en una burbuja es:", opts: ["Proporcional radio.", "Inversamente proporcional al radio.", "Independiente.", "Cero."], a: 1, exp: "Ley de Laplace." },
        { q: "La Ley de Laplace para una esfera se expresa como:", opts: ["P=2T/r.", "F=-kx.", "V=Av.", "P=gh."], a: 0, exp: "Relación Presión-Tensión-Radio." },
        { q: "La compliancia o distensibilidad es la medida de:", opts: ["Rigidez.", "Facilidad de deformación bajo fuerza/presión.", "Retorno.", "Viscosidad."], a: 1, exp: "Inverso de rigidez." },
        { q: "La elastancia es el recíproco de:", opts: ["Resistencia.", "La compliancia.", "Tensión.", "Radio."], a: 1, exp: "E = 1/C." },
        { q: "La histéresis pulmonar se observa al comparar:", opts: ["Brazo.", "Curvas de inflación y deflación.", "Sangre-aire.", "Radio-diámetro."], a: 1, exp: "Diferente camino de carga/descarga." },
        { q: "En una superficie hidrófoba, el líquido:", opts: ["Moja.", "NO moja al sólido.", "Ángulo 0.", "Evapora."], a: 1, exp: "Repelencia al agua." },
        { q: "Si el ángulo de contacto (θ) es mayor de 90°, la humectancia es:", opts: ["Alta.", "Baja.", "Perfecta.", "Infinita."], a: 1, exp: "No moja." },
        { q: "Las fuerzas de cohesión ocurren entre:", opts: ["Distintas.", "Moléculas de la misma naturaleza.", "Sólido-gas.", "Cristalino."], a: 1, exp: "Unión interna." },
        { q: "¿Qué fenómeno permite que los alvéolos pequeños no colapsen en los grandes?", opts: ["Gravedad.", "El surfactante (altera T sup).", "Presión atm.", "Fibra."], a: 1, exp: "Iguala presiones." },
        { q: "Un fluido es una sustancia que:", opts: ["Sin masa.", "Se deforma continuamente bajo esfuerzo cortante.", "Recupera forma.", "Vacío."], a: 1, exp: "No resiste cizalla estática." },
        { q: "La unidad de presión en el SI es el:", opts: ["mmHg.", "Pascal (Pa).", "Torr.", "Atm."], a: 1, exp: "N/m²." },
        { q: "¿Cuál es la equivalencia de 1 atmósfera en Pascales?", opts: ["10^5 Pa (aprox).", "760.", "1.", "10."], a: 0, exp: "101325 Pa." },
        { q: "El pandeo es un fenómeno que hace fallar a:", opts: ["Líquidos.", "Columnas bajo compresión.", "Lentes.", "Transductores."], a: 1, exp: "Inestabilidad elástica." },
        { q: "La tensión interfacial (TLS) se da en la separación entre:", opts: ["Sólidos.", "Líquido y sólido (o fases inmiscibles).", "Gases.", "Protones."], a: 1, exp: "Interfase." }
    ];

    // Variables de estado
    let currentQuestions = [];
    
    // Sets para guardar los índices ORIGINALES
    let wrongIndices = new Set();
    let markedIndices = new Set();
    
    let score = 0;
    let wrongCount = 0;

    function initQuiz(questions) {
        const container = document.getElementById('quiz-container');
        container.innerHTML = '';
        currentQuestions = questions;
        
        // Reset stats visuales para la sesión actual
        document.getElementById('total-count').textContent = questions.length;
        document.getElementById('remaining').textContent = questions.length;
        document.getElementById('score').textContent = 0;
        document.getElementById('wrong').textContent = 0;
        
        // Si es una carga completa (reinicio total), reseteamos contadores globales
        if(questions === allQuestions) {
            score = 0;
            wrongCount = 0;
            wrongIndices.clear();
            markedIndices.clear();
        } else {
            // Si es un "retry", reseteamos contadores visuales para esta sesión solamente
            score = 0;
            wrongCount = 0;
        }

        // Renderizado
        questions.forEach((item, index) => {
            const qBlock = document.createElement('div');
            qBlock.className = 'question-block';
            qBlock.id = `q-${index}`;

            // Determinar el índice original para verificar si está marcado
            const realIndex = allQuestions.indexOf(item);

            // Botón de Marcado
            const bookmarkBtn = document.createElement('div');
            bookmarkBtn.className = 'bookmark';
            bookmarkBtn.innerHTML = '&#9733;'; // Estrella
            if (markedIndices.has(realIndex)) {
                bookmarkBtn.classList.add('active');
            }
            bookmarkBtn.onclick = (e) => toggleMark(realIndex, bookmarkBtn, e);
            qBlock.appendChild(bookmarkBtn);

            const qTitle = document.createElement('div');
            qTitle.className = 'question-text';
            qTitle.textContent = `${index + 1}. ${item.q}`;
            qBlock.appendChild(qTitle);

            const optList = document.createElement('ul');
            optList.className = 'options';

            item.opts.forEach((opt, i) => {
                const li = document.createElement('li');
                li.className = 'option';
                li.textContent = opt;
                li.onclick = () => checkAnswer(li, item, i, qBlock);
                optList.appendChild(li);
            });
            qBlock.appendChild(optList);

            const expDiv = document.createElement('div');
            expDiv.className = 'explanation';
            expDiv.innerHTML = `<strong>Respuesta correcta:</strong> ${item.opts[item.a]}<br><em>${item.exp}</em>`;
            qBlock.appendChild(expDiv);

            container.appendChild(qBlock);
        });

        document.getElementById('final-section').classList.add('hidden');
    }

    function toggleMark(realIndex, btn, e) {
        e.stopPropagation(); // Evitar otros clics
        if (markedIndices.has(realIndex)) {
            markedIndices.delete(realIndex);
            btn.classList.remove('active');
        } else {
            markedIndices.add(realIndex);
            btn.classList.add('active');
        }
    }

    function checkAnswer(selectedLi, questionObj, selectedIndex, block) {
        if (block.classList.contains('answered')) return;
        block.classList.add('answered');

        const realIndex = allQuestions.indexOf(questionObj);
        const options = block.querySelectorAll('.option');
        options.forEach(opt => opt.classList.add('disabled'));

        const explanation = block.querySelector('.explanation');
        explanation.style.display = 'block';

        if (selectedIndex === questionObj.a) {
            selectedLi.classList.add('correct');
            score++;
            // Si acierta, nos aseguramos que no esté en la lista de fallos para el futuro
            if (wrongIndices.has(realIndex)) {
               wrongIndices.delete(realIndex); 
            }
        } else {
            selectedLi.classList.add('incorrect');
            options[questionObj.a].classList.add('correct');
            wrongIndices.add(realIndex);
            wrongCount++;
        }
        
        updateStats();
        checkCompletion();
    }

    function updateStats() {
        document.getElementById('score').textContent = score;
        document.getElementById('wrong').textContent = wrongCount;
        const total = document.querySelectorAll('.question-block').length;
        const answered = document.querySelectorAll('.question-block.answered').length;
        document.getElementById('remaining').textContent = total - answered;
    }

    function checkCompletion() {
        const total = document.querySelectorAll('.question-block').length;
        const answered = document.querySelectorAll('.question-block.answered').length;
        
        if (total === answered) {
            document.getElementById('final-section').classList.remove('hidden');
            document.getElementById('final-score').textContent = `Test finalizado. Puntuación: ${score} / ${total}`;
            
            // Habilitar/Deshabilitar botones según disponibilidad
            const markedAndWrongCount = Array.from(wrongIndices).filter(i => markedIndices.has(i)).length;

            document.getElementById('btn-retry-wrong').disabled = (wrongIndices.size === 0);
            document.getElementById('btn-retry-marked').disabled = (markedIndices.size === 0);
            document.getElementById('btn-retry-marked-wrong').disabled = (markedAndWrongCount === 0);
            
            // Textos dinámicos en botones
            document.getElementById('btn-retry-wrong').textContent = `Repetir Falladas (${wrongIndices.size})`;
            document.getElementById('btn-retry-marked').textContent = `Repetir Marcadas (${markedIndices.size})`;
            document.getElementById('btn-retry-marked-wrong').textContent = `Repetir Marcadas y Falladas (${markedAndWrongCount})`;
        }
    }

    function restartQuiz(mode) {
        let indicesToLoad = [];
        
        // Ordenamos los índices para mantener el orden original del examen
        const sortedWrong = Array.from(wrongIndices).sort((a, b) => a - b);
        const sortedMarked = Array.from(markedIndices).sort((a, b) => a - b);

        if (mode === 'all') {
            indicesToLoad = allQuestions.map((_, i) => i); // Todos los índices
        } else if (mode === 'wrong') {
            indicesToLoad = sortedWrong;
            // Opcional: limpiar wrongIndices para re-evaluar, o mantenerlos.
            // Aquí los limpiamos para una nueva "ronda" de práctica sobre estos errores.
            wrongIndices.clear(); 
        } else if (mode === 'marked') {
            indicesToLoad = sortedMarked;
            wrongIndices.clear(); // Limpiamos fallos para re-evaluar
        } else if (mode === 'marked_wrong') {
            // Intersección: Marcadas Y Falladas
            indicesToLoad = sortedWrong.filter(index => markedIndices.has(index));
            wrongIndices.clear();
        }

        if (indicesToLoad.length === 0) {
            alert("No hay preguntas en esta categoría.");
            return;
        }

        const questionsToLoad = indicesToLoad.map(index => allQuestions[index]);
        initQuiz(questionsToLoad);
        window.scrollTo(0, 0);
    }

    // Iniciar con todas las preguntas
    initQuiz(allQuestions);
</script>

</body>
</html>
